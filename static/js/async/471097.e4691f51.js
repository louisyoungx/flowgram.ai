/*! For license information please see 471097.e4691f51.js.LICENSE.txt */
(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["471097"],{636345:function(e,t,r){"use strict";e=r.nmd(e);let a=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,i=(e=0)=>(t,r,a)=>`\u001B[${38+e};2;${t};${r};${a}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,a]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,i]of Object.entries(a))t[r]={open:`\u001B[${i[0]}m`,close:`\u001B[${i[1]}m`},a[r]=t[r],e.set(i[0],i[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=a(),t.color.ansi16m=i(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=i(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},392279:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],a=t[1];return(r+a)*3/4-a},t.toByteArray=function(e){var t,r,n=l(e),s=n[0],o=n[1],u=new i((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,a=e.length,i=a%3,n=[],s=0,o=a-i;s<o;s+=16383)n.push(function(e,t,a){for(var i,n=[],s=t;s<a;s+=3)i=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),n.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return n.join("")}(e,s,s+16383>o?o:s+16383));return 1===i?n.push(r[(t=e[a-1])>>2]+r[t<<4&63]+"=="):2===i&&n.push(r[(t=(e[a-2]<<8)+e[a-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),n.join("")};for(var r=[],a=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=n.length;s<o;++s)r[s]=n[s],a[n.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var a=r===t?0:4-r%4;return[r,a]}a[45]=62,a[95]=63},89151:function(e){"use strict";let t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,a=/^[\p{Lu}](?![\p{Lu}])/gu,i=/([\p{Alpha}\p{N}_]|$)/u,n=/[_.\- ]+/,s=RegExp("^"+n.source),o=RegExp(n.source+i.source,"gu"),l=RegExp("\\d+"+i.source,"gu"),u=(e,i)=>{var n,u;if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(i={pascalCase:!1,preserveConsecutiveUppercase:!1,...i},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let c=!1===i.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(i.locale),d=!1===i.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(i.locale);return 1===e.length?i.pascalCase?d(e):c(e):((e!==c(e)&&(e=((e,a,i)=>{let n=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];n&&t.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),n=!1,o=s,s=!0,l++):s&&o&&r.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,n=!0):(n=a(u)===u&&i(u)!==u,o=s,s=i(u)===u&&a(u)!==u)}return e})(e,c,d)),e=e.replace(s,""),i.preserveConsecutiveUppercase)?(n=e,a.lastIndex=0,e=n.replace(a,e=>c(e))):e=c(e),i.pascalCase&&(e=d(e.charAt(0))+e.slice(1)),u=e,o.lastIndex=0,l.lastIndex=0,u.replace(o,(e,t)=>d(t)).replace(l,e=>d(e)))};e.exports=u,e.exports.default=u},822227:function(e){"use strict";e.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},504303:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function a(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,a,n,s){if("function"!=typeof a)throw TypeError("The listener must be a function");var o=new i(a,n||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function o(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(r=!1)),o.prototype.eventNames=function(){var e,a,i=[];if(0===this._eventsCount)return i;for(a in e=this._events)t.call(e,a)&&i.push(r?a.slice(1):a);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=r?r+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var i=0,n=a.length,s=Array(n);i<n;i++)s[i]=a[i].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,a=this._events[t];return a?a.fn?1:a.length:0},o.prototype.emit=function(e,t,a,i,n,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,a),!0;case 4:return c.fn.call(c.context,t,a,i),!0;case 5:return c.fn.call(c.context,t,a,i,n),!0;case 6:return c.fn.call(c.context,t,a,i,n,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,a);break;case 4:c[u].fn.call(c[u].context,t,a,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,a,i){var n=r?r+e:e;if(!this._events[n])return this;if(!t)return s(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||i&&!o.once||a&&o.context!==a||s(this,n);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||a&&o[l].context!==a)&&u.push(o[l]);u.length?this._events[n]=1===u.length?u[0]:u:s(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new a,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},772610:function(e){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},350709:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(504303),i=r(388763),n=r(85771),s=()=>{},o=new i.TimeoutError;t.default=class extends a{constructor(e){var t,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:n.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!=(r=null==(t=e.intervalCap)?void 0:t.toString())?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!=(i=null==(a=e.interval)?void 0:a.toString())?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let n=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)});r(await n)}catch(e){a(e)}this._next()};this._queue.enqueue(n,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},991847:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let a=0,i=e.length;for(;i>0;){let n=i/2|0,s=a+n;0>=r(e[s],t)?(a=++s,i-=n+1):i=n}return a}},85771:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(991847);t.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);let i=a.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(i,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},750980:function(e,t,r){"use strict";let a=r(92701),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t)=>new Promise((r,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};let o=a.operation(t);o.attempt(async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error))return void s(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof n)o.stop(),s(e.originalError);else{let r;if(e instanceof TypeError&&(r=e.message,!i.includes(r)))o.stop(),s(e);else{((e,t,r)=>{let a=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=a})(e,a,t);try{await t.onFailedAttempt(e)}catch(e){s(e);return}o.retry(e)||s(o.mainError())}}}})});e.exports=s,e.exports.default=s,e.exports.AbortError=n},388763:function(e,t,r){"use strict";let a=r(772610);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}let n=(e,t,r)=>new Promise((n,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void n(e);let o=setTimeout(()=>{if("function"==typeof r){try{n(r())}catch(e){s(e)}return}let a="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new i(a);"function"==typeof e.cancel&&e.cancel(),s(o)},t);a(e.then(n,s),()=>{clearTimeout(o)})});e.exports=n,e.exports.default=n,e.exports.TimeoutError=i},92701:function(e,t,r){e.exports=r(311997)},311997:function(e,t,r){var a=r(969165);t.operation=function(e){return new a(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<t.retries;i++)a.push(this.createTimeout(i,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(i,t)),a.sort(function(e,t){return e-t}),a},t.createTimeout=function(e,t){var r=Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var i in a=[],e)"function"==typeof e[i]&&a.push(i);for(var n=0;n<a.length;n++){var s=a[n],o=e[s];e[s]=(function(a){var i=t.operation(r),n=Array.prototype.slice.call(arguments,1),s=n.pop();n.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){a.apply(e,n)})}).bind(e,o),e[s].options=r}}},969165:function(e){function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var i=this._errors[a],n=i.message,s=(e[n]||0)+1;e[n]=s,s>=r&&(t=i,r=s)}return t}},173311:function(e,t,r){"use strict";let a=Symbol("SemVer ANY");class i{static get ANY(){return a}constructor(e,t){if(t=n(t),e instanceof i)if(!!t.loose===e.loose)return e;else e=e.value;u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===a?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=a}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===a||e===a)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=n(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=i;let n=r(203279),{safeRe:s,t:o}=r(78359),l=r(837142),u=r(802739),c=r(158818),d=r(703836)},703836:function(e,t,r){"use strict";let a=/\s+/g;class i{constructor(e,t){if(t=s(t),e instanceof i)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else return new i(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(a," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&_(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&m)|(this.options.loose&&g))+":"+e,r=n.get(t);if(r)return r;let a=this.options.loose,i=a?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];l("hyphen replace",e=e.replace(i,P(this.options.includePrerelease))),l("comparator trim",e=e.replace(c[d.COMPARATORTRIM],h)),l("tilde trim",e=e.replace(c[d.TILDETRIM],p)),l("caret trim",e=e.replace(c[d.CARETTRIM],f));let s=e.split(" ").map(e=>w(e,this.options)).join(" ").split(/\s+/).map(e=>I(e,this.options));a&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(c[d.COMPARATORLOOSE])))),l("range list",s);let u=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let _=[...u.values()];return n.set(t,_),_}intersects(e,t){if(!(e instanceof i))throw TypeError("a Range is required");return this.set.some(r=>b(r,t)&&e.set.some(e=>b(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(T(this.set[t],e,this.options))return!0;return!1}}e.exports=i;let n=new(r(399191)),s=r(203279),o=r(173311),l=r(802739),u=r(158818),{safeRe:c,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:f}=r(78359),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:g}=r(200378),y=e=>"<0.0.0-0"===e.value,_=e=>""===e.value,b=(e,t)=>{let r=!0,a=e.slice(),i=a.pop();for(;r&&a.length;)r=a.every(e=>i.intersects(e,t)),i=a.pop();return r},w=(e,t)=>(l("comp",e,t),l("caret",e=x(e,t)),l("tildes",e=O(e,t)),l("xrange",e=$(e,t)),l("stars",e=A(e,t)),e),v=e=>!e||"x"===e.toLowerCase()||"*"===e,O=(e,t)=>e.trim().split(/\s+/).map(e=>E(e,t)).join(" "),E=(e,t)=>{let r=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(r,(t,r,a,i,n)=>{let s;return l("tilde",e,t,r,a,i,n),v(r)?s="":v(a)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:v(i)?s=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:n?(l("replaceTilde pr",n),s=`>=${r}.${a}.${i}-${n} <${r}.${+a+1}.0-0`):s=`>=${r}.${a}.${i} <${r}.${+a+1}.0-0`,l("tilde return",s),s})},x=(e,t)=>e.trim().split(/\s+/).map(e=>S(e,t)).join(" "),S=(e,t)=>{l("caret",e,t);let r=t.loose?c[d.CARETLOOSE]:c[d.CARET],a=t.includePrerelease?"-0":"";return e.replace(r,(t,r,i,n,s)=>{let o;return l("caret",e,t,r,i,n,s),v(r)?o="":v(i)?o=`>=${r}.0.0${a} <${+r+1}.0.0-0`:v(n)?o="0"===r?`>=${r}.${i}.0${a} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${a} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===i?`>=${r}.${i}.${n}-${s} <${r}.${i}.${+n+1}-0`:`>=${r}.${i}.${n}-${s} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${n}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===i?`>=${r}.${i}.${n}${a} <${r}.${i}.${+n+1}-0`:`>=${r}.${i}.${n}${a} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${n} <${+r+1}.0.0-0`),l("caret return",o),o})},$=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>k(e,t)).join(" ")),k=(e,t)=>{e=e.trim();let r=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(r,(r,a,i,n,s,o)=>{l("xRange",e,r,a,i,n,s,o);let u=v(i),c=u||v(n),d=c||v(s);return"="===a&&d&&(a=""),o=t.includePrerelease?"-0":"",u?r=">"===a||"<"===a?"<0.0.0-0":"*":a&&d?(c&&(n=0),s=0,">"===a?(a=">=",c?(i=+i+1,n=0):n=+n+1,s=0):"<="===a&&(a="<",c?i=+i+1:n=+n+1),"<"===a&&(o="-0"),r=`${a+i}.${n}.${s}${o}`):c?r=`>=${i}.0.0${o} <${+i+1}.0.0-0`:d&&(r=`>=${i}.${n}.0${o} <${i}.${+n+1}.0-0`),l("xRange return",r),r})},A=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),I=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),P=e=>(t,r,a,i,n,s,o,l,u,c,d,h)=>(r=v(a)?"":v(i)?`>=${a}.0.0${e?"-0":""}`:v(n)?`>=${a}.${i}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,l=v(u)?"":v(c)?`<${+u+1}.0.0-0`:v(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`,`${r} ${l}`.trim()),T=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let a=e[r].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}},158818:function(e,t,r){"use strict";let a=r(802739),{MAX_LENGTH:i,MAX_SAFE_INTEGER:n}=r(200378),{safeRe:s,t:o}=r(78359),l=r(203279),{compareIdentifiers:u}=r(685889);class c{constructor(e,t){if(t=l(t),e instanceof c)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else e=e.version;else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw TypeError(`version is longer than ${i} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>n||this.major<0)throw TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<n)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],i=e.prerelease[t];if(a("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return -1;else if(r===i)continue;else return u(r,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let r=this.build[t],i=e.build[t];if(a("build compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return -1;else if(r===i)continue;else return u(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?s[o.PRERELEASELOOSE]:s[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=+!!Number(r);if(0===this.prerelease.length)this.prerelease=[e];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let a=[t,e];!1===r&&(a=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=c},24693:function(e,t,r){"use strict";let a=r(427340);e.exports=(e,t)=>{let r=a(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},837142:function(e,t,r){"use strict";let a=r(474899),i=r(990482),n=r(308222),s=r(312281),o=r(952894),l=r(355886);e.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return a(e,r,u);case"!=":return i(e,r,u);case">":return n(e,r,u);case">=":return s(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw TypeError(`Invalid operator: ${t}`)}}},967355:function(e,t,r){"use strict";let a=r(158818),i=r(427340),{safeRe:n,t:s}=r(78359);e.exports=(e,t)=>{if(e instanceof a)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let a,i=t.includePrerelease?n[s.COERCERTLFULL]:n[s.COERCERTL];for(;(a=i.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&a.index+a[0].length===r.index+r[0].length||(r=a),i.lastIndex=a.index+a[1].length+a[2].length;i.lastIndex=-1}else r=e.match(t.includePrerelease?n[s.COERCEFULL]:n[s.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return i(`${o}.${l}.${u}${c}${d}`,t)}},8855:function(e,t,r){"use strict";let a=r(158818);e.exports=(e,t,r)=>{let i=new a(e,r),n=new a(t,r);return i.compare(n)||i.compareBuild(n)}},889789:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t)=>a(e,t,!0)},658697:function(e,t,r){"use strict";let a=r(158818);e.exports=(e,t,r)=>new a(e,r).compare(new a(t,r))},167814:function(e,t,r){"use strict";let a=r(427340);e.exports=(e,t)=>{let r=a(e,null,!0),i=a(t,null,!0),n=r.compare(i);if(0===n)return null;let s=n>0,o=s?r:i,l=s?i:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let c=u?"pre":"";return r.major!==i.major?c+"major":r.minor!==i.minor?c+"minor":r.patch!==i.patch?c+"patch":"prerelease"}},474899:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t,r)=>0===a(e,t,r)},308222:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t,r)=>a(e,t,r)>0},312281:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t,r)=>a(e,t,r)>=0},74315:function(e,t,r){"use strict";let a=r(158818);e.exports=(e,t,r,i,n)=>{"string"==typeof r&&(n=i,i=r,r=void 0);try{return new a(e instanceof a?e.version:e,r).inc(t,i,n).version}catch(e){return null}}},952894:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t,r)=>0>a(e,t,r)},355886:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t,r)=>0>=a(e,t,r)},238056:function(e,t,r){"use strict";let a=r(158818);e.exports=(e,t)=>new a(e,t).major},893496:function(e,t,r){"use strict";let a=r(158818);e.exports=(e,t)=>new a(e,t).minor},990482:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t,r)=>0!==a(e,t,r)},427340:function(e,t,r){"use strict";let a=r(158818);e.exports=(e,t,r=!1)=>{if(e instanceof a)return e;try{return new a(e,t)}catch(e){if(!r)return null;throw e}}},906005:function(e,t,r){"use strict";let a=r(158818);e.exports=(e,t)=>new a(e,t).patch},174313:function(e,t,r){"use strict";let a=r(427340);e.exports=(e,t)=>{let r=a(e,t);return r&&r.prerelease.length?r.prerelease:null}},696365:function(e,t,r){"use strict";let a=r(658697);e.exports=(e,t,r)=>a(t,e,r)},36490:function(e,t,r){"use strict";let a=r(8855);e.exports=(e,t)=>e.sort((e,r)=>a(r,e,t))},162848:function(e,t,r){"use strict";let a=r(703836);e.exports=(e,t,r)=>{try{t=new a(t,r)}catch(e){return!1}return t.test(e)}},334466:function(e,t,r){"use strict";let a=r(8855);e.exports=(e,t)=>e.sort((e,r)=>a(e,r,t))},629131:function(e,t,r){"use strict";let a=r(427340);e.exports=(e,t)=>{let r=a(e,t);return r?r.version:null}},578493:function(e,t,r){"use strict";let a=r(78359),i=r(200378),n=r(158818),s=r(685889),o=r(427340),l=r(629131),u=r(24693),c=r(74315),d=r(167814),h=r(238056),p=r(893496),f=r(906005),m=r(174313),g=r(658697),y=r(696365),_=r(889789),b=r(8855),w=r(334466),v=r(36490),O=r(308222),E=r(952894),x=r(474899),S=r(990482),$=r(312281),k=r(355886),A=r(837142),I=r(967355),P=r(173311),T=r(703836),j=r(162848),R=r(504128),N=r(955666),C=r(161653),L=r(779495),M=r(77944),U=r(595186),z=r(641315),D=r(647442),B=r(339753);e.exports={parse:o,valid:l,clean:u,inc:c,diff:d,major:h,minor:p,patch:f,prerelease:m,compare:g,rcompare:y,compareLoose:_,compareBuild:b,sort:w,rsort:v,gt:O,lt:E,eq:x,neq:S,gte:$,lte:k,cmp:A,coerce:I,Comparator:P,Range:T,satisfies:j,toComparators:R,maxSatisfying:N,minSatisfying:C,minVersion:L,validRange:M,outside:U,gtr:z,ltr:D,intersects:B,simplifyRange:r(526296),subset:r(869096),SemVer:n,re:a.re,src:a.src,tokens:a.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},200378:function(e){"use strict";e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},802739:function(e){"use strict";e.exports="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}},685889:function(e){"use strict";let t=/^[0-9]+$/,r=(e,r)=>{let a=t.test(e),i=t.test(r);return a&&i&&(e*=1,r*=1),e===r?0:a&&!i?-1:i&&!a?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},399191:function(e){"use strict";e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},203279:function(e){"use strict";let t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},78359:function(e,t,r){"use strict";let{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:n}=r(200378),s=r(802739),o=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],c=t.safeSrc=[],d=t.t={},h=0,p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",n],[p,i]],m=(e,t,r)=>{let a=(e=>{for(let[t,r]of f)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),i=h++;s(e,i,t),d[e]=i,u[i]=t,c[i]=a,o[i]=new RegExp(t,r?"g":void 0),l[i]=new RegExp(a,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),m("FULL",`^${u[d.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),m("LOOSE",`^${u[d.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),m("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),m("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?`+`(?:${u[d.BUILD]})?`+"(?:$|[^\\d])"),m("COERCERTL",u[d.COERCE],!0),m("COERCERTLFULL",u[d.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},641315:function(e,t,r){"use strict";let a=r(595186);e.exports=(e,t,r)=>a(e,t,">",r)},339753:function(e,t,r){"use strict";let a=r(703836);e.exports=(e,t,r)=>(e=new a(e,r),t=new a(t,r),e.intersects(t,r))},647442:function(e,t,r){"use strict";let a=r(595186);e.exports=(e,t,r)=>a(e,t,"<",r)},955666:function(e,t,r){"use strict";let a=r(158818),i=r(703836);e.exports=(e,t,r)=>{let n=null,s=null,o=null;try{o=new i(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!n||-1===s.compare(e))&&(s=new a(n=e,r))}),n}},161653:function(e,t,r){"use strict";let a=r(158818),i=r(703836);e.exports=(e,t,r)=>{let n=null,s=null,o=null;try{o=new i(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!n||1===s.compare(e))&&(s=new a(n=e,r))}),n}},779495:function(e,t,r){"use strict";let a=r(158818),i=r(703836),n=r(308222);e.exports=(e,t)=>{e=new i(e,t);let r=new a("0.0.0");if(e.test(r)||(r=new a("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let i=e.set[t],s=null;i.forEach(e=>{let t=new a(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||n(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||n(r,s))&&(r=s)}return r&&e.test(r)?r:null}},595186:function(e,t,r){"use strict";let a=r(158818),i=r(173311),{ANY:n}=i,s=r(703836),o=r(162848),l=r(308222),u=r(952894),c=r(355886),d=r(312281);e.exports=(e,t,r,h)=>{let p,f,m,g,y;switch(e=new a(e,h),t=new s(t,h),r){case">":p=l,f=c,m=u,g=">",y=">=";break;case"<":p=u,f=d,m=l,g="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let a=t.set[r],s=null,o=null;if(a.forEach(e=>{e.semver===n&&(e=new i(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:m(e.semver,o.semver,h)&&(o=e)}),s.operator===g||s.operator===y||(!o.operator||o.operator===g)&&f(e,o.semver)||o.operator===y&&m(e,o.semver))return!1}return!0}},526296:function(e,t,r){"use strict";let a=r(162848),i=r(658697);e.exports=(e,t,r)=>{let n=[],s=null,o=null,l=e.sort((e,t)=>i(e,t,r));for(let e of l)a(e,t,r)?(o=e,s||(s=e)):(o&&n.push([s,o]),o=null,s=null);s&&n.push([s,null]);let u=[];for(let[e,t]of n)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},869096:function(e,t,r){"use strict";let a=r(703836),i=r(173311),{ANY:n}=i,s=r(162848),o=r(658697),l=[new i(">=0.0.0-0")],u=[new i(">=0.0.0")],c=(e,t,r)=>{let a,i,c,p,f,m,g;if(e===t)return!0;if(1===e.length&&e[0].semver===n)if(1===t.length&&t[0].semver===n)return!0;else e=r.includePrerelease?l:u;if(1===t.length&&t[0].semver===n)if(r.includePrerelease)return!0;else t=u;let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?a=d(a,t,r):"<"===t.operator||"<="===t.operator?i=h(i,t,r):y.add(t.semver);if(y.size>1)return null;if(a&&i&&((c=o(a.semver,i.semver,r))>0||0===c&&(">="!==a.operator||"<="!==i.operator)))return null;for(let e of y){if(a&&!s(e,String(a),r)||i&&!s(e,String(i),r))return null;for(let a of t)if(!s(e,String(a),r))return!1;return!0}let _=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver,b=!!a&&!r.includePrerelease&&!!a.semver.prerelease.length&&a.semver;for(let e of(_&&1===_.prerelease.length&&"<"===i.operator&&0===_.prerelease[0]&&(_=!1),t)){if(g=g||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,a){if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if((p=d(a,e,r))===e&&p!==a)return!1}else if(">="===a.operator&&!s(a.semver,String(e),r))return!1}if(i){if(_&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===_.major&&e.semver.minor===_.minor&&e.semver.patch===_.patch&&(_=!1),"<"===e.operator||"<="===e.operator){if((f=h(i,e,r))===e&&f!==i)return!1}else if("<="===i.operator&&!s(i.semver,String(e),r))return!1}if(!e.operator&&(i||a)&&0!==c)return!1}return(!a||!m||!!i||0===c)&&(!i||!g||!!a||0===c)&&!b&&!_&&!0},d=(e,t,r)=>{if(!e)return t;let a=o(e.semver,t.semver,r);return a>0?e:a<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;let a=o(e.semver,t.semver,r);return a<0?e:a>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new a(e,r),t=new a(t,r);let i=!1;e:for(let a of e.set){for(let e of t.set){let t=c(a,e,r);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},504128:function(e,t,r){"use strict";let a=r(703836);e.exports=(e,t)=>new a(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},77944:function(e,t,r){"use strict";let a=r(703836);e.exports=(e,t)=>{try{return new a(e,t).range||"*"}catch(e){return null}}},778982:function(e,t,r){"use strict";r.d(t,{S:()=>n});for(var a=[],i=0;i<256;++i)a.push((i+256).toString(16).slice(1));function n(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}},24176:function(e,t,r){"use strict";r.d(t,{Z:()=>o});let a="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var i,n=new Uint8Array(16),s=r(778982);let o=function(e,t,r){if(a&&!t&&!e)return a();var o=(e=e||{}).random||(e.rng||function(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=o[l];return t}return(0,s.S)(o)}},443269:function(e,t,r){"use strict";r.d(t,{Z:()=>i});let a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,i=function(e){return"string"==typeof e&&a.test(e)}},745225:function(e,t,r){"use strict";r.d(t,{S:()=>i});let a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function i(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}},842307:function(e,t,r){"use strict";let a;r.d(t,{Z:()=>o});let i="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),n=new Uint8Array(16);var s=r(745225);let o=function(e,t,r){if(i&&!t&&!e)return i();let o=(e=e||{}).random||(e.rng||function(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(n)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=o[e];return t}return(0,s.S)(o)}},102149:function(e,t,r){"use strict";var a,i;function n(e,t){let r=typeof e;if(r!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let a=0;a<r;a++)if(!n(e[a],t[a]))return!1;return!0}if("object"===r){if(!e||!t)return e===t;let r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(let a of r)if(!n(e[a],t[a]))return!1;return!0}return e===t}function s(e){return encodeURI(e.replace(/~/g,"~0").replace(/\//g,"~1"))}r.d(t,{hh:()=>n,Gu:()=>function e(t,r,a="2019-09",i=function e(t,r=Object.create(null),a=c,i=""){if(t&&"object"==typeof t&&!Array.isArray(t)){let n=t.$id||t.id;if(n){let s=new URL(n,a.href);s.hash.length>1?r[s.href]=t:(s.hash="",""===i?a=s:e(t,r,a))}}else if(!0!==t&&!1!==t)return r;let n=a.href+(i?"#"+i:"");if(void 0!==r[n])throw Error(`Duplicate schema URI "${n}".`);if(r[n]=t,!0===t||!1===t)return r;if(void 0===t.__absolute_uri__&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:n}),t.$ref&&void 0===t.__absolute_ref__){let e=new URL(t.$ref,a.href);e.hash=e.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:e.href})}if(t.$recursiveRef&&void 0===t.__absolute_recursive_ref__){let e=new URL(t.$recursiveRef,a.href);e.hash=e.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:e.href})}for(let n in t.$anchor&&(r[new URL("#"+t.$anchor,a.href).href]=t),t){if(u[n])continue;let c=`${i}/${s(n)}`,d=t[n];if(Array.isArray(d)){if(o[n]){let t=d.length;for(let i=0;i<t;i++)e(d[i],r,a,`${c}/${i}`)}}else if(l[n])for(let t in d)e(d[t],r,a,`${c}/${s(t)}`);else e(d,r,a,c)}return r}(r),d=!0,h=null,p="#",f="#",g=Object.create(null)){let y;if(!0===r)return{valid:!0,errors:[]};if(!1===r)return{valid:!1,errors:[{instanceLocation:p,keyword:"false",keywordLocation:p,error:"False boolean schema."}]};let _=typeof t;switch(_){case"boolean":case"number":case"string":y=_;break;case"object":y=null===t?"null":Array.isArray(t)?"array":"object";break;default:throw Error(`Instances of "${_}" type are not supported.`)}let{$ref:b,$recursiveRef:w,$recursiveAnchor:v,type:O,const:E,enum:x,required:S,not:$,anyOf:k,allOf:A,oneOf:I,if:P,then:T,else:j,format:R,properties:N,patternProperties:C,additionalProperties:L,unevaluatedProperties:M,minProperties:U,maxProperties:z,propertyNames:D,dependentRequired:B,dependentSchemas:F,dependencies:q,prefixItems:H,items:J,additionalItems:G,unevaluatedItems:Z,contains:W,minContains:K,maxContains:V,minItems:X,maxItems:Y,uniqueItems:Q,minimum:ee,maximum:et,exclusiveMinimum:er,exclusiveMaximum:ea,multipleOf:ei,minLength:en,maxLength:es,pattern:eo,__absolute_ref__:el,__absolute_recursive_ref__:eu}=r,ec=[];if(!0===v&&null===h&&(h=r),"#"===w){let n=null===h?i[eu]:h,s=`${f}/$recursiveRef`,o=e(t,null===h?r:h,a,i,d,n,p,s,g);o.valid||ec.push({instanceLocation:p,keyword:"$recursiveRef",keywordLocation:s,error:"A subschema had errors."},...o.errors)}if(void 0!==b){let r=i[el||b];if(void 0===r){let e=`Unresolved $ref "${b}".`;throw el&&el!==b&&(e+=`  Absolute URI "${el}".`),Error(e+=`
Known schemas:
- ${Object.keys(i).join("\n- ")}`)}let n=`${f}/$ref`,s=e(t,r,a,i,d,h,p,n,g);if(s.valid||ec.push({instanceLocation:p,keyword:"$ref",keywordLocation:n,error:"A subschema had errors."},...s.errors),"4"===a||"7"===a)return{valid:0===ec.length,errors:ec}}if(Array.isArray(O)){let e=O.length,r=!1;for(let a=0;a<e;a++)if(y===O[a]||"integer"===O[a]&&"number"===y&&t%1==0&&t==t){r=!0;break}r||ec.push({instanceLocation:p,keyword:"type",keywordLocation:`${f}/type`,error:`Instance type "${y}" is invalid. Expected "${O.join('", "')}".`})}else"integer"===O?("number"!==y||t%1||t!=t)&&ec.push({instanceLocation:p,keyword:"type",keywordLocation:`${f}/type`,error:`Instance type "${y}" is invalid. Expected "${O}".`}):void 0!==O&&y!==O&&ec.push({instanceLocation:p,keyword:"type",keywordLocation:`${f}/type`,error:`Instance type "${y}" is invalid. Expected "${O}".`});if(void 0!==E&&("object"===y||"array"===y?n(t,E)||ec.push({instanceLocation:p,keyword:"const",keywordLocation:`${f}/const`,error:`Instance does not match ${JSON.stringify(E)}.`}):t!==E&&ec.push({instanceLocation:p,keyword:"const",keywordLocation:`${f}/const`,error:`Instance does not match ${JSON.stringify(E)}.`})),void 0!==x&&("object"===y||"array"===y?x.some(e=>n(t,e))||ec.push({instanceLocation:p,keyword:"enum",keywordLocation:`${f}/enum`,error:`Instance does not match any of ${JSON.stringify(x)}.`}):x.some(e=>t===e)||ec.push({instanceLocation:p,keyword:"enum",keywordLocation:`${f}/enum`,error:`Instance does not match any of ${JSON.stringify(x)}.`})),void 0!==$){let r=`${f}/not`;e(t,$,a,i,d,h,p,r).valid&&ec.push({instanceLocation:p,keyword:"not",keywordLocation:r,error:'Instance matched "not" schema.'})}let ed=[];if(void 0!==k){let r=`${f}/anyOf`,n=ec.length,s=!1;for(let n=0;n<k.length;n++){let o=k[n],l=Object.create(g),u=e(t,o,a,i,d,!0===v?h:null,p,`${r}/${n}`,l);ec.push(...u.errors),s=s||u.valid,u.valid&&ed.push(l)}s?ec.length=n:ec.splice(n,0,{instanceLocation:p,keyword:"anyOf",keywordLocation:r,error:"Instance does not match any subschemas."})}if(void 0!==A){let r=`${f}/allOf`,n=ec.length,s=!0;for(let n=0;n<A.length;n++){let o=A[n],l=Object.create(g),u=e(t,o,a,i,d,!0===v?h:null,p,`${r}/${n}`,l);ec.push(...u.errors),s=s&&u.valid,u.valid&&ed.push(l)}s?ec.length=n:ec.splice(n,0,{instanceLocation:p,keyword:"allOf",keywordLocation:r,error:"Instance does not match every subschema."})}if(void 0!==I){let r=`${f}/oneOf`,n=ec.length,s=I.filter((n,s)=>{let o=Object.create(g),l=e(t,n,a,i,d,!0===v?h:null,p,`${r}/${s}`,o);return ec.push(...l.errors),l.valid&&ed.push(o),l.valid}).length;1===s?ec.length=n:ec.splice(n,0,{instanceLocation:p,keyword:"oneOf",keywordLocation:r,error:`Instance does not match exactly one subschema (${s} matches).`})}if(("object"===y||"array"===y)&&Object.assign(g,...ed),void 0!==P){let r=`${f}/if`;if(e(t,P,a,i,d,h,p,r,g).valid){if(void 0!==T){let n=e(t,T,a,i,d,h,p,`${f}/then`,g);n.valid||ec.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "then" schema.'},...n.errors)}}else if(void 0!==j){let n=e(t,j,a,i,d,h,p,`${f}/else`,g);n.valid||ec.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "else" schema.'},...n.errors)}}if("object"===y){if(void 0!==S)for(let e of S)e in t||ec.push({instanceLocation:p,keyword:"required",keywordLocation:`${f}/required`,error:`Instance does not have required property "${e}".`});let r=Object.keys(t);if(void 0!==U&&r.length<U&&ec.push({instanceLocation:p,keyword:"minProperties",keywordLocation:`${f}/minProperties`,error:`Instance does not have at least ${U} properties.`}),void 0!==z&&r.length>z&&ec.push({instanceLocation:p,keyword:"maxProperties",keywordLocation:`${f}/maxProperties`,error:`Instance does not have at least ${z} properties.`}),void 0!==D){let r=`${f}/propertyNames`;for(let n in t){let t=`${p}/${s(n)}`,o=e(n,D,a,i,d,h,t,r);o.valid||ec.push({instanceLocation:p,keyword:"propertyNames",keywordLocation:r,error:`Property name "${n}" does not match schema.`},...o.errors)}}if(void 0!==B){let e=`${f}/dependantRequired`;for(let r in B)if(r in t)for(let a of B[r])a in t||ec.push({instanceLocation:p,keyword:"dependentRequired",keywordLocation:e,error:`Instance has "${r}" but does not have "${a}".`})}if(void 0!==F)for(let r in F){let n=`${f}/dependentSchemas`;if(r in t){let o=e(t,F[r],a,i,d,h,p,`${n}/${s(r)}`,g);o.valid||ec.push({instanceLocation:p,keyword:"dependentSchemas",keywordLocation:n,error:`Instance has "${r}" but does not match dependant schema.`},...o.errors)}}if(void 0!==q){let r=`${f}/dependencies`;for(let n in q)if(n in t){let o=q[n];if(Array.isArray(o))for(let e of o)e in t||ec.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${n}" but does not have "${e}".`});else{let l=e(t,o,a,i,d,h,p,`${r}/${s(n)}`);l.valid||ec.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${n}" but does not match dependant schema.`},...l.errors)}}}let n=Object.create(null),o=!1;if(void 0!==N){let r=`${f}/properties`;for(let l in N){if(!(l in t))continue;let u=`${p}/${s(l)}`,c=e(t[l],N[l],a,i,d,h,u,`${r}/${s(l)}`);if(c.valid)g[l]=n[l]=!0;else if(o=d,ec.push({instanceLocation:p,keyword:"properties",keywordLocation:r,error:`Property "${l}" does not match schema.`},...c.errors),o)break}}if(!o&&void 0!==C){let r=`${f}/patternProperties`;for(let l in C){let u=RegExp(l,"u"),c=C[l];for(let f in t){if(!u.test(f))continue;let m=`${p}/${s(f)}`,y=e(t[f],c,a,i,d,h,m,`${r}/${s(l)}`);y.valid?g[f]=n[f]=!0:(o=d,ec.push({instanceLocation:p,keyword:"patternProperties",keywordLocation:r,error:`Property "${f}" matches pattern "${l}" but does not match associated schema.`},...y.errors))}}}if(o||void 0===L){if(!o&&void 0!==M){let r=`${f}/unevaluatedProperties`;for(let n in t)if(!g[n]){let o=`${p}/${s(n)}`,l=e(t[n],M,a,i,d,h,o,r);l.valid?g[n]=!0:ec.push({instanceLocation:p,keyword:"unevaluatedProperties",keywordLocation:r,error:`Property "${n}" does not match unevaluated properties schema.`},...l.errors)}}}else{let r=`${f}/additionalProperties`;for(let l in t){if(n[l])continue;let u=`${p}/${s(l)}`,c=e(t[l],L,a,i,d,h,u,r);c.valid?g[l]=!0:(o=d,ec.push({instanceLocation:p,keyword:"additionalProperties",keywordLocation:r,error:`Property "${l}" does not match additional properties schema.`},...c.errors))}}}else if("array"===y){void 0!==Y&&t.length>Y&&ec.push({instanceLocation:p,keyword:"maxItems",keywordLocation:`${f}/maxItems`,error:`Array has too many items (${t.length} > ${Y}).`}),void 0!==X&&t.length<X&&ec.push({instanceLocation:p,keyword:"minItems",keywordLocation:`${f}/minItems`,error:`Array has too few items (${t.length} < ${X}).`});let r=t.length,s=0,o=!1;if(void 0!==H){let n=`${f}/prefixItems`,l=Math.min(H.length,r);for(;s<l;s++){let r=e(t[s],H[s],a,i,d,h,`${p}/${s}`,`${n}/${s}`);if(g[s]=!0,!r.valid&&(o=d,ec.push({instanceLocation:p,keyword:"prefixItems",keywordLocation:n,error:"Items did not match schema."},...r.errors),o))break}}if(void 0!==J){let n=`${f}/items`;if(Array.isArray(J)){let l=Math.min(J.length,r);for(;s<l;s++){let r=e(t[s],J[s],a,i,d,h,`${p}/${s}`,`${n}/${s}`);if(g[s]=!0,!r.valid&&(o=d,ec.push({instanceLocation:p,keyword:"items",keywordLocation:n,error:"Items did not match schema."},...r.errors),o))break}}else for(;s<r;s++){let r=e(t[s],J,a,i,d,h,`${p}/${s}`,n);if(g[s]=!0,!r.valid&&(o=d,ec.push({instanceLocation:p,keyword:"items",keywordLocation:n,error:"Items did not match schema."},...r.errors),o))break}if(!o&&void 0!==G){let n=`${f}/additionalItems`;for(;s<r;s++){let r=e(t[s],G,a,i,d,h,`${p}/${s}`,n);g[s]=!0,r.valid||(o=d,ec.push({instanceLocation:p,keyword:"additionalItems",keywordLocation:n,error:"Items did not match additional items schema."},...r.errors))}}}if(void 0!==W)if(0===r&&void 0===K)ec.push({instanceLocation:p,keyword:"contains",keywordLocation:`${f}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==K&&r<K)ec.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${f}/minContains`,error:`Array has less items (${r}) than minContains (${K}).`});else{let n=`${f}/contains`,s=ec.length,o=0;for(let s=0;s<r;s++){let r=e(t[s],W,a,i,d,h,`${p}/${s}`,n);r.valid?(g[s]=!0,o++):ec.push(...r.errors)}o>=(K||0)&&(ec.length=s),void 0===K&&void 0===V&&0===o?ec.splice(s,0,{instanceLocation:p,keyword:"contains",keywordLocation:n,error:"Array does not contain item matching schema."}):void 0!==K&&o<K?ec.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${f}/minContains`,error:`Array must contain at least ${K} items matching schema. Only ${o} items were found.`}):void 0!==V&&o>V&&ec.push({instanceLocation:p,keyword:"maxContains",keywordLocation:`${f}/maxContains`,error:`Array may contain at most ${V} items matching schema. ${o} items were found.`})}if(!o&&void 0!==Z){let n=`${f}/unevaluatedItems`;for(;s<r;s++){if(g[s])continue;let r=e(t[s],Z,a,i,d,h,`${p}/${s}`,n);g[s]=!0,r.valid||ec.push({instanceLocation:p,keyword:"unevaluatedItems",keywordLocation:n,error:"Items did not match unevaluated items schema."},...r.errors)}}if(Q)for(let e=0;e<r;e++){let a=t[e],i="object"==typeof a&&null!==a;for(let s=0;s<r;s++){if(e===s)continue;let r=t[s],o="object"==typeof r&&null!==r;(a===r||i&&o&&n(a,r))&&(ec.push({instanceLocation:p,keyword:"uniqueItems",keywordLocation:`${f}/uniqueItems`,error:`Duplicate items at indexes ${e} and ${s}.`}),e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER)}}}else if("number"===y){if("4"===a?(void 0!==ee&&(!0===er&&t<=ee||t<ee)&&ec.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${f}/minimum`,error:`${t} is less than ${er?"or equal to ":""} ${ee}.`}),void 0!==et&&(!0===ea&&t>=et||t>et)&&ec.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${f}/maximum`,error:`${t} is greater than ${ea?"or equal to ":""} ${et}.`})):(void 0!==ee&&t<ee&&ec.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${f}/minimum`,error:`${t} is less than ${ee}.`}),void 0!==et&&t>et&&ec.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${f}/maximum`,error:`${t} is greater than ${et}.`}),void 0!==er&&t<=er&&ec.push({instanceLocation:p,keyword:"exclusiveMinimum",keywordLocation:`${f}/exclusiveMinimum`,error:`${t} is less than ${er}.`}),void 0!==ea&&t>=ea&&ec.push({instanceLocation:p,keyword:"exclusiveMaximum",keywordLocation:`${f}/exclusiveMaximum`,error:`${t} is greater than or equal to ${ea}.`})),void 0!==ei){let e=t%ei;Math.abs(0-e)>=11920929e-14&&Math.abs(ei-e)>=11920929e-14&&ec.push({instanceLocation:p,keyword:"multipleOf",keywordLocation:`${f}/multipleOf`,error:`${t} is not a multiple of ${ei}.`})}}else if("string"===y){let e=void 0===en&&void 0===es?0:function(e){let t,r=0,a=e.length,i=0;for(;i<a;)r++,(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a&&(64512&(t=e.charCodeAt(i)))==56320&&i++;return r}(t);void 0!==en&&e<en&&ec.push({instanceLocation:p,keyword:"minLength",keywordLocation:`${f}/minLength`,error:`String is too short (${e} < ${en}).`}),void 0!==es&&e>es&&ec.push({instanceLocation:p,keyword:"maxLength",keywordLocation:`${f}/maxLength`,error:`String is too long (${e} > ${es}).`}),void 0===eo||RegExp(eo,"u").test(t)||ec.push({instanceLocation:p,keyword:"pattern",keywordLocation:`${f}/pattern`,error:"String does not match pattern."}),void 0!==R&&m[R]&&!m[R](t)&&ec.push({instanceLocation:p,keyword:"format",keywordLocation:`${f}/format`,error:`String does not match format "${R}".`})}return{valid:0===ec.length,errors:ec}}});let o={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},l={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},u={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},c="undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker"),d=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,h=[0,31,28,31,30,31,30,31,31,30,31,30,31],p=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function f(e){return e.test.bind(e)}let m={date:g,time:y.bind(void 0,!1),"date-time":function(e){let t=e.split(_);return 2==t.length&&g(t[0])&&y(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return b.test(e)&&w.test(e)},"uri-reference":f(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":f(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:f(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;let[t,r,...a]=e.split("@");return!(!t||!r||0!==a.length||t.length>64||r.length>253||"."===t[0]||t.endsWith(".")||t.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(r)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)&&r.split(".").every(e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e))},hostname:f(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:f(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:f(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(v.test(e))return!1;try{return RegExp(e,"u"),!0}catch(e){return!1}},uuid:f(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":f(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":f(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":f(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function g(e){var t;let r=e.match(d);if(!r)return!1;let a=+r[1],i=+r[2],n=+r[3];return i>=1&&i<=12&&n>=1&&n<=(2==i&&(t=a)%4==0&&(t%100!=0||t%400==0)?29:h[i])}function y(e,t){let r=t.match(p);if(!r)return!1;let a=+r[1],i=+r[2],n=+r[3],s=!!r[5];return(a<=23&&i<=59&&n<=59||23==a&&59==i&&60==n)&&(!e||s)}let _=/t|\s/i,b=/\/|:/,w=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,v=/[^\\]\\Z/;(i=a||(a={}))[i.Flag=1]="Flag",i[i.Basic=2]="Basic",i[i.Detailed=4]="Detailed"},349981:function(e,t,r){"use strict";r.d(t,{ET:()=>l,K$:()=>u,mb:()=>o});var a=r(24176),i=r(92150),n=r(257185);class s{}function o(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}class l extends s{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,i.j)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===(0,n.lS)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return i.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return i.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends l{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:a.Z()}),Object.assign(this,e)}}}}let u=e=>void 0!==e&&"function"==typeof e.copy&&"string"==typeof e.name&&"boolean"==typeof e.awaitHandlers},792551:function(e,t,r){"use strict";let a,i;r.d(t,{Ye:()=>R,QH:()=>$,xz:()=>N});var n=r(24176),s=r(349981),o=r(636345),l=r(261118);function u(e,t){return`${e.open}${t}${e.close}`}function c(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function d(e){return"string"==typeof e?e.trim():null==e?e:c(e,e.toString())}function h(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:p}=o;class f extends l.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?u(o.bold,a):a}).join(" > ");return u(p.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.green,"[chain/start]")} [${t}] Entering Chain run with input: ${c(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[chain/end]")} [${t}] [${h(e)}] Exiting Chain run with output: ${c(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[chain/error]")} [${t}] [${h(e)}] Chain run errored with error: ${c(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${u(p.green,"[llm/start]")} [${t}] Entering LLM run with input: ${c(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[llm/end]")} [${t}] [${h(e)}] Exiting LLM run with output: ${c(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[llm/error]")} [${t}] [${h(e)}] LLM run errored with error: ${c(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.green,"[tool/start]")} [${t}] Entering Tool run with input: "${d(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[tool/end]")} [${t}] [${h(e)}] Exiting Tool run with output: "${d(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[tool/error]")} [${t}] [${h(e)}] Tool run errored with error: ${c(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${c(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[retriever/end]")} [${t}] [${h(e)}] Exiting Retriever run with output: ${c(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[retriever/error]")} [${t}] [${h(e)}] Retriever run errored with error: ${c(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.blue,"[agent/action]")} [${t}] Agent selected action: ${c(e.actions[e.actions.length-1],"[action]")}`)}}var m=r(711617),g=r(257185),y=r(440455),_=r(400032),b=r(906774);class w extends l.Z{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:r,client:i,replicas:n}=e;this.projectName=r??(0,y.Bm)(),this.replicas=n,this.exampleId=t,this.client=i??(()=>{if(void 0===a){let e="false"===(0,g.lS)("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{};a=new y.KU(e)}return a})();let s=w.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.postRun()}async onRunUpdate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);){;t=t.parent_run}r.clear();let a=[t];for(;a.length>0;){let e=a.shift();!(!e||r.has(e.id))&&(r.add(e.id),this.runTreeMap.set(e.id,e),e.child_runs&&a.push(...e.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new _.IV({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return(0,b.dy)(!0)}catch{return}}}var v=r(350709),O=r(436147);async function E(e,t){if(!0===t){let t=(0,O.IU)();void 0!==t?await t.run(void 0,async()=>e()):await e()}else void 0===i&&(i=new("default"in v?v.default:v)({autoStart:!0,concurrency:1})),i.add(async()=>{let t=(0,O.IU)();void 0!==t?await t.run(void 0,async()=>e()):await e()})}function x(e){let t=(0,O.IU)();if(void 0===t)return;let r=t.getStore();return r?.[O.aU]?.[e]}let S=Symbol("lc:configure_hooks");function $(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class k{setHandler(e){return this.setHandlers([e])}}class A{constructor(e,t,r,a,i,n,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>E(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,a,i){await Promise.all(this.handlers.map(r=>E(async()=>{try{await r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}}class I extends A{getChild(e){let t=new R(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}}class P extends A{async handleLLMNewToken(e,t,r,a,i,n){await Promise.all(this.handlers.map(r=>E(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,n)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}async handleLLMError(e,t,r,a,i){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,r,a,i){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class T extends A{getChild(e){let t=new R(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,i){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,r,a,i){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class j extends A{getChild(e){let t=new R(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>E(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class R extends k{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,a,i,s,o,u){return Promise.all(t.map(async(t,a)=>{let s=0===a&&r?r:(0,n.Z)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return(0,l.H)(r)&&r._createRunForLLMStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u),E(async()=>{try{await r.handleLLMStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new P(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,a,i,s,o,u){return Promise.all(t.map(async(t,a)=>{let s=0===a&&r?r:(0,n.Z)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return(0,l.H)(r)&&r._createRunForChatModelStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u),E(async()=>{try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u);else if(r.handleLLMStart){let a=(0,m.zs)(t);await r.handleLLMStart?.(e,[a],s,this._parentRunId,i,this.tags,this.metadata,u)}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new P(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,n.Z)(),a,i,s,o){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreChain)return(0,l.H)(i)&&i._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,a,o),E(async()=>{try{await i.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,o)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new T(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,n.Z)(),a,i,s,o){return await Promise.all(this.handlers.map(a=>{if(!a.ignoreAgent)return(0,l.H)(a)&&a._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),E(async()=>{try{await a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`),a.raiseError)throw e}},a.awaitHandlers)})),new j(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,n.Z)(),a,i,s,o){return await Promise.all(this.handlers.map(a=>{if(!a.ignoreRetriever)return(0,l.H)(a)&&a._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),E(async()=>{try{await a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`),a.raiseError)throw e}},a.awaitHandlers)})),new I(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,a,i){await Promise.all(this.handlers.map(a=>E(async()=>{if(!a.ignoreCustomEvent)try{await a.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${e}`),a.raiseError)throw e}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new R(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let a of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends s.ET{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.Z)()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,a,i,n,s){return this._configureSync(e,t,r,a,i,n,s)}static _configureSync(e,t,r,a,i,n,o){var l;let u;(e||t)&&(Array.isArray(e)||!e?(u=new R).setHandlers(e?.map(N)??[],!0):u=e,u=u.copy(Array.isArray(t)?t.map(N):t?.handlers,!1));let c="true"===(0,g.lS)("LANGCHAIN_VERBOSE")||o?.verbose,d=w.getTraceableRunTree()?.tracingEnabled||(void 0!==l?l:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===(0,g.lS)(e))),h=d||((0,g.lS)("LANGCHAIN_TRACING")??!1);if(c||h){if(u||(u=new R),c&&!u.handlers.some(e=>e.name===f.prototype.name)){let e=new f;u.addHandler(e,!0)}if(h&&!u.handlers.some(e=>"langchain_tracer"===e.name)&&d){let e=new w;u.addHandler(e,!0)}if(d){let e=w.getTraceableRunTree();if(e&&void 0===u._parentRunId){u._parentRunId=e.id;let t=u.handlers.find(e=>"langchain_tracer"===e.name);t?.updateFromRunTree(e)}}}for(let{contextVar:e,inheritable:t=!0,handlerClass:r,envVar:a}of x(S)||[]){let i,n=a&&"true"===(0,g.lS)(a)&&r,o=void 0!==e?x(e):void 0;o&&(0,s.K$)(o)?i=o:n&&(i=new r({})),void 0!==i&&(u||(u=new R),u.handlers.some(e=>e.name===i.name)||u.addHandler(i,t))}return(r||a)&&u&&(u.addTags(r??[]),u.addTags(a??[],!1)),(i||n)&&u&&(u.addMetadata(i??{}),u.addMetadata(n??{},!1)),u}}function N(e){return"name"in e?e:s.ET.fromMethods(e)}},986807:function(e,t,r){"use strict";function a(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/
`,e}r.d(t,{r:()=>a})},92150:function(e,t,r){"use strict";r.d(t,{i:()=>o,j:()=>s});var a=r(822227);function i(e,t){return t?.[e]||a(e)}function n(e){return Array.isArray(e)?[...e]:{...e}}function s(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}r(89151);class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([e])=>this.lc_serializable_keys?.includes(e))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,a=r,[i,...n]=e.split(".").reverse();for(let e of n.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}i in t&&void 0!==t[i]&&(a[i]=a[i]||t[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(e,t,r){let a={};for(let i in e)Object.hasOwn(e,i)&&(a[t(i,r)]=e[i]);return a}(Object.keys(t).length?function(e,t){let r=n(e);for(let[e,a]of Object.entries(t)){let[t,...i]=e.split(".").reverse(),s=r;for(let e of i.reverse()){if(void 0===s[e])break;s[e]=n(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[a]})}return r}(r,t):r,i,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},197680:function(e,t,r){"use strict";r.d(t,{GC:()=>u,Z0:()=>o,gY:()=>s,wT:()=>l});var a=r(757845),i=r(620712),n=r(210482);class s extends i.ku{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if("string"==typeof e)r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let t=r.additional_kwargs?.tool_calls,a=r.tool_calls;null!=t&&t.length>0&&(void 0===a||0===a.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `yarn add @langchain/anthropic`, yarn add @langchain/openai`, etc.");try{if(null!=t&&void 0===a){let[e,a]=(0,n.jC)(t);r.tool_calls=e??[],r.invalid_tool_calls=a??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch(e){r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"string"!=typeof r&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function o(e){return"ai"===e._getType()}function l(e){return"ai"===e._getType()}class u extends i.$k{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0};else{let r=e.tool_call_chunks.reduce((e,t)=>{let r=t.id||`fallback-${t.index||0}`;return e[r]=e[r]??[],e[r].push(t),e},{}),i=[],n=[];for(let[e,t]of Object.entries(r)){let r={},s=t[0]?.name??"",o=t.map(e=>e.args||"").join(""),l=o.length?o:"{}",u=t[0]?.id||e;try{if(r=(0,a.g)(l),null===r||"object"!=typeof r||Array.isArray(r))throw Error("Malformed tool call chunk args.");i.push({name:s,args:r,id:u,type:"tool_call"})}catch(e){n.push({name:s,args:l,id:u,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:i,invalid_tool_calls:n,usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:(0,i.Wf)(this.content,e.content),additional_kwargs:(0,i.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,i.wv)(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let r=(0,i.eL)(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){let r={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},a={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},i=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},n=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0};t.usage_metadata={input_tokens:i.input_tokens+n.input_tokens,output_tokens:i.output_tokens+n.output_tokens,total_tokens:i.total_tokens+n.total_tokens,...Object.keys(r).length>0&&{input_token_details:r},...Object.keys(a).length>0&&{output_token_details:a}}}return new u(t)}}},620712:function(e,t,r){"use strict";r.d(t,{$k:()=>d,QW:()=>p,Wf:()=>n,a2:()=>f,eL:()=>u,gQ:()=>h,ku:()=>o,n4:()=>s,wv:()=>l,x:()=>c});var a=r(92150),i=r(984710);function n(e,t){return"string"==typeof e?""===e?t:"string"==typeof t?e+t:Array.isArray(t)&&t.some(e=>(0,i.JG)(e))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t]:Array.isArray(t)?u(e,t)??[...e,...t]:""===t?e:Array.isArray(e)&&e.some(e=>(0,i.JG)(e))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}function s(e,t){return"error"===e||"error"===t?"error":"success"}class o extends a.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"==typeof e?e:"text"===e.type?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){var t,r;if(null===e)return this;let a=(t=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,a){if("object"!=typeof t||null==t)return t;if(a>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,a+1));let i={};for(let r of Object.keys(t))i[r]=e(t[r],a+1);return i}(t,0),null,2));return`${this.constructor.lc_name()} ${a}`}}function l(e,t){let r={...e};for(let[e,a]of Object.entries(t))if(null==r[e])r[e]=a;else if(null==a)continue;else if(typeof r[e]!=typeof a||Array.isArray(r[e])!==Array.isArray(a))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e]){if("type"===e)continue;r[e]+=a}else if("object"!=typeof r[e]||Array.isArray(r[e]))if(Array.isArray(r[e]))r[e]=u(r[e],a);else{if(r[e]===a)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else r[e]=l(r[e],a);return r}function u(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;let r=[...e];for(let e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>t.index===e.index);-1!==t?r[t]=l(r[t],e):r.push(e)}else{if("object"==typeof e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}function c(e,t){if(!e&&!t)throw Error("Cannot merge two undefined objects.");if(!e||!t)return e||t;if(typeof e!=typeof t)throw Error(`Cannot merge objects of different types.
Left ${typeof e}
Right ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return u(e,t);if("object"==typeof e&&"object"==typeof t)return l(e,t);else if(e===t)return e;else throw Error(`Can not merge objects of different types.
Left ${e}
Right ${t}`)}class d extends o{}function h(e){return"string"==typeof e.role}function p(e){return"function"==typeof e?._getType}function f(e){return p(e)&&"function"==typeof e.concat}},606340:function(e,t,r){"use strict";r.d(t,{HD:()=>n,J:()=>i});var a=r(620712);class i extends a.ku{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return i}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}get _printableFields(){return{...super._printableFields,role:this.role}}}class n extends a.$k{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new n({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}},984710:function(e,t,r){"use strict";function a(e){return"object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}function i(e){return a(e)&&"url"===e.source_type&&"url"in e&&"string"==typeof e.url}function n(e){return a(e)&&"base64"===e.source_type&&"data"in e&&"string"==typeof e.data}function s(e){if(a(e)){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url}};if("base64"===e.source_type){if(!e.mime_type)throw Error("mime_type key is required for base64 data.");let t=e.mime_type;return{type:"image_url",image_url:{url:`data:${t};base64,${e.data}`}}}}throw Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function o(e){let t=e.split(";")[0].split("/");if(2!==t.length)throw Error(`Invalid mime type: "${e}" - does not match type/subtype format.`);let r=t[0].trim(),a=t[1].trim();if(""===r||""===a)throw Error(`Invalid mime type: "${e}" - type or subtype is empty.`);let i={};for(let t of e.split(";").slice(1)){let r=t.split("=");if(2!==r.length)throw Error(`Invalid parameter syntax in mime type: "${e}".`);let a=r[0].trim(),n=r[1].trim();if(""===a)throw Error(`Invalid parameter syntax in mime type: "${e}".`);i[a]=n}return{type:r,subtype:a,parameters:i}}function l({dataUrl:e,asTypedArray:t=!1}){let r=e.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);if(r)return{mime_type:r[1].toLowerCase(),data:t?Uint8Array.from(atob(r[2]),e=>e.charCodeAt(0)):r[2]}}function u(e,t){if("text"===e.type){if(!t.fromStandardTextBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardTextBlock\` method.`);return t.fromStandardTextBlock(e)}if("image"===e.type){if(!t.fromStandardImageBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardImageBlock\` method.`);return t.fromStandardImageBlock(e)}if("audio"===e.type){if(!t.fromStandardAudioBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardAudioBlock\` method.`);return t.fromStandardAudioBlock(e)}if("file"===e.type){if(!t.fromStandardFileBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardFileBlock\` method.`);return t.fromStandardFileBlock(e)}throw Error(`Unable to convert content block type '${e.type}' to provider-specific format: not recognized.`)}r.d(t,{JG:()=>a,Nu:()=>i,SR:()=>l,VL:()=>u,c1:()=>n,j0:()=>s,uy:()=>o})},94780:function(e,t,r){"use strict";r.d(t,{Cr:()=>i});var a=r(620712);a.ku;class i extends a.$k{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new i({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}},468501:function(e,t,r){"use strict";r.d(t,{ro:()=>n,xk:()=>i});var a=r(620712);class i extends a.ku{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class n extends a.$k{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new n({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},727060:function(e,t,r){"use strict";r.d(t,{JG:()=>d.JG,zs:()=>u.zs,SR:()=>d.SR,gY:()=>a.gY,xk:()=>o.xk,jN:()=>l.jN,j0:()=>d.j0,VL:()=>d.VL,Cr:()=>s.Cr,c1:()=>d.c1,J:()=>n.J,Xz:()=>c.Xz,wT:()=>a.wT,QW:()=>i.QW,uy:()=>d.uy,Nu:()=>d.Nu,ro:()=>o.ro,GC:()=>a.GC,Z0:()=>a.Z0,HD:()=>n.HD,E1:()=>u.E1,xq:()=>l.xq});var a=r(197680),i=r(620712),n=r(606340),s=r(94780),o=r(468501),l=r(670274),u=r(711617);r(806866),i.ku;var c=r(210482),d=r(984710)},670274:function(e,t,r){"use strict";r.d(t,{jN:()=>i,xq:()=>n});var a=r(620712);class i extends a.ku{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class n extends a.$k{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new n({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},210482:function(e,t,r){"use strict";r.d(t,{BE:()=>i,Cq:()=>n,Xz:()=>s,jC:()=>o});var a=r(620712);function i(e){return null!=e&&"object"==typeof e&&"lc_direct_tool_output"in e&&!0===e.lc_direct_tool_output}class n extends a.ku{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status,this.metadata=e.metadata}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class s extends a.$k{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new s({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),artifact:(0,a.x)(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:(0,a.n4)(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function o(e){let t=[],r=[];for(let a of e)if(!a.function)continue;else{let e=a.function.name;try{let r=JSON.parse(a.function.arguments),i={name:e||"",args:r||{},id:a.id};t.push(i)}catch(t){r.push({name:e,args:a.function.arguments,id:a.id,error:"Malformed args."})}}return[t,r]}},711617:function(e,t,r){"use strict";r.d(t,{E1:()=>f,Oy:()=>g,zs:()=>m});var a=r(986807),i=r(658207),n=r(197680),s=r(620712),o=r(606340),l=r(94780),u=r(468501),c=r(670274),d=r(210482);function h(e){return(0,i.uB)(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function p(e){let t,r;if("object"==typeof e&&null!=e&&1===e.lc&&Array.isArray(e.id)&&null!=e.kwargs&&"object"==typeof e.kwargs){let a=e.id.at(-1);t="HumanMessage"===a||"HumanMessageChunk"===a?"user":"AIMessage"===a||"AIMessageChunk"===a?"assistant":"SystemMessage"===a||"SystemMessageChunk"===a?"system":"FunctionMessage"===a||"FunctionMessageChunk"===a?"function":"ToolMessage"===a||"ToolMessageChunk"===a?"tool":"unknown",r=e.kwargs}else{let{type:a,...i}=e;t=a,r=i}if("human"===t||"user"===t)return new u.xk(r);if("ai"===t||"assistant"===t){let{tool_calls:e,...t}=r;if(!Array.isArray(e))return new n.gY(r);let a=e.map(h);return new n.gY({...t,tool_calls:a})}if("system"===t)return new c.jN(r);if("developer"===t)return new c.jN({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if("tool"===t&&"tool_call_id"in r)return new d.Cq({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});throw(0,a.r)(Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}function f(e){if("string"==typeof e)return new u.xk(e);if((0,s.QW)(e))return e;if(Array.isArray(e)){let[t,r]=e;return p({type:t,content:r})}if(!(0,s.gQ)(e))return p(e);{let{role:t,...r}=e;return p({...r,type:t})}}function m(e,t="Human",r="AI"){let a=[];for(let i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=r;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("tool"===i._getType())e="Tool";else if("generic"===i._getType())e=i.role;else throw Error(`Got unsupported message type: ${i._getType()}`);let n=i.name?`${i.name}, `:"",s="string"==typeof i.content?i.content:JSON.stringify(i.content,null,2);a.push(`${e}: ${n}${s}`)}return a.join("\n")}function g(e){let t=e._getType();if("human"===t)return new u.ro({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),new n.GC({...t})}if("system"===t)return new c.xq({...e});if("function"===t)return new l.Cr({...e});if(o.J.isInstance(e))return new o.HD({...e});else throw Error("Unknown message type.")}},796733:function(e,t,r){"use strict";r.d(t,{Ls:()=>n,WH:()=>a,b6:()=>i});let a="__run";class i{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class n extends i{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}},806866:function(e,t,r){"use strict";r.d(t,{Vh:()=>ee,k9:()=>Q,eq:()=>H,pX:()=>J,dT:()=>K,Uv:()=>q,lW:()=>W,Y8:()=>X});var a=r(628614),i=r(750980),n=r(24176),s=r(906774),o=r(127117),l=r(261118),u=r(849079),c=r(197680);class d{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=(0,o.af)({},t);return new h({ops:t,state:r[r.length-1].newDocument})}}class h extends d{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=(0,o.af)(this.state,e.ops);return new h({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=(0,o.af)({},e.ops);return new h({ops:e.ops,state:t[t.length-1].newDocument})}}let p=e=>"log_stream_tracer"===e.name;async function f(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function m(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}class g extends l.Z{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=u.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new d({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new d({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await f(e,this._schemaFormat)),await this.writer.write(new d({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await f(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await m(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new d({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){let t=new d({ops:[{op:"replace",path:"/final_output",value:await m(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let a,i=this.keyMapByRunId[e.id];if(void 0===i)return;if(void 0!==e.inputs.messages){var n;a=void 0!==(n=r?.chunk)&&void 0!==n.message?r?.chunk:new c.GC({id:`run-${e.id}`,content:t})}else a=t;let s=new d({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});await this.writer.write(s)}}var y=r(796733);function _({name:e,serialized:t}){return void 0!==e?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}let b=e=>"event_stream_tracer"===e.name;class w extends l.Z{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=u.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let a=this.runInfoMap.get(e);if(void 0===a)return void(yield r.value);function i(e,t){return"llm"===e&&"string"==typeof t?new y.b6({text:t}):t}let n=this.tappedPromises.get(e);if(void 0===n){let s;n=new Promise(e=>{s=e}),this.tappedPromises.set(e,n);try{let n={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};for await(let e of(await this.send({...n,data:{chunk:i(a.runType,r.value)}},a),yield r.value,t))"tool"!==a.runType&&"retriever"!==a.runType&&await this.send({...n,data:{chunk:i(a.runType,e)}},a),yield e}finally{s()}}else for await(let e of(yield r.value,t))yield e}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);void 0!==r?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=_(e),r=void 0!==e.inputs.messages?"chat_model":"llm",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,a);let i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onLLMNewToken(e,t,r){let a,i,n=this.runInfoMap.get(e.id);if(void 0===n)throw Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===n.runType)i="on_chat_model_stream",a=r?.chunk===void 0?new c.GC({content:t,id:`run-${e.id}`}):r.chunk.message;else if("llm"===n.runType)i="on_llm_stream",a=r?.chunk===void 0?new y.b6({text:t}):r.chunk;else throw Error(`Unexpected run type ${n.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}}async onLLMEnd(e){let t,r,a=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===a)throw Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let i=e.outputs?.generations;if("chat_model"===a.runType){for(let e of i??[]){if(void 0!==r)break;r=e[0]?.message}t="on_chat_model_end"}else if("llm"===a.runType)r={generations:i?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},t="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${a.runType}`);await this.sendEndEvent({event:t,data:{output:r,input:a.inputs},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}async onChainStart(e){let t=_(e),r=e.run_type??"chain",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},i={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(i={},a.inputs={}):void 0!==e.inputs.input?(i.input=e.inputs.input,a.inputs=e.inputs.input):(i.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:a};a.input&&1===Object.keys(a).length&&(i.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=_(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=_(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let a=this.runInfoMap.get(r);if(void 0===a)throw Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}}var v=r(92150),O=r(386502),E=r(53899),x=r(829070);class S extends l.Z{constructor({config:e,onStart:t,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function $(e){return!!e&&e.lc_runnable}class k{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,a=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||a.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&a.every(e=>!this.excludeTags?.includes(e))),r}}var A=r(150629),I=r(443269);function P(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}let T=["*","_","`"];async function j(e,t){let{backgroundColor:r="white"}=t??{},a=btoa(e);void 0!==r&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));let i=`https://mermaid.ink/img/${a}?bgColor=${r}`,n=await fetch(i);if(!n.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${n.status}
Status text: ${n.statusText}`);return await n.blob()}var R=r(48389);class N{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=(0,I.Z)(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...$(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...(0,R.Bx)(t.data.schema),title:t.data.name}}})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let a=t??(0,n.Z)(),i={id:a,data:e,name:function(e,t){if(void 0!==e&&!(0,I.Z)(e))return e;if(!$(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch(e){return t.getName()}}(t,e),metadata:r};return this.nodes[a]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,a){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let i={source:e.id,target:t.id,data:r,conditional:a};return this.edges.push(i),i}firstNode(){return C(this)}lastNode(){return L(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(e=>e.id).every(I.Z)&&(r="");let a=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[a(e)]={...t,id:a(e)}});let i=e.edges.map(e=>({...e,source:a(e.source),target:a(e.target)}));this.edges=[...this.edges,...i];let n=e.firstNode(),s=e.lastNode();return[n?{id:a(n.id),data:n.data}:void 0,s?{id:a(s.id),data:s.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&C(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&L(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),t=new Map;Object.values(e).forEach(e=>{t.set(e,(t.get(e)||0)+1)});let r=r=>{let a=e[r];return(0,I.Z)(r)&&1===t.get(a)?a:r};return new N({nodes:Object.fromEntries(Object.entries(this.nodes).map(([e,t])=>[r(e),{...t,id:r(e)}])),edges:this.edges.map(e=>({...e,source:r(e.source),target:r(e.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},n=this.reid(),s=n.firstNode(),o=n.lastNode();return function(e,t,r){let{firstNode:a,lastNode:i,nodeColors:n,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:"graph TD;\n";if(s){let t="default",r={[t]:"{0}({1})"};for(let[n,s]of(void 0!==a&&(r[a]="{0}([{1}]):::first"),void 0!==i&&(r[i]="{0}([{1}]):::last"),Object.entries(e))){let e=s.name.split(":").pop()??"",a=T.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(s.metadata??{}).length&&(a+=`<hr/><small><em>${Object.entries(s.metadata??{}).map(([e,t])=>`${e} = ${t}`).join("\n")}</em></small>`);let i=(r[n]??r[t]).replace("{0}",P(n)).replace("{1}",a);u+=`	${i}
`}}let c={};for(let e of t){let t=e.source.split(":"),r=e.target.split(":"),a=t.filter((e,t)=>e===r[t]).join(":");c[a]||(c[a]=[]),c[a].push(e)}let d=new Set;function h(e,t){let r=1===e.length&&e[0].source===e[0].target;if(t&&!r){let e=t.split(":").pop();if(d.has(e))throw Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),u+=`	subgraph ${e}
`}for(let t of e){let{source:e,target:r,data:a,conditional:i}=t,n="";if(void 0!==a){let e=a,t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},(e,r)=>t.slice(r*l,(r+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),n=i?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --> `}else n=i?" -.-> ":" --\x3e ";u+=`	${P(e)}${n}${P(r)};
`}for(let e in c)e.startsWith(`${t}:`)&&e!==t&&h(c[e],e);t&&!r&&(u+="	end\n")}for(let e in h(c[""]??[],""),c)e.includes(":")||""===e||h(c[e],e);return s&&(u+=function(e){let t="";for(let[r,a]of Object.entries(e))t+=`	classDef ${r} ${a};
`;return t}(n??{})),u}(n.nodes,n.edges,{firstNode:s?.id,lastNode:o?.id,withStyles:t,curveStyle:r,nodeColors:a,wrapLabelNWords:i})}async drawMermaidPng(e){return j(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function C(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),a=[];for(let i of Object.values(e.nodes))t.includes(i.id)||r.has(i.id)||a.push(i);return 1===a.length?a[0]:void 0}function L(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),a=[];for(let i of Object.values(e.nodes))t.includes(i.id)||r.has(i.id)||a.push(i);return 1===a.length?a[0]:void 0}function M(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function U(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*z(e,t){for(;;){let{value:r,done:a}=A.AO.runWithConfig((0,E.yG)(e),t.next.bind(t),!0);if(a)break;yield r}}async function*D(e,t){let r=t[Symbol.asyncIterator]();for(;;){let{value:a,done:i}=await A.AO.runWithConfig((0,E.yG)(e),r.next.bind(t),!0);if(i)break;yield a}}var B=r(658207),F=r(568976);function q(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class H extends v.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new J({bound:this,kwargs:e,config:{}})}map(){return new G({bound:this})}withRetry(e){return new Z({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new J({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new Y({runnable:this,fallbacks:Array.isArray(e)?e:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(E.LE);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,a)=>(0,E.LE)(0===a?e:r))}return Array.from({length:t},()=>(0,E.LE)(e))}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),i=a[0]?.maxConcurrency??r?.maxConcurrency,n=new x.L({maxConcurrency:i,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>n.call(async()=>{try{return await this.invoke(e,a[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=(0,E.LE)(t),a=new u.qq({generator:this._streamIterator(e,r),config:r});return await a.setup,u.QJ.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?(0,E.LE)(e):(0,E.LE)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let a,i=(0,E.LE)(r),n=await (0,E.Le)(i),s=await n?.handleChainStart(this.toJSON(),q(t,"input"),i.runId,i?.runType,void 0,void 0,i?.runName??this.getName());delete i.runId;try{let n=e.call(this,t,i,s);a=await (0,O.E)(n,r?.signal)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(q(a,"output")),a}async _batchWithConfig(e,t,r,a){let i,n=this._getOptionsList(r??{},t.length),s=await Promise.all(n.map(E.Le)),o=await Promise.all(s.map(async(e,r)=>{let a=await e?.handleChainStart(this.toJSON(),q(t[r],"input"),n[r].runId,n[r].runType,void 0,void 0,n[r].runName??this.getName());return delete n[r].runId,a}));try{let r=e.call(this,t,n,o,a);i=await (0,O.E)(r,n?.[0]?.signal)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(q(i,"output")))),i}_concatOutputChunks(e,t){return(0,u.zo)(e,t)}async *_transformStreamWithConfig(e,t,r){let a,i,n,s=!0,o=!0,l=(0,E.LE)(r),c=await (0,E.Le)(l),d=this;async function*h(){for await(let t of e){if(s)if(void 0===a)a=t;else try{a=d._concatOutputChunks(a,t)}catch{a=void 0,s=!1}yield t}}try{let e=await (0,u.E7)(t.bind(this),h(),async()=>c?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,n=e.setup;let a=n?.handlers.find(b),s=e.output;void 0!==a&&void 0!==n&&(s=a.tapOutputIterable(n.runId,s));let d=n?.handlers.find(p);for await(let e of(void 0!==d&&void 0!==n&&(s=d.tapOutputIterable(n.runId,s)),s))if(yield e,o)if(void 0===i)i=e;else try{i=this._concatOutputChunks(i,e)}catch{i=void 0,o=!1}}catch(e){throw await n?.handleChainError(e,void 0,void 0,void 0,{inputs:q(a,"input")}),e}await n?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:q(a,"input")})}getGraph(e){let t=new N,r=t.addNode({name:`${this.getName()}Input`,schema:a.Yj()}),i=t.addNode(this),n=t.addNode({name:`${this.getName()}Output`,schema:a.Yj()});return t.addEdge(r,i),t.addEdge(i,n),t}pipe(e){return new W({first:this,last:Q(e)})}pick(e){return this.pipe(new et(e))}assign(e){return this.pipe(new ee(new K({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:this._concatOutputChunks(r,t);yield*this._streamIterator(r,(0,E.LE)(t))}async *streamLog(e,t,r){let a=new g({...r,autoClose:!1,_schemaFormat:"original"}),i=(0,E.LE)(t);yield*this._streamLog(e,a,i)}async *_streamLog(e,t,r){let{callbacks:a}=r;if(void 0===a)r.callbacks=[t];else if(Array.isArray(a))r.callbacks=a.concat([t]);else{let e=a.copy();e.addHandler(t,!0),r.callbacks=e}let i=this.stream(e,r),n=async function(){try{for await(let e of(await i)){let r=new d({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await t.writer.write(r)}}finally{await t.writer.close()}}();try{for await(let e of t)yield e}finally{await n}}streamEvents(e,t,r){let a;if("v1"===t.version)a=this._streamEventsV1(e,t,r);else if("v2"===t.version)a=this._streamEventsV2(e,t,r);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');if("text/event-stream"!==t.encoding)return u.QJ.fromAsyncGenerator(a);var i=a;let n=new TextEncoder,s=new ReadableStream({async start(e){for await(let t of i)e.enqueue(n.encode(`event: data
data: ${JSON.stringify(t)}

`));e.enqueue(n.encode("event: end\n\n")),e.close()}});return u.QJ.fromReadableStream(s)}async *_streamEventsV2(e,t,r){let a,i=new w({...r,autoClose:!1}),s=(0,E.LE)(t),o=s.runId??(0,n.Z)();s.runId=o;let l=s.callbacks;if(void 0===l)s.callbacks=[i];else if(Array.isArray(l))s.callbacks=l.concat(i);else{let e=l.copy();e.addHandler(i,!0),s.callbacks=e}let u=new AbortController,c=this,d=async function(){let r,a=null;try{t?.signal?"any"in AbortSignal?r=AbortSignal.any([u.signal,t.signal]):(r=t.signal,a=()=>{u.abort()},t.signal.addEventListener("abort",a,{once:!0})):r=u.signal;let n=await c.stream(e,{...s,signal:r});for await(let e of i.tapOutputIterable(o,n))if(u.signal.aborted)break}finally{await i.finish(),r&&a&&r.removeEventListener("abort",a)}}(),h=!1;try{for await(let t of i){if(!h){t.data.input=e,h=!0,a=t.run_id,yield t;continue}t.run_id===a&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t}}finally{u.abort(),await d}}async *_streamEventsV1(e,t,r){let a,i=!1,n=(0,E.LE)(t),s=n.tags??[],o=n.metadata??{},l=n.runName??this.getName(),u=new g({...r,autoClose:!1,_schemaFormat:"streaming_events"}),c=new k({...r});for await(let t of this._streamLog(e,u,n)){if(void 0===(a=a?a.concat(t):h.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let t={...a.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};c.includeEvent(r,t.type)&&(yield r)}for(let e of[...new Set(t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]))]){let t,r={},i=a.state.logs[e];if("start"==(t=void 0===i.end_time?i.streamed_output.length>0?"stream":"start":"end"))void 0!==i.inputs&&(r.input=i.inputs);else if("end"===t)void 0!==i.inputs&&(r.input=i.inputs),r.output=i.final_output;else if("stream"===t){let e=i.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${i.name}"`);r={chunk:i.streamed_output[0]},i.streamed_output=[]}yield{event:`on_${i.type}_${t}`,name:i.name,run_id:i.id,tags:i.tags,metadata:i.metadata,data:r}}let{state:r}=a;if(r.streamed_output.length>0){let e=r.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${r.name}"`);let t={chunk:r.streamed_output[0]};r.streamed_output=[];let a={event:`on_${r.type}_stream`,run_id:r.id,tags:s,metadata:o,name:l,data:t};c.includeEvent(a,r.type)&&(yield a)}}let d=a?.state;if(void 0!==d){let e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:s,metadata:o,data:{output:d.final_output}};c.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return $(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new J({bound:this,config:{},configFactories:[a=>({callbacks:[new S({config:a,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){var t=this,r=e;let i=r.name??t.getName(),n=r.description??(0,F.$v)(r.schema);return new er((0,F.q$)(r.schema)?{name:i,description:n,schema:a.Ry({input:a.Z_()}).transform(e=>e.input),bound:t}:{name:i,description:n,schema:r.schema,bound:t})}}class J extends H{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=(0,E.t8)(this.config,...e);return(0,E.t8)(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new Z({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig((0,E.LE)(t),this.kwargs))}async batch(e,t,r){let a=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig((0,E.LE)(e),this.kwargs))):await this._mergeConfig((0,E.LE)(t),this.kwargs);return this.bound.batch(e,a,r)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig((0,E.LE)(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig((0,E.LE)(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig((0,E.LE)(t),this.kwargs))}streamEvents(e,t,r){let a=this,i=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig((0,E.LE)(t),a.kwargs),version:t.version},r)};return u.QJ.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&H.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new J({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new S({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class G extends H{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new G({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,(0,E.q)(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new G({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class Z extends J{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return(0,E.q)(t,{callbacks:r?.getChild(a)})}async _invoke(e,t,r){return i(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,a){let n={};try{await i(async i=>{let s,o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(i,t?.[e],r?.[e])),c=await super.batch(l,u,{...a,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&((s=t).input=l[e]),n[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(a?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class W extends H{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r,a=(0,E.LE)(t),i=await (0,E.Le)(a),n=await i?.handleChainStart(this.toJSON(),q(e,"input"),a.runId,void 0,void 0,void 0,a?.runName);delete a.runId;let s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let i=e[r].invoke(s,(0,E.q)(a,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));s=await (0,O.E)(i,t?.signal)}if(t?.signal?.aborted)throw Error("Aborted");r=await this.last.invoke(s,(0,E.q)(a,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(q(r,"output")),r}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(E.Le)),n=await Promise.all(i.map(async(t,r)=>{let i=await t?.handleChainStart(this.toJSON(),q(e[r],"input"),a[r].runId,void 0,void 0,void 0,a[r].runName);return delete a[r].runId,i})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e].batch(s,n.map((t,r)=>{let i=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return(0,E.q)(a[r],{callbacks:i})}),r);s=await (0,O.E)(t,a[0]?.signal)}}catch(e){throw await Promise.all(n.map(t=>t?.handleChainError(e))),e}return await Promise.all(n.map(e=>e?.handleChainEnd(q(s,"output")))),s}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async *_streamIterator(e,t){let r,a=await (0,E.Le)(t),{runId:i,...n}=t??{},s=await a?.handleChainStart(this.toJSON(),q(e,"input"),i,void 0,void 0,void 0,n?.runName),o=[this.first,...this.middle,this.last],l=!0;async function*u(){yield e}try{let e=o[0].transform(u(),(0,E.q)(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,(0,E.q)(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${t+1}`)}))}for await(let a of e)if(t?.signal?.throwIfAborted(),yield a,l)if(void 0===r)r=a;else try{r=this._concatOutputChunks(r,a)}catch(e){r=void 0,l=!1}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(q(r,"output"))}getGraph(e){let t=new N,r=null;return this.steps.forEach((a,i)=>{let n=a.getGraph(e);0!==i&&n.trimFirstNode(),i!==this.steps.length-1&&n.trimLastNode(),t.extend(n);let s=n.firstNode();if(!s)throw Error(`Runnable ${a} has no first node`);r&&t.addEdge(r,s),r=n.lastNode()}),t}pipe(e){return new W(W.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}:{first:this.first,middle:[...this.middle,this.last],last:Q(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&H.isRunnable(e)}static from([e,...t],r){let a={};return"string"==typeof r?a.name=r:void 0!==r&&(a=r),new W({...a,first:Q(e),middle:t.slice(0,-1).map(Q),last:Q(t[t.length-1])})}}class K extends H{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=Q(r)}static from(e){return new K({steps:e})}async invoke(e,t){let r=(0,E.LE)(t),a=await (0,E.Le)(r),i=await a?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let n={};try{let a=Object.entries(this.steps).map(async([t,a])=>{n[t]=await a.invoke(e,(0,E.q)(r,{callbacks:i?.getChild(`map:key:${t}`)}))});await (0,O.E)(Promise.all(a),t?.signal)}catch(e){throw await i?.handleChainError(e),e}return await i?.handleChainEnd(n),n}async *_transform(e,t,r){let a={...this.steps},i=(0,u.y2)(e,Object.keys(a).length),n=new Map(Object.entries(a).map(([e,a],n)=>{let s=a.transform(i[n],(0,E.q)(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;n.size;){let e=Promise.race(n.values()),{key:t,result:a,gen:i}=await (0,O.E)(e,r?.signal);n.delete(t),a.done||(yield{[t]:a.value},n.set(t,i.next().then(e=>({key:t,gen:i,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,E.LE)(t),i=new u.qq({generator:this.transform(r(),a),config:a});return await i.setup,u.QJ.fromAsyncGenerator(i)}}class V extends H{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!(0,s.xQ)(e.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),a=await (0,E.Le)(r),i=this.func((0,E.q)(r,{callbacks:a}),e);return(0,O.E)(i,r?.signal)}async *_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),a=await this.invoke(e,t);if(U(a)){for await(let e of a)r?.signal?.throwIfAborted(),yield e;return}if(null!=a&&"object"==typeof a&&"next"in a&&"function"==typeof a.next){for(;;){r?.signal?.throwIfAborted();let e=a.next();if(e.done)break;yield e.value}return}yield a}static from(e){return new V({func:e})}}class X extends H{static lc_name(){return"RunnableLambda"}constructor(e){if((0,s.xQ)(e.func))return V.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0});var t=e.func;if((0,s.xQ)(t))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.");this.func=e.func}static from(e){return new X({func:e})}async _invoke(e,t,r){return new Promise((a,i)=>{let n=(0,E.q)(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??E.ov)-1});A.AO.runWithConfig((0,E.yG)(n),async()=>{try{let r=await this.func(e,{...n});if(r&&H.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...n,recursionLimit:(n.recursionLimit??E.ov)-1})}else if(U(r)){let e;for await(let a of D(n,r))if(t?.signal?.throwIfAborted(),void 0===e)e=a;else try{e=this._concatOutputChunks(e,a)}catch(t){e=a}r=e}else if(M(r)){let e;for(let a of z(n,r))if(t?.signal?.throwIfAborted(),void 0===e)e=a;else try{e=this._concatOutputChunks(e,a)}catch(t){e=a}r=e}a(r)}catch(e){i(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async *_transform(e,t,r){let a;for await(let t of e)if(void 0===a)a=t;else try{a=this._concatOutputChunks(a,t)}catch(e){a=t}let i=(0,E.q)(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??E.ov)-1}),n=await new Promise((e,t)=>{A.AO.runWithConfig((0,E.yG)(i),async()=>{try{let t=await this.func(a,{...i,config:i});e(t)}catch(e){t(e)}})});if(n&&H.isRunnable(n)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let e of(await n.stream(a,i)))yield e}else if(U(n))for await(let e of D(i,n))r?.signal?.throwIfAborted(),yield e;else if(M(n))for(let e of z(i,n))r?.signal?.throwIfAborted(),yield e;else yield n}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,E.LE)(t),i=new u.qq({generator:this.transform(r(),a),config:a});return await i.setup,u.QJ.fromAsyncGenerator(i)}}class Y extends H{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r=(0,E.LE)(t),a=await (0,E.Le)(r),{runId:i,...n}=r,s=await a?.handleChainStart(this.toJSON(),q(e,"input"),i,void 0,void 0,void 0,n?.runName),o=(0,E.q)(n,{callbacks:s?.getChild()});return await A.AO.runWithConfig(o,async()=>{let t;for(let a of this.runnables()){r?.signal?.throwIfAborted();try{let t=await a.invoke(e,o);return await s?.handleChainEnd(q(t,"output")),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw Error("No error stored at end of fallback.");throw await s?.handleChainError(t),t})}async *_streamIterator(e,t){let r,a,i,n=(0,E.LE)(t),s=await (0,E.Le)(n),{runId:o,...l}=n,u=await s?.handleChainStart(this.toJSON(),q(e,"input"),o,void 0,void 0,void 0,l?.runName);for(let t of this.runnables()){n?.signal?.throwIfAborted();let i=(0,E.q)(l,{callbacks:u?.getChild()});try{let r=await t.stream(e,i);a=D(i,r);break}catch(e){void 0===r&&(r=e)}}if(void 0===a){let e=r??Error("No error stored at end of fallback.");throw await u?.handleChainError(e),e}try{for await(let e of a){yield e;try{i=void 0===i?i:this._concatOutputChunks(i,e)}catch(e){i=void 0}}}catch(e){throw await u?.handleChainError(e),e}await u?.handleChainEnd(q(i,"output"))}async batch(e,t,r){let a;if(r?.returnExceptions)throw Error("Not implemented.");let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(e=>(0,E.Le)(e))),s=await Promise.all(n.map(async(t,r)=>{let a=await t?.handleChainStart(this.toJSON(),q(e[r],"input"),i[r].runId,void 0,void 0,void 0,i[r].runName);return delete i[r].runId,a}));for(let t of this.runnables()){i[0].signal?.throwIfAborted();try{let a=await t.batch(e,s.map((e,t)=>(0,E.q)(i[t],{callbacks:e?.getChild()})),r);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(q(a[t],"output")))),a}catch(e){void 0===a&&(a=e)}}if(!a)throw Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(a))),a}}function Q(e){if("function"==typeof e)return new X({func:e});if(H.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,a]of Object.entries(e))t[r]=Q(a);return new K({steps:t})}}class ee extends H{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof K&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let a=this.mapper.getStepsKeys(),[i,n]=(0,u.y2)(e),s=this.mapper.transform(n,(0,E.q)(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of i){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!a.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,E.LE)(t),i=new u.qq({generator:this.transform(r(),a),config:a});return await i.setup,u.QJ.fromAsyncGenerator(i)}}class et extends H{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,E.LE)(t),i=new u.qq({generator:this.transform(r(),a),config:a});return await i.setup,u.QJ.fromAsyncGenerator(i)}}class er extends J{constructor(e){super({bound:W.from([X.from(async e=>{let t;if((0,B.uB)(e))try{t=await (0,F.Jf)(this.schema,e.args)}catch(t){throw new B.YE("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}},53899:function(e,t,r){"use strict";r.d(t,{LE:()=>u,Le:()=>s,ov:()=>n,q:()=>c,t8:()=>o,yG:()=>d});var a=r(792551),i=r(150629);let n=25;async function s(e){return a.Ye._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function o(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let a=t[e]??[];t[e]=[...new Set(a.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){let e=t.callbacks,i=r.callbacks;if(Array.isArray(i))if(e)if(Array.isArray(e))t.callbacks=e.concat(i);else{let r=e.copy();for(let e of i)r.addHandler((0,a.xz)(e),!0);t.callbacks=r}else t.callbacks=i;else if(i)if(e)if(Array.isArray(e)){let r=i.copy();for(let t of e)r.addHandler((0,a.xz)(t),!0);t.callbacks=r}else t.callbacks=new a.Ye(i._parentRunId,{handlers:e.handlers.concat(i.handlers),inheritableHandlers:e.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(i.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(i.inheritableTags))),metadata:{...e.metadata,...i.metadata}});else t.callbacks=i}else t[e]=r[e]??t[e];return t}let l=new Set(["string","number","boolean"]);function u(e){let t=i.AO.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){let{runId:e,runName:a,...i}=t;r=Object.entries(i).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)}if(e&&(r=Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)),r?.configurable)for(let e of Object.keys(r.configurable))l.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw Error("Timeout must be a positive number");let e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function c(e={},{callbacks:t,maxConcurrency:r,recursionLimit:a,runName:i,configurable:n,runId:s}={}){let o=u(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==a&&(o.recursionLimit=a),void 0!==r&&(o.maxConcurrency=r),void 0!==i&&(o.runName=i),void 0!==n&&(o.configurable={...o.configurable,...n}),void 0!==s&&delete o.runId,o}function d(e){return e?{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal}:void 0}},436147:function(e,t,r){"use strict";r.d(t,{IU:()=>s,aU:()=>i,eO:()=>n});let a=Symbol.for("ls:tracing_async_local_storage"),i=Symbol.for("lc:context_variables"),n=e=>{globalThis[a]=e},s=()=>globalThis[a]},150629:function(e,t,r){"use strict";r.d(t,{AO:()=>l});var a=r(440455),i=r(436147),n=r(792551);let s=new class{getStore(){}run(e,t){return t()}enterWith(e){}},o=Symbol.for("lc:child_config"),l=new class{getInstance(){return(0,i.IU)()??s}getRunnableConfig(){let e=this.getInstance();return e.getStore()?.extra?.[o]}runWithConfig(e,t,r){let s,l=n.Ye._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),u=this.getInstance(),c=u.getStore(),d=l?.getParentRunId(),h=l?.handlers?.find(e=>e?.name==="langchain_tracer");return h&&d?s=h.getRunTreeWithTracingConfig(d):r||(s=new a.IV({name:"<runnable_lambda>",tracingEnabled:!1})),s&&(s.extra={...s.extra,[o]:e}),void 0!==c&&void 0!==c[i.aU]&&(void 0===s&&(s={}),s[i.aU]=c[i.aU]),u.run(s,t)}initializeGlobalInstance(e){void 0===(0,i.IU)()&&(0,i.eO)(e)}}},658207:function(e,t,r){"use strict";function a(e){return!!(e&&"object"==typeof e&&"type"in e&&"tool_call"===e.type)}function i(e){return!!(e&&"object"==typeof e&&"toolCall"in e&&null!=e.toolCall&&"object"==typeof e.toolCall&&"id"in e.toolCall&&"string"==typeof e.toolCall.id)}r.d(t,{YE:()=>n,qS:()=>i,uB:()=>a});class n extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}},261118:function(e,t,r){"use strict";r.d(t,{H:()=>o,Z:()=>l});var a=r(400032),i=r(349981),n=r(257185);function s(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function o(e){return"function"==typeof e._addRunToRunMap}class l extends i.ET{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(void 0!==e)return this.usesRunTreeMap?(e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e})(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:r}=(0,a.Yo)(new Date(e.start_time).getTime(),e.id,e.execution_order),i={...e},s=this.getRunById(i.parent_run_id);if(void 0!==i.parent_run_id?s&&(this._addChildRun(s,i),s.child_execution_order=Math.max(s.child_execution_order,i.child_execution_order),i.trace_id=s.trace_id,void 0!==s.dotted_order&&(i.dotted_order=[s.dotted_order,t].join("."),i._serialized_start_time=r)):(i.trace_id=i.id,i.dotted_order=t,i._serialized_start_time=r),this.usesRunTreeMap){let e=function e(t,r){if(t)return new a.IV({...t,start_time:t._serialized_start_time??t.start_time,parent_run:e(r),child_runs:t.child_runs.map(t=>e(t)).filter(e=>void 0!==e),extra:{...t.extra,runtime:(0,n.h1)()},tracingEnabled:!1})}(i,s);void 0!==e&&this.runTreeMap.set(i.id,e)}else this.runMap.set(i.id,i);return i}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=void 0!==e&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,a,i,n,s,o){let l=this.getRunById(r)??this._createRunForLLMStart(e,t,r,a,i,n,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,a,i,n,s,o){let l=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,a,i,n,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t,r,a,i){let n=this.getRunById(t);if(!n||n?.run_type!=="llm")throw Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),n.extra={...n.extra,...i},await this.onLLMEnd?.(n),await this._endTrace(n),n}async handleLLMError(e,t,r,a,i){let n=this.getRunById(t);if(!n||n?.run_type!=="llm")throw Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),n.extra={...n.extra,...i},await this.onLLMError?.(n),await this._endTrace(n),n}_createRunForChainStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleChainStart(e,t,r,a,i,n,s,o){let l=this.getRunById(r)??this._createRunForChainStart(e,t,r,a,i,n,s,o);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,a,i){let n=this.getRunById(t);if(!n)throw Error("No chain run to end.");return n.end_time=Date.now(),n.outputs=s(e,"output"),n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),i?.inputs!==void 0&&(n.inputs=s(i.inputs,"input")),await this.onChainEnd?.(n),await this._endTrace(n),n}async handleChainError(e,t,r,a,i){let n=this.getRunById(t);if(!n)throw Error("No chain run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),i?.inputs!==void 0&&(n.inputs=s(i.inputs,"input")),await this.onChainError?.(n),await this._endTrace(n),n}_createRunForToolStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,a,i,n,s){let o=this.getRunById(r)??this._createRunForToolStart(e,t,r,a,i,n,s);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,a,i,n,s){let o=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,a,i,n,s);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,i,n){let s=this.getRunById(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:n?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:n?.chunk}),s}}},829070:function(e,t,r){"use strict";r.d(t,{L:()=>o});var a=r(750980),i=r(350709);let n=[400,401,402,403,404,405,406,407,409],s=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&n.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??s;let t="default"in i?i.default:i;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>a(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},257185:function(e,t,r){"use strict";let a;r.d(t,{dU:()=>i,h1:()=>n,lS:()=>s});let i=()=>"undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||"undefined"!=typeof Deno?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":"undefined"!=typeof Deno?"deno":"other":"node";function n(){return void 0===a&&(a={library:"langchain-js",runtime:i()}),a}function s(e){try{if("undefined"!=typeof process)return process.env?.[e];if("undefined"!=typeof Deno)return Deno?.env.get(e);return}catch(e){return}}},127117:function(e,t,r){"use strict";r.d(t,{af:()=>b,qu:()=>x});var a={};r.r(a),r.d(a,{JsonPatchError:()=>p,_areEquals:()=>E,applyOperation:()=>_,applyPatch:()=>b,applyReducer:()=>w,deepClone:()=>f,getValueByPointer:()=>y,validate:()=>O,validator:()=>v});let i=Object.prototype.hasOwnProperty;function n(e,t){return i.call(e,t)}function s(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)n(e,r)&&t.push(r);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t,r=0,a=e.length;for(;r<a;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function u(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function d(e,t){let r=[e];for(let e in t){let a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}class h extends Error{constructor(e,t,r,a,i){super(d(e,{name:t,index:r,operation:a,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=d(e,{name:t,index:r,operation:a,tree:i})}}let p=h,f=o,m={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=y(r,this.path);a&&(a=o(a));let i=_(r,{op:"remove",path:this.from}).removed;return _(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:a}},copy:function(e,t,r){let a=y(r,this.from);return _(r,{op:"add",path:this.path,value:o(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:E(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var g={add:function(e,t,r){return l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:m.move,copy:m.copy,test:m.test,_get:m._get};function y(e,t){if(""==t)return e;var r={op:"_get",path:t};return _(e,r),r.value}function _(e,t,r=!1,a=!0,i=!0,n=0){if(r&&("function"==typeof r?r(t,0,e,t.path):v(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=y(e,t.from),"move"===t.op&&(a.removed=e),a;else if("test"===t.op){if(a.test=E(e,t.value),!1===a.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return a.newDocument=e,a}else if("remove"===t.op)return a.removed=e,a.newDocument=null,a;else if("_get"===t.op)return t.value=e,a;else if(!r)return a;else throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e)}{let s,u,d;a||(e=o(e));let h=(t.path||"").split("/"),f=e,y=1,_=h.length;for(u="function"==typeof r?r:v;;){if((s=h[y])&&-1!=s.indexOf("~")&&(s=c(s)),i&&("__proto__"==s||"prototype"==s&&y>0&&"constructor"==h[y-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===d&&(void 0===f[s]?d=h.slice(0,y).join("/"):y==_-1&&(d=t.path),void 0!==d&&u(t,0,e,d)),y++,Array.isArray(f)){if("-"===s)s=f.length;else if(r&&!l(s))throw new p("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);else l(s)&&(s=~~s);if(y>=_){if(r&&"add"===t.op&&s>f.length)throw new p("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);let a=g[t.op].call(t,f,s,e);if(!1===a.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return a}}else if(y>=_){let r=m[t.op].call(t,f,s,e);if(!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r}if(f=f[s],r&&y<_&&(!f||"object"!=typeof f))throw new p("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function b(e,t,r,a=!0,i=!0){if(r&&!Array.isArray(t))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=o(e));let n=Array(t.length);for(let a=0,s=t.length;a<s;a++)n[a]=_(e,t[a],r,!0,i,a),e=n[a].newDocument;return n.newDocument=e,n}function w(e,t,r){let a=_(e,t);if(!1===a.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function v(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new p("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(m[e.op]){if("string"!=typeof e.path)throw new p("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);else if(0!==e.path.indexOf("/")&&e.path.length>0)throw new p('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);else if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new p("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(e(t[r]))return!0}else if("object"==typeof t){let a=s(t),i=a.length;for(var r=0;r<i;r++)if(e(t[a[r]]))return!0}}return!1}(e.value))throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var i=e.path.split("/").length,n=a.split("/").length;if(i!==n+1&&i!==n)throw new p("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new p("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var o=O([{op:"_get",path:e.from,value:void 0}],r);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new p("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function O(e,t,r){try{if(!Array.isArray(e))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)b(o(t),o(e),r||!0);else{r=r||v;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof p)return e;throw e}}function E(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,i,n=Array.isArray(e),s=Array.isArray(t);if(n&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!E(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!E(e[i=o[r]],t[i]))return!1;return!0}return e!=e&&t!=t}function x(e,t,r=!1){var a=[];return!function e(t,r,a,i,l){if(r!==t){"function"==typeof r.toJSON&&(r=r.toJSON());for(var c=s(r),d=s(t),h=!1,p=d.length-1;p>=0;p--){var f=d[p],m=t[f];if(n(r,f)&&(void 0!==r[f]||void 0===m||!1!==Array.isArray(r))){var g=r[f];"object"==typeof m&&null!=m&&"object"==typeof g&&null!=g&&Array.isArray(m)===Array.isArray(g)?e(m,g,a,i+"/"+u(f),l):m!==g&&(l&&a.push({op:"test",path:i+"/"+u(f),value:o(m)}),a.push({op:"replace",path:i+"/"+u(f),value:o(g)}))}else Array.isArray(t)===Array.isArray(r)?(l&&a.push({op:"test",path:i+"/"+u(f),value:o(m)}),a.push({op:"remove",path:i+"/"+u(f)}),h=!0):(l&&a.push({op:"test",path:i,value:t}),a.push({op:"replace",path:i,value:r}))}if(h||c.length!=d.length)for(var p=0;p<c.length;p++){var f=c[p];n(t,f)||void 0===r[f]||a.push({op:"add",path:i+"/"+u(f),value:o(r[f])})}}}(e,t,a,"",r),a}new WeakMap,{...a,JsonPatchError:h,deepClone:o,escapePathComponent:u,unescapePathComponent:c}},757845:function(e,t,r){"use strict";function a(e,t=i){let r=(e=e.trim()).indexOf("```");if(-1===r)return t(e);let n=e.substring(r+3);n.startsWith("json\n")?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith("\n")&&(n=n.substring(1));let s=n.indexOf("```"),o=n;return -1!==s&&(o=n.substring(0,s)),t(o.trim())}function i(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="",r=[],a=!1,i=!1;for(let n of e){if(a)'"'!==n||i?"\n"!==n||i?i="\\"===n&&!i:n="\\n":a=!1;else if('"'===n)a=!0,i=!1;else if("{"===n)r.push("}");else if("["===n)r.push("]");else if("}"===n||"]"===n)if(!r||r[r.length-1]!==n)return null;else r.pop();t+=n}a&&(t+='"');for(let e=r.length-1;e>=0;e-=1)t+=r[e];try{return JSON.parse(t)}catch(e){return null}}r.d(t,{M:()=>a,g:()=>i})},48389:function(e,t,r){"use strict";let a;r.d(t,{Bx:()=>M});var i=r(608580);let n=Symbol("Let zodToJsonSchema decide on which parser to use"),s={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"};var o=r(628614);let l=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function u(e){if("openAi"!==e.target)return{};let t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?l(t,e.currentPath):t.join("/")}}function c(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function d(e,t,r,a,i){e[t]=r,c(e,t,a,i)}function h(e,t){return R(e.type._def,t)}let p=/^[cC][^\s-]{8,}$/,f=/^[0-9a-z]+$/,m=/^[0-9A-HJKMNP-TV-Z]{26}$/,g=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,y=()=>(void 0===a&&(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a),_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,b=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,w=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,v=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,O=/^[a-zA-Z0-9_-]{21}$/,E=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function x(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":d(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":d(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":k(r,"email",a.message,t);break;case"format:idn-email":k(r,"idn-email",a.message,t);break;case"pattern:zod":A(r,g,a.message,t)}break;case"url":k(r,"uri",a.message,t);break;case"uuid":k(r,"uuid",a.message,t);break;case"regex":A(r,a.regex,a.message,t);break;case"cuid":A(r,p,a.message,t);break;case"cuid2":A(r,f,a.message,t);break;case"startsWith":A(r,RegExp(`^${S(a.value,t)}`),a.message,t);break;case"endsWith":A(r,RegExp(`${S(a.value,t)}$`),a.message,t);break;case"datetime":k(r,"date-time",a.message,t);break;case"date":k(r,"date",a.message,t);break;case"time":k(r,"time",a.message,t);break;case"duration":k(r,"duration",a.message,t);break;case"length":d(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),d(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":A(r,RegExp(S(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&k(r,"ipv4",a.message,t),"v4"!==a.version&&k(r,"ipv6",a.message,t);break;case"base64url":A(r,v,a.message,t);break;case"jwt":A(r,E,a.message,t);break;case"cidr":"v6"!==a.version&&A(r,_,a.message,t),"v4"!==a.version&&A(r,b,a.message,t);break;case"emoji":A(r,y(),a.message,t);break;case"ulid":A(r,m,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":k(r,"binary",a.message,t);break;case"contentEncoding:base64":d(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":A(r,w,a.message,t)}break;case"nanoid":A(r,O,a.message,t)}return r}function S(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)$.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let $=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function k(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):d(e,"format",t,r,a)}function A(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:I(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):d(e,"pattern",I(t,a),r,a)}function I(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,i="",n=!1,s=!1,o=!1;for(let e=0;e<a.length;e++){if(n){i+=a[e],n=!1;continue}if(r.i){if(s){if(a[e].match(/[a-z]/)){o?(i+=a[e],i+=`${a[e-2]}-${a[e]}`.toUpperCase(),o=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(i+=a[e],o=!0):i+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){i+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){i+=`(^|(?<=[\r
]))`;continue}else if("$"===a[e]){i+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){i+=s?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}i+=a[e],"\\"===a[e]?n=!0:s&&"]"===a[e]?s=!1:s||"["!==a[e]||(s=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function P(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===o.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:R(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??u(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:R(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===o.pA.ZodString&&e.keyType._def.checks?.length){let{type:a,...i}=x(e.keyType._def,t);return{...r,propertyNames:i}}if(e.keyType?._def.typeName===o.pA.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===o.pA.ZodBranded&&e.keyType._def.type._def.typeName===o.pA.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...i}=h(e.keyType._def,t);return{...r,propertyNames:i}}return r}let T={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},j=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>R(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function R(e,t,r=!1){let a=t.seen.get(e);if(t.override){let i=t.override?.(e,t,a,r);if(i!==n)return i}if(a&&!r){let e=N(a,t);if(void 0!==e)return e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let s=((e,t,r)=>{switch(t){case o.pA.ZodString:return x(e,r);case o.pA.ZodNumber:let a={type:"number"};if(!e.checks)return a;for(let t of e.checks)switch(t.kind){case"int":a.type="integer",c(a,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?d(a,"minimum",t.value,t.message,r):d(a,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(a.exclusiveMinimum=!0),d(a,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?d(a,"maximum",t.value,t.message,r):d(a,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(a.exclusiveMaximum=!0),d(a,"maximum",t.value,t.message,r));break;case"multipleOf":d(a,"multipleOf",t.value,t.message,r)}return a;case o.pA.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",properties:{}},i=[],n=e.shape();for(let e in n){let s=n[e];if(void 0===s||void 0===s._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(s);o&&r&&("ZodOptional"===s._def.typeName&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);let l=R(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(a.properties[e]=l,o||i.push(e))}i.length&&(a.required=i);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return R(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(a.additionalProperties=s),a}(e,r);case o.pA.ZodBigInt:let i={type:"integer",format:"int64"};if(!e.checks)return i;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?d(i,"minimum",t.value,t.message,r):d(i,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(i.exclusiveMinimum=!0),d(i,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?d(i,"maximum",t.value,t.message,r):d(i,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(i.exclusiveMaximum=!0),d(i,"maximum",t.value,t.message,r));break;case"multipleOf":d(i,"multipleOf",t.value,t.message,r)}return i;case o.pA.ZodBoolean:return{type:"boolean"};case o.pA.ZodDate:return function e(t,r,a){let i=a??r.dateStrategy;if(Array.isArray(i))return{anyOf:i.map((a,i)=>e(t,r,a))};switch(i){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var n=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of n.checks)switch(e.kind){case"min":d(o,"minimum",e.value,e.message,s);break;case"max":d(o,"maximum",e.value,e.message,s)}return o}}(e,r);case o.pA.ZodUndefined:return{not:u(r)};case o.pA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case o.pA.ZodArray:let n={type:"array"};return e.type?._def&&e.type?._def?.typeName!==o.pA.ZodAny&&(n.items=R(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&d(n,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&d(n,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(d(n,"minItems",e.exactLength.value,e.exactLength.message,r),d(n,"maxItems",e.exactLength.value,e.exactLength.message,r)),n;case o.pA.ZodUnion:case o.pA.ZodDiscriminatedUnion:if("openApi3"===r.target)return j(e,r);let s=e.options instanceof Map?Array.from(e.options.values()):e.options;if(s.every(e=>e._def.typeName in T&&(!e._def.checks||!e._def.checks.length))){let e=s.reduce((e,t)=>{let r=T[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(s.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=s.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===s.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:s.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(s.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:s.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return j(e,r);case o.pA.ZodIntersection:let l=[R(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),R(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),p="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,f=[];return l.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)f.push(...e.allOf),void 0===e.unevaluatedProperties&&(p=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else p=void 0;f.push(t)}}),f.length?{allOf:f,...p}:void 0;case o.pA.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>R(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:R(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>R(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case o.pA.ZodRecord:return P(e,r);case o.pA.ZodLiteral:let m=typeof e.value;return"bigint"!==m&&"number"!==m&&"boolean"!==m&&"string"!==m?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===m?"integer":m,enum:[e.value]}:{type:"bigint"===m?"integer":m,const:e.value};case o.pA.ZodEnum:return{type:"string",enum:Array.from(e.values)};case o.pA.ZodNativeEnum:let g=e.values,y=Object.keys(e.values).filter(e=>"number"!=typeof g[g[e]]).map(e=>g[e]),_=Array.from(new Set(y.map(e=>typeof e)));return{type:1===_.length?"string"===_[0]?"string":"number":["string","number"],enum:y};case o.pA.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target?{type:T[e.innerType._def.typeName],nullable:!0}:{type:[T[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=R(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let b=R(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return b&&{anyOf:[b,{type:"null"}]};case o.pA.ZodOptional:if(r.currentPath.toString()===r.propertyPath?.toString())return R(e.innerType._def,r);let w=R(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return w?{anyOf:[{not:u(r)},w]}:u(r);case o.pA.ZodMap:if("record"===r.mapStrategy)return P(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[R(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||u(r),R(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||u(r)],minItems:2,maxItems:2}};case o.pA.ZodSet:let v={type:"array",uniqueItems:!0,items:R(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})};return e.minSize&&d(v,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&d(v,"maxItems",e.maxSize.value,e.maxSize.message,r),v;case o.pA.ZodLazy:return()=>e.getter()._def;case o.pA.ZodPromise:return R(e.type._def,r);case o.pA.ZodNaN:case o.pA.ZodNever:return"openAi"===r.target?void 0:{not:u({...r,currentPath:[...r.currentPath,"not"]})};case o.pA.ZodEffects:return"input"===r.effectStrategy?R(e.schema._def,r):u(r);case o.pA.ZodAny:case o.pA.ZodUnknown:return u(r);case o.pA.ZodDefault:return{...R(e.innerType._def,r),default:e.defaultValue()};case o.pA.ZodBranded:return h(e,r);case o.pA.ZodReadonly:case o.pA.ZodCatch:return R(e.innerType._def,r);case o.pA.ZodPipeline:if("input"===r.pipeStrategy)return R(e.in._def,r);if("output"===r.pipeStrategy)return R(e.out._def,r);let O=R(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),E=R(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",O?"1":"0"]});return{allOf:[O,E].filter(e=>void 0!==e)};case o.pA.ZodFunction:case o.pA.ZodVoid:case o.pA.ZodSymbol:default:return}})(e,e.typeName,t),l="function"==typeof s?R(s(),t):s;if(l&&C(e,t,l),t.postProcess){let r=t.postProcess(l,e,t);return i.jsonSchema=l,r}return i.jsonSchema=l,l}let N=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:l(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),u(t);return"seen"===t.$refStrategy?u(t):void 0}},C=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);r(102149);var L=r(568976);function M(e){if((0,L.Mw)(e)){let t=(0,L.Dn)(e,!0);if(!(0,L.K1)(t))return(0,i.a)(e);{let e=(0,L.IP)(t,!0);return(0,i.a)(e)}}return(0,L.XC)(e)?((e,t)=>{let r=(e=>{let t="string"==typeof e?{...s,name:e}:{...s,...e},r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}})(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:R(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??u(r)}),{}):void 0,i="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,n=R(e._def,void 0===i?r:{...r,currentPath:[...r.basePath,r.definitionPath,i]},!1)??u(r),o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(n.title=o),r.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[r.openAiAnyTypeName]||(a[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===r.$refStrategy?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let l=void 0===i?a?{...n,[r.definitionPath]:a}:n:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:{...a,[i]:n}};return"jsonSchema7"===r.target?l.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in l||"oneOf"in l||"allOf"in l||"type"in l&&Array.isArray(l.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),l})(e):e}},386502:function(e,t,r){"use strict";async function a(e,t){let r;return void 0===t?e:Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,a)=>{r=()=>{a(Error("Aborted"))},t.addEventListener("abort",r),t.aborted&&a(Error("Aborted"))})]).finally(()=>t.removeEventListener("abort",r))}r.d(t,{E:()=>a})},849079:function(e,t,r){"use strict";r.d(t,{E7:()=>u,QJ:()=>s,qq:()=>l,y2:()=>o,zo:()=>function e(t,r){if(Array.isArray(t)&&Array.isArray(r))return t.concat(r);if("string"==typeof t&&"string"==typeof r)return t+r;if("number"==typeof t&&"number"==typeof r)return t+r;if("concat"in t&&"function"==typeof t.concat)return t.concat(r);if("object"==typeof t&&"object"==typeof r){let a={...t};for(let[t,i]of Object.entries(r))t in a&&!Array.isArray(a[t])?a[t]=e(a[t],i):a[t]=i;return a}else throw Error(`Cannot concat ${typeof t} and ${typeof r}`)}});var a=r(53899),i=r(150629),n=r(386502);class s extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new s({start:e=>(function r(){return t.read().then(({done:t,value:a})=>t?void e.close():(e.enqueue(a),r()))})(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new s({async pull(t){let{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function o(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}class l{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{i.AO.runWithConfig((0,a.yG)(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(e=>t(void 0),r)},!0)})}async next(...e){return(this.signal?.throwIfAborted(),this.firstResultUsed)?i.AO.runWithConfig((0,a.yG)(this.config),this.signal?async()=>(0,n.E)(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}}async function u(e,t,r,a,...i){let n=new l({generator:t,startSetup:r,signal:a}),s=await n.setup;return{output:e(n,s,...i),setup:s}}},568976:function(e,t,r){"use strict";r.d(t,{$v:()=>m,Mw:()=>c,q$:()=>g,Jf:()=>f,K1:()=>y,BV:()=>h,IP:()=>function e(t,r=!1){if(d(t))return t.strict();if(y(t)){let a=t._zod.def.shape;if(r)for(let[s,o]of Object.entries(t._zod.def.shape)){if(y(o)){let t=e(o,r);a[s]=t}else if(_(o)){let t=o._zod.def.element;y(t)&&(t=e(t,r)),a[s]=(0,n.d9)(o,{...o._zod.def,element:t})}else a[s]=o;let t=i.$Z.get(o);t&&i.$Z.add(a[s],t)}let s=(0,n.d9)(t,{...t._zod.def,shape:a,catchall:new u({type:"never",...n.de(void 0)})}),o=i.$Z.get(t);return o&&i.$Z.add(s,o),s}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")},Dn:()=>function e(t,r=!1){if(d(t))return d(t)&&"typeName"in t._def&&"ZodEffects"===t._def.typeName?e(t._def.schema,r):t;if(c(t)){let a=t;if(c(t)&&"pipe"===t._zod.def.type&&(a=e(t._zod.def.in,r)),r){if(y(a)){let t=a._zod.def.shape;for(let[i,n]of Object.entries(a._zod.def.shape))t[i]=e(n,r);a=(0,n.d9)(a,{...a._zod.def,shape:t})}else if(_(a)){let t=e(a._zod.def.element,r);a=(0,n.d9)(a,{...a._zod.def,element:t})}}let s=i.$Z.get(t);return s&&i.$Z.add(a,s),a}throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")},AV:()=>p,XC:()=>d});var a=r(297661),i=r(70712),n=r(201988),s=r(492589);let o={major:4,minor:0,patch:0},l=s.IF("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=o;let i=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&i.unshift(e),i))for(let r of t._zod.onattach)r(e);if(0===i.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let a,i=n.Ko(e);for(let o of t){if(o._zod.def.when){if(!o._zod.def.when(e))continue}else if(i)continue;let t=e.issues.length,l=o._zod.check(e);if(l instanceof Promise&&r?.async===!1)throw new s.TG;if(a||l instanceof Promise)a=(a??Promise.resolve()).then(async()=>{await l,e.issues.length!==t&&(i||(i=n.Ko(e,t)))});else{if(e.issues.length===t)continue;i||(i=n.Ko(e,t))}}return a?a.then(()=>e):e};e._zod.run=(r,a)=>{let n=e._zod.parse(r,a);if(n instanceof Promise){if(!1===a.async)throw new s.TG;return n.then(e=>t(e,i,a))}return t(n,i,a)}}e["~standard"]={validate:t=>{try{let r=(0,a.As)(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return(0,a.X9)(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),u=s.IF("$ZodNever",(e,t)=>{l.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function c(e){if("object"!=typeof e||null===e||!("_zod"in e))return!1;let t=e._zod;return"object"==typeof t&&null!==t&&"def"in t}function d(e){if("object"!=typeof e||null===e||!("_def"in e)||"_zod"in e)return!1;let t=e._def;return"object"==typeof t&&null!=t&&"typeName"in t}function h(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&!!(c(e)||d(e))}async function p(e,t){if(c(e))try{let r=await (0,a.Vw)(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(d(e))return e.safeParse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function f(e,t){if(c(e))return(0,a.Qc)(e,t);if(d(e))return e.parse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function m(e){return c(e)?i.$Z.get(e)?.description:d(e)||"description"in e&&"string"==typeof e.description?e.description:void 0}function g(e){return!!h(e)&&(d(e)?"ZodString"===e._def.typeName:!!c(e)&&"string"===e._zod.def.type)}function y(e){return!!c(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"object"===e._zod.def.type||!1)}function _(e){return!!c(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"array"===e._zod.def.type||!1)}},999310:function(e,t,r){"use strict";r.d(t,{Cr:()=>a.Cr,GC:()=>a.GC,HD:()=>a.HD,J:()=>a.J,JG:()=>a.JG,SR:()=>a.SR,VL:()=>a.VL,Xz:()=>a.Xz,Z0:()=>a.Z0,gY:()=>a.gY,jN:()=>a.jN,ro:()=>a.ro,uy:()=>a.uy,xk:()=>a.xk,xq:()=>a.xq});var a=r(727060)},17217:function(e,t,r){"use strict";let a,i,n,s,o,l;function u(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r}function c(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}r.d(t,{z7:()=>iY});let d=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return d=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^r()&15>>e/4).toString(16))};function h(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let p=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class f extends Error{}class m extends f{constructor(e,t,r,a){super(`${m.makeMessage(e,t,r)}`),this.status=e,this.headers=a,this.requestID=a?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let a=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,r,a){if(!e||!a)return new y({message:r,cause:p(t)});let i=t?.error;return 400===e?new b(e,i,r,a):401===e?new w(e,i,r,a):403===e?new v(e,i,r,a):404===e?new O(e,i,r,a):409===e?new E(e,i,r,a):422===e?new x(e,i,r,a):429===e?new S(e,i,r,a):e>=500?new $(e,i,r,a):new m(e,i,r,a)}}class g extends m{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class y extends m{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class _ extends y{constructor({message:e}={}){super({message:e??"Request timed out."})}}class b extends m{}class w extends m{}class v extends m{}class O extends m{}class E extends m{}class x extends m{}class S extends m{}class $ extends m{}class k extends f{constructor(){super("Could not parse response content as the length limit was reached")}}class A extends f{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class I extends Error{constructor(e){super(e)}}let P=/^[a-z][a-z0-9+.-]*:/i,T=e=>(T=Array.isArray)(e),j=T;function R(e){return"object"!=typeof e?{}:e??{}}function N(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let C=e=>new Promise(t=>setTimeout(t,e)),L="5.20.2",M=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",U=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function z(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function D(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return z({start(){},async pull(e){let{done:r,value:a}=await t.next();r?e.close():e.enqueue(a)},async cancel(){await t.return?.()}})}function B(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function F(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}let q=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),H="RFC3986",J=e=>String(e),G={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:J},Z=(e,t)=>(Z=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),W=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function K(e,t){if(T(e)){let r=[];for(let a=0;a<e.length;a+=1)r.push(t(e[a]));return r}return t(e)}let V={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},X=function(e,t){Array.prototype.push.apply(e,T(t)?t:[t])},Y={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,a,i)=>{if(0===e.length)return e;let n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let s="";for(let e=0;e<n.length;e+=1024){let t=n.length>=1024?n.slice(e,e+1024):n,r=[];for(let e=0;e<t.length;++e){let a=t.charCodeAt(e);if(45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||"RFC1738"===i&&(40===a||41===a)){r[r.length]=t.charAt(e);continue}if(a<128){r[r.length]=W[a];continue}if(a<2048){r[r.length]=W[192|a>>6]+W[128|63&a];continue}if(a<55296||a>=57344){r[r.length]=W[224|a>>12]+W[128|a>>6&63]+W[128|63&a];continue}e+=1,a=65536+((1023&a)<<10|1023&t.charCodeAt(e)),r[r.length]=W[240|a>>18]+W[128|a>>12&63]+W[128|a>>6&63]+W[128|63&a]}s+=r.join("")}return s},encodeValuesOnly:!1,format:H,formatter:J,indices:!1,serializeDate:e=>(i??(i=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},Q={};function ee(e){let t;return(n??(n=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function et(e){let t;return(s??(s=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class er{constructor(){t2.set(this,void 0),t5.set(this,void 0),u(this,t2,new Uint8Array,"f"),u(this,t5,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?ee(e):e;u(this,t2,function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),a=0;for(let t of e)r.set(t,a),a+=t.length;return r}([c(this,t2,"f"),r]),"f");let a=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(c(this,t2,"f"),c(this,t5,"f")));){if(t.carriage&&null==c(this,t5,"f")){u(this,t5,t.index,"f");continue}if(null!=c(this,t5,"f")&&(t.index!==c(this,t5,"f")+1||t.carriage)){a.push(et(c(this,t2,"f").subarray(0,c(this,t5,"f")-1))),u(this,t2,c(this,t2,"f").subarray(c(this,t5,"f")),"f"),u(this,t5,null,"f");continue}let e=null!==c(this,t5,"f")?t.preceding-1:t.preceding,r=et(c(this,t2,"f").subarray(0,e));a.push(r),u(this,t2,c(this,t2,"f").subarray(t.index),"f"),u(this,t5,null,"f")}return a}flush(){return c(this,t2,"f").length?this.decode("\n"):[]}}t2=new WeakMap,t5=new WeakMap,er.NEWLINE_CHARS=new Set(["\n","\r"]),er.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ea={off:0,error:200,warn:300,info:400,debug:500},ei=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(ea,e))return e;eu(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ea))}`)}};function en(){}function es(e,t,r){return!t||ea[e]>ea[r]?en:t[e].bind(t)}let eo={error:en,warn:en,info:en,debug:en},el=new WeakMap;function eu(e){let t=e.logger,r=e.logLevel??"off";if(!t)return eo;let a=el.get(t);if(a&&a[0]===r)return a[1];let i={error:es("error",t,r),warn:es("warn",t,r),info:es("info",t,r),debug:es("debug",t,r)};return el.set(t,[r,i]),i}let ec=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class ed{constructor(e,t,r){this.iterator=e,t4.set(this,void 0),this.controller=t,u(this,t4,r,"f")}static fromSSEResponse(e,t,r){let a=!1,i=r?eu(r):console;async function*n(){if(a)throw new f("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let r=!1;try{for await(let a of eh(e,t))if(!r){if(a.data.startsWith("[DONE]")){r=!0;continue}if(null!==a.event&&a.event.startsWith("thread.")){let e;try{e=JSON.parse(a.data)}catch(e){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),e}if("error"==a.event)throw new m(void 0,e.error,e.message,void 0);yield{event:a.event,data:e}}else{let t;try{t=JSON.parse(a.data)}catch(e){throw i.error("Could not parse message into JSON:",a.data),i.error("From chunk:",a.raw),e}if(t&&t.error)throw new m(void 0,t.error,void 0,e.headers);yield t}}r=!0}catch(e){if(h(e))return;throw e}finally{r||t.abort()}}return new ed(n,t,r)}static fromReadableStream(e,t,r){let a=!1;async function*i(){let t=new er;for await(let r of B(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new ed(async function*(){if(a)throw new f("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let e=!1;try{for await(let t of i())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(h(e))return;throw e}finally{e||t.abort()}},t,r)}[(t4=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),a=a=>({next:()=>{if(0===a.length){let a=r.next();e.push(a),t.push(a)}return a.shift()}});return[new ed(()=>a(e),this.controller,c(this,t4,"f")),new ed(()=>a(t),this.controller,c(this,t4,"f"))]}toReadableStream(){let e,t=this;return z({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:a}=await e.next();if(a)return t.close();let i=ee(JSON.stringify(r)+"\n");t.enqueue(i)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*eh(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new f("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new f("Attempted to iterate over a response with no body")}let r=new ef,a=new er;for await(let t of ep(B(e.body)))for(let e of a.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of a.flush()){let t=r.decode(e);t&&(yield t)}}async function*ep(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let a=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?ee(r):r,i=new Uint8Array(t.length+a.length);for(i.set(t),i.set(a,t.length),t=i;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class ef{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=function(e,t){let r=e.indexOf(":");return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return a.startsWith(" ")&&(a=a.substring(1)),"event"===t?this.event=a:"data"===t&&this.data.push(a),null}}async function em(e,t){let{response:r,requestLogID:a,retryOfRequestLogID:i,startTime:n}=t,s=await (async()=>{if(t.options.stream)return(eu(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):ed.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let a=r.headers.get("content-type"),i=a?.split(";")[0]?.trim();return i?.includes("application/json")||i?.endsWith("+json")?eg(await r.json(),r):await r.text()})();return eu(e).debug(`[${a}] response parsed`,ec({retryOfRequestLogID:i,url:r.url,status:r.status,body:s,durationMs:Date.now()-n})),s}function eg(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class ey extends Promise{constructor(e,t,r=em){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,t9.set(this,void 0),u(this,t9,e,"f")}_thenUnwrap(e){return new ey(c(this,t9,"f"),this.responsePromise,async(t,r)=>eg(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(c(this,t9,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}t9=new WeakMap;class e_{constructor(e,t,r,a){t6.set(this,void 0),u(this,t6,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new f("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await c(this,t6,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(t6=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class eb extends ey{constructor(e,t,r){super(e,t,async(e,t)=>new r(e,t.response,await em(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class ew extends e_{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class ev extends e_{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...R(this.options.query),after:t}}:null}}class eO extends e_{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...R(this.options.query),after:e}}:null}}let eE=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ex(e,t,r){return eE(),new File(e,t??"unknown_file",r)}function eS(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let e$=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],ek=async(e,t)=>({...e,body:await eI(e.body,t)}),eA=new WeakMap,eI=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,r=eA.get(t);if(r)return r;let a=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,r=new FormData;if(r.toString()===await new e(r).text())return!1;return!0}catch{return!0}})();return eA.set(t,a),a}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>ej(r,e,t))),r},eP=e=>e instanceof Blob&&"name"in e,eT=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||e$(e)||eP(e)))return!0;if(Array.isArray(e))return e.some(eT);if(e&&"object"==typeof e){for(let t in e)if(eT(e[t]))return!0}return!1},ej=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r instanceof Response)e.append(t,ex([await r.blob()],eS(r)));else if(e$(r))e.append(t,ex([await new Response(D(r)).blob()],eS(r)));else if(eP(r))e.append(t,r,eS(r));else if(Array.isArray(r))await Promise.all(r.map(r=>ej(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,a])=>ej(e,`${t}[${r}]`,a)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}},eR=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function eN(e,t,r){let a,i;if(eE(),null!=(a=e=await e)&&"object"==typeof a&&"string"==typeof a.name&&"number"==typeof a.lastModified&&eR(a))return e instanceof File?e:ex([await e.arrayBuffer()],e.name);if(null!=(i=e)&&"object"==typeof i&&"string"==typeof i.url&&"function"==typeof i.blob){let a=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ex(await eC(a),t,r)}let n=await eC(e);if(t||(t=eS(e)),!r?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r={...r,type:e})}return ex(n,t,r)}async function eC(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(eR(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(e$(e))for await(let r of e)t.push(...await eC(r));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class eL{constructor(e){this._client=e}}function eM(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let eU=Object.freeze(Object.create(null)),ez=((e=eM)=>function(t,...r){let a;if(1===t.length)return t[0];let i=!1,n=[],s=t.reduce((t,a,s)=>{/[?#]/.test(a)&&(i=!0);let o=r[s],l=(i?encodeURIComponent:e)(""+o);return s!==r.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??eU)??eU)?.toString)&&(l=o+"",n.push({start:t.length+a.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+a+(s===r.length?"":l)},""),o=s.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(a=l.exec(o));)n.push({start:a.index,length:a[0].length,error:`Value "${a[0]}" can't be safely passed as a path parameter`});if(n.sort((e,t)=>e.start-t.start),n.length>0){let e=0,t=n.reduce((t,r)=>{let a=" ".repeat(r.start-e),i="^".repeat(r.length);return e=r.start+r.length,t+a+i},"");throw new f(`Path parameters result in path with invalid segments:
${n.map(e=>e.error).join("\n")}
${s}
${t}`)}return s})(eM);class eD extends eL{list(e,t={},r){return this._client.getAPIList(ez`/chat/completions/${e}/messages`,ev,{query:t,...r})}}function eB(e){return void 0!==e&&"function"in e&&void 0!==e.function}function eF(e){return e?.$brand==="auto-parseable-response-format"}function eq(e){return e?.$brand==="auto-parseable-tool"}function eH(e,t){let r=e.choices.map(e=>{var r,a;if("length"===e.finish_reason)throw new k;if("content_filter"===e.finish_reason)throw new A;return eG(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let r=e.tools?.find(e=>eB(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:eq(r)?r.$parseRaw(t.function.arguments):r?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=t,a=e.message.content,r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(a):JSON.parse(a):null):null}}});return{...e,choices:r}}function eJ(e){return!!eF(e.response_format)||(e.tools?.some(e=>eq(e)||"function"===e.type&&!0===e.function.strict)??!1)}function eG(e){for(let t of e||[])if("function"!==t.type)throw new f(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let eZ=e=>e?.role==="assistant",eW=e=>e?.role==="tool";class eK{constructor(){t3.add(this),this.controller=new AbortController,t8.set(this,void 0),t7.set(this,()=>{}),re.set(this,()=>{}),rt.set(this,void 0),rr.set(this,()=>{}),ra.set(this,()=>{}),ri.set(this,{}),rn.set(this,!1),rs.set(this,!1),ro.set(this,!1),rl.set(this,!1),u(this,t8,new Promise((e,t)=>{u(this,t7,e,"f"),u(this,re,t,"f")}),"f"),u(this,rt,new Promise((e,t)=>{u(this,rr,e,"f"),u(this,ra,t,"f")}),"f"),c(this,t8,"f").catch(()=>{}),c(this,rt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},c(this,t3,"m",ru).bind(this))},0)}_connected(){this.ended||(c(this,t7,"f").call(this),this._emit("connect"))}get ended(){return c(this,rn,"f")}get errored(){return c(this,rs,"f")}get aborted(){return c(this,ro,"f")}abort(){this.controller.abort()}on(e,t){return(c(this,ri,"f")[e]||(c(this,ri,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=c(this,ri,"f")[e];if(!r)return this;let a=r.findIndex(e=>e.listener===t);return a>=0&&r.splice(a,1),this}once(e,t){return(c(this,ri,"f")[e]||(c(this,ri,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{u(this,rl,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){u(this,rl,!0,"f"),await c(this,rt,"f")}_emit(e,...t){if(c(this,rn,"f"))return;"end"===e&&(u(this,rn,!0,"f"),c(this,rr,"f").call(this));let r=c(this,ri,"f")[e];if(r&&(c(this,ri,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];c(this,rl,"f")||r?.length||Promise.reject(e),c(this,re,"f").call(this,e),c(this,ra,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];c(this,rl,"f")||r?.length||Promise.reject(e),c(this,re,"f").call(this,e),c(this,ra,"f").call(this,e),this._emit("end")}}_emitFinal(){}}t8=new WeakMap,t7=new WeakMap,re=new WeakMap,rt=new WeakMap,rr=new WeakMap,ra=new WeakMap,ri=new WeakMap,rn=new WeakMap,rs=new WeakMap,ro=new WeakMap,rl=new WeakMap,t3=new WeakSet,ru=function(e){if(u(this,rs,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new g),e instanceof g)return u(this,ro,!0,"f"),this._emit("abort",e);if(e instanceof f)return this._emit("error",e);if(e instanceof Error){let t=new f(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new f(String(e)))};class eV extends eK{constructor(){super(...arguments),rc.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),eW(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(eZ(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new f("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),c(this,rc,"m",rd).call(this)}async finalMessage(){return await this.done(),c(this,rc,"m",rh).call(this)}async finalFunctionToolCall(){return await this.done(),c(this,rc,"m",rp).call(this)}async finalFunctionToolCallResult(){return await this.done(),c(this,rc,"m",rf).call(this)}async totalUsage(){return await this.done(),c(this,rc,"m",rm).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=c(this,rc,"m",rh).call(this);t&&this._emit("finalMessage",t);let r=c(this,rc,"m",rd).call(this);r&&this._emit("finalContent",r);let a=c(this,rc,"m",rp).call(this);a&&this._emit("finalFunctionToolCall",a);let i=c(this,rc,"m",rf).call(this);null!=i&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",c(this,rc,"m",rm).call(this))}async _createChatCompletion(e,t,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),c(this,rc,"m",rg).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(eH(i,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let a="tool",{tool_choice:i="auto",stream:n,...s}=t,o="string"!=typeof i&&"function"===i.type&&i?.function?.name,{maxChatCompletions:l=10}=r||{},u=t.tools.map(e=>{if(eq(e)){if(!e.$callback)throw new f("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),d={};for(let e of u)"function"===e.type&&(d[e.function.name||e.function.function.name]=e.function);let h="tools"in t?u.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...s,tool_choice:i,tools:h,messages:[...this.messages]},r),n=t.choices[0]?.message;if(!n)throw new f("missing message in ChatCompletion response");if(!n.tool_calls?.length)break;for(let e of n.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:i,arguments:n}=e.function,s=d[i];if(s){if(o&&o!==i){let e=`Invalid tool_call: ${JSON.stringify(i)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:a,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(i)}. Available options are: ${Object.keys(d).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:r,content:e});continue}try{t="function"==typeof s.parse?await s.parse(n):n}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:a,tool_call_id:r,content:e});continue}let l=await s.function(t,this),u=c(this,rc,"m",ry).call(this,l);if(this._addMessage({role:a,tool_call_id:r,content:u}),o)return}}}}rc=new WeakSet,rd=function(){return c(this,rc,"m",rh).call(this).content??null},rh=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(eZ(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new f("stream ended without producing a ChatCompletionMessage with role=assistant")},rp=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(eZ(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},rf=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(eW(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},rm=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},rg=function(e){if(null!=e.n&&e.n>1)throw new f("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ry=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class eX extends eV{static runTools(e,t,r){let a=new eX,i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,i)),a}_addMessage(e,t=!0){super._addMessage(e,t),eZ(e)&&e.content&&this._emit("content",e.content)}}let eY=511;class eQ extends Error{}class e0 extends Error{}let e1=e=>(function(e,t=eY){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return((e,t)=>{let r=e.length,a=0,i=e=>{throw new eQ(`${e} at position ${a}`)},n=e=>{throw new e0(`${e} at position ${a}`)},s=()=>(d(),a>=r&&i("Unexpected end of input"),'"'===e[a])?o():"{"===e[a]?l():"["===e[a]?u():"null"===e.substring(a,a+4)||16&t&&r-a<4&&"null".startsWith(e.substring(a))?(a+=4,null):"true"===e.substring(a,a+4)||32&t&&r-a<4&&"true".startsWith(e.substring(a))?(a+=4,!0):"false"===e.substring(a,a+5)||32&t&&r-a<5&&"false".startsWith(e.substring(a))?(a+=5,!1):"Infinity"===e.substring(a,a+8)||128&t&&r-a<8&&"Infinity".startsWith(e.substring(a))?(a+=8,1/0):"-Infinity"===e.substring(a,a+9)||256&t&&1<r-a&&r-a<9&&"-Infinity".startsWith(e.substring(a))?(a+=9,-1/0):"NaN"===e.substring(a,a+3)||64&t&&r-a<3&&"NaN".startsWith(e.substring(a))?(a+=3,NaN):c(),o=()=>{let s=a,o=!1;for(a++;a<r&&('"'!==e[a]||o&&"\\"===e[a-1]);)o="\\"===e[a]&&!o,a++;if('"'==e.charAt(a))try{return JSON.parse(e.substring(s,++a-Number(o)))}catch(e){n(String(e))}else if(1&t)try{return JSON.parse(e.substring(s,a-Number(o))+'"')}catch(t){return JSON.parse(e.substring(s,e.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{a++,d();let n={};try{for(;"}"!==e[a];){if(d(),a>=r&&8&t)return n;let i=o();d(),a++;try{let e=s();Object.defineProperty(n,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(8&t)return n;throw e}d(),","===e[a]&&a++}}catch(e){if(8&t)return n;i("Expected '}' at end of object")}return a++,n},u=()=>{a++;let r=[];try{for(;"]"!==e[a];)r.push(s()),d(),","===e[a]&&a++}catch(e){if(4&t)return r;i("Expected ']' at end of array")}return a++,r},c=()=>{if(0===a){"-"===e&&2&t&&i("Not sure what '-' is");try{return JSON.parse(e)}catch(r){if(2&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}n(String(r))}}let s=a;for("-"===e[a]&&a++;e[a]&&!",]}".includes(e[a]);)a++;a!=r||2&t||i("Unterminated number literal");try{return JSON.parse(e.substring(s,a))}catch(r){"-"===e.substring(s,a)&&2&t&&i("Not sure what '-' is");try{return JSON.parse(e.substring(s,e.lastIndexOf("e")))}catch(e){n(String(e))}}},d=()=>{for(;a<r&&" \n\r	".includes(e[a]);)a++};return s()})(e.trim(),t)})(e,2^eY);class e2 extends eV{constructor(e){super(),r_.add(this),rb.set(this,void 0),rw.set(this,void 0),rv.set(this,void 0),u(this,rb,e,"f"),u(this,rw,[],"f")}get currentChatCompletionSnapshot(){return c(this,rv,"f")}static fromReadableStream(e){let t=new e2(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let a=new e2(t);return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,r){super._createChatCompletion;let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),c(this,r_,"m",rO).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),i))c(this,r_,"m",rx).call(this,e);if(i.controller.signal?.aborted)throw new g;return this._addChatCompletion(c(this,r_,"m",rk).call(this))}async _fromReadableStream(e,t){let r,a=t?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),c(this,r_,"m",rO).call(this),this._connected();let i=ed.fromReadableStream(e,this.controller);for await(let e of i)r&&r!==e.id&&this._addChatCompletion(c(this,r_,"m",rk).call(this)),c(this,r_,"m",rx).call(this,e),r=e.id;if(i.controller.signal?.aborted)throw new g;return this._addChatCompletion(c(this,r_,"m",rk).call(this))}[(rb=new WeakMap,rw=new WeakMap,rv=new WeakMap,r_=new WeakSet,rO=function(){this.ended||u(this,rv,void 0,"f")},rE=function(e){let t=c(this,rw,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},c(this,rw,"f")[e.index]=t),t},rx=function(e){if(this.ended)return;let t=c(this,r_,"m",rI).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let a=c(this,r_,"m",rE).call(this,e);for(let t of(e.finish_reason&&(c(this,r_,"m",r$).call(this,e),null!=a.current_tool_call_index&&c(this,r_,"m",rS).call(this,e,a.current_tool_call_index)),r.delta.tool_calls??[]))a.current_tool_call_index!==t.index&&(c(this,r_,"m",r$).call(this,e),null!=a.current_tool_call_index&&c(this,r_,"m",rS).call(this,e,a.current_tool_call_index)),a.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):r?.type)}}},rS=function(e,t){if(c(this,r_,"m",rE).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=c(this,rb,"f")?.tools?.find(e=>eB(e)&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:eq(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},r$=function(e){let t=c(this,r_,"m",rE).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=c(this,r_,"m",rA).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},rk=function(){if(this.ended)throw new f("stream has ended, this shouldn't happen");let e=c(this,rv,"f");if(!e)throw new f("request ended without sending any chunks");return u(this,rv,void 0,"f"),u(this,rw,[],"f"),function(e,t){var r;let{id:a,choices:i,created:n,model:s,system_fingerprint:o,...l}=e;return r={...l,id:a,choices:i.map(({message:t,finish_reason:r,index:a,logprobs:i,...n})=>{if(!r)throw new f(`missing finish_reason for choice ${a}`);let{content:s=null,function_call:o,tool_calls:l,...u}=t,c=t.role;if(!c)throw new f(`missing role for choice ${a}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new f(`missing function_call.arguments for choice ${a}`);if(!l)throw new f(`missing function_call.name for choice ${a}`);return{...n,message:{content:s,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:r,index:a,logprobs:i}}return l?{...n,index:a,finish_reason:r,logprobs:i,message:{...u,role:c,content:s,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:i,type:n,id:s,...o}=t,{arguments:l,name:u,...c}=i||{};if(null==s)throw new f(`missing choices[${a}].tool_calls[${r}].id
${e5(e)}`);if(null==n)throw new f(`missing choices[${a}].tool_calls[${r}].type
${e5(e)}`);if(null==u)throw new f(`missing choices[${a}].tool_calls[${r}].function.name
${e5(e)}`);if(null==l)throw new f(`missing choices[${a}].tool_calls[${r}].function.arguments
${e5(e)}`);return{...o,id:s,type:n,function:{...c,name:u,arguments:l}}})}}:{...n,message:{...u,content:s,role:c,refusal:t.refusal??null},finish_reason:r,index:a,logprobs:i}}),created:n,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&eJ(t)?eH(r,t):{...r,choices:r.choices.map(e=>(eG(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,c(this,rb,"f"))},rA=function(){let e=c(this,rb,"f")?.response_format;return eF(e)?e:null},rI=function(e){var t,r,a,i;let n=c(this,rv,"f"),{choices:s,...o}=e;for(let{delta:s,finish_reason:l,index:d,logprobs:h=null,...p}of(n?Object.assign(n,o):n=u(this,rv,{...o,choices:[]},"f"),e.choices)){let e=n.choices[d];if(e||(e=n.choices[d]={finish_reason:l,index:d,message:{},logprobs:h,...p}),h)if(e.logprobs){let{content:a,refusal:i,...n}=h;Object.assign(e.logprobs,n),a&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...a)),i&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...i))}else e.logprobs=Object.assign({},h);if(l&&(e.finish_reason=l,c(this,rb,"f")&&eJ(c(this,rb,"f")))){if("length"===l)throw new k;if("content_filter"===l)throw new A}if(Object.assign(e,p),!s)continue;let{content:o,refusal:u,function_call:f,role:m,tool_calls:g,...y}=s;if(Object.assign(e.message,y),u&&(e.message.refusal=(e.message.refusal||"")+u),m&&(e.message.role=m),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((a=e.message.function_call).arguments??(a.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&c(this,r_,"m",rA).call(this)&&(e.message.parsed=e1(e.message.content))),g)for(let{index:t,id:r,type:a,function:n,...s}of(e.message.tool_calls||(e.message.tool_calls=[]),g)){let o=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(o,s),r&&(o.id=r),a&&(o.type=a),n&&(o.function??(o.function={name:n.name??"",arguments:""})),n?.name&&(o.function.name=n.name),n?.arguments&&(o.function.arguments+=n.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let r=e.tools?.find(e=>eB(e)&&e.function?.name===t.function.name);return eB(r)&&(eq(r)||r?.function.strict||!1)}(c(this,rb,"f"),o)&&(o.function.parsed_arguments=e1(o.function.arguments)))}}return n},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),this.on("error",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ed(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function e5(e){return JSON.stringify(e)}class e4 extends e2{static fromReadableStream(e){let t=new e4(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let a=new e4(t),i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,i)),a}}class e9 extends eL{constructor(){super(...arguments),this.messages=new eD(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(ez`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(ez`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",ev,{query:e,...t})}delete(e,t){return this._client.delete(ez`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new f(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new f(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>eH(t,e))}runTools(e,t){return e.stream?e4.runTools(this._client,e,t):eX.runTools(this._client,e,t)}stream(e,t){return e2.createChatCompletion(this._client,e,t)}}e9.Messages=eD;class e6 extends eL{constructor(){super(...arguments),this.completions=new e9(this._client)}}e6.Completions=e9;let e3=Symbol("brand.privateNullableHeaders"),e8=e=>{let t=new Headers,r=new Set;for(let a of e){let e=new Set;for(let[i,n]of function*(e){let t;if(!e)return;if(e3 in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let a of(e instanceof Headers?t=e.entries():j(e)?t=e:(r=!0,t=Object.entries(e??{})),t)){let e=a[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=j(a[1])?a[1]:[a[1]],i=!1;for(let a of t)void 0!==a&&(r&&!i&&(i=!0,yield[e,null]),yield[e,a])}}(a)){let a=i.toLowerCase();e.has(a)||(t.delete(i),e.add(a)),null===n?(t.delete(i),r.add(a)):(t.append(i,n),r.delete(a))}}return{[e3]:!0,values:t,nulls:r}};class e7 extends eL{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:e8([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class te extends eL{create(e,t){return this._client.post("/audio/transcriptions",ek({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class tt extends eL{create(e,t){return this._client.post("/audio/translations",ek({body:e,...t,__metadata:{model:e.model}},this._client))}}class tr extends eL{constructor(){super(...arguments),this.transcriptions=new te(this._client),this.translations=new tt(this._client),this.speech=new e7(this._client)}}tr.Transcriptions=te,tr.Translations=tt,tr.Speech=e7;class ta extends eL{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(ez`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",ev,{query:e,...t})}cancel(e,t){return this._client.post(ez`/batches/${e}/cancel`,t)}}class ti extends eL{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(ez`/assistants/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(ez`/assistants/${e}`,{body:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",ev,{query:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(ez`/assistants/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class tn extends eL{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ts extends eL{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class to extends eL{constructor(){super(...arguments),this.sessions=new tn(this._client),this.transcriptionSessions=new ts(this._client)}}to.Sessions=tn,to.TranscriptionSessions=ts;class tl extends eL{create(e,t,r){return this._client.post(ez`/threads/${e}/messages`,{body:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:a}=t;return this._client.get(ez`/threads/${a}/messages/${e}`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:a,...i}=t;return this._client.post(ez`/threads/${a}/messages/${e}`,{body:i,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(ez`/threads/${e}/messages`,ev,{query:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:a}=t;return this._client.delete(ez`/threads/${a}/messages/${e}`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class tu extends eL{retrieve(e,t,r){let{thread_id:a,run_id:i,...n}=t;return this._client.get(ez`/threads/${a}/runs/${i}/steps/${e}`,{query:n,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:a,...i}=t;return this._client.getAPIList(ez`/threads/${a}/runs/${e}/steps`,ev,{query:i,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}let tc=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class td extends eK{constructor(){super(...arguments),rP.add(this),rj.set(this,[]),rR.set(this,{}),rN.set(this,{}),rC.set(this,void 0),rL.set(this,void 0),rM.set(this,void 0),rU.set(this,void 0),rz.set(this,void 0),rD.set(this,void 0),rB.set(this,void 0),rF.set(this,void 0),rq.set(this,void 0)}[(rj=new WeakMap,rR=new WeakMap,rN=new WeakMap,rC=new WeakMap,rL=new WeakMap,rM=new WeakMap,rU=new WeakMap,rz=new WeakMap,rD=new WeakMap,rB=new WeakMap,rF=new WeakMap,rq=new WeakMap,rP=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),this.on("error",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new rT;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let a=ed.fromReadableStream(e,this.controller);for await(let e of a)c(this,rP,"m",rH).call(this,e);if(a.controller.signal?.aborted)throw new g;return this._addRun(c(this,rP,"m",rJ).call(this))}toReadableStream(){return new ed(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,a){let i=new rT;return i._run(()=>i._runToolAssistantStream(e,t,r,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,a){let i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let n={...r,stream:!0},s=await e.submitToolOutputs(t,n,{...a,signal:this.controller.signal});for await(let e of(this._connected(),s))c(this,rP,"m",rH).call(this,e);if(s.controller.signal?.aborted)throw new g;return this._addRun(c(this,rP,"m",rJ).call(this))}static createThreadAssistantStream(e,t,r){let a=new rT;return a._run(()=>a._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,t,r,a){let i=new rT;return i._run(()=>i._runAssistantStream(e,t,r,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return c(this,rB,"f")}currentRun(){return c(this,rF,"f")}currentMessageSnapshot(){return c(this,rC,"f")}currentRunStepSnapshot(){return c(this,rq,"f")}async finalRunSteps(){return await this.done(),Object.values(c(this,rR,"f"))}async finalMessages(){return await this.done(),Object.values(c(this,rN,"f"))}async finalRun(){if(await this.done(),!c(this,rL,"f"))throw Error("Final run was not received.");return c(this,rL,"f")}async _createThreadAssistantStream(e,t,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},n=await e.createAndRun(i,{...r,signal:this.controller.signal});for await(let e of(this._connected(),n))c(this,rP,"m",rH).call(this,e);if(n.controller.signal?.aborted)throw new g;return this._addRun(c(this,rP,"m",rJ).call(this))}async _createAssistantStream(e,t,r,a){let i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let n={...r,stream:!0},s=await e.create(t,n,{...a,signal:this.controller.signal});for await(let e of(this._connected(),s))c(this,rP,"m",rH).call(this,e);if(s.controller.signal?.aborted)throw new g;return this._addRun(c(this,rP,"m",rJ).call(this))}static accumulateDelta(e,t){for(let[r,a]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=a;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=a;continue}if("string"==typeof t&&"string"==typeof a)t+=a;else if("number"==typeof t&&"number"==typeof a)t+=a;else if(N(t)&&N(a))t=this.accumulateDelta(t,a);else if(Array.isArray(t)&&Array.isArray(a)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...a);continue}for(let e of a){if(!N(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let a=t[r];null==a?t.push(e):t[r]=this.accumulateDelta(a,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${a}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,a){return await this._createAssistantStream(t,e,r,a)}async _runToolAssistantStream(e,t,r,a){return await this._createToolAssistantStream(t,e,r,a)}}rT=td,rH=function(e){if(!this.ended)switch(u(this,rB,e,"f"),c(this,rP,"m",rW).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":c(this,rP,"m",rY).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":c(this,rP,"m",rZ).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":c(this,rP,"m",rG).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},rJ=function(){if(this.ended)throw new f("stream has ended, this shouldn't happen");if(!c(this,rL,"f"))throw Error("Final run has not been received");return c(this,rL,"f")},rG=function(e){let[t,r]=c(this,rP,"m",rV).call(this,e,c(this,rC,"f"));for(let e of(u(this,rC,t,"f"),c(this,rN,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,a=t.content[r.index];if(a&&"text"==a.type)this._emit("textDelta",e,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=c(this,rM,"f")){if(c(this,rU,"f"))switch(c(this,rU,"f").type){case"text":this._emit("textDone",c(this,rU,"f").text,c(this,rC,"f"));break;case"image_file":this._emit("imageFileDone",c(this,rU,"f").image_file,c(this,rC,"f"))}u(this,rM,r.index,"f")}u(this,rU,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==c(this,rM,"f")){let t=e.data.content[c(this,rM,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,c(this,rC,"f"));break;case"text":this._emit("textDone",t.text,c(this,rC,"f"))}}c(this,rC,"f")&&this._emit("messageDone",e.data),u(this,rC,void 0,"f")}},rZ=function(e){let t=c(this,rP,"m",rK).call(this,e);switch(u(this,rq,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==c(this,rz,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(c(this,rD,"f")&&this._emit("toolCallDone",c(this,rD,"f")),u(this,rz,e.index,"f"),u(this,rD,t.step_details.tool_calls[e.index],"f"),c(this,rD,"f")&&this._emit("toolCallCreated",c(this,rD,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":u(this,rq,void 0,"f"),"tool_calls"==e.data.step_details.type&&c(this,rD,"f")&&(this._emit("toolCallDone",c(this,rD,"f")),u(this,rD,void 0,"f")),this._emit("runStepDone",e.data,t)}},rW=function(e){c(this,rj,"f").push(e),this._emit("event",e)},rK=function(e){switch(e.event){case"thread.run.step.created":return c(this,rR,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=c(this,rR,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let a=rT.accumulateDelta(t,r.delta);c(this,rR,"f")[e.data.id]=a}return c(this,rR,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":c(this,rR,"f")[e.data.id]=e.data}if(c(this,rR,"f")[e.data.id])return c(this,rR,"f")[e.data.id];throw Error("No snapshot available")},rV=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(let e of a.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=c(this,rP,"m",rX).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},rX=function(e,t){return rT.accumulateDelta(t,e)},rY=function(e){switch(u(this,rF,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":u(this,rL,e.data,"f"),c(this,rD,"f")&&(this._emit("toolCallDone",c(this,rD,"f")),u(this,rD,void 0,"f"))}};class th extends eL{constructor(){super(...arguments),this.steps=new tu(this._client)}create(e,t,r){let{include:a,...i}=t;return this._client.post(ez`/threads/${e}/runs`,{query:{include:a},body:i,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:a}=t;return this._client.get(ez`/threads/${a}/runs/${e}`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:a,...i}=t;return this._client.post(ez`/threads/${a}/runs/${e}`,{body:i,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(ez`/threads/${e}/runs`,ev,{query:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:a}=t;return this._client.post(ez`/threads/${a}/runs/${e}/cancel`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let a=await this.create(e,t,r);return await this.poll(a.id,{thread_id:e},r)}createAndStream(e,t,r){return td.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let a=e8([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:n}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...a}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=n.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await C(s);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return td.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:a,...i}=t;return this._client.post(ez`/threads/${a}/runs/${e}/submit_tool_outputs`,{body:i,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let a=await this.submitToolOutputs(e,t,r);return await this.poll(a.id,t,r)}submitToolOutputsStream(e,t,r){return td.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}}th.Steps=tu;class tp extends eL{constructor(){super(...arguments),this.runs=new th(this._client),this.messages=new tl(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(ez`/threads/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(ez`/threads/${e}`,{body:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(ez`/threads/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return td.createThreadAssistantStream(e,this._client.beta.threads,t)}}tp.Runs=th,tp.Messages=tl;class tf extends eL{constructor(){super(...arguments),this.realtime=new to(this._client),this.assistants=new ti(this._client),this.threads=new tp(this._client)}}tf.Realtime=to,tf.Assistants=ti,tf.Threads=tp;class tm extends eL{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class tg extends eL{retrieve(e,t,r){let{container_id:a}=t;return this._client.get(ez`/containers/${a}/files/${e}/content`,{...r,headers:e8([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}}class ty extends eL{constructor(){super(...arguments),this.content=new tg(this._client)}create(e,t,r){return this._client.post(ez`/containers/${e}/files`,ek({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:a}=t;return this._client.get(ez`/containers/${a}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(ez`/containers/${e}/files`,ev,{query:t,...r})}delete(e,t,r){let{container_id:a}=t;return this._client.delete(ez`/containers/${a}/files/${e}`,{...r,headers:e8([{Accept:"*/*"},r?.headers])})}}ty.Content=tg;class t_ extends eL{constructor(){super(...arguments),this.files=new ty(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(ez`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",ev,{query:e,...t})}delete(e,t){return this._client.delete(ez`/containers/${e}`,{...t,headers:e8([{Accept:"*/*"},t?.headers])})}}t_.Files=ty;class tb extends eL{create(e,t,r){let{include:a,...i}=t;return this._client.post(ez`/conversations/${e}/items`,{query:{include:a},body:i,...r})}retrieve(e,t,r){let{conversation_id:a,...i}=t;return this._client.get(ez`/conversations/${a}/items/${e}`,{query:i,...r})}list(e,t={},r){return this._client.getAPIList(ez`/conversations/${e}/items`,eO,{query:t,...r})}delete(e,t,r){let{conversation_id:a}=t;return this._client.delete(ez`/conversations/${a}/items/${e}`,r)}}class tw extends eL{constructor(){super(...arguments),this.items=new tb(this._client)}create(e,t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(ez`/conversations/${e}`,t)}update(e,t,r){return this._client.post(ez`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete(ez`/conversations/${e}`,t)}}tw.Items=tb;class tv extends eL{create(e,t){let r=!!e.encoding_format,a=r?e.encoding_format:"base64";r&&eu(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:a},...t});return r?i:(eu(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,a=new Uint8Array(r);for(let e=0;e<r;e++)a[e]=t.charCodeAt(e);return Array.from(new Float32Array(a.buffer))}})(t)}),e)))}}class tO extends eL{retrieve(e,t,r){let{eval_id:a,run_id:i}=t;return this._client.get(ez`/evals/${a}/runs/${i}/output_items/${e}`,r)}list(e,t,r){let{eval_id:a,...i}=t;return this._client.getAPIList(ez`/evals/${a}/runs/${e}/output_items`,ev,{query:i,...r})}}class tE extends eL{constructor(){super(...arguments),this.outputItems=new tO(this._client)}create(e,t,r){return this._client.post(ez`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:a}=t;return this._client.get(ez`/evals/${a}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(ez`/evals/${e}/runs`,ev,{query:t,...r})}delete(e,t,r){let{eval_id:a}=t;return this._client.delete(ez`/evals/${a}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:a}=t;return this._client.post(ez`/evals/${a}/runs/${e}`,r)}}tE.OutputItems=tO;class tx extends eL{constructor(){super(...arguments),this.runs=new tE(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(ez`/evals/${e}`,t)}update(e,t,r){return this._client.post(ez`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",ev,{query:e,...t})}delete(e,t){return this._client.delete(ez`/evals/${e}`,t)}}tx.Runs=tE;class tS extends eL{create(e,t){return this._client.post("/files",ek({body:e,...t},this._client))}retrieve(e,t){return this._client.get(ez`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",ev,{query:e,...t})}delete(e,t){return this._client.delete(ez`/files/${e}`,t)}content(e,t){return this._client.get(ez`/files/${e}/content`,{...t,headers:e8([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let a=new Set(["processed","error","deleted"]),i=Date.now(),n=await this.retrieve(e);for(;!n.status||!a.has(n.status);)if(await C(t),n=await this.retrieve(e),Date.now()-i>r)throw new _({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return n}}class t$ extends eL{}class tk extends eL{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class tA extends eL{constructor(){super(...arguments),this.graders=new tk(this._client)}}tA.Graders=tk;class tI extends eL{create(e,t,r){return this._client.getAPIList(ez`/fine_tuning/checkpoints/${e}/permissions`,ew,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(ez`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:a}=t;return this._client.delete(ez`/fine_tuning/checkpoints/${a}/permissions/${e}`,r)}}class tP extends eL{constructor(){super(...arguments),this.permissions=new tI(this._client)}}tP.Permissions=tI;class tT extends eL{list(e,t={},r){return this._client.getAPIList(ez`/fine_tuning/jobs/${e}/checkpoints`,ev,{query:t,...r})}}class tj extends eL{constructor(){super(...arguments),this.checkpoints=new tT(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(ez`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",ev,{query:e,...t})}cancel(e,t){return this._client.post(ez`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(ez`/fine_tuning/jobs/${e}/events`,ev,{query:t,...r})}pause(e,t){return this._client.post(ez`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(ez`/fine_tuning/jobs/${e}/resume`,t)}}tj.Checkpoints=tT;class tR extends eL{constructor(){super(...arguments),this.methods=new t$(this._client),this.jobs=new tj(this._client),this.checkpoints=new tP(this._client),this.alpha=new tA(this._client)}}tR.Methods=t$,tR.Jobs=tj,tR.Checkpoints=tP,tR.Alpha=tA;class tN extends eL{}class tC extends eL{constructor(){super(...arguments),this.graderModels=new tN(this._client)}}tC.GraderModels=tN;class tL extends eL{createVariation(e,t){return this._client.post("/images/variations",ek({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",ek({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class tM extends eL{retrieve(e,t){return this._client.get(ez`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ew,e)}delete(e,t){return this._client.delete(ez`/models/${e}`,t)}}class tU extends eL{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class tz extends eL{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class tD extends eL{constructor(){super(...arguments),this.clientSecrets=new tz(this._client)}}function tB(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,a;let i=(r=e.tools??[],a=t.name,r.find(e=>"function"===e.type&&e.name===a));return{...t,...t,parsed_arguments:i?.$brand==="auto-parseable-tool"?i.$parseRaw(t.arguments):i?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r,a;return"output_text"===e.type?{...e,parsed:(r=t,a=e.text,r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(a):JSON.parse(a))}:e});return{...e,content:r}}return e}),a=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||tF(a),Object.defineProperty(a,"output_parsed",{enumerable:!0,get(){for(let e of a.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),a}function tF(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}tD.ClientSecrets=tz;class tq extends eK{constructor(e){super(),rQ.add(this),r0.set(this,void 0),r1.set(this,void 0),r2.set(this,void 0),u(this,r0,e,"f")}static createResponse(e,t,r){let a=new tq(t);return a._run(()=>a._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createOrRetrieveResponse(e,t,r){let a,i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),c(this,rQ,"m",r5).call(this);let n=null;for await(let i of("response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),n=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),a))c(this,rQ,"m",r4).call(this,i,n);if(a.controller.signal?.aborted)throw new g;return c(this,rQ,"m",r9).call(this)}[(r0=new WeakMap,r1=new WeakMap,r2=new WeakMap,rQ=new WeakSet,r5=function(){this.ended||u(this,r1,void 0,"f")},r4=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},a=c(this,rQ,"m",r6).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=a.output[e.output_index];if(!t)throw new f(`missing output at index ${e.output_index}`);if("message"===t.type){let a=t.content[e.content_index];if(!a)throw new f(`missing content at index ${e.content_index}`);if("output_text"!==a.type)throw new f(`expected content to be 'output_text', got ${a.type}`);r("response.output_text.delta",{...e,snapshot:a.text})}break}case"response.function_call_arguments.delta":{let t=a.output[e.output_index];if(!t)throw new f(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},r9=function(){if(this.ended)throw new f("stream has ended, this shouldn't happen");let e=c(this,r1,"f");if(!e)throw new f("request ended without sending any events");u(this,r1,void 0,"f");let t=function(e,t){var r;return t&&(r=t,eF(r.text?.format))?tB(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,c(this,r0,"f"));return u(this,r2,t,"f"),t},r6=function(e){let t=c(this,r1,"f");if(!t){if("response.created"!==e.type)throw new f(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return u(this,r1,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new f(`missing output at index ${e.output_index}`);"message"===r.type&&r.content.push(e.part);break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new f(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new f(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new f(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new f(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.completed":u(this,r1,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),this.on("error",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=c(this,r2,"f");if(!e)throw new f("stream ended without producing a ChatCompletion");return e}}class tH extends eL{list(e,t={},r){return this._client.getAPIList(ez`/responses/${e}/input_items`,ev,{query:t,...r})}}class tJ extends eL{constructor(){super(...arguments),this.inputItems=new tH(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&tF(e),e))}retrieve(e,t={},r){return this._client.get(ez`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&tF(e),e))}delete(e,t){return this._client.delete(ez`/responses/${e}`,{...t,headers:e8([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>tB(t,e))}stream(e,t){return tq.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(ez`/responses/${e}/cancel`,t)}}tJ.InputItems=tH;class tG extends eL{create(e,t,r){return this._client.post(ez`/uploads/${e}/parts`,ek({body:t,...r},this._client))}}class tZ extends eL{constructor(){super(...arguments),this.parts=new tG(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(ez`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(ez`/uploads/${e}/complete`,{body:t,...r})}}tZ.Parts=tG;let tW=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let a=[];for(let e of t)"fulfilled"===e.status&&a.push(e.value);return a};class tK extends eL{create(e,t,r){return this._client.post(ez`/vector_stores/${e}/file_batches`,{body:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:a}=t;return this._client.get(ez`/vector_stores/${a}/file_batches/${e}`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:a}=t;return this._client.post(ez`/vector_stores/${a}/file_batches/${e}/cancel`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let a=await this.create(e,t);return await this.poll(e,a.id,r)}listFiles(e,t,r){let{vector_store_id:a,...i}=t;return this._client.getAPIList(ez`/vector_stores/${a}/file_batches/${e}/files`,ev,{query:i,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let a=e8([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:n}=await this.retrieve(t,{vector_store_id:e},{...r,headers:a}).withResponse();switch(i.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=n.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await C(s);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},a){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=Math.min(a?.maxConcurrency??5,t.length),n=this._client,s=t.values(),o=[...r];async function l(e){for(let t of e){let e=await n.files.create({file:t,purpose:"assistants"},a);o.push(e.id)}}let u=Array(i).fill(s).map(l);return await tW(u),await this.createAndPoll(e,{file_ids:o})}}class tV extends eL{create(e,t,r){return this._client.post(ez`/vector_stores/${e}/files`,{body:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:a}=t;return this._client.get(ez`/vector_stores/${a}/files/${e}`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:a,...i}=t;return this._client.post(ez`/vector_stores/${a}/files/${e}`,{body:i,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(ez`/vector_stores/${e}/files`,ev,{query:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:a}=t;return this._client.delete(ez`/vector_stores/${a}/files/${e}`,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let a=await this.create(e,t,r);return await this.poll(e,a.id,r)}async poll(e,t,r){let a=e8([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...r,headers:a}).withResponse(),n=i.data;switch(n.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=i.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await C(s);break;case"failed":case"completed":return n}}}async upload(e,t,r){let a=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:a.id},r)}async uploadAndPoll(e,t,r){let a=await this.upload(e,t,r);return await this.poll(e,a.id,r)}content(e,t,r){let{vector_store_id:a}=t;return this._client.getAPIList(ez`/vector_stores/${a}/files/${e}/content`,ew,{...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class tX extends eL{constructor(){super(...arguments),this.files=new tV(this._client),this.fileBatches=new tK(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(ez`/vector_stores/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(ez`/vector_stores/${e}`,{body:t,...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",ev,{query:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(ez`/vector_stores/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(ez`/vector_stores/${e}/search`,ew,{body:t,method:"post",...r,headers:e8([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}tX.Files=tV,tX.FileBatches=tK;class tY extends eL{constructor(){super(...arguments),r3.add(this)}async unwrap(e,t,r=this._client.webhookSecret,a=300){return await this.verifySignature(e,t,r,a),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,a=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");c(this,r3,"m",r8).call(this,r);let i=e8([t]).values,n=c(this,r3,"m",r7).call(this,i,"webhook-signature"),s=c(this,r3,"m",r7).call(this,i,"webhook-timestamp"),o=c(this,r3,"m",r7).call(this,i,"webhook-id"),l=parseInt(s,10);if(isNaN(l))throw new I("Invalid webhook timestamp format");let u=Math.floor(Date.now()/1e3);if(u-l>a)throw new I("Webhook timestamp is too old");if(l>u+a)throw new I("Webhook timestamp is too new");let d=n.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),p=o?`${o}.${s}.${e}`:`${s}.${e}`,f=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of d)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",f,t,new TextEncoder().encode(p)))return}catch{continue}throw new I("The given webhook signature does not match the expected signature")}}r3=new WeakSet,r8=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},r7=function(e,t){if(!e)throw Error("Headers are required");let r=e.get(t);if(null==r)throw Error(`Missing required header: ${t}`);return r};class tQ{constructor({baseURL:e=tc("OPENAI_BASE_URL"),apiKey:t=tc("OPENAI_API_KEY"),organization:r=tc("OPENAI_ORG_ID")??null,project:a=tc("OPENAI_PROJECT_ID")??null,webhookSecret:i=tc("OPENAI_WEBHOOK_SECRET")??null,...n}={}){if(ae.add(this),ar.set(this,void 0),this.completions=new tm(this),this.chat=new e6(this),this.embeddings=new tv(this),this.files=new tS(this),this.images=new tL(this),this.audio=new tr(this),this.moderations=new tU(this),this.models=new tM(this),this.fineTuning=new tR(this),this.graders=new tC(this),this.vectorStores=new tX(this),this.webhooks=new tY(this),this.beta=new tf(this),this.batches=new ta(this),this.uploads=new tZ(this),this.responses=new tJ(this),this.realtime=new tD(this),this.conversations=new tw(this),this.evals=new tx(this),this.containers=new t_(this),void 0===t)throw new f("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let s={apiKey:t,organization:r,project:a,webhookSecret:i,...n,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new f("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=s.baseURL,this.timeout=s.timeout??at.DEFAULT_TIMEOUT,this.logger=s.logger??console;let o="warn";this.logLevel=o,this.logLevel=ei(s.logLevel,"ClientOptions.logLevel",this)??ei(tc("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=s.fetchOptions,this.maxRetries=s.maxRetries??2,this.fetch=s.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),u(this,ar,q,"f"),this._options=s,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=r,this.project=a,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return e8([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let r,a=e,i=function(e=Y){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||Y.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let a=H;if(void 0!==e.format){if(!Z(G,e.format))throw TypeError("Unknown format option provided.");a=e.format}let i=G[a],n=Y.filter;if(("function"==typeof e.filter||T(e.filter))&&(n=e.filter),t=e.arrayFormat&&e.arrayFormat in V?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":Y.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let s=void 0===e.allowDots?!0==!!e.encodeDotInKeys||Y.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:Y.addQueryPrefix,allowDots:s,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:Y.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:Y.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?Y.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:Y.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:Y.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:Y.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:Y.encodeValuesOnly,filter:n,format:a,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:Y.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:Y.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:Y.strictNullHandling}}(t);"function"==typeof i.filter?a=(0,i.filter)("",a):T(i.filter)&&(r=i.filter);let n=[];if("object"!=typeof a||null===a)return"";let s=V[i.arrayFormat],o="comma"===s&&i.commaRoundTrip;r||(r=Object.keys(a)),i.sort&&r.sort(i.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];i.skipNulls&&null===a[t]||X(n,function e(t,r,a,i,n,s,o,l,u,c,d,h,p,f,m,g,y,_){var b,w;let v,O=t,E=_,x=0,S=!1;for(;void 0!==(E=E.get(Q))&&!S;){let e=E.get(t);if(x+=1,void 0!==e)if(e===x)throw RangeError("Cyclic object value");else S=!0;void 0===E.get(Q)&&(x=0)}if("function"==typeof c?O=c(r,O):O instanceof Date?O=p?.(O):"comma"===a&&T(O)&&(O=K(O,function(e){return e instanceof Date?p?.(e):e})),null===O){if(s)return u&&!g?u(r,Y.encoder,y,"key",f):r;O=""}if("string"==typeof(b=O)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||(w=O)&&"object"==typeof w&&w.constructor&&w.constructor.isBuffer&&w.constructor.isBuffer(w)){if(u){let e=g?r:u(r,Y.encoder,y,"key",f);return[m?.(e)+"="+m?.(u(O,Y.encoder,y,"value",f))]}return[m?.(r)+"="+m?.(String(O))]}let $=[];if(void 0===O)return $;if("comma"===a&&T(O))g&&u&&(O=K(O,u)),v=[{value:O.length>0?O.join(",")||null:void 0}];else if(T(c))v=c;else{let e=Object.keys(O);v=d?e.sort(d):e}let k=l?String(r).replace(/\./g,"%2E"):String(r),A=i&&T(O)&&1===O.length?k+"[]":k;if(n&&T(O)&&0===O.length)return A+"[]";for(let r=0;r<v.length;++r){let b=v[r],w="object"==typeof b&&void 0!==b.value?b.value:O[b];if(o&&null===w)continue;let E=h&&l?b.replace(/\./g,"%2E"):b,S=T(O)?"function"==typeof a?a(A,E):A:A+(h?"."+E:"["+E+"]");_.set(t,x);let k=new WeakMap;k.set(Q,_),X($,e(w,S,a,i,n,s,o,l,"comma"===a&&g&&T(O)?null:u,c,d,h,p,f,m,g,y,k))}return $}(a[t],t,s,o,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,l))}let u=n.join(i.delimiter),c=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),u.length>0?c+u:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${L}`}defaultIdempotencyKey(){return`stainless-node-retry-${d()}`}makeStatusError(e,t,r,a){return m.generate(e,t,r,a)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof f)throw e;throw new f(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new f(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,r){let a=!c(this,ae,"m",aa).call(this)&&r||this.baseURL,i=new URL(P.test(e)?e:a+(a.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(n)&&(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new ey(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let a=await e,i=a.maxRetries??this.maxRetries;null==t&&(t=i),await this.prepareOptions(a);let{req:n,url:s,timeout:o}=await this.buildRequest(a,{retryCount:i-t});await this.prepareRequest(n,{url:s,options:a});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),u=void 0===r?"":`, retryOf: ${r}`,c=Date.now();if(eu(this).debug(`[${l}] sending request`,ec({retryOfRequestLogID:r,method:a.method,url:s,options:a,headers:n.headers})),a.signal?.aborted)throw new g;let d=new AbortController,f=await this.fetchWithTimeout(s,n,o,d).catch(p),m=Date.now();if(f instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(a.signal?.aborted)throw new g;let i=h(f)||/timed? ?out/i.test(String(f)+("cause"in f?String(f.cause):""));if(t)return eu(this).info(`[${l}] connection ${i?"timed out":"failed"} - ${e}`),eu(this).debug(`[${l}] connection ${i?"timed out":"failed"} (${e})`,ec({retryOfRequestLogID:r,url:s,durationMs:m-c,message:f.message})),this.retryRequest(a,t,r??l);if(eu(this).info(`[${l}] connection ${i?"timed out":"failed"} - error; no more retries left`),eu(this).debug(`[${l}] connection ${i?"timed out":"failed"} (error; no more retries left)`,ec({retryOfRequestLogID:r,url:s,durationMs:m-c,message:f.message})),i)throw new _;throw new y({cause:f})}let b=[...f.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),w=`[${l}${u}${b}] ${n.method} ${s} ${f.ok?"succeeded":"failed"} with status ${f.status} in ${m-c}ms`;if(!f.ok){let e=await this.shouldRetry(f);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await F(f.body),eu(this).info(`${w} - ${e}`),eu(this).debug(`[${l}] response error (${e})`,ec({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,durationMs:m-c})),this.retryRequest(a,t,r??l,f.headers)}let i=e?"error; no more retries left":"error; not retryable";eu(this).info(`${w} - ${i}`);let n=await f.text().catch(e=>p(e).message),s=(e=>{try{return JSON.parse(e)}catch(e){return}})(n),o=s?void 0:n;throw eu(this).debug(`[${l}] response error (${i})`,ec({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,message:o,durationMs:Date.now()-c})),this.makeStatusError(f.status,s,o,f.headers)}return eu(this).info(w),eu(this).debug(`[${l}] response start`,ec({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,durationMs:m-c})),{response:f,options:a,controller:d,requestLogID:l,retryOfRequestLogID:r,startTime:c}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){return new eb(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,r,a){let{signal:i,method:n,...s}=t||{};i&&i.addEventListener("abort",()=>a.abort());let o=setTimeout(()=>a.abort(),r),l=globalThis.ReadableStream&&s.body instanceof globalThis.ReadableStream||"object"==typeof s.body&&null!==s.body&&Symbol.asyncIterator in s.body,u={signal:a.signal,...l?{duplex:"half"}:{},method:"GET",...s};n&&(u.method=n.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,r,a){let i,n=a?.get("retry-after-ms");if(n){let e=parseFloat(n);Number.isNaN(e)||(i=e)}let s=a?.get("retry-after");if(s&&!i){let e=parseFloat(s);i=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(i&&0<=i&&i<6e4)){let r=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,r)}return await C(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:a,path:i,query:n,defaultBaseURL:s}=r,o=this.buildURL(i,n,s);"timeout"in r&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new f(`${e} must be an integer`);if(t<0)throw new f(`${e} must be a positive integer`)})("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:u}=this.buildBody({options:r}),c=await this.buildHeaders({options:e,method:a,bodyHeaders:l,retryCount:t});return{req:{method:a,headers:c,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:i}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let s=e8([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...a??(a=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":L,"X-Stainless-OS":U(Deno.build.os),"X-Stainless-Arch":M(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":L,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":L,"X-Stainless-OS":U(globalThis.process.platform??"unknown"),"X-Stainless-Arch":M(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${t}.${a}.${i}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":L,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":L,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=e8([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:D(e)}:c(this,ar,"f").call(this,{body:e,headers:r})}}at=tQ,ar=new WeakMap,ae=new WeakSet,aa=function(){return"https://api.openai.com/v1"!==this.baseURL},tQ.OpenAI=at,tQ.DEFAULT_TIMEOUT=6e5,tQ.OpenAIError=f,tQ.APIError=m,tQ.APIConnectionError=y,tQ.APIConnectionTimeoutError=_,tQ.APIUserAbortError=g,tQ.NotFoundError=O,tQ.ConflictError=E,tQ.RateLimitError=S,tQ.BadRequestError=b,tQ.AuthenticationError=w,tQ.InternalServerError=$,tQ.PermissionDeniedError=v,tQ.UnprocessableEntityError=x,tQ.InvalidWebhookSignatureError=I,tQ.toFile=eN,tQ.Completions=tm,tQ.Chat=e6,tQ.Embeddings=tv,tQ.Files=tS,tQ.Images=tL,tQ.Audio=tr,tQ.Moderations=tU,tQ.Models=tM,tQ.FineTuning=tR,tQ.Graders=tC,tQ.VectorStores=tX,tQ.Webhooks=tY,tQ.Beta=tf,tQ.Batches=ta,tQ.Uploads=tZ,tQ.Responses=tJ,tQ.Realtime=tD,tQ.Conversations=tw,tQ.Evals=tx,tQ.Containers=t_;var t0,t1,t2,t5,t4,t9,t6,t3,t8,t7,re,rt,rr,ra,ri,rn,rs,ro,rl,ru,rc,rd,rh,rp,rf,rm,rg,ry,r_,rb,rw,rv,rO,rE,rx,rS,r$,rk,rA,rI,rP,rT,rj,rR,rN,rC,rL,rM,rU,rz,rD,rB,rF,rq,rH,rJ,rG,rZ,rW,rK,rV,rX,rY,rQ,r0,r1,r2,r5,r4,r9,r6,r3,r8,r7,ae,at,ar,aa,ai=r(608580),an=r(297661),as=r(999310),ao=r(796733),al=r(257185),au=r(727060),ac="object"==typeof window?window:{},ad="0123456789abcdef".split(""),ah=[-0x80000000,8388608,32768,128],ap=[24,16,8,0],af=[];function am(e){e?(af[0]=af[16]=af[1]=af[2]=af[3]=af[4]=af[5]=af[6]=af[7]=af[8]=af[9]=af[10]=af[11]=af[12]=af[13]=af[14]=af[15]=0,this.blocks=af):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=0x67452301,this.h1=0xefcdab89,this.h2=0x98badcfe,this.h3=0x10325476,this.h4=0xc3d2e1f0,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}am.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===ac.ArrayBuffer&&(e=new Uint8Array(e));for(var r,a,i=0,n=e.length||0,s=this.blocks;i<n;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(a=this.start;i<n&&a<64;++i)s[a>>2]|=e[i]<<ap[3&a++];else for(a=this.start;i<n&&a<64;++i)(r=e.charCodeAt(i))<128?s[a>>2]|=r<<ap[3&a++]:(r<2048?s[a>>2]|=(192|r>>6)<<ap[3&a++]:(r<55296||r>=57344?s[a>>2]|=(224|r>>12)<<ap[3&a++]:(r=65536+((1023&r)<<10|1023&e.charCodeAt(++i)),s[a>>2]|=(240|r>>18)<<ap[3&a++],s[a>>2]|=(128|r>>12&63)<<ap[3&a++]),s[a>>2]|=(128|r>>6&63)<<ap[3&a++]),s[a>>2]|=(128|63&r)<<ap[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=s[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000|0,this.bytes=this.bytes%0x100000000),this}},am.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=ah[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},am.prototype.hash=function(){var e,t,r,a=this.h0,i=this.h1,n=this.h2,s=this.h3,o=this.h4,l=this.blocks;for(t=16;t<80;++t)r=l[t-3]^l[t-8]^l[t-14]^l[t-16],l[t]=r<<1|r>>>31;for(t=0;t<20;t+=5)e=i&n|~i&s,o=(r=a<<5|a>>>27)+e+o+0x5a827999+l[t]|0,e=a&(i=i<<30|i>>>2)|~a&n,s=(r=o<<5|o>>>27)+e+s+0x5a827999+l[t+1]|0,e=o&(a=a<<30|a>>>2)|~o&i,n=(r=s<<5|s>>>27)+e+n+0x5a827999+l[t+2]|0,e=s&(o=o<<30|o>>>2)|~s&a,i=(r=n<<5|n>>>27)+e+i+0x5a827999+l[t+3]|0,e=n&(s=s<<30|s>>>2)|~n&o,a=(r=i<<5|i>>>27)+e+a+0x5a827999+l[t+4]|0,n=n<<30|n>>>2;for(;t<40;t+=5)e=i^n^s,o=(r=a<<5|a>>>27)+e+o+0x6ed9eba1+l[t]|0,e=a^(i=i<<30|i>>>2)^n,s=(r=o<<5|o>>>27)+e+s+0x6ed9eba1+l[t+1]|0,e=o^(a=a<<30|a>>>2)^i,n=(r=s<<5|s>>>27)+e+n+0x6ed9eba1+l[t+2]|0,e=s^(o=o<<30|o>>>2)^a,i=(r=n<<5|n>>>27)+e+i+0x6ed9eba1+l[t+3]|0,e=n^(s=s<<30|s>>>2)^o,a=(r=i<<5|i>>>27)+e+a+0x6ed9eba1+l[t+4]|0,n=n<<30|n>>>2;for(;t<60;t+=5)e=i&n|i&s|n&s,o=(r=a<<5|a>>>27)+e+o-0x70e44324+l[t]|0,e=a&(i=i<<30|i>>>2)|a&n|i&n,s=(r=o<<5|o>>>27)+e+s-0x70e44324+l[t+1]|0,e=o&(a=a<<30|a>>>2)|o&i|a&i,n=(r=s<<5|s>>>27)+e+n-0x70e44324+l[t+2]|0,e=s&(o=o<<30|o>>>2)|s&a|o&a,i=(r=n<<5|n>>>27)+e+i-0x70e44324+l[t+3]|0,e=n&(s=s<<30|s>>>2)|n&o|s&o,a=(r=i<<5|i>>>27)+e+a-0x70e44324+l[t+4]|0,n=n<<30|n>>>2;for(;t<80;t+=5)e=i^n^s,o=(r=a<<5|a>>>27)+e+o-0x359d3e2a+l[t]|0,e=a^(i=i<<30|i>>>2)^n,s=(r=o<<5|o>>>27)+e+s-0x359d3e2a+l[t+1]|0,e=o^(a=a<<30|a>>>2)^i,n=(r=s<<5|s>>>27)+e+n-0x359d3e2a+l[t+2]|0,e=s^(o=o<<30|o>>>2)^a,i=(r=n<<5|n>>>27)+e+i-0x359d3e2a+l[t+3]|0,e=n^(s=s<<30|s>>>2)^o,a=(r=i<<5|i>>>27)+e+a-0x359d3e2a+l[t+4]|0,n=n<<30|n>>>2;this.h0=this.h0+a|0,this.h1=this.h1+i|0,this.h2=this.h2+n|0,this.h3=this.h3+s|0,this.h4=this.h4+o|0},am.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,i=this.h4;return ad[e>>28&15]+ad[e>>24&15]+ad[e>>20&15]+ad[e>>16&15]+ad[e>>12&15]+ad[e>>8&15]+ad[e>>4&15]+ad[15&e]+ad[t>>28&15]+ad[t>>24&15]+ad[t>>20&15]+ad[t>>16&15]+ad[t>>12&15]+ad[t>>8&15]+ad[t>>4&15]+ad[15&t]+ad[r>>28&15]+ad[r>>24&15]+ad[r>>20&15]+ad[r>>16&15]+ad[r>>12&15]+ad[r>>8&15]+ad[r>>4&15]+ad[15&r]+ad[a>>28&15]+ad[a>>24&15]+ad[a>>20&15]+ad[a>>16&15]+ad[a>>12&15]+ad[a>>8&15]+ad[a>>4&15]+ad[15&a]+ad[i>>28&15]+ad[i>>24&15]+ad[i>>20&15]+ad[i>>16&15]+ad[i>>12&15]+ad[i>>8&15]+ad[i>>4&15]+ad[15&i]},am.prototype.toString=am.prototype.hex,am.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,i=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,i>>24&255,i>>16&255,i>>8&255,255&i]},am.prototype.array=am.prototype.digest,am.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};let ag=!1;var ay="0123456789abcdef".split(""),a_=[-0x80000000,8388608,32768,128],ab=[24,16,8,0],aw=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],av=[];function aO(e,t){t?(av[0]=av[16]=av[1]=av[2]=av[3]=av[4]=av[5]=av[6]=av[7]=av[8]=av[9]=av[10]=av[11]=av[12]=av[13]=av[14]=av[15]=0,this.blocks=av):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=0xc1059ed8,this.h1=0x367cd507,this.h2=0x3070dd17,this.h3=0xf70e5939,this.h4=0xffc00b31,this.h5=0x68581511,this.h6=0x64f98fa7,this.h7=0xbefa4fa4):(this.h0=0x6a09e667,this.h1=0xbb67ae85,this.h2=0x3c6ef372,this.h3=0xa54ff53a,this.h4=0x510e527f,this.h5=0x9b05688c,this.h6=0x1f83d9ab,this.h7=0x5be0cd19),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}aO.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"===r){if(null===e)throw Error(ERROR);else if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw Error(ERROR)}else throw Error(ERROR);t=!0}for(var a,i,n=0,s=e.length,o=this.blocks;n<s;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(i=this.start;n<s&&i<64;++n)o[i>>>2]|=e[n]<<ab[3&i++];else for(i=this.start;n<s&&i<64;++n)(a=e.charCodeAt(n))<128?o[i>>>2]|=a<<ab[3&i++]:(a<2048?o[i>>>2]|=(192|a>>>6)<<ab[3&i++]:(a<55296||a>=57344?o[i>>>2]|=(224|a>>>12)<<ab[3&i++]:(a=65536+((1023&a)<<10|1023&e.charCodeAt(++n)),o[i>>>2]|=(240|a>>>18)<<ab[3&i++],o[i>>>2]|=(128|a>>>12&63)<<ab[3&i++]),o[i>>>2]|=(128|a>>>6&63)<<ab[3&i++]),o[i>>>2]|=(128|63&a)<<ab[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=o[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000|0,this.bytes=this.bytes%0x100000000),this}},aO.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=a_[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},aO.prototype.hash=function(){var e,t,r,a,i,n,s,o,l,u,c=this.h0,d=this.h1,h=this.h2,p=this.h3,f=this.h4,m=this.h5,g=this.h6,y=this.h7,_=this.blocks;for(e=16;e<64;++e)t=((i=_[e-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,r=((i=_[e-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10,_[e]=_[e-16]+t+_[e-7]+r|0;for(e=0,u=d&h;e<64;e+=4)this.first?(this.is224?(s=300032,y=(i=_[0]-0x543c9a5b)-0x8f1a6c7|0,p=i+0x170e9b5|0):(s=0x2a01a605,y=(i=_[0]-0xc881298)-0x5ab00ac6|0,p=i+0x8909ae5|0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),a=(s=c&d)^c&h^u,i=y+r+(f&m^~f&g)+aw[e]+_[e],n=t+a,y=p+i|0,p=i+n|0),t=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),r=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),a=(o=p&c)^p&d^s,i=m+r+(g&y^~g&f)+aw[e+1]+_[e+1],n=t+a,g=h+i|0,t=((h=i+n|0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),a=(l=h&p)^h&c^o,i=f+r+(m&g^~m&y)+aw[e+2]+_[e+2],n=t+a,m=d+i|0,t=((d=i+n|0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),a=(u=d&h)^d&p^l,i=f+r+(m&g^~m&y)+aw[e+3]+_[e+3],n=t+a,f=c+i|0,c=i+n|0,this.chromeBugWorkAround=!0;this.h0=this.h0+c|0,this.h1=this.h1+d|0,this.h2=this.h2+h|0,this.h3=this.h3+p|0,this.h4=this.h4+f|0,this.h5=this.h5+m|0,this.h6=this.h6+g|0,this.h7=this.h7+y|0},aO.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,i=this.h4,n=this.h5,s=this.h6,o=this.h7,l=ay[e>>>28&15]+ay[e>>>24&15]+ay[e>>>20&15]+ay[e>>>16&15]+ay[e>>>12&15]+ay[e>>>8&15]+ay[e>>>4&15]+ay[15&e]+ay[t>>>28&15]+ay[t>>>24&15]+ay[t>>>20&15]+ay[t>>>16&15]+ay[t>>>12&15]+ay[t>>>8&15]+ay[t>>>4&15]+ay[15&t]+ay[r>>>28&15]+ay[r>>>24&15]+ay[r>>>20&15]+ay[r>>>16&15]+ay[r>>>12&15]+ay[r>>>8&15]+ay[r>>>4&15]+ay[15&r]+ay[a>>>28&15]+ay[a>>>24&15]+ay[a>>>20&15]+ay[a>>>16&15]+ay[a>>>12&15]+ay[a>>>8&15]+ay[a>>>4&15]+ay[15&a]+ay[i>>>28&15]+ay[i>>>24&15]+ay[i>>>20&15]+ay[i>>>16&15]+ay[i>>>12&15]+ay[i>>>8&15]+ay[i>>>4&15]+ay[15&i]+ay[n>>>28&15]+ay[n>>>24&15]+ay[n>>>20&15]+ay[n>>>16&15]+ay[n>>>12&15]+ay[n>>>8&15]+ay[n>>>4&15]+ay[15&n]+ay[s>>>28&15]+ay[s>>>24&15]+ay[s>>>20&15]+ay[s>>>16&15]+ay[s>>>12&15]+ay[s>>>8&15]+ay[s>>>4&15]+ay[15&s];return this.is224||(l+=ay[o>>>28&15]+ay[o>>>24&15]+ay[o>>>20&15]+ay[o>>>16&15]+ay[o>>>12&15]+ay[o>>>8&15]+ay[o>>>4&15]+ay[15&o]),l},aO.prototype.toString=aO.prototype.hex,aO.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,i=this.h4,n=this.h5,s=this.h6,o=this.h7,l=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,a>>>24&255,a>>>16&255,a>>>8&255,255&a,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s];return this.is224||l.push(o>>>24&255,o>>>16&255,o>>>8&255,255&o),l},aO.prototype.array=aO.prototype.digest,aO.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e};var aE=r(711617);let ax=(...e)=>{var t;return t=e.join("_"),ag||(console.warn(`The default method for hashing keys is insecure and will be replaced in a future version,
but hasn't been replaced yet as to not break existing caches. It's recommended that you use
a more secure hashing algorithm to avoid cache poisoning.

See this page for more information:
|
> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm`),ag=!0),new am(!0).update(t).hex()};class aS{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:ax})}makeDefaultKeyEncoder(e){this.keyEncoder=e}}let a$=new Map;class ak extends aS{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new ak(a$)}}var aA=r(92150),aI=r(468501);class aP extends aA.i{}class aT extends aP{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new aI.xk(this.value)]}}class aj extends aP{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,aE.zs)(this.messages)}toChatMessages(){return this.messages}}var aR=r(829070),aN=r(392279),aC=Object.defineProperty,aL=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(let[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,a,...i]=t.split(" "),n=Number.parseInt(a,10);return i.forEach((t,r)=>e[t]=n+r),e},{})))){let e=aN.toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let a=RegExp(this.patStr,"ug"),i=aL.specialTokenRegex(Object.keys(this.specialTokens)),n=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=aL.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;i.lastIndex=r,!(null==(t=i.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(a)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){n.push(r);continue}n.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let a=null;for(let i=0;i<r.length-1;i++){let n=e.slice(r[i].start,r[i+1].end),s=t.get(n.join(","));null!=s&&(null==a||s<a[0])&&(a=[s,i])}if(null!=a){let e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];n.push(u),l=t.index+t[0].length}return n}decode(e){let t=[],r=0;for(let a=0;a<e.length;++a){let i=e[a],n=this.textMap.get(i)??this.inverseSpecialTokens[i];null!=n&&(t.push(n),r+=n.length)}let a=new Uint8Array(r),i=0;for(let e of t)a.set(e,i),i+=e.length;return this.textDecoder.decode(a)}};t0="specialTokenRegex",t1=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),(l="symbol"!=typeof t0?t0+"":t0)in aL?aC(aL,l,{enumerable:!0,configurable:!0,writable:!0,value:t1}):aL[l]=t1;let aM={},aU=new aR.L({});async function az(e){return e in aM||(aM[e]=aU.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new aL(e)).catch(t=>{throw delete aM[e],t})),await aM[e]}async function aD(e){return az(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw Error("Unknown model")}}(e))}var aB=r(806866);function aF(e){return"object"==typeof e&&!!e&&("type"in e&&"function"===e.type&&"function"in e&&"object"==typeof e.function&&!!e.function&&"name"in e.function&&"parameters"in e.function||!1)}class aq extends aB.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class aH extends aq{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){let{cache:a,...i}=r;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof a?this.cache=a:a?this.cache=ak.global():this.cache=void 0,this.caller=new aR.L(r??{})}async getNumTokens(e){let t,r=Math.ceil((t="string"==typeof e?e:e.map(e=>"string"==typeof e?e:"text"===e.type&&"text"in e?e.text:"").join("")).length/4);if(!this._encoding)try{var a;this._encoding=await aD("modelName"in this?(a=this.modelName).startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":a.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":a.startsWith("gpt-4-32k")?"gpt-4-32k":a.startsWith("gpt-4-")?"gpt-4":a.startsWith("gpt-4o")?"gpt-4o":a:"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return r}static _convertInputToPromptValue(e){return"string"==typeof e?new aT(e):Array.isArray(e)?new aj(e.map(aE.E1)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){return Object.entries({...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}}var aJ=r(792551),aG=r(849079),aZ=r(53899);class aW extends aB.eq{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let r=(0,aZ.LE)(t);return this.func&&await this.func(e,r),this._callWithConfig(e=>Promise.resolve(e),e,r)}async *transform(e,t){let r,a=(0,aZ.LE)(t),i=!0;for await(let t of this._transformStreamWithConfig(e,e=>e,a))if(yield t,i)if(void 0===r)r=t;else try{r=(0,aG.zo)(r,t)}catch{r=void 0,i=!1}this.func&&void 0!==r&&await this.func(r,a)}static assign(e){return new aB.Vh(new aB.dT({steps:e}))}}var aK=r(568976),aV=r(349981),aX=r(48389);function aY(e){let t=[];for(let r of e){let e=r;if(Array.isArray(r.content))for(let t=0;t<r.content.length;t++){let a=r.content[t];((0,au.Nu)(a)||(0,au.c1)(a))&&e===r&&(e=new r.constructor({...e,content:[...r.content.slice(0,t),(0,au.j0)(a),...r.content.slice(t+1)]}))}t.push(e)}return t}class aQ extends aH{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){let r=aQ._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}async *_streamIterator(e,t){if(this._streamResponseChunks===aQ.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{let r,a,i=aQ._convertInputToPromptValue(e).toChatMessages(),[n,s]=this._separateRunnableConfigFromCallOptionsCompat(t),o={...n.metadata,...this.getLsParams(s)},l=await aJ.Ye.configure(n.callbacks,this.callbacks,n.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this?.invocationParams(s),batch_size:1},c=await l?.handleChatModelStart(this.toJSON(),[aY(i)],n.runId,void 0,u,void 0,void 0,n.runName);try{for await(let e of this._streamResponseChunks(i,s,c?.[0])){if(null==e.message.id){let t=c?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},yield e.message,r=r?r.concat(e):e,(0,au.wT)(e.message)&&void 0!==e.message.usage_metadata&&(a={tokenUsage:{promptTokens:e.message.usage_metadata.input_tokens,completionTokens:e.message.usage_metadata.output_tokens,totalTokens:e.message.usage_metadata.total_tokens}})}}catch(e){throw await Promise.all((c??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((c??[]).map(e=>e?.handleLLMEnd({generations:[[r]],llmOutput:a})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,r,a){let i,n=e.map(e=>e.map(au.E1));if(void 0!==a&&a.length===n.length)i=a;else{let e={...r.metadata,...this.getLsParams(t)},a=await aJ.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,e,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this?.invocationParams(t),batch_size:1};i=await a?.handleChatModelStart(this.toJSON(),n.map(aY),r.runId,void 0,s,void 0,void 0,r.runName)}let s=[],o=[];if(i?.[0].handlers.find(aV.mb)&&!this.disableStreaming&&1===n.length&&this._streamResponseChunks!==aQ.prototype._streamResponseChunks)try{let e,r;for await(let a of(await this._streamResponseChunks(n[0],t,i?.[0]))){if(null==a.message.id){let e=i?.at(0)?.runId;null!=e&&a.message._updateId(`run-${e}`)}e=void 0===e?a:(0,aG.zo)(e,a),(0,au.wT)(a.message)&&void 0!==a.message.usage_metadata&&(r={tokenUsage:{promptTokens:a.message.usage_metadata.input_tokens,completionTokens:a.message.usage_metadata.output_tokens,totalTokens:a.message.usage_metadata.total_tokens}})}if(void 0===e)throw Error("Received empty response from chat model call.");s.push([e]),await i?.[0].handleLLMEnd({generations:s,llmOutput:r})}catch(e){throw await i?.[0].handleLLMError(e),e}else{let e=await Promise.allSettled(n.map((e,r)=>this._generate(e,{...t,promptIndex:r},i?.[r])));await Promise.all(e.map(async(e,t)=>{if("fulfilled"!==e.status)return await i?.[t]?.handleLLMError(e.reason),Promise.reject(e.reason);{let r=e.value;for(let e of r.generations){if(null==e.message.id){let t=i?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata}}return 1===r.generations.length&&(r.generations[0].message.response_metadata={...r.llmOutput,...r.generations[0].message.response_metadata}),s[t]=r.generations,o[t]=r.llmOutput,i?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}}))}let l={generations:s,llmOutput:o.length?this._combineLLMOutput?.(...o):void 0};return Object.defineProperty(l,ao.WH,{value:i?{runIds:i?.map(e=>e.runId)}:void 0,configurable:!0}),l}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:a,handledOptions:i}){let n=e.map(e=>e.map(au.E1)),s={...i.metadata,...this.getLsParams(a)},o=await aJ.Ye.configure(i.callbacks,this.callbacks,i.tags,this.tags,s,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this?.invocationParams(a),batch_size:1},u=await o?.handleChatModelStart(this.toJSON(),n.map(aY),i.runId,void 0,l,void 0,void 0,i.runName),c=[],d=(await Promise.allSettled(n.map(async(e,a)=>{let i=aQ._convertInputToPromptValue(e).toString(),n=await t.lookup(i,r);return null==n&&c.push(a),n}))).map((e,t)=>({result:e,runManager:u?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),h=[];await Promise.all(d.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let a=e.value;return h[r]=a.map(e=>("message"in e&&(0,au.QW)(e.message)&&(0,au.Z0)(e.message)&&(e.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),a.length&&await t?.handleLLMNewToken(a[0].text),t?.handleLLMEnd({generations:[a]},void 0,void 0,void 0,{cached:!0})}}));let p={generations:h,missingPromptIndices:c,startedRunManagers:u};return Object.defineProperty(p,ao.WH,{value:u?{runIds:u?.map(e=>e.runId)}:void 0,configurable:!0}),p}async generate(e,t,r){let a;a=Array.isArray(t)?{stop:t}:t;let i=e.map(e=>e.map(au.E1)),[n,s]=this._separateRunnableConfigFromCallOptionsCompat(a);if(n.callbacks=n.callbacks??r,!this.cache)return this._generateUncached(i,s,n);let{cache:o}=this,l=this._getSerializedCacheKeyParametersForCall(s),{generations:u,missingPromptIndices:c,startedRunManagers:d}=await this._generateCached({messages:i,cache:o,llmStringKey:l,parsedOptions:s,handledOptions:n}),h={};if(c.length>0){let e=await this._generateUncached(c.map(e=>i[e]),s,n,void 0!==d?c.map(e=>d?.[e]):void 0);await Promise.all(e.generations.map(async(e,t)=>{let r=c[t];u[r]=e;let a=aQ._convertInputToPromptValue(i[r]).toString();return o.update(a,l,e)})),h=e.llmOutput??{}}return{generations:u,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let a=e.map(e=>e.toChatMessages());return this.generate(a,t,r)}async call(e,t,r){return(await this.generate([e.map(au.E1)],t,r)).generations[0][0].message}async callPrompt(e,t,r){let a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let a=new au.xk(e),i=await this.call([a],t,r);if("string"!=typeof i.content)throw Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){let r;if("function"!=typeof this.bindTools)throw Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw Error('"strict" mode is not supported for this model by default.');let a=t?.name,i=(0,aK.$v)(e)??"A function available to call.",n=t?.method,s=t?.includeRaw;if("jsonMode"===n)throw Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let o=a??"extract";(0,aK.BV)(e)?r=[{type:"function",function:{name:o,description:i,parameters:(0,aX.Bx)(e)}}]:("name"in e&&(o=e.name),r=[{type:"function",function:{name:o,description:i,parameters:e}}]);let l=this.bindTools(r),u=aB.Y8.from(e=>{if(!e.tool_calls||0===e.tool_calls.length)throw Error("No tool calls found in the response.");let t=e.tool_calls.find(e=>e.name===o);if(!t)throw Error(`No tool call found with name ${o}.`);return t.args});if(!s)return l.pipe(u).withConfig({runName:"StructuredOutput"});let c=aW.assign({parsed:(e,t)=>u.invoke(e.raw,t)}),d=aW.assign({parsed:()=>null}),h=c.withFallbacks({fallbacks:[d]});return aB.lW.from([{raw:l},h]).withConfig({runName:"StructuredOutputRunnable"})}}aB.eq,aB.eq,aB.pX;var a0=r(986807);class a1 extends aB.eq{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async(e,t)=>this.parseResult([{text:e}],t?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks),e,{...t,runType:"parser"})}}class a2 extends a1{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}}class a5 extends Error{constructor(e,t,r,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=a,a&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");(0,a0.r)(this,"OUTPUT_PARSING_FAILURE")}}var a4=r(102149),a9=r(620712);class a6 extends a2{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class a3 extends a6{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async *_transform(e){let t,r;for await(let a of e){let e;if("string"!=typeof a&&"string"!=typeof a.content)throw Error("Cannot handle non-string output.");if((0,a9.a2)(a)){if("string"!=typeof a.content)throw Error("Cannot handle non-string message output.");e=new ao.Ls({message:a,text:a.content})}else if((0,a9.QW)(a)){if("string"!=typeof a.content)throw Error("Cannot handle non-string message output.");e=new ao.Ls({message:(0,aE.Oy)(a),text:a.content})}else e=new ao.b6({text:a});r=void 0===r?e:r.concat(e);let i=await this.parsePartialResult([r]);null==i||(0,a4.hh)(i,t)||(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}}var a8=r(628614);class a7 extends a2{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(a8.Ry(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,a8.Z_().describe(t)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify((0,aX.Bx)(this.schema))}
\`\`\`
`}async parse(e){try{let t=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(e,t)=>{let r=t.replace(/\n/g,"\\n");return`"${r}"`}).replace(/\n/g,"");return await (0,aK.Jf)(this.schema,JSON.parse(t))}catch(t){throw new a5(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}var ie=r(127117),it=r(757845);class ir extends a3{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?(0,ie.qu)(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return(0,it.M)(e[0].text)}async parse(e){return(0,it.M)(e,JSON.parse)}getFormatInstructions(){return""}}let ia=e=>{if(0===Object.keys(e).length)return{};let t={};return e.children.length>0?t[e.name]=e.children.map(ia):t[e.name]=e.text??void 0,t};var ii=r(197680);function is(e,t){let r;if(void 0===e.function)return;if(t?.partial)try{r=(0,it.g)(e.function.arguments??"{}")}catch(e){return}else try{r=JSON.parse(e.function.arguments)}catch(t){throw new a5([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"\nare not valid JSON.",`Error: ${t.message}`].join("\n"))}let a={name:e.function.name,args:r,type:"tool_call"};return t?.returnId&&(a.id=e.id),a}function io(e){if(void 0===e.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function il(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t,type:"invalid_tool_call"}}class iu extends a3{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw Error("Not supported.")}async parse(){throw Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r,a=e[0].message;if((0,ii.Z0)(a)&&a.tool_calls?.length?r=a.tool_calls.map(e=>{let{id:t,...r}=e;return this.returnId?{id:t,...r}:r}):void 0!==a.additional_kwargs.tool_calls&&(r=JSON.parse(JSON.stringify(a.additional_kwargs.tool_calls)).map(e=>is(e,{returnId:this.returnId,partial:t}))),!r)return[];let i=[];for(let e of r)if(void 0!==e){let t={type:e.name,args:e.args,id:e.id};i.push(t)}return i}}class ic extends iu{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;let t=await (0,aK.AV)(this.zodSchema,e);if(t.success)return t.data;throw new a5(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let t=(await super.parsePartialResult(e)).filter(e=>e.type===this.keyName),r=t;if(t.length)return(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?r[0]:r}async parseResult(e){let t=(await super.parsePartialResult(e,!1)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?this._validateResult(r[0]):await Promise.all(r.map(e=>this._validateResult(e))):void 0}}let id=Symbol("Let zodToJsonSchema decide on which parser to use"),ih={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},ip=e=>"_def"in e?e._def:e;function im(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function ig(e,t,r,a,i){e[t]=r,im(e,t,a,i)}let iy=/^[cC][^\s-]{8,}$/,i_=/^[0-9a-z]+$/,ib=/^[0-9A-HJKMNP-TV-Z]{26}$/,iw=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,iv=()=>(void 0===o&&(o=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),o),iO=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,iE=/^[a-zA-Z0-9_-]{21}$/;function ix(e,t){let r={type:"string"};function a(e){return"escape"===t.patternStrategy?iS(e):e}if(e.checks)for(let i of e.checks)switch(i.kind){case"min":ig(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":ig(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":i$(r,"email",i.message,t);break;case"format:idn-email":i$(r,"idn-email",i.message,t);break;case"pattern:zod":ik(r,iw,i.message,t)}break;case"url":i$(r,"uri",i.message,t);break;case"uuid":i$(r,"uuid",i.message,t);break;case"regex":ik(r,i.regex,i.message,t);break;case"cuid":ik(r,iy,i.message,t);break;case"cuid2":ik(r,i_,i.message,t);break;case"startsWith":ik(r,RegExp(`^${a(i.value)}`),i.message,t);break;case"endsWith":ik(r,RegExp(`${a(i.value)}$`),i.message,t);break;case"datetime":i$(r,"date-time",i.message,t);break;case"date":i$(r,"date",i.message,t);break;case"time":i$(r,"time",i.message,t);break;case"duration":i$(r,"duration",i.message,t);break;case"length":ig(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),ig(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":ik(r,RegExp(a(i.value)),i.message,t);break;case"ip":"v6"!==i.version&&i$(r,"ipv4",i.message,t),"v4"!==i.version&&i$(r,"ipv6",i.message,t);break;case"emoji":ik(r,iv,i.message,t);break;case"ulid":ik(r,ib,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":i$(r,"binary",i.message,t);break;case"contentEncoding:base64":ig(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":ik(r,iO,i.message,t)}break;case"nanoid":ik(r,iE,i.message,t)}return r}let iS=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),i$=(e,t,r,a)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):ig(e,"format",t,r,a)},ik=(e,t,r,a)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:iA(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):ig(e,"pattern",iA(t,a),r,a)},iA=(e,t)=>{let r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;let a={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},i=a.i?r.source.toLowerCase():r.source,n="",s=!1,o=!1,l=!1;for(let e=0;e<i.length;e++){if(s){n+=i[e],s=!1;continue}if(a.i){if(o){if(i[e].match(/[a-z]/)){l?(n+=i[e],n+=`${i[e-2]}-${i[e]}`.toUpperCase(),l=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(n+=i[e],l=!0):n+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){n+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(a.m){if("^"===i[e]){n+=`(^|(?<=[\r
]))`;continue}else if("$"===i[e]){n+=`($|(?=[\r
]))`;continue}}if(a.s&&"."===i[e]){n+=o?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}n+=i[e],"\\"===i[e]?s=!0:o&&"]"===i[e]?o=!1:o||"["!==i[e]||(o=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return n};function iI(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===a8.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:ij(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:ij(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===a8.pA.ZodString&&e.keyType._def.checks?.length){let a=Object.entries(ix(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:{...e,[t]:r},{});return{...r,propertyNames:a}}return e.keyType?._def.typeName===a8.pA.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}let iP={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},iT=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>ij(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function ij(e,t,r=!1){let a=t.seen.get(e);if(t.override){let i=t.override?.(e,t,a,r);if(i!==id)return i}if(a&&!r){let e=iR(a,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let n=iC(e,e.typeName,t,r);return n&&iL(e,t,n),i.jsonSchema=n,n}let iR=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":let r=e.path.slice(t.basePath.length+1).join("_");return r!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[r]=e.def),{$ref:[...t.basePath,t.definitionPath,r].join("/")};case"relative":return{$ref:iN(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},iN=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},iC=(e,t,r,a)=>{switch(t){case a8.pA.ZodString:return ix(e,r);case a8.pA.ZodNumber:let i={type:"number"};if(!e.checks)return i;for(let t of e.checks)switch(t.kind){case"int":i.type="integer",im(i,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?ig(i,"minimum",t.value,t.message,r):ig(i,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(i.exclusiveMinimum=!0),ig(i,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?ig(i,"maximum",t.value,t.message,r):ig(i,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(i.exclusiveMaximum=!0),ig(i,"maximum",t.value,t.message,r));break;case"multipleOf":ig(i,"multipleOf",t.value,t.message,r)}return i;case a8.pA.ZodObject:let n={type:"object",...Object.entries(e.shape()).reduce((e,[t,a])=>{if(void 0===a||void 0===a._def)return e;let i=[...r.currentPath,"properties",t],n=ij(a._def,{...r,currentPath:i,propertyPath:i});if(void 0===n)return e;if(r.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&void 0===a._def?.defaultValue)throw Error(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...e.properties,[t]:n},required:a.isOptional()&&!r.openaiStrictMode?e.required:[...e.required,t]}},{properties:{},required:[]}),additionalProperties:"strict"===r.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:ij(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:ij(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0};return n.required.length||delete n.required,n;case a8.pA.ZodBigInt:let s={type:"integer",format:"int64"};if(!e.checks)return s;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?ig(s,"minimum",t.value,t.message,r):ig(s,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(s.exclusiveMinimum=!0),ig(s,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?ig(s,"maximum",t.value,t.message,r):ig(s,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(s.exclusiveMaximum=!0),ig(s,"maximum",t.value,t.message,r));break;case"multipleOf":ig(s,"multipleOf",t.value,t.message,r)}return s;case a8.pA.ZodBoolean:return{type:"boolean"};case a8.pA.ZodDate:return function e(t,r,a){let i=a??r.dateStrategy;if(Array.isArray(i))return{anyOf:i.map((a,i)=>e(t,r,a))};switch(i){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var n=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of n.checks)switch(e.kind){case"min":ig(o,"minimum",e.value,e.message,s);break;case"max":ig(o,"maximum",e.value,e.message,s)}return o}}(e,r);case a8.pA.ZodUndefined:return{not:{}};case a8.pA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case a8.pA.ZodArray:let o={type:"array"};return e.type?._def?.typeName!==a8.pA.ZodAny&&(o.items=ij(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&ig(o,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&ig(o,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(ig(o,"minItems",e.exactLength.value,e.exactLength.message,r),ig(o,"maxItems",e.exactLength.value,e.exactLength.message,r)),o;case a8.pA.ZodUnion:case a8.pA.ZodDiscriminatedUnion:if("openApi3"===r.target)return iT(e,r);let l=e.options instanceof Map?Array.from(e.options.values()):e.options;if(l.every(e=>e._def.typeName in iP&&(!e._def.checks||!e._def.checks.length))){let e=l.reduce((e,t)=>{let r=iP[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(l.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=l.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===l.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:l.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(l.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:l.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return iT(e,r);case a8.pA.ZodIntersection:let u=[ij(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),ij(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),c="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,d=[];return u.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)d.push(...e.allOf),void 0===e.unevaluatedProperties&&(c=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else c=void 0;d.push(t)}}),d.length?{allOf:d,...c}:void 0;case a8.pA.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>ij(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:ij(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>ij(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case a8.pA.ZodRecord:return iI(e,r);case a8.pA.ZodLiteral:let h=typeof e.value;return"bigint"!==h&&"number"!==h&&"boolean"!==h&&"string"!==h?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===h?"integer":h,enum:[e.value]}:{type:"bigint"===h?"integer":h,const:e.value};case a8.pA.ZodEnum:return{type:"string",enum:[...e.values]};case a8.pA.ZodNativeEnum:let p=e.values,f=Object.keys(e.values).filter(e=>"number"!=typeof p[p[e]]).map(e=>p[e]),m=Array.from(new Set(f.map(e=>typeof e)));return{type:1===m.length?"string"===m[0]?"string":"number":["string","number"],enum:f};case a8.pA.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target||"property"===r.nullableStrategy?{type:iP[e.innerType._def.typeName],nullable:!0}:{type:[iP[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=ij(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let g=ij(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return g&&{anyOf:[g,{type:"null"}]};case a8.pA.ZodOptional:if(r.propertyPath&&r.currentPath.slice(0,r.propertyPath.length).toString()===r.propertyPath.toString())return ij(e.innerType._def,{...r,currentPath:r.currentPath});let y=ij(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return y?{anyOf:[{not:{}},y]}:{};case a8.pA.ZodMap:if("record"===r.mapStrategy)return iI(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[ij(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||{},ij(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case a8.pA.ZodSet:let _={type:"array",uniqueItems:!0,items:ij(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})};return e.minSize&&ig(_,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&ig(_,"maxItems",e.maxSize.value,e.maxSize.message,r),_;case a8.pA.ZodLazy:return ij(e.getter()._def,r);case a8.pA.ZodPromise:return ij(e.type._def,r);case a8.pA.ZodNaN:case a8.pA.ZodNever:return{not:{}};case a8.pA.ZodEffects:return"input"===r.effectStrategy?ij(e.schema._def,r,a):{};case a8.pA.ZodAny:case a8.pA.ZodUnknown:return{};case a8.pA.ZodDefault:return{...ij(e.innerType._def,r),default:e.defaultValue()};case a8.pA.ZodBranded:return ij(e.type._def,r);case a8.pA.ZodReadonly:case a8.pA.ZodCatch:return ij(e.innerType._def,r);case a8.pA.ZodPipeline:if("input"===r.pipeStrategy)return ij(e.in._def,r);if("output"===r.pipeStrategy)return ij(e.out._def,r);let b=ij(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),w=ij(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",b?"1":"0"]});return{allOf:[b,w].filter(e=>void 0!==e)};case a8.pA.ZodFunction:case a8.pA.ZodVoid:case a8.pA.ZodSymbol:default:return}},iL=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);function iM(e){return!!e&&"object"==typeof e&&"name"in e&&"schema"in e&&((0,aK.BV)(e.schema)||null!=e.schema&&"object"==typeof e.schema&&"type"in e.schema&&"string"==typeof e.schema.type&&["null","boolean","object","array","number","string"].includes(e.schema.type))||void 0!==e&&aB.eq.isRunnable(e)&&"lc_name"in e.constructor&&"function"==typeof e.constructor.lc_name&&"RunnableToolLike"===e.constructor.lc_name()||void 0!==e&&Array.isArray(e.lc_namespace)}function iU(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/
`,e}function iz(e){let t;return e.constructor.name===_.name?(t=Error(e.message)).name="TimeoutError":e.constructor.name===g.name?(t=Error(e.message)).name="AbortError":t=400===e.status&&e.message.includes("tool_calls")?iU(e,"INVALID_TOOL_RESULTS"):401===e.status?iU(e,"MODEL_AUTHENTICATION"):429===e.status?iU(e,"MODEL_RATE_LIMIT"):404===e.status?iU(e,"MODEL_NOT_FOUND"):e,t}function iD(e){if(e){if("any"===e||"required"===e)return"required";if("auto"===e)return"auto";if("none"===e)return"none";else if("string"==typeof e)return{type:"function",function:{name:e}};else return e}}function iB(e,t){let r=[];for(let[a,i]of Object.entries(e.properties??{}))i.description&&t<2&&r.push(`// ${i.description}`),e.required?.includes(a)?r.push(`${a}: ${iF(i,t)},`):r.push(`${a}?: ${iF(i,t)},`);return r.map(e=>" ".repeat(t)+e).join("\n")}function iF(e,t){if(void 0!==e.anyOf&&Array.isArray(e.anyOf))return e.anyOf.map(e=>iF(e,t)).join(" | ");switch(e.type){case"string":if(e.enum)return e.enum.map(e=>`"${e}"`).join(" | ");return"string";case"number":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"integer":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",iB(e,t+2),"}"].join("\n");case"array":if(e.items)return`${iF(e.items,t)}[]`;return"any[]";default:return""}}function iq(e){let t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!as.J.isInstance(e))throw Error("Invalid generic chat message");return"system"!==e.role&&"developer"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role;default:throw Error(`Unknown message type: ${t}`)}}let iH={providerName:"ChatOpenAI",fromStandardTextBlock:e=>({type:"text",text:e.text}),fromStandardImageBlock(e){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};if("base64"===e.source_type)return{type:"image_url",image_url:{url:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};throw Error(`Image content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(e){if("url"===e.source_type){let t,r=(0,as.SR)({dataUrl:e.url});if(!r)throw Error(`URL audio blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);let a=r.mime_type||e.mime_type||"";try{t=(0,as.uy)(a)}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:r.data}}}if("base64"===e.source_type){let t;try{t=(0,as.uy)(e.mime_type??"")}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:e.data}}}throw Error(`Audio content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(e){if("url"===e.source_type){if(!(0,as.SR)({dataUrl:e.url}))throw Error(`URL file blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:e.url,...e.metadata?.filename||e.metadata?.name?{filename:e.metadata?.filename||e.metadata?.name}:{}}}}if("base64"===e.source_type)return{type:"file",file:{file_data:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.filename||e.metadata?.name||e.metadata?.title?{filename:e.metadata?.filename||e.metadata?.name||e.metadata?.title}:{}}};if("id"===e.source_type)return{type:"file",file:{file_id:e.id}};throw Error(`File content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)}};function iJ(e,t){return e.flatMap(e=>{let r=iq(e);"system"===r&&iX(t)&&(r="developer");let a={role:r,content:"string"==typeof e.content?e.content:e.content.map(e=>(0,as.JG)(e)?(0,as.VL)(e,iH):e)};return(null!=e.name&&(a.name=e.name),null!=e.additional_kwargs.function_call&&(a.function_call=e.additional_kwargs.function_call,a.content=""),(0,as.Z0)(e)&&e.tool_calls?.length?(a.tool_calls=e.tool_calls.map(io),a.content=""):(null!=e.additional_kwargs.tool_calls&&(a.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(a.tool_call_id=e.tool_call_id)),e.additional_kwargs.audio&&"object"==typeof e.additional_kwargs.audio&&"id"in e.additional_kwargs.audio)?[a,{role:"assistant",audio:{id:e.additional_kwargs.audio.id}}]:a})}let iG="__openai_function_call_ids__";function iZ(e,t,r){return e.flatMap(e=>{let a=e.additional_kwargs,i=iq(e);if("system"===i&&iX(t)&&(i="developer"),"function"===i)throw Error("Function messages are not supported in Responses API");if("tool"===i)return a?.type==="computer_call_output"?{type:"computer_call_output",output:(()=>{if("string"==typeof e.content)return{type:"computer_screenshot",image_url:e.content};if(Array.isArray(e.content)){let t=e.content.find(e=>"computer_screenshot"===e.type);if(t)return t;let r=e.content.find(e=>"image_url"===e.type);if(r)return{type:"computer_screenshot",image_url:"string"==typeof r.image_url?r.image_url:r.image_url.url}}throw Error("Invalid computer call output")})(),call_id:e.tool_call_id}:{type:"function_call_output",call_id:e.tool_call_id,id:e.id?.startsWith("fc_")?e.id:void 0,output:"string"!=typeof e.content?JSON.stringify(e.content):e.content};if("assistant"===i){if(!r&&null!=e.response_metadata.output&&Array.isArray(e.response_metadata.output)&&e.response_metadata.output.length>0&&e.response_metadata.output.every(e=>"type"in e))return e.response_metadata.output;let t=[];if(a?.reasoning&&!r){let e=function(e){let t=(e.summary.length>1?e.summary.reduce((e,t)=>{let r=e.at(-1);return r.index===t.index?r.text+=t.text:e.push(t),e},[{...e.summary[0]}]):e.summary).map(e=>Object.fromEntries(Object.entries(e).filter(([e])=>"index"!==e)));return{...e,summary:t}}(a.reasoning);t.push(e)}let{content:i}=e;a?.refusal&&("string"==typeof i&&(i=[{type:"output_text",text:i,annotations:[]}]),i=[...i,{type:"refusal",refusal:a.refusal}]),t.push({type:"message",role:"assistant",...e.id&&!r&&e.id.startsWith("msg_")?{id:e.id}:{},content:"string"==typeof i?i:i.flatMap(e=>"text"===e.type?{type:"output_text",text:e.text,annotations:e.annotations??[]}:"output_text"===e.type||"refusal"===e.type?e:[])});let n=a?.[iG];(0,as.Z0)(e)&&e.tool_calls?.length?t.push(...e.tool_calls.map(e=>({type:"function_call",name:e.name,arguments:JSON.stringify(e.args),call_id:e.id,...r?{id:n?.[e.id]}:{}}))):a?.tool_calls&&t.push(...a.tool_calls.map(e=>({type:"function_call",name:e.function.name,call_id:e.id,arguments:e.function.arguments,...r?{id:n?.[e.id]}:{}})));let s=e.response_metadata.output?.length?e.response_metadata.output:a.tool_outputs,o=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(null!=s){let e=s?.filter(e=>o.includes(e.type));e.length>0&&t.push(...e)}return t}if("user"===i||"system"===i||"developer"===i){if("string"==typeof e.content)return{type:"message",role:i,content:e.content};let t=[],r=e.content.flatMap(e=>("mcp_approval_response"===e.type&&t.push({type:"mcp_approval_response",approval_request_id:e.approval_request_id,approve:e.approve}),(0,as.JG)(e))?(0,as.VL)(e,iH):"text"===e.type?{type:"input_text",text:e.text}:"image_url"===e.type?{type:"input_image",image_url:"string"==typeof e.image_url?e.image_url:e.image_url.url,detail:"string"==typeof e.image_url?"auto":e.image_url.detail}:"input_text"===e.type||"input_image"===e.type||"input_file"===e.type?e:[]);return r.length>0&&t.push({type:"message",role:i,content:r}),t}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${i}`),[]})}function iW(e){let t;if(e.error){let t=Error(e.error.message);throw t.name=e.error.code,t}let r=[],a=[],i=[],n={model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,service_tier:e.service_tier,model_name:e.model},s={};for(let n of e.output)if("message"===n.type)t=n.id,r.push(...n.content.flatMap(e=>"output_text"===e.type?("parsed"in e&&null!=e.parsed&&(s.parsed=e.parsed),{type:"text",text:e.text,annotations:e.annotations}):"refusal"===e.type?(s.refusal=e.refusal,[]):e));else if("function_call"===n.type){let e={function:{name:n.name,arguments:n.arguments},id:n.call_id};try{a.push(is(e,{returnId:!0}))}catch(r){let t;"object"==typeof r&&null!=r&&"message"in r&&"string"==typeof r.message&&(t=r.message),i.push(il(e,t))}s[iG]??={},n.id&&(s[iG][n.call_id]=n.id)}else"reasoning"===n.type?s.reasoning=n:(s.tool_outputs??=[],s.tool_outputs.push(n));return new as.gY({id:t,content:r,tool_calls:a,invalid_tool_calls:i,usage_metadata:e.usage,additional_kwargs:s,response_metadata:n})}function iK(e){return"type"in e&&"function"!==e.type}function iV(e,t){var r,a,i,n;let s,o;if(aF(e))return t?.strict!==void 0?{...e,function:{...e.function,strict:t.strict}}:e;return s=iM(e)?(o=iM(r=e)?{type:"function",function:{name:(i=r).name,description:i.description,parameters:(0,aX.Bx)(i.schema),...{}}}:r,o):e,t?.strict!==void 0&&(s.function.strict=t.strict),s}function iX(e){return e&&/^o\d/.test(e)}class iY extends aQ{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort","service_tier"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","useResponsesApi","zdrEnabled","reasoning"]}constructor(e){super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??e?.configuration?.apiKey??(0,al.lS)("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=e?.configuration?.organization??(0,al.lS)("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelName=this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoningEffort=e?.reasoningEffort??e?.reasoning?.effort,this.reasoning=e?.reasoning??(e?.reasoningEffort?{effort:e.reasoningEffort}:void 0),this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.useResponsesApi=e?.useResponsesApi??this.useResponsesApi,this.disableStreaming=e?.disableStreaming??this.disableStreaming,this.streaming=e?.streaming??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),e?.service_tier!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=e?.zdrEnabled??!1}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return t?.strict!==void 0?r=t.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(e=>iK(e)?e:iV(e,{strict:r})),...t})}createResponseFormat(e){return e&&"json_schema"===e.type&&e.json_schema.schema&&(0,aK.BV)(e.json_schema.schema)?function(e,t,r){if((0,aK.XC)(e))return function(e,t){let r={...e};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),r}({type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:((e,t)=>{let r=(e=>{let t="string"==typeof e?{...ih,basePath:["#"],definitions:{},name:e}:{...ih,basePath:["#"],definitions:{},...e},r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[ip(r),{def:ip(r),path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}})(t),a="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,i=ij(e._def,void 0===a?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1)??{},n="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==n&&(i.title=n);let s=(()=>{if(function(e){if(!e)return!0;for(let t in e)return!1;return!0}(r.definitions))return;let e={},t=new Set;for(let a=0;a<500;a++){let a=Object.entries(r.definitions).filter(([e])=>!t.has(e));if(0===a.length)break;for(let[i,n]of a)e[i]=ij(ip(n),{...r,currentPath:[...r.basePath,r.definitionPath,i]},!0)??{},t.add(i)}return e})(),o=void 0===a?s?{...i,[r.definitionPath]:s}:i:"duplicate-ref"===r.nameStrategy?{...i,...s||r.seenRefs.size?{[r.definitionPath]:{...s,...r.seenRefs.size?{[a]:i}:void 0}}:void 0}:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...s,[a]:i}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===r.target&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o})(e,{openaiStrictMode:!0,name:{name:t}.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}},t=>e.parse(JSON.parse(t)));if((0,aK.Mw)(e))return function(e,t){let r={...e};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),r}({type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:ai.a(e,{cycles:"ref",reused:"ref",override(e){e.jsonSchema.title=t}})}},t=>an.Qc(e,JSON.parse(t)));throw Error("Unsupported schema response format")}(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}getReasoningParams(e){let t;if(iX(this.model))return void 0!==this.reasoningEffort&&(t={effort:this.reasoningEffort}),void 0!==this.reasoning&&(t={...t,...this.reasoning}),e?.reasoning_effort!==void 0&&(t={...t,effort:e.reasoning_effort}),e?.reasoning!==void 0&&(t={...t,...e.reasoning}),t}invocationParams(e,t){let r;if(e?.strict!==void 0?r=e.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling),this._useResponseApi(e)){var a;let t={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e?.previous_response_id,truncation:e?.truncation,include:e?.include,tools:e?.tools?.length?function(e,t){let r=[];for(let a of e)iK(a)?("image_generation"===a.type&&t?.stream&&(a.partial_images=1),r.push(a)):aF(a)&&r.push({type:"function",name:a.function.name,parameters:a.function.parameters,description:a.function.description,strict:t?.strict??null});return r}(e.tools,{stream:this.streaming,strict:r}):void 0,tool_choice:null!=(a=e?.tool_choice)&&"object"==typeof a&&"type"in a&&"function"!==a.type?e?.tool_choice:(()=>{let t=iD(e?.tool_choice);return"object"==typeof t&&"type"in t?{type:"function",name:t.function.name}:void 0})(),text:(()=>{if(e?.text)return e.text;let t=this.createResponseFormat(e?.response_format);return t?.type==="json_schema"?null!=t.json_schema.schema?{format:{type:"json_schema",schema:t.json_schema.schema,description:t.json_schema.description,name:t.json_schema.name,strict:t.json_schema.strict}}:void 0:{format:t}})(),parallel_tool_calls:e?.parallel_tool_calls,max_output_tokens:-1===this.maxTokens?void 0:this.maxTokens,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},i=this.getReasoningParams(e);return void 0!==i&&(t.reasoning=i),t}let i={};e?.stream_options!==void 0?i={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(i={stream_options:{include_usage:!0}});let n={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(e=>iV(e,{strict:r})):void 0,tool_choice:iD(e?.tool_choice),response_format:this.createResponseFormat(e?.response_format),seed:e?.seed,...i,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs};e?.prediction!==void 0&&(n.prediction=e.prediction),void 0!==this.service_tier&&(n.service_tier=this.service_tier),e?.service_tier!==void 0&&(n.service_tier=e.service_tier);let s=this.getReasoningParams(e);return void 0!==s&&void 0!==s.effort&&(n.reasoning_effort=s.effort),iX(n.model)?n.max_completion_tokens=-1===this.maxTokens?void 0:this.maxTokens:n.max_tokens=-1===this.maxTokens?void 0:this.maxTokens,n}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){let r=e.tool_calls;if("assistant"!==e.role)return new as.J(e.content||"",e.role??"unknown");{let a=[],i=[];for(let e of r??[])try{a.push(is(e,{returnId:!0}))}catch(t){i.push(il(e,t.message))}let n={function_call:e.function_call,tool_calls:r};void 0!==this.__includeRawResponse&&(n.__raw_response=t);let s={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(n.audio=e.audio),new as.gY({content:e.content||"",tool_calls:a,invalid_tool_calls:i,additional_kwargs:n,response_metadata:s,id:t.id})}}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){let a,i=e.role??r,n=e.content??"";a=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});let s={usage:{...t.usage}};if("user"===i)return new as.ro({content:n,response_metadata:s});if("assistant"===i){let r=[];if(Array.isArray(e.tool_calls))for(let t of e.tool_calls)r.push({name:t.function?.name,args:t.function?.arguments,id:t.id,index:t.index,type:"tool_call_chunk"});return new as.GC({content:n,tool_call_chunks:r,additional_kwargs:a,id:t.id,response_metadata:s})}if("system"===i)return new as.xq({content:n,response_metadata:s});if("developer"===i)return new as.xq({content:n,response_metadata:s,additional_kwargs:{__openai_role__:"developer"}});if("function"===i)return new as.Cr({content:n,additional_kwargs:a,name:e.name,response_metadata:s});else if("tool"===i)return new as.Xz({content:n,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:s});else return new as.HD({content:n,role:i,response_metadata:s})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async *_streamResponseChunks(e,t,r){let a,i;if(this._useResponseApi(t)){for await(let r of(await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:iZ(e,this.model,this.zdrEnabled),stream:!0},t))){let e=function(e){let t,r,a=[],i={},n=[],s={},o={};if("response.output_text.delta"===e.type)a.push({type:"text",text:e.delta,index:e.content_index});else if("response.output_text_annotation.added"===e.type)a.push({type:"text",text:"",annotations:[e.annotation],index:e.content_index});else if("response.output_item.added"===e.type&&"message"===e.item.type)r=e.item.id;else if("response.output_item.added"===e.type&&"function_call"===e.item.type)n.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),o[iG]={[e.item.call_id]:e.item.id};else if("response.output_item.done"===e.type&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call"].includes(e.item.type))o.tool_outputs=[e.item];else if("response.created"===e.type)s.id=e.response.id,s.model_name=e.response.model,s.model=e.response.model;else if("response.completed"===e.type){let r=iW(e.response);for(let[a,i]of(t=e.response.usage,e.response.text?.format?.type==="json_schema"&&(o.parsed??=JSON.parse(r.text)),Object.entries(e.response)))"id"!==a&&(s[a]=i)}else if("response.function_call_arguments.delta"===e.type)n.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if("response.web_search_call.completed"===e.type||"response.file_search_call.completed"===e.type)i={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if("response.refusal.done"===e.type)o.refusal=e.refusal;else if("response.output_item.added"===e.type&&"item"in e&&"reasoning"===e.item.type){let t=e.item.summary?e.item.summary.map((e,t)=>({...e,index:t})):void 0;o.reasoning={id:e.item.id,type:e.item.type,...t?{summary:t}:{}}}else if("response.reasoning_summary_part.added"===e.type)o.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]};else if("response.reasoning_summary_text.delta"===e.type)o.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]};else if("response.image_generation_call.partial_image"===e.type)return null;else return null;return new ao.Ls({text:a.map(e=>e.text).join(""),message:new as.GC({id:r,content:a,tool_call_chunks:n,usage_metadata:t,additional_kwargs:o,response_metadata:s}),generationInfo:i})}(r);null!=e&&(yield e)}return}let n=iJ(e,this.model),s={...this.invocationParams(t,{streaming:!0}),messages:n,stream:!0};for await(let e of(await this.completionWithRetry(s,t))){let n=e?.choices?.[0];if(e.usage&&(i=e.usage),!n)continue;let{delta:s}=n;if(!s)continue;let o=this._convertOpenAIDeltaToBaseMessageChunk(s,e,a);a=s.role??a;let l={prompt:t.promptIndex??0,completion:n.index??0};if("string"!=typeof o.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let u={...l};null!=n.finish_reason&&(u.finish_reason=n.finish_reason,u.system_fingerprint=e.system_fingerprint,u.model_name=e.model,u.service_tier=e.service_tier),this.logprobs&&(u.logprobs=n.logprobs);let c=new ao.Ls({message:o,text:o.content,generationInfo:u});yield c,await r?.handleLLMNewToken(c.text??"",l,void 0,void 0,void 0,{chunk:c})}if(i){let e={...i.prompt_tokens_details?.audio_tokens!==null&&{audio:i.prompt_tokens_details?.audio_tokens},...i.prompt_tokens_details?.cached_tokens!==null&&{cache_read:i.prompt_tokens_details?.cached_tokens}},t={...i.completion_tokens_details?.audio_tokens!==null&&{audio:i.completion_tokens_details?.audio_tokens},...i.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:i.completion_tokens_details?.reasoning_tokens}},r=new ao.Ls({message:new as.GC({content:"",response_metadata:{usage:{...i}},usage_metadata:{input_tokens:i.prompt_tokens,output_tokens:i.completion_tokens,total_tokens:i.total_tokens,...Object.keys(e).length>0&&{input_token_details:e},...Object.keys(t).length>0&&{output_token_details:t}}}),text:""});yield r}if(t.signal?.aborted)throw Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,r){let a=this.invocationParams(t);if(a.stream){let a;for await(let i of this._streamResponseChunks(e,t,r))i.message.response_metadata={...i.generationInfo,...i.message.response_metadata},a=a?.concat(i)??i;return{generations:a?[a]:[],llmOutput:{estimatedTokenUsage:a?.message?.usage_metadata}}}let i=iZ(e,this.model,this.zdrEnabled),n=await this.responseApiWithRetry({input:i,...a},{signal:t?.signal,...t?.options});return{generations:[{text:n.output_text,message:iW(n)}],llmOutput:{id:n.id,estimatedTokenUsage:n.usage?{promptTokens:n.usage.input_tokens,completionTokens:n.usage.output_tokens,totalTokens:n.usage.total_tokens}:void 0}}}_useResponseApi(e){let t=e?.tools?.some(iK),r=e?.previous_response_id!=null||e?.text!=null||e?.truncation!=null||e?.include!=null||e?.reasoning?.summary!=null||this.reasoning?.summary!=null;return this.useResponsesApi||t||r}async _generate(e,t,r){if(this._useResponseApi(t))return this._responseApiGenerate(e,t,r);let a={},i=this.invocationParams(t),n=iJ(e,this.model);if(i.stream){let i=this._streamResponseChunks(e,t,r),n={};for await(let e of i){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};let t=e.generationInfo?.completion??0;void 0===n[t]?n[t]=e:n[t]=n[t].concat(e)}let s=Object.entries(n).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t),{functions:o,function_call:l}=this.invocationParams(t),u=await this.getEstimatedTokenCountFromPrompt(e,o,l),c=await this.getNumTokensFromGenerations(s);return a.input_tokens=u,a.output_tokens=c,a.total_tokens=u+c,{generations:s,llmOutput:{estimatedTokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}{let e;e=t.response_format&&"json_schema"===t.response_format.type?await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:n},{signal:t?.signal,...t?.options}):await this.completionWithRetry({...i,stream:!1,messages:n},{signal:t?.signal,...t?.options});let{completion_tokens:r,prompt_tokens:s,total_tokens:o,prompt_tokens_details:l,completion_tokens_details:u}=e?.usage??{};r&&(a.output_tokens=(a.output_tokens??0)+r),s&&(a.input_tokens=(a.input_tokens??0)+s),o&&(a.total_tokens=(a.total_tokens??0)+o),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(a.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(u?.audio_tokens!==null||u?.reasoning_tokens!==null)&&(a.output_token_details={...u?.audio_tokens!==null&&{audio:u?.audio_tokens},...u?.reasoning_tokens!==null&&{reasoning:u?.reasoning_tokens}});let c=[];for(let t of e?.choices??[]){let r={text:t.message?.content??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(t.message??{role:"assistant"},e)};r.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},(0,as.Z0)(r.message)&&(r.message.usage_metadata=a),r.message=new as.gY(Object.fromEntries(Object.entries(r.message).filter(([e])=>!e.startsWith("lc_")))),c.push(r)}return{generations:c,llmOutput:{tokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let a=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==r){let e=function(e){let t=["namespace functions {",""];for(let r of e)r.description&&t.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(t.push(`type ${r.name} = (_: {`),t.push(iB(r.parameters,0)),t.push("}) => any;")):t.push(`type ${r.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);a+=await this.getNumTokens(e),a+=9}return t&&e.find(e=>"system"===e._getType())&&(a-=4),"none"===r?a+=1:"object"==typeof r&&(a+=await this.getNumTokens(r.name)+4),a}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content)))).reduce((e,t)=>e+t,0)}async getNumTokensFromMessages(e){let t=0,r=0,a=0;"gpt-3.5-turbo-0301"===this.model?(r=4,a=-1):(r=3,a=1);let i=await Promise.all(e.map(async e=>{let i=await this.getNumTokens(e.content),n=await this.getNumTokens(iq(e)),s=void 0!==e.name?a+await this.getNumTokens(e.name):0,o=i+r+n+s;if("function"===e._getType()&&(o-=2),e.additional_kwargs?.function_call&&(o+=3),e?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(e.additional_kwargs.function_call?.name)),e.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(e.additional_kwargs.function_call?.arguments)))}catch(t){console.error("Error parsing function arguments",t,JSON.stringify(e.additional_kwargs.function_call)),o+=await this.getNumTokens(e.additional_kwargs.function_call?.arguments)}return t+=o,o}));return{totalCount:t+=3,countPerMessage:i}}async completionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(e){throw iz(e)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{let r=this._getClientOptions(t);try{if(e.text?.format?.type==="json_schema"&&!e.stream)return await this.client.responses.parse(e,r);return await this.client.responses.create(e,r)}catch(e){throw iz(e)}})}async betaParsedCompletionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.parse(e,r)}catch(e){throw iz(e)}})}_getClientOptions(e){if(!this.client){let e=function(e){let{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:a,azureOpenAIBasePath:i,baseURL:n,azureADTokenProvider:s,azureOpenAIEndpoint:o}=e;if((a||s)&&i&&t)return`${i}/${t}`;if((a||s)&&o&&t)return`${o}/openai/deployments/${t}`;if(a||s){if(!r)throw Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return n}({baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new tQ(t)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){var r;let a,i,n,s,o,l;if(void 0!==(r=e)&&"object"==typeof r.schema?(a=e.schema,i=e.name,n=e.method,s=e.includeRaw):(a=e,i=t?.name,n=t?.method,s=t?.includeRaw),t?.strict!==void 0&&"jsonMode"===n)throw Error("Argument `strict` is only supported for `method` = 'function_calling'");if(this.model.startsWith("gpt-3")||this.model.startsWith("gpt-4-")||"gpt-4"===this.model?"jsonSchema"===n&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`):void 0===n&&(n="jsonSchema"),"jsonMode"===n){let e;(0,aK.BV)(a)?(l=a7.fromZodSchema(a),e=(0,aX.Bx)(a)):l=new ir,o=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"jsonMode"},schema:e}})}else if("jsonSchema"===n)if(o=this.withConfig({response_format:{type:"json_schema",json_schema:{name:i??"extract",description:(0,aK.$v)(a),schema:a,strict:t?.strict}},ls_structured_output_format:{kwargs:{method:"jsonSchema"},schema:(0,aX.Bx)(a)}}),(0,aK.BV)(a)){let e=a7.fromZodSchema(a);l=aB.Y8.from(t=>"parsed"in t.additional_kwargs?t.additional_kwargs.parsed:e)}else l=new ir;else{let e=i??"extract";if((0,aK.BV)(a)){let r=(0,aX.Bx)(a);o=this.withConfig({tools:[{type:"function",function:{name:e,description:r.description,parameters:r}}],tool_choice:{type:"function",function:{name:e}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:r},...t?.strict!==void 0?{strict:t.strict}:{}}),l=new ic({returnSingle:!0,keyName:e,zodSchema:a})}else{let r;"string"==typeof a.name&&"object"==typeof a.parameters&&null!=a.parameters?(r=a,e=a.name):r={name:e=a.title??e,description:a.description??"",parameters:a},o=this.withConfig({tools:[{type:"function",function:r}],tool_choice:{type:"function",function:{name:e}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:(0,aX.Bx)(a)},...t?.strict!==void 0?{strict:t.strict}:{}}),l=new ic({returnSingle:!0,keyName:e})}}if(!s)return o.pipe(l);let u=aW.assign({parsed:(e,t)=>l.invoke(e.raw,t)}),c=aW.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return aB.lW.from([{raw:o},d])}}var iQ=r(210482);r(150629);var i0=r(658207);class i1 extends aq{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),Object.defineProperty(this,"defaultConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata}async invoke(e,t){let r,a=(0,aZ.LE)((0,aZ.t8)(this.defaultConfig,t));return(0,i0.uB)(e)?(r=e.args,a={...a,toolCall:e}):r=e,this.call(r,a)}async call(e,t,r){let a,i,n,s,o,l=(0,i0.uB)(e)?e.args:e;if((0,aK.BV)(this.schema))try{a=await (0,aK.Jf)(this.schema,l)}catch(r){let t="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(t=`${t}
Details: ${r.message}`),new i0.YE(t,JSON.stringify(e))}else{let t=(0,a4.Gu)(l,this.schema);if(!t.valid){let r="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(r=`${r}
Details: ${t.errors.map(e=>`${e.keywordLocation}: ${e.error}`).join("\n")}`),new i0.YE(r,JSON.stringify(e))}a=l}let u=(0,aJ.QH)(t),c=aJ.Ye.configure(u.callbacks,this.callbacks,u.tags||r,this.tags,u.metadata,this.metadata,{verbose:this.verbose}),d=await c?.handleToolStart(this.toJSON(),"string"==typeof e?e:JSON.stringify(e),u.runId,void 0,void 0,void 0,u.runName);delete u.runId;try{i=await this._call(a,d,u)}catch(e){throw await d?.handleToolError(e),e}if("content_and_artifact"===this.responseFormat)if(Array.isArray(i)&&2===i.length)[n,s]=i;else throw Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(i)}`);else n=i;(0,i0.uB)(e)&&(o=e.id),!o&&(0,i0.qS)(u)&&(o=u.toolCall.id);let h=function(e){let{content:t,artifact:r,toolCallId:a,metadata:i}=e;return!a||(0,iQ.BE)(t)?t:new iQ.Cq("string"==typeof t||Array.isArray(t)&&t.every(e=>"object"==typeof e)?{status:"success",content:t,artifact:r,tool_call_id:a,name:e.name,metadata:i}:{status:"success",content:function(e){try{return JSON.stringify(e,null,2)??""}catch(t){return`${e}`}}(t),artifact:r,tool_call_id:a,name:e.name,metadata:i})}({content:n,artifact:s,toolCallId:o,name:this.name,metadata:this.metadata});return await d?.handleToolEnd(h),h}}class i2 extends i1{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:a8.Ry({input:a8.Z_().optional()}).transform(e=>e.input)})}call(e,t){return super.call("string"==typeof e||null==e?{input:e}:e,t)}}Object.defineProperty(class extends i2{static lc_name(){return"DallEAPIWrapper"}constructor(e){e?.responseFormat!==void 0&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t={apiKey:e?.apiKey??e?.openAIApiKey??(0,al.lS)("OPENAI_API_KEY"),organization:e?.organization??(0,al.lS)("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0,baseURL:e?.baseUrl};this.client=new tQ(t),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.dallEResponseFormat=e?.dallEResponseFormat??this.dallEResponseFormat,this.user=e?.user}processMultipleGeneratedUrls(e){return"url"===this.dallEResponseFormat?e.flatMap(e=>e.data?.flatMap(e=>e.url?{type:"image_url",image_url:e.url}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"string"==typeof e.image_url&&void 0!==e.image_url)??[]):e.flatMap(e=>e.data?.flatMap(e=>e.b64_json?{type:"image_url",image_url:{url:e.b64_json}}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"object"==typeof e.image_url&&"url"in e.image_url&&"string"==typeof e.image_url.url&&void 0!==e.image_url.url)??[])}async _call(e){let t={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let e=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(t)));return this.processMultipleGeneratedUrls(e)}let r=await this.client.images.generate(t),a="";return"url"===this.dallEResponseFormat?[a]=r.data?.map(e=>e.url).filter(e=>"undefined"!==e)??[]:[a]=r.data?.map(e=>e.b64_json).filter(e=>"undefined"!==e)??[],a}},"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"})},640191:function(e,t,r){"use strict";r.d(t,{KU:()=>W});var a=r(24176);let i="gen_ai.request.model",n="gen_ai.usage.input_tokens",s="gen_ai.usage.output_tokens",o="gen_ai.usage.total_tokens",l="langsmith.span.tags";var u=r(457099);class c{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let r;if(!this.hasWarned&&(0,u.US)()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?r=t[0]:2===t.length&&"function"==typeof t[1]?r=t[1]:3===t.length&&"function"==typeof t[2]&&(r=t[2]),"function"==typeof r)return r()}}let d=Symbol.for("ls:otel_trace"),h=Symbol.for("ls:otel_context"),p=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),f=new class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new c})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},m=new class{active(){return{}}with(e,t){return t()}},g=new class{getTraceInstance(){return globalThis[d]??f}getContextInstance(){return globalThis[h]??m}initializeGlobalInstances(e){void 0===globalThis[d]&&(globalThis[d]=e.trace),void 0===globalThis[h]&&(globalThis[h]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[p]=e}getDefaultOTLPTracerComponents(){return globalThis[p]??void 0}};function y(){return g.getTraceInstance()}let _={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class b{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let r of e)try{if(!r.run)continue;if("post"===r.operation){let e=this.createSpanForRun(r,r.run,t.get(r.id));e&&!r.run.end_time&&this.spans.set(r.id,e)}else this.updateSpanForRun(r,r.run)}catch(e){console.error(`Error processing operation ${r.id}:`,e)}}createSpanForRun(e,t,r){let a=r&&y().getSpan(r);if(a)try{return this.finishSpanSetup(a,t,e)}catch(t){console.error(`Failed to create span for run ${e.id}:`,t);return}}finishSpanSetup(e,t,r){return this.setSpanAttributes(e,t,r),t.error?(e.setStatus({code:2}),e.recordException(Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let r=this.spans.get(e.id);if(!r)return void console.debug(`No span found for run ${e.id} during update`);this.setSpanAttributes(r,t,e),t.error?(r.setStatus({code:2}),r.recordException(Error(t.error))):r.setStatus({code:1});let a=t.end_time;a&&(r.end(new Date(a)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,r){if("run_type"in t&&t.run_type){var a;e.setAttribute("langsmith.span.kind",t.run_type);let r=_[a=t.run_type||"chain"]||a;e.setAttribute("gen_ai.operation.name",r)}"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);let u=this.extractModelName(t);for(let[r,a]of(u&&e.setAttribute(i,u),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(n,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(s,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(o,t.total_tokens),this.setInvocationParameters(e,t),Object.entries(t.extra?.metadata||{})))null!=a&&e.setAttribute(`langsmith.metadata.${r}`,String(a));let c=t.tags;if(c&&Array.isArray(c)?e.setAttribute(l,c.join(", ")):c&&e.setAttribute(l,String(c)),"serialized"in t&&"object"==typeof t.serialized){let r=t.serialized;r.name&&e.setAttribute("gen_ai.serialized.name",String(r.name)),r.signature&&e.setAttribute("gen_ai.serialized.signature",String(r.signature)),r.doc&&e.setAttribute("gen_ai.serialized.doc",String(r.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,t){let r="langchain",a=this.extractModelName(t);if(a){let e=a.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?r="anthropic":e.includes("bedrock")?r="aws.bedrock":e.includes("azure")&&e.includes("openai")?r="az.ai.openai":e.includes("azure")&&e.includes("inference")?r="az.ai.inference":e.includes("cohere")?r="cohere":e.includes("deepseek")?r="deepseek":e.includes("gemini")?r="gemini":e.includes("groq")?r="groq":e.includes("watson")||e.includes("ibm")?r="ibm.watsonx.ai":e.includes("mistral")?r="mistral_ai":e.includes("gpt")||e.includes("openai")?r="openai":e.includes("perplexity")||e.includes("sonar")?r="perplexity":e.includes("vertex")?r="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(r="xai")}e.setAttribute("gen_ai.system",r)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let r=t.extra.metadata.invocation_params;void 0!==r.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",r.max_tokens),void 0!==r.temperature&&e.setAttribute("gen_ai.request.temperature",r.temperature),void 0!==r.top_p&&e.setAttribute("gen_ai.request.top_p",r.top_p),void 0!==r.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",r.frequency_penalty),void 0!==r.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",r.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let r=t.run.inputs;"object"==typeof r&&null!==r&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(i,r.model),void 0!==r.stream&&e.setAttribute("langsmith.request.streaming",r.stream),r.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(r.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(r))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{let r=t.run.outputs,a=this.getUnifiedRunTokens(r);if(a&&(e.setAttribute(n,a[0]),e.setAttribute(s,a[1]),e.setAttribute(o,a[0]+a[1])),r&&"object"==typeof r){if(r.model&&e.setAttribute("gen_ai.response.model",String(r.model)),r.id&&e.setAttribute("gen_ai.response.id",r.id),r.choices&&Array.isArray(r.choices)){let t=r.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(r.service_tier&&e.setAttribute("gen_ai.response.service_tier",r.service_tier),r.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",r.system_fingerprint),r.usage_metadata&&"object"==typeof r.usage_metadata){let t=r.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(r))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;for(let r of Object.keys(e)){let a=e[r];if(a&&"object"==typeof a&&((t=this.extractUnifiedRunTokens(a.usage_metadata))||1===a.lc&&a.kwargs&&"object"==typeof a.kwargs&&(t=this.extractUnifiedRunTokens(a.kwargs.usage_metadata))))return t}let r=e.generations||[];if(!Array.isArray(r))return null;for(let e of Array.isArray(r[0])?r.flat():r)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata)))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e&&"number"==typeof e.input_tokens&&"number"==typeof e.output_tokens?[e.input_tokens,e.output_tokens]:null}}var w=r(750980),v=r(350709);let O=[429,500,502,503,504];class E{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in v?this.queue=new v.default({concurrency:this.maxConcurrency}):this.queue=new v({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>w(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response;if(r&&await r(t))return;let a=t?.status??e?.status;if(a&&!O.includes(+a))throw e},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}}function x(e){return"function"==typeof e?._getType}function S(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}var $=r(642106);let k=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function A(e,t){if(!k.test(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}var I=r(723352);function P(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,r]=e.split(":"),a=r||"latest";if(t.includes("/")){let[r,i]=t.split("/",2);if(!r||!i)throw Error(`Invalid identifier format: ${e}`);return[r,i,a]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,a]}r(578493);var T=r(994743),j=r(127766),R={result:"[Circular]"},N=[],C=[];let L=new TextEncoder;function M(e){return L.encode(e)}function U(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);else if(e instanceof Set)return Array.from(e);else if(e instanceof Date)return e.toISOString();else if(e instanceof RegExp)return e.toString();else if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function z(e,t,r,a,i){try{let t=JSON.stringify(e,function(e,t){if(r){let a=r.call(this,e,t);if(void 0!==a)return a}return U(t)},a);return M(t)}catch(o){let s;if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),M("[Unserializable]");"true"!==(0,u.HC)("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===i&&(i={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,a,i,n,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<i.length;l++)if(i[l]===t)return void D(R,t,r,n);if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&a+1>o.edgesLimit)return void D("[...]",t,r,n);if(i.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,i,t,s,o);else{var l,u=Object.keys(t=U(t));for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,i,t,s,o)}}i.pop()}}(e,"",0,[],void 0,0,i);try{var n;s=0===C.length?JSON.stringify(e,r,a):JSON.stringify(e,(n=r,n=void 0!==n?n:function(e,t){return t},function(e,t){if(C.length>0)for(var r=0;r<C.length;r++){var a=C[r];if(a[1]===e&&a[0]===t){t=a[2],C.splice(r,1);break}}return n.call(this,e,t)}),a)}catch(e){return M("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==N.length;){let e=N.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return M(s)}}function D(e,t,r,a){var i=Object.getOwnPropertyDescriptor(a,r);void 0!==i.get?i.configurable?(Object.defineProperty(a,r,{value:e}),N.push([a,r,t,i])):C.push([t,r,e]):(a[r]=e,N.push([a,r,t]))}function B(e){let t=(0,u.sA)(),r=(0,u.DW)(),a=e.extra??{},i=a.metadata;return e.extra={...a,runtime:{...t,...a?.runtime},metadata:{...r,...r.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??r.revision_id}:{},...i}},e}async function F(e){let t=[];for await(let r of e)t.push(r);return t}function q(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let H=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"10",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function J(e){return"number"==typeof e?Number(e.toFixed(4)):e}class G{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,r=new Promise(e=>{t=e}),a=z(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:r,size:a}),this.sizeBytes+=a,r}pop(e){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let e=this.items.shift();e&&(t.push(e),r+=e.size,this.sizeBytes-=e.size)}if(0===t.length&&this.items.length>0){let e=this.items.shift();t.push(e),r+=e.size,this.sizeBytes-=e.size}return[t.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl})),()=>t.forEach(e=>e.itemPromiseResolve())]}}let Z="https://api.smith.langchain.com";class W{get _fetch(){return this.fetchImplementation||(0,j.sv)(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new G}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===(0,u.lS)("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===(0,u.lS)("LANGSMITH_DEBUG")});let t=W.getDefaultClientConfig();if(this.tracingSampleRate=(e=>{let t=e?.toString()??(0,u.HC)("TRACING_SAMPLING_RATE");if(void 0===t)return;let r=parseFloat(t);if(r<0||r>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r})(e.tracingSamplingRate),this.apiUrl=q(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=q(e.apiKey??t.apiKey),this.webUrl=q(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=q(e.workspaceId??(0,u.HC)("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new E({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new E({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:H,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,(0,u.US)()&&(this.langSmithToOTELTranslator=new b)}static getDefaultClientConfig(){let e=(0,u.HC)("API_KEY"),t=(0,u.HC)("ENDPOINT")??Z;return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:"true"===(0,u.HC)("HIDE_INPUTS"),hideOutputs:"true"===(0,u.HC)("HIDE_OUTPUTS")}}getHostUrl(){if(this.webUrl)return this.webUrl;if((e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t})(this.apiUrl))return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${$.I9}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{let t=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,`fetch ${e}`),t})}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,r){let a=Number(t.get("offset"))||0,i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(i));let n=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(async()=>{let t=await this._fetch(n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,`fetch ${e}`),t}),o=r?r(await s.json()):await s.json();if(0===o.length||(yield o,o.length<i))break;a+=o.length}}async *_getCursorPaginatedList(e,t=null,r="POST",a="runs"){let i=t?{...t}:{};for(;;){let t=JSON.stringify(i),n=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:t});return await (0,T.y6)(a,`fetch ${e}`),a}),s=await n.json();if(!s||!s[a])break;yield s[a];let o=s.cursors;if(!o||!o.next)break;i.cursor=o.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.filteredPostUuids.has(r.trace_id)?r.id===r.trace_id&&this.filteredPostUuids.delete(r.trace_id):t.push(r);return t}{let t=[];for(let r of e){let e=r.trace_id??r.id;this.filteredPostUuids.has(e)||(r.id===e?this._shouldSample()?t.push(r):this.filteredPostUuids.add(e):t.push(r))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??0x1800000}async _getDatasetExamplesMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){let t=[];for(;this.autoBatchQueue.items.length>0;){let[r,a]=this.autoBatchQueue.pop(e);if(!r.length){a();break}let i=r.reduce((e,t)=>{let r=t.apiUrl??this.apiUrl,a=t.apiKey??this.apiKey,i=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${r}|${a}`;return e[i]||(e[i]=[]),e[i].push(t),e},{}),n=[];for(let[e,t]of Object.entries(i)){let r=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});n.push(r)}let s=Promise.all(n).finally(a);t.push(s)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{let r={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},a=await this._ensureServerInfo();if(a?.batch_ingest_config?.use_multipart_endpoint){let e=a?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(r,{...t,useGzip:e})}else await this.batchIngestRuns(r,t)}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){let t=new Map,r=[];for(let a of e)a.item.id&&a.otelContext&&(t.set(a.item.id,a.otelContext),"create"===a.action?r.push({operation:"post",id:a.item.id,trace_id:a.item.trace_id??a.item.id,run:a.item}):r.push({operation:"patch",id:a.item.id,trace_id:a.item.trace_id??a.item.id,run:a.item}));this.langSmithToOTELTranslator.exportBatch(r,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=B(e.item);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4),...this.fetchOptions});return await (0,T.y6)(e,"get server info"),e}),t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){let e=y(),t=g.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let r=e.getActiveSpan();if(r)return e.setSpan(t.active(),r)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let r={...this.headers,"Content-Type":"application/json"},a=e.project_name;delete e.project_name;let i=await this.prepareRunCreateOrUpdateInputs({session_name:a,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==i.trace_id&&void 0!==i.dotted_order){let e=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:i,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let n=B(i);t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(r["x-tenant-id"]=t.workspaceId);let s=z(n,`Creating run with id: ${n.id}`);await this.caller.call(async()=>{let e=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await (0,T.y6)(e,"create run",!0),e})}async batchIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let a=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),i=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(a.length>0&&i.length>0){let e=a.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of i)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);a=Object.values(e),i=t}let n={post:a,patch:i};if(!n.post.length&&!n.patch.length)return;let s={post:[],patch:[]};for(let e of["post","patch"]){let t=n[e].reverse(),r=t.pop();for(;void 0!==r;)s[e].push(r),r=t.pop()}if(s.post.length>0||s.patch.length>0){let e=s.post.map(e=>e.id).concat(s.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(z(s,`Ingesting runs with ids: ${e}`),r)}}async _postBatchIngestRuns(e,t){let r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{let a=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await (0,T.y6)(a,"batch create run",!0),a})}async multipartIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let a={},i=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(a[e.id]=e.attachments),delete e.attachments,i.push(e)}let n=[];for(let e of t??[])n.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==i.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==n.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&n.length>0){let e=i.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);i=Object.values(e),n=t}if(0===i.length&&0===n.length)return;let s=[],o=[];for(let[e,t]of[["post",i],["patch",n]])for(let r of t){let{inputs:t,outputs:i,events:n,extra:l,error:u,serialized:c,attachments:d,...h}=r,p={inputs:t,outputs:i,events:n,extra:l,error:u,serialized:c},f=z(h,`Serializing for multipart ingestion of run with id: ${h.id}`);for(let[t,r]of(o.push({name:`${e}.${h.id}`,payload:new Blob([f],{type:`application/json; length=${f.length}`})}),Object.entries(p))){if(void 0===r)continue;let a=z(r,`Serializing ${t} for multipart ingestion of run with id: ${h.id}`);o.push({name:`${e}.${h.id}.${t}`,payload:new Blob([a],{type:`application/json; length=${a.length}`})})}if(void 0!==h.id){let e=a[h.id];if(e)for(let[t,r]of(delete a[h.id],Object.entries(e))){let e,a;if(Array.isArray(r)?[e,a]=r:(e=r.mimeType,a=r.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${h.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}o.push({name:`attachment.${h.id}.${t}`,payload:new Blob([a],{type:`${e}; length=${a.byteLength}`})})}}s.push(`trace=${h.trace_id},id=${h.id}`)}await this._sendMultipartRequest(o,s.join("; "),r)}async _createNodeFetchBody(e,t){let r=[];for(let a of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),r.push(a.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${t}--\r
`]));let a=new Blob(r);return await a.arrayBuffer()}async _createMultipartStream(e,t){let r=new TextEncoder;return new ReadableStream({async start(a){let i=async e=>{"string"==typeof e?a.enqueue(r.encode(e)):a.enqueue(e)};for(let r of e){await i(`--${t}\r
`),await i(`Content-Disposition: form-data; name="${r.name}"\r
`),await i(`Content-Type: ${r.payload.type}\r
\r
`);let e=r.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)a.enqueue(t.value)}finally{e.releaseLock()}await i("\r\n")}await i(`--${t}--\r
`),a.close()}})}async _sendMultipartRequest(e,t,r){let a="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=(0,j.Pf)(),n=()=>this._createNodeFetchBody(e,a),s=()=>this._createMultipartStream(e,a),o=async e=>this.batchIngestCaller.call(async()=>{let t=await e(),i={...this.headers,"Content-Type":`multipart/form-data; boundary=${a}`};r?.apiKey!==void 0&&(i["x-api-key"]=r.apiKey);let n=t;r?.useGzip&&"object"==typeof t&&"pipeThrough"in t&&(n=t.pipeThrough(new CompressionStream("gzip")),i["Content-Encoding"]="gzip");let s=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:i,body:n,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(s,"Failed to send multipart request",!0),s});try{let e,a=!1;i||this.multipartStreamingDisabled||"bun"===(0,u.dU)()?e=await o(n):(a=!0,e=await o(s)),(!this.multipartStreamingDisabled||a)&&422===e.status&&(r?.apiUrl??this.apiUrl)!==Z&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,e=await o(n))}catch(e){console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t,r){A(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let a={...t,id:e};if(!this._filterForSampling([a],!0).length)return;if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){let e=this._cloneCurrentOTELContext();return void 0!==t.end_time&&void 0===a.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:a,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error):void this.processRunOperation({action:"update",item:a,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error)}let i={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(i["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(i["x-tenant-id"]=r.workspaceId);let n=z(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let t=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await (0,T.y6)(t,"update run",!0),t})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){A(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,u.HC)("PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await F(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},a={};for(let i of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===i.parent_run_id||void 0===i.parent_run_id)throw Error(`Child run ${i.id} has no parent`);i.dotted_order?.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),a[i.id]=i)}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(a[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:a,traceId:i,referenceExampleId:n,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:d,query:h,filter:p,traceFilter:f,treeFilter:m,limit:g,select:y,order:_}=e,b=[];if(t&&(b=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));b.push(...t)}let w={session:b.length?b:null,run_type:u,reference_example:n,query:h,filter:p,trace_filter:f,tree_filter:m,execution_order:o,parent_run:a,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:i,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:_},v=0;for await(let e of this._getCursorPaginatedList("/runs/query",w))if(g){if(v>=g)break;if(e.length+v>g){let t=e.slice(0,g-v);yield*t;break}v+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:r,groupBy:a,filter:i,startTime:n,endTime:s,limit:o,offset:l}=e,u={session_id:t||(await this.readProject({projectName:r})).id,group_by:a,filter:i,start_time:n?n.toISOString():null,end_time:s?s.toISOString():null,limit:Number(o)||100},c=Number(l)||0,d="/runs/group",h=`${this.apiUrl}${d}`;for(;;){let e=JSON.stringify(Object.fromEntries(Object.entries({...u,offset:c}).filter(([e,t])=>void 0!==t))),t=await this.caller.call(async()=>{let t=await this._fetch(h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await (0,T.y6)(t,`Failed to fetch ${d}`),t}),{groups:r,total:a}=await t.json();if(0===r.length)break;for(let e of r)yield e;if((c+=r.length)>=a)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:a,projectNames:i,projectIds:n,referenceExampleIds:s,startTime:o,endTime:l,error:u,query:c,filter:d,traceFilter:h,treeFilter:p,isRoot:f,dataSourceType:m}){let g=n||[];i&&(g=[...n||[],...await Promise.all(i.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let y=JSON.stringify(Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:a,session:g,reference_example:s,start_time:o,end_time:l,error:u,query:c,filter:d,trace_filter:h,tree_filter:p,is_root:f,data_source_type:m}).filter(([e,t])=>void 0!==t))),_=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await (0,T.y6)(e,"get run stats"),e});return await _.json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||a.Z()};A(e);let i=JSON.stringify(r),n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await (0,T.y6)(t,"share run"),t}),s=await n.json();if(null===s||!("share_token"in s))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){A(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"unshare run",!0),t})}async readRunSharedLink(e){A(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"read run shared link"),t}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);A(e);let a=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"list shared runs"),t});return await a.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),A(e);let r=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"read dataset shared schema"),t}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};A(e);let a=JSON.stringify(r),i=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await (0,T.y6)(t,"share dataset"),t}),n=await i.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){A(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"unshare dataset",!0),t})}async readSharedDataset(e){A(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"read shared dataset"),t});return await t.json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let a=new URLSearchParams;Object.entries(r).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>a.append(e,t)):a.append(e,t)});let i=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"list shared examples"),t}),n=await i.json();if(!i.ok){if("detail"in n)throw Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${Array.isArray(n.detail)?n.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${i.status} ${i.statusText}`)}return n.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:i=null,referenceDatasetId:n=null}){let s=`${this.apiUrl}/sessions${a?"?upsert=true":""}`,o=i||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==n&&(l.reference_dataset_id=n);let u=JSON.stringify(l),c=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await (0,T.y6)(e,"create project"),e});return await c.json()}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:i=null,endTime:n=null}){let s=`${this.apiUrl}/sessions/${e}`,o=i;a&&(o={...o||{},metadata:a});let l=JSON.stringify({name:t,extra:o,description:r,end_time:n?new Date(n).toISOString():null}),u=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await (0,T.y6)(e,"update project"),e});return await u.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)A(e),r+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");let i=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,"has project"),e});try{let e=await i.json();if(!i.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a,i="/sessions",n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)A(e),i+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&n.append("include_stats",r.toString());let s=await this._get(i,n);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,includeStats:n,datasetVersion:s,referenceFree:o,metadata:l}={}){let u=new URLSearchParams;if(void 0!==e)for(let t of e)u.append("id",t);if(void 0!==t&&u.append("name",t),void 0!==r&&u.append("name_contains",r),void 0!==a)u.append("reference_dataset",a);else if(void 0!==i){let e=await this.readDataset({datasetName:i});u.append("reference_dataset",e.id)}for await(let e of(void 0!==n&&u.append("include_stats",n.toString()),void 0!==s&&u.append("dataset_version",s),void 0!==o&&u.append("reference_free",o.toString()),void 0!==l&&u.append("metadata",JSON.stringify(l)),this._getPaginated("/sessions",u)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");A(r=void 0===e?(await this.readProject({projectName:t})).id:e),await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,`delete session ${r} (${t})`,!0),e})}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:n,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),a.forEach(e=>{l.append("output_keys",e)}),i&&l.append("description",i),n&&l.append("data_type",n),s&&l.append("name",s);let u=await this.caller.call(async()=>{let e=await this._fetch(o,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await (0,T.y6)(e,"upload CSV"),e});return await u.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:a,outputsSchema:i,metadata:n}={}){let s={name:e,description:t,extra:n?{metadata:n}:void 0};r&&(s.data_type=r),a&&(s.inputs_schema_definition=a),i&&(s.outputs_schema_definition=i);let o=JSON.stringify(s),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await (0,T.y6)(e,"create dataset"),e});return await l.json()}async readDataset({datasetId:e,datasetName:t}){let r,a="/datasets",i=new URLSearchParams({limit:"1"});if(e&&t)throw Error("Must provide either datasetName or datasetId, not both");if(e)A(e),a+=`/${e}`;else if(t)i.append("name",t);else throw Error("Must provide datasetName or datasetId");let n=await this._get(a,i);if(Array.isArray(n)){if(0===n.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:a}){let i=e;if(void 0===i&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:t})).id);let n=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof a?a:a.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,n)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i,metadata:n}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==a&&s.append("name",a),void 0!==i&&s.append("name_contains",i),void 0!==n&&s.append("metadata",JSON.stringify(n)),this._getPaginated("/datasets",s)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:r,...a}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let i=t??(await this.readDataset({datasetName:r})).id;A(i);let n=JSON.stringify(a),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await (0,T.y6)(e,"update dataset"),e});return await s.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:r,asOf:a,tag:i}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let n=t??(await this.readDataset({datasetName:r})).id;A(n);let s=JSON.stringify({as_of:"string"==typeof a?a:a.toISOString(),tag:i});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await (0,T.y6)(e,"update dataset tags",!0),e})}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(a=(await this.readDataset({datasetName:t})).id),void 0!==a)A(a),r+=`/${a}`;else throw Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,`delete ${r}`,!0),e})}async indexDataset({datasetId:e,datasetName:t,tag:r}){let a=e;if(a||t)if(a&&t)throw Error("Must provide either datasetName or datasetId, not both");else a||(a=(await this.readDataset({datasetName:t})).id);else throw Error("Must provide either datasetName or datasetId");A(a);let i=JSON.stringify({tag:r}),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await (0,T.y6)(e,"index dataset"),e});await n.json()}async similarExamples(e,t,r,{filter:a}={}){let i={limit:r,inputs:e};void 0!==a&&(i.filter=a),A(t);let n=JSON.stringify(i),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:n});return await (0,T.y6)(e,"fetch similar examples"),e});return(await s.json()).examples}async createExample(e,t,r){let i;if(K(e)&&(void 0!==t||void 0!==r))throw Error("Cannot provide outputs or options when using ExampleCreate object");let n=t?r?.datasetId:e.dataset_id,s=t?r?.datasetName:e.dataset_name;if(void 0===n&&void 0===s)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==s)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:s})).id);let o=(t?r?.createdAt:e.created_at)||new Date;i=K(e)?e:{inputs:e,outputs:t,created_at:o?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};let l=await this._uploadExamplesMultipart(n,[i]);return await this.readExample(l.example_ids?.[0]??a.Z())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,r=e[0].dataset_name;if(void 0===t&&void 0===r)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==r)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:r})).id);let a=await this._uploadExamplesMultipart(t,e);return await Promise.all(a.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:r,metadata:a,splits:i,sourceRunIds:n,useSourceRunIOs:s,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:c,datasetName:d}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let h=c;if(void 0===h&&void 0===d)throw Error("Must provide either datasetName or datasetId");if(void 0!==h&&void 0!==d)throw Error("Must provide either datasetName or datasetId, not both");void 0===h&&(h=(await this.readDataset({datasetName:d})).id);let p=t.map((e,t)=>({dataset_id:h,inputs:e,outputs:r?.[t],metadata:a?.[t],split:i?.[t],id:u?.[t],attachments:l?.[t],source_run_id:n?.[t],use_source_run_io:s?.[t],use_source_run_attachments:o?.[t]})),f=await this._uploadExamplesMultipart(h,p);return await Promise.all(f.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(e=>x(e)?S(e):e),i=x(t)?S(t):t;return this.createExample({input:a},{output:i},r)}async readExample(e){A(e);let t=`/examples/${e}`,{attachment_urls:r,...a}=await this._get(t);return r&&(a.attachments=Object.entries(r).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e),{})),a}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:a,splits:i,inlineS3Urls:n,metadata:s,limit:o,offset:l,filter:u,includeAttachments:c}={}){let d;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else if(void 0!==t)d=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let h=new URLSearchParams({dataset:d}),p=a?"string"==typeof a?a:a?.toISOString():void 0;if(p&&h.append("as_of",p),h.append("inline_s3_urls",(n??!0).toString()),void 0!==r)for(let e of r)h.append("id",e);if(void 0!==i)for(let e of i)h.append("splits",e);if(void 0!==s){let e=JSON.stringify(s);h.append("metadata",e)}void 0!==o&&h.append("limit",o.toString()),void 0!==l&&h.append("offset",l.toString()),void 0!==u&&h.append("filter",u),!0===c&&["attachment_urls","outputs","metadata"].forEach(e=>h.append("select",e));let f=0;for await(let e of this._getPaginated("/examples",h)){for(let t of e){let{attachment_urls:e,...r}=t;e&&(r.attachments=Object.entries(e).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e),{})),yield r,f++}if(void 0!==o&&f>=o)break}}async deleteExample(e){A(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,`delete ${t}`,!0),e})}async updateExample(e,t){let r,a,i;return A(r=t?e:e.id),i=void 0!==(a=t?{id:r,...t}:e).dataset_id?a.dataset_id:(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(i,[a])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:a}){let i;if(A(i=e||(await this.readDataset({datasetName:t})).id),r&&a||!r&&!a)throw Error("Exactly one of asOf and tag must be specified.");let n=new URLSearchParams;void 0!==r&&n.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==a&&n.append("tag",a);let s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${i}/version?${n.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,"read dataset version"),e});return await s.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let a;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");A(a=void 0===e?(await this.readDataset({datasetName:t})).id:e);let i=new URLSearchParams,n=r?"string"==typeof r?r:r?.toISOString():void 0;return n&&i.append("as_of",n),await this._get(`/datasets/${a}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:a,remove:i=!1}){let n;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");A(n=void 0===e?(await this.readDataset({datasetName:t})).id:e);let s=JSON.stringify({split_name:r,examples:a.map(e=>(A(e),e)),remove:i});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await (0,T.y6)(e,"update dataset splits",!0),e})}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:i}={loadChildRuns:!1}){let n;if((0,I.O)("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)n=await this.readRun(e,{loadChildRuns:a});else if("object"==typeof e&&"id"in e)n=e;else throw Error(`Invalid run type: ${typeof e}`);null!==n.reference_example_id&&void 0!==n.reference_example_id&&(i=await this.readExample(n.reference_example_id));let s=await t.evaluateRun(n,i),[o,l]=await this._logEvaluationFeedback(s,n,r);return l[0]}async createFeedback(e,t,{score:r,value:i,correction:n,comment:s,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:h,comparativeExperimentId:p}){if(!e&&!h)throw Error("One of runId or projectId must be provided");if(e&&h)throw Error("Only one of runId or projectId can be provided");let f={type:l??"api",metadata:o??{}};void 0===u||f?.metadata===void 0||f.metadata.__run||(f.metadata.__run={run_id:u}),f?.metadata!==void 0&&f.metadata.__run?.run_id!==void 0&&A(f.metadata.__run.run_id);let m={id:c??a.Z(),run_id:e,key:t,score:J(r),value:i,correction:n,comment:s,feedback_source:f,comparative_experiment_id:p,feedbackConfig:d,session_id:h},g=JSON.stringify(m),y=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let e=await this._fetch(y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await (0,T.y6)(e,"create feedback",!0),e}),m}async updateFeedback(e,{score:t,value:r,correction:a,comment:i}){let n={};null!=t&&(n.score=J(t)),null!=r&&(n.value=r),null!=a&&(n.correction=a),null!=i&&(n.comment=i),A(e);let s=JSON.stringify(n);await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await (0,T.y6)(t,"update feedback",!0),t})}async readFeedback(e){A(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){A(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,`delete ${t}`,!0),e})}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e)for(let t of e)A(t),a.append("run",t);if(t)for(let e of t)a.append("key",e);if(r)for(let e of r)a.append("source",e);for await(let e of this._getPaginated("/feedback",a))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:a}={}){let i={run_id:e,feedback_key:t,feedback_config:a};r?"string"==typeof r?i.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(i.expires_in=r):i.expires_in={hours:3};let n=JSON.stringify(i),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await (0,T.y6)(e,"create presigned feedback token"),e});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:a,description:i,metadata:n,id:s}){if(0===t.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let o={id:s,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(a??new Date)?.toISOString(),extra:{}};n&&(o.extra.metadata=n);let l=JSON.stringify(o);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await (0,T.y6)(e,"create comparative experiment"),e})).json()}async *listPresignedFeedbackTokens(e){A(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,r){let a=this._selectEvalResults(e),i=[];for(let e of a){let a=r||{};e.evaluatorInfo&&(a={...e.evaluatorInfo,...a});let n=null;e.targetRunId?n=e.targetRunId:t&&(n=t.id),i.push(await this.createFeedback(n,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:a,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[a,i]}async logEvaluationFeedback(e,t,r){let[a]=await this._logEvaluationFeedback(e,t,r);return a}async *listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:a,limit:i}=e,n=new URLSearchParams;t&&t.forEach((e,t)=>{A(e,`queueIds[${t}]`),n.append("ids",e)}),r&&n.append("name",r),a&&n.append("name_contains",a),n.append("limit",(void 0!==i?Math.min(i,100):100).toString());let s=0;for await(let e of this._getPaginated("/annotation-queues",n))if(yield*e,s++,void 0!==i&&s>=i)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:i,rubricInstructions:n}=e,s=JSON.stringify(Object.fromEntries(Object.entries({name:t,description:r,id:i||a.Z(),rubric_instructions:n}).filter(([e,t])=>void 0!==t)));return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await (0,T.y6)(e,"create annotation queue"),e})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${A(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"read annotation queue"),t})).json()}async updateAnnotationQueue(e,t){let{name:r,description:a,rubricInstructions:i}=t,n=JSON.stringify({name:r,description:a,rubric_instructions:i});await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${A(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await (0,T.y6)(t,"update annotation queue",!0),t})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${A(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let r=JSON.stringify(t.map((e,t)=>A(e,`runIds[${t}]`).toString()));await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${A(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await (0,T.y6)(t,"add runs to annotation queue",!0),t})}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${A(e,"queueId")}/run`;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,"get run from annotation queue"),e})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/annotation-queues/${A(e,"queueId")}/runs/${A(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${A(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"get size from annotation queue"),t})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(t,"get latest commit hash"),t}),r=await t.json();if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,a,i]=P(e),n=JSON.stringify({like:t});return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/likes/${r}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await (0,T.y6)(e,`${t?"like":"unlike"} prompt`),e})).json()}async _getPromptUrl(e){let[t,r,a]=P(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==a?`${this.getHostUrl()}/prompts/${r}/${a.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==a?`${this.getHostUrl()}/hub/${t}/${r}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let r of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*r}async getPrompt(e){let[t,r,a]=P(e),i=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return e?.status===404?null:(await (0,T.y6)(e,"get prompt"),e)}),n=await i?.json();return n?.repo?n.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[a,i,n]=P(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);let s=JSON.stringify({repo_handle:i,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic}),o=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await (0,T.y6)(e,"create prompt"),e}),{repo:l}=await o.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[a,i,n]=P(e),s=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${a}/${i}`),o=JSON.stringify({manifest:JSON.parse(JSON.stringify(t)),parent_commit:s}),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${a}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await (0,T.y6)(e,"create commit"),e}),u=await l.json();return this._getPromptUrl(`${a}/${i}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=e.id,a=new Blob([z({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`)],{type:"application/json"});if(r.append(t,a),e.inputs){let a=new Blob([z(e.inputs,`Serializing inputs for example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,a)}if(e.outputs){let a=new Blob([z(e.outputs,`Serializing outputs whle updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,a)}if(e.attachments)for(let[a,i]of Object.entries(e.attachments)){let e,n;Array.isArray(i)?[e,n]=i:(e=i.mimeType,n=i.data);let s=new Blob([n],{type:`${e}; length=${n.byteLength}`});r.append(`${t}.attachment.${a}`,s)}if(e.attachments_operations){let a=new Blob([z(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.attachments_operations`,a)}}let a=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${a}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await (0,T.y6)(e,"update examples"),e})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=(e.id??a.Z()).toString(),i=new Blob([z({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let a=new Blob([z(e.inputs,`Serializing inputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,a)}if(e.outputs){let a=new Blob([z(e.outputs,`Serializing outputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,a)}if(e.attachments)for(let[a,i]of Object.entries(e.attachments)){let e,n;Array.isArray(i)?[e,n]=i:(e=i.mimeType,n=i.data);let s=new Blob([n],{type:`${e}; length=${n.byteLength}`});r.append(`${t}.attachment.${a}`,s)}}return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await (0,T.y6)(t,"upload examples"),t})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,a]=P(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let i={};if(t?.description!==void 0&&(i.description=t.description),t?.readme!==void 0&&(i.readme=t.readme),t?.tags!==void 0&&(i.tags=t.tags),t?.isPublic!==void 0&&(i.is_public=t.isPublic),t?.isArchived!==void 0&&(i.is_archived=t.isArchived),0===Object.keys(i).length)throw Error("No valid update options provided");let n=JSON.stringify(i);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${r}/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await (0,T.y6)(e,"update prompt"),e})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,r,a]=P(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,"delete prompt"),e})).json()}async pullPromptCommit(e,t){let[r,a,i]=P(e),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${r}/${a}/${i}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await (0,T.y6)(e,"pull prompt commit"),e}),s=await n.json();return{owner:r,repo:a,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:a}=t,[i,n]=this.parseTokenOrUrl(e,r),s=new W({apiUrl:i,apiKey:"placeholder"}),o=await s.readSharedDataset(n),l=a||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(e){}let u=await s.listSharedExamples(n),c=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:c.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,a="dataset"){try{return A(e),[t,e]}catch(e){}try{let i=new URL(e).pathname.split("/").filter(e=>""!==e);if(i.length>=r){let e=i[i.length-r];return[t,e]}throw Error(`Invalid public ${a} URL: ${e}`)}catch(t){throw Error(`Invalid public ${a} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await g.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function K(e){return"dataset_id"in e||"dataset_name"in e}},642106:function(e,t,r){"use strict";r.d(t,{Bm:()=>n.B,I9:()=>s,IV:()=>i.IV,KU:()=>a.KU});var a=r(640191),i=r(936852);r(127766);var n=r(791259);let s="0.3.68"},936852:function(e,t,r){"use strict";r.d(t,{Yo:()=>m,IV:()=>y});var a=r(24176),i=r(778982),n=r(443269);let s=function(e){if(!(0,n.Z)(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/0x10000000000&255,r[11]=t/0x100000000&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function o(e,t){return e<<t|e>>>32-t}var l=function(e,t,r){function a(e,t,a,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof t&&(t=s(t)),(null==(o=t)?void 0:o.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o,l=new Uint8Array(16+e.length);if(l.set(t),l.set(e,t.length),(l=r(l))[6]=15&l[6]|80,l[8]=63&l[8]|128,a){n=n||0;for(var u=0;u<16;++u)a[n+u]=l[u];return a}return(0,i.S)(l)}try{a.name="v5"}catch(e){}return a.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",a.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",a}(0,0,function(e){var t=[0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xca62c1d6],r=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0];if("string"==typeof e){var a=unescape(encodeURIComponent(e));e=[];for(var i=0;i<a.length;++i)e.push(a.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var n=Math.ceil((e.length/4+2)/16),s=Array(n),l=0;l<n;++l){for(var u=new Uint32Array(16),c=0;c<16;++c)u[c]=e[64*l+4*c]<<24|e[64*l+4*c+1]<<16|e[64*l+4*c+2]<<8|e[64*l+4*c+3];s[l]=u}s[n-1][14]=(e.length-1)*8/0x100000000,s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=(e.length-1)*8|0;for(var d=0;d<n;++d){for(var h=new Uint32Array(80),p=0;p<16;++p)h[p]=s[d][p];for(var f=16;f<80;++f)h[f]=o(h[f-3]^h[f-8]^h[f-14]^h[f-16],1);for(var m=r[0],g=r[1],y=r[2],_=r[3],b=r[4],w=0;w<80;++w){var v=Math.floor(w/20),O=o(m,5)+function(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:case 3:return t^r^a;case 2:return t&r^t&a^r&a}}(v,g,y,_)+b+t[v]+h[w]>>>0;b=_,_=y,y=o(g,30)>>>0,g=m,m=O}r[0]=r[0]+m>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+y>>>0,r[3]=r[3]+_>>>0,r[4]=r[4]+b>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}),u=r(640191),c=r(457099),d=r(994743);let h=Symbol.for("lc:context_variables");var p=r(791259),f=r(723352);function m(e,t,r=1){let a=r.toFixed(0).slice(0,3).padStart(3,"0"),i=`${new Date(e).toISOString().slice(0,-1)}${a}Z`;return{dottedOrder:i.replace(/[-:.]/g,"")+t,microsecondPrecisionDatestring:i}}class g{constructor(e,t,r,a){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=a}static fromHeader(e){let t,r,a=e.split(","),i={},n=[];for(let e of a){let[a,s]=e.split("="),o=decodeURIComponent(s);"langsmith-metadata"===a?i=JSON.parse(o):"langsmith-tags"===a?n=o.split(","):"langsmith-project"===a?t=o:"langsmith-replicas"===a&&(r=JSON.parse(o))}return new g(i,n,t,r)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class y{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){return null!=e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}(e))return void Object.assign(this,{...e});let t=y.getDefaultConfig(),{metadata:r,...a}=e,i=a.client??y.getSharedClient(),n={...r,...a?.extra?.metadata};if(a.extra={...a.extra,metadata:n},Object.assign(this,{...t,...a,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=function(e){return e?e.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):function(){let e=(0,c.lS)("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{let r=JSON.parse(e);if(Array.isArray(r)){let e=[];for(let t of r){if("object"!=typeof t||null===t){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof t}`);continue}if("string"!=typeof t.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_url}`);continue}if("string"!=typeof t.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_key}`);continue}e.push({apiUrl:t.api_url.replace(/\/$/,""),apiKey:t.api_key})}return e}if("object"!=typeof r||null===r)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof r}`),[];{var t=r;if(Object.keys(t).length>0&&(0,c.HC)("ENDPOINT"))throw new d.Jz;let e=[];for(let[t,a]of Object.entries(r)){let r=t.replace(/\/$/,"");if("string"==typeof a)e.push({apiUrl:r,apiKey:a});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${t}: expected string, got ${typeof a}`);continue}}return e}}catch(e){if((0,d._2)(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}()}(this.replicas),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let{dottedOrder:e,microsecondPrecisionDatestring:t}=m(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e,this._serialized_start_time=t}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:a.Z(),run_type:"chain",project_name:(0,p.B)(),child_runs:[],api_url:(0,c.lS)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,c.lS)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return y.sharedClient||(y.sharedClient=new u.KU),y.sharedClient}createChild(e){var t,r;let a=this.child_execution_order+1,i=new y({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:a,child_execution_order:a});h in this&&(i[h]=this[h]);let n=Symbol.for("lc:child_config"),s=e.extra?.[n]??this.extra[n];if(null!=(t=s)&&"object"==typeof t.callbacks&&(b(t.callbacks?.handlers)||b(t.callbacks))){let e={...s},t="object"==typeof(r=e.callbacks)&&null!=r&&Array.isArray(r.handlers)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:i.id}),t.handlers?.find(_)?.updateFromRunTree?.(i),e.callbacks=t),i.extra[n]=e}let o=new Set,l=this;for(;null!=l&&!o.has(l.id);)o.add(l.id),l.child_execution_order=Math.max(l.child_execution_order,a),l=l.parent_run;return this.child_runs.push(i),i}async end(e,t,r=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,r=!0){let a,i,n=e.extra??{};if(n?.runtime?.library===void 0&&(n.runtime||(n.runtime={}),t))for(let[e,r]of Object.entries(t))n.runtime[e]||(n.runtime[e]=r);return r?(i=e.parent_run?.id??e.parent_run_id,a=[]):(a=e.child_runs.map(e=>this._convertToCreate(e,t,r)),i=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){let a,i=this._convertToCreate(this,t,r);if(e===this.project_name)return i;let n=t=>l(`${t}:${e}`,l.DNS),s=n(i.id),o=i.trace_id?n(i.trace_id):void 0,u=i.parent_run_id?n(i.parent_run_id):void 0;if(i.dotted_order){let e=i.dotted_order.split(".").map(e=>{let t=e.slice(0,-36),r=e.slice(-36),a=parseInt(t.slice(0,4)),i=parseInt(t.slice(4,6))-1,n=parseInt(t.slice(6,8)),s=parseInt(t.slice(9,11)),o=parseInt(t.slice(11,13));return[new Date(a,i,n,s,o,parseInt(t.slice(13,15)),parseInt(t.slice(15,21))/1e3),r]}),t=[];for(let r=0;r<e.length-1;r++){let[a,i]=e[r],s=n(i);t.push(a.toISOString().replace(/[-:]/g,"").replace(".","")+s)}let[r]=e[e.length-1];t.push(r.toISOString().replace(/[-:]/g,"").replace(".","")+s),a=t.join(".")}else a=void 0;return{...i,id:s,trace_id:o,parent_run_id:u,dotted_order:a,session_name:e}}async postRun(e=!0){try{let t=(0,c.sA)();if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:r,apiUrl:a,workspaceId:i}of this.replicas){let n=this._remapForProject(e??this.project_name,t,!0);await this.client.createRun(n,{apiKey:r,apiUrl:a,workspaceId:i})}else{let r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e)for(let e of((0,f.O)("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:r,apiUrl:a,workspaceId:i,updates:n}of this.replicas){let s=this._remapForProject(t??this.project_name),o={id:s.id,outputs:s.outputs,error:s.error,parent_run_id:s.parent_run_id,session_name:s.session_name,reference_example_id:s.reference_example_id,end_time:s.end_time,dotted_order:s.dotted_order,trace_id:s.trace_id,events:s.events,tags:s.tags,extra:s.extra,attachments:this.attachments,...n};e?.excludeInputs||(o.inputs=s.inputs),await this.client.updateRun(s.id,o,{apiKey:r,apiUrl:a,workspaceId:i})}else try{let t={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var r;let a,i,n,s=e?.callbacks,o=void 0!==r?r:!!["TRACING_V2","TRACING"].find(e=>"true"===(0,c.HC)(e));if(s){let e=s?.getParentRunId?.()??"",t=s?.handlers?.find(e=>e?.name=="langchain_tracer");a=t?.getRun?.(e),i=t?.projectName,n=t?.client,o=o||!!t}return a?new y({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:n,tracingEnabled:o,project_name:i,tags:[...new Set((a?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...a?.extra?.metadata,...e?.metadata}}}).createChild(t):new y({...t,client:n,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=r["langsmith-trace"];if(!a||"string"!=typeof a)return;let i=a.trim(),n=i.split(".").map(e=>{let[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}}),s=n[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:n.at(-1)?.uuid,trace_id:s,dotted_order:i};if(r.baggage&&"string"==typeof r.baggage){let e=g.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}return new y(o)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new g(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[r,a]of Object.entries(t))e.set(r,a);return t}}function _(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function b(e){return Array.isArray(e)&&e.some(e=>_(e))}Object.defineProperty(y,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})},127766:function(e,t,r){"use strict";r.d(t,{Pf:()=>n,sv:()=>s});var a=r(457099);let i=Symbol.for("ls:fetch_implementation"),n=()=>{let e=globalThis[i];return!!e&&"function"==typeof e&&"Headers"in e&&"Request"in e&&"Response"in e},s=e=>async(...t)=>{if(e||"true"===(0,a.HC)("DEBUG")){let[e,r]=t;console.log(` ${r?.method||"GET"} ${e}`)}let r=await (globalThis[i]??((...e)=>fetch(...e)))(...t);return(e||"true"===(0,a.HC)("DEBUG"))&&console.log(` ${r.status} ${r.statusText} ${r.url}`),r}},457099:function(e,t,r){"use strict";let a,i,n;r.d(t,{DW:()=>u,HC:()=>d,US:()=>h,dU:()=>o,lS:()=>c,sA:()=>l});var s=r(642106);let o=()=>a||(a="undefined"!=typeof Bun?"bun":"undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||"undefined"!=typeof Deno?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":"undefined"!=typeof Deno?"deno":"other":"node");function l(){if(void 0===i){let e=o(),t=function(){if(void 0!==n)return n;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=c(t);void 0!==r&&(e[t]=r)}return n=e,e}();i={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:s.I9,...t}}return i}function u(){let e=function(){try{if("undefined"!=typeof process&&process.env)return Object.entries(process.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[a,i]of Object.entries(e))(a.startsWith("LANGCHAIN_")||a.startsWith("LANGSMITH_"))&&"string"==typeof i&&!r.includes(a)&&!a.toLowerCase().includes("key")&&!a.toLowerCase().includes("secret")&&!a.toLowerCase().includes("token")&&("LANGCHAIN_REVISION_ID"===a?t.revision_id=i:t[a]=i);return t}function c(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function d(e){return c(`LANGSMITH_${e}`)||c(`LANGCHAIN_${e}`)}function h(){return"true"===c("OTEL_ENABLED")||"true"===d("OTEL_ENABLED")}},994743:function(e,t,r){"use strict";r.d(t,{Jz:()=>s,_2:()=>o,y6:()=>i});class a extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function i(e,t,r){let i;if(e.ok){r&&(i=await e.text());return}if(403===e.status)try{let t=await e.json(),r=t?.error;"org_scoped_key_requires_workspace"===r&&(i="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch(r){let t=Error(`${e.status} ${e.statusText}`);throw t.status=e?.status,t}if(void 0===i)try{i=await e.text()}catch(e){i=""}let n=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Message: ${i}`;if(409===e.status)throw new a(n);let s=Error(n);throw s.status=e.status,s}let n="ERR_CONFLICTING_ENDPOINTS";class s extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:n}),this.name="ConflictingEndpointsError"}}function o(e){return"object"==typeof e&&null!==e&&e.code===n}},791259:function(e,t,r){"use strict";r.d(t,{B:()=>i});var a=r(457099);let i=()=>(0,a.HC)("PROJECT")??(0,a.lS)("LANGCHAIN_SESSION")??"default"},723352:function(e,t,r){"use strict";r.d(t,{O:()=>i});let a={};function i(e){a[e]||(console.warn(e),a[e]=!0)}},440455:function(e,t,r){"use strict";r.d(t,{Bm:()=>a.Bm,IV:()=>a.IV,KU:()=>a.KU});var a=r(642106)},400032:function(e,t,r){"use strict";r.d(t,{IV:()=>a.IV,Yo:()=>a.Yo});var a=r(936852)},906774:function(e,t,r){"use strict";r.d(t,{xQ:()=>o,dy:()=>s});let a=Symbol.for("ls:tracing_async_local_storage"),i=new class{getStore(){}run(e,t){return t()}},n=new class{getInstance(){return globalThis[a]??i}initializeGlobalInstance(e){void 0===globalThis[a]&&(globalThis[a]=e)}};function s(e=!1){let t=n.getInstance().getStore();if(!e&&void 0===t)throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}function o(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root")},492589:function(e,t,r){"use strict";function a(e,t,r){function a(r,a){var i;for(let n in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(i=r._zod).traits??(i.traits=new Set),r._zod.traits.add(e),t(r,a),s.prototype)n in r||Object.defineProperty(r,n,{value:s.prototype[n].bind(r)});r._zod.constr=s,r._zod.def=a}let i=r?.Parent??Object;class n extends i{}function s(e){var t;let i=r?.Parent?new n:this;for(let r of(a(i,e),(t=i._zod).deferred??(t.deferred=[]),i._zod.deferred))r();return i}return Object.defineProperty(n,"name",{value:e}),Object.defineProperty(s,"init",{value:a}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}r.d(t,{IF:()=>a,TG:()=>i,vc:()=>s}),Object.freeze({status:"aborted"}),Symbol("zod_brand");class i extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let n={};function s(e){return e&&Object.assign(n,e),n}},297661:function(e,t,r){"use strict";r.d(t,{X9:()=>d,As:()=>c,Qc:()=>l,Vw:()=>u});var a=r(492589),i=r(201988);let n=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,i.$W,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},s=(0,a.IF)("$ZodError",n),o=(0,a.IF)("$ZodError",n,{Parent:Error}),l=(e,t,r,n)=>{let s=r?Object.assign(r,{async:!1}):{async:!1},l=e._zod.run({value:t,issues:[]},s);if(l instanceof Promise)throw new a.TG;if(l.issues.length){let e=new(n?.Err??o)(l.issues.map(e=>i.G$(e,s,a.vc())));throw i.zw(e,n?.callee),e}return l.value},u=async(e,t,r,n)=>{let s=r?Object.assign(r,{async:!0}):{async:!0},l=e._zod.run({value:t,issues:[]},s);if(l instanceof Promise&&(l=await l),l.issues.length){let e=new(n?.Err??o)(l.issues.map(e=>i.G$(e,s,a.vc())));throw i.zw(e,n?.callee),e}return l.value},c=(e,t,r)=>{let n=r?{...r,async:!1}:{async:!1},l=e._zod.run({value:t,issues:[]},n);if(l instanceof Promise)throw new a.TG;return l.issues.length?{success:!1,error:new(o??s)(l.issues.map(e=>i.G$(e,n,a.vc())))}:{success:!0,data:l.value}},d=async(e,t,r)=>{let n=r?Object.assign(r,{async:!0}):{async:!0},s=e._zod.run({value:t,issues:[]},n);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new o(s.issues.map(e=>i.G$(e,n,a.vc())))}:{success:!0,data:s.value}}},70712:function(e,t,r){"use strict";r.d(t,{$Z:()=>i,EC:()=>a}),Symbol("ZodOutput"),Symbol("ZodInput");class a{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}let i=new a},608580:function(e,t,r){"use strict";r.d(t,{a:()=>s});var a=r(70712),i=r(201988);class n{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??a.$Z,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;let a=e._zod.def,n=this.seen.get(e);if(n)return n.count++,t.schemaPath.includes(e)&&(n.cycle=t.path),n.schema;let s={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,s);let o=e._zod.toJSONSchema?.();if(o)s.schema=o;else{let r={...t,schemaPath:[...t.schemaPath,e],path:t.path},n=e._zod.parent;if(n)s.ref=n,this.process(n,r),this.seen.get(n).isParent=!0;else{let t=s.schema;switch(a.type){case"string":{t.type="string";let{minimum:r,maximum:a,format:i,patterns:n,contentEncoding:o}=e._zod.bag;if("number"==typeof r&&(t.minLength=r),"number"==typeof a&&(t.maxLength=a),i&&(t.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[i]??i,""===t.format&&delete t.format),o&&(t.contentEncoding=o),n&&n.size>0){let e=[...n];1===e.length?t.pattern=e[0].source:e.length>1&&(s.schema.allOf=[...e.map(e=>({..."draft-7"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{let{minimum:r,maximum:a,format:i,multipleOf:n,exclusiveMaximum:s,exclusiveMinimum:o}=e._zod.bag;"string"==typeof i&&i.includes("int")?t.type="integer":t.type="number","number"==typeof o&&(t.exclusiveMinimum=o),"number"==typeof r&&(t.minimum=r,"number"==typeof o&&(o>=r?delete t.minimum:delete t.exclusiveMinimum)),"number"==typeof s&&(t.exclusiveMaximum=s),"number"==typeof a&&(t.maximum=a,"number"==typeof s&&(s<=a?delete t.maximum:delete t.exclusiveMaximum)),"number"==typeof n&&(t.multipleOf=n);break}case"boolean":case"success":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"null":t.type="null";break;case"any":case"unknown":break;case"undefined":if("throw"===this.unrepresentable)throw Error("Undefined cannot be represented in JSON Schema");break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"never":t.not={};break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:i,maximum:n}=e._zod.bag;"number"==typeof i&&(t.minItems=i),"number"==typeof n&&(t.maxItems=n),t.type="array",t.items=this.process(a.element,{...r,path:[...r.path,"items"]});break}case"object":{t.type="object",t.properties={};let e=a.shape;for(let a in e)t.properties[a]=this.process(e[a],{...r,path:[...r.path,"properties",a]});let i=new Set([...new Set(Object.keys(e))].filter(e=>{let t=a.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}));i.size>0&&(t.required=Array.from(i)),a.catchall?._zod.def.type==="never"?t.additionalProperties=!1:a.catchall?a.catchall&&(t.additionalProperties=this.process(a.catchall,{...r,path:[...r.path,"additionalProperties"]})):"output"===this.io&&(t.additionalProperties=!1);break}case"union":t.anyOf=a.options.map((e,t)=>this.process(e,{...r,path:[...r.path,"anyOf",t]}));break;case"intersection":{let e=this.process(a.left,{...r,path:[...r.path,"allOf",0]}),i=this.process(a.right,{...r,path:[...r.path,"allOf",1]}),n=e=>"allOf"in e&&1===Object.keys(e).length;t.allOf=[...n(e)?e.allOf:[e],...n(i)?i.allOf:[i]];break}case"tuple":{t.type="array";let i=a.items.map((e,t)=>this.process(e,{...r,path:[...r.path,"prefixItems",t]}));if("draft-2020-12"===this.target?t.prefixItems=i:t.items=i,a.rest){let e=this.process(a.rest,{...r,path:[...r.path,"items"]});"draft-2020-12"===this.target?t.items=e:t.additionalItems=e}a.rest&&(t.items=this.process(a.rest,{...r,path:[...r.path,"items"]}));let{minimum:n,maximum:s}=e._zod.bag;"number"==typeof n&&(t.minItems=n),"number"==typeof s&&(t.maxItems=s);break}case"record":t.type="object",t.propertyNames=this.process(a.keyType,{...r,path:[...r.path,"propertyNames"]}),t.additionalProperties=this.process(a.valueType,{...r,path:[...r.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let e=(0,i.B8)(a.entries);e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),t.enum=e;break}case"literal":{let e=[];for(let t of a.values)if(void 0===t){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof t)if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else e.push(Number(t));else e.push(t);if(0===e.length);else if(1===e.length){let r=e[0];t.type=null===r?"null":typeof r,t.const=r}else e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),e.every(e=>"boolean"==typeof e)&&(t.type="string"),e.every(e=>null===e)&&(t.type="null"),t.enum=e;break}case"file":{let r={type:"string",format:"binary",contentEncoding:"binary"},{minimum:a,maximum:i,mime:n}=e._zod.bag;void 0!==a&&(r.minLength=a),void 0!==i&&(r.maxLength=i),n?1===n.length?(r.contentMediaType=n[0],Object.assign(t,r)):t.anyOf=n.map(e=>({...r,contentMediaType:e})):Object.assign(t,r);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":t.anyOf=[this.process(a.innerType,r),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(a.innerType,r),s.ref=a.innerType;break;case"default":this.process(a.innerType,r),s.ref=a.innerType,t.default=JSON.parse(JSON.stringify(a.defaultValue));break;case"prefault":this.process(a.innerType,r),s.ref=a.innerType,"input"===this.io&&(t._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break;case"catch":{let e;this.process(a.innerType,r),s.ref=a.innerType;try{e=a.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let r=e._zod.pattern;if(!r)throw Error("Pattern not found in template literal");t.type="string",t.pattern=r.source;break}case"pipe":{let e="input"===this.io?"transform"===a.in._zod.def.type?a.out:a.in:a.out;this.process(e,r),s.ref=e;break}case"readonly":this.process(a.innerType,r),s.ref=a.innerType,t.readOnly=!0;break;case"lazy":{let t=e._zod.innerType;this.process(t,r),s.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}}let l=this.metadataRegistry.get(e);return l&&Object.assign(s.schema,l),"input"===this.io&&function e(t,r){let a=r??{seen:new Set};if(a.seen.has(t))return!1;a.seen.add(t);let i=t._zod.def;switch(i.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return e(i.element,a);case"object":for(let t in i.shape)if(e(i.shape[t],a))return!0;return!1;case"union":for(let t of i.options)if(e(t,a))return!0;return!1;case"intersection":return e(i.left,a)||e(i.right,a);case"tuple":for(let t of i.items)if(e(t,a))return!0;if(i.rest&&e(i.rest,a))return!0;return!1;case"record":case"map":return e(i.keyType,a)||e(i.valueType,a);case"set":return e(i.valueType,a);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return e(i.innerType,a);case"lazy":return e(i.getter(),a);case"transform":return!0;case"pipe":return e(i.in,a)||e(i.out,a)}throw Error(`Unknown schema type: ${i.type}`)}(e)&&(delete s.schema.examples,delete s.schema.default),"input"===this.io&&s.schema._prefault&&((r=s.schema).default??(r.default=s.schema._prefault)),delete s.schema._prefault,this.seen.get(e).schema}emit(e,t){let r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},a=this.seen.get(e);if(!a)throw Error("Unprocessed schema. This is a bug in Zod.");let i=e=>{let t="draft-2020-12"===this.target?"$defs":"definitions";if(r.external){let a=r.external.registry.get(e[0])?.id,i=r.external.uri??(e=>e);if(a)return{ref:i(a)};let n=e[1].defId??e[1].schema.id??`schema${this.counter++}`;return e[1].defId=n,{defId:n,ref:`${i("__shared")}#/${t}/${n}`}}if(e[1]===a)return{ref:"#"};let i=`#/${t}/`,n=e[1].schema.id??`__schema${this.counter++}`;return{defId:n,ref:i+n}},n=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:r,defId:a}=i(e);t.def={...t.schema},a&&(t.defId=a);let n=t.schema;for(let e in n)delete n[e];n.$ref=r};if("throw"===r.cycles)for(let e of this.seen.entries()){let t=e[1];if(t.cycle)throw Error(`Cycle detected: #/${t.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let t of this.seen.entries()){let a=t[1];if(e===t[0]){n(t);continue}if(r.external){let a=r.external.registry.get(t[0])?.id;if(e!==t[0]&&a){n(t);continue}}if(this.metadataRegistry.get(t[0])?.id||a.cycle||a.count>1&&"ref"===r.reused){n(t);continue}}let s=(e,t)=>{let r=this.seen.get(e),a=r.def??r.schema,i={...a};if(null===r.ref)return;let n=r.ref;if(r.ref=null,n){s(n,t);let e=this.seen.get(n).schema;e.$ref&&"draft-7"===t.target?(a.allOf=a.allOf??[],a.allOf.push(e)):(Object.assign(a,e),Object.assign(a,i))}r.isParent||this.override({zodSchema:e,jsonSchema:a,path:r.path??[]})};for(let e of[...this.seen.entries()].reverse())s(e[0],{target:this.target});let o={};if("draft-2020-12"===this.target?o.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?o.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),r.external?.uri){let t=r.external.registry.get(e)?.id;if(!t)throw Error("Schema is missing an `id` property");o.$id=r.external.uri(t)}Object.assign(o,a.def);let l=r.external?.defs??{};for(let e of this.seen.entries()){let t=e[1];t.def&&t.defId&&(l[t.defId]=t.def)}r.external||Object.keys(l).length>0&&("draft-2020-12"===this.target?o.$defs=l:o.definitions=l);try{return JSON.parse(JSON.stringify(o))}catch(e){throw Error("Error converting schema to JSON.")}}}function s(e,t){if(e instanceof a.EC){let r=new n(t),a={};for(let t of e._idmap.entries()){let[e,a]=t;r.process(a)}let i={},s={registry:e,uri:t?.uri,defs:a};for(let a of e._idmap.entries()){let[e,n]=a;i[e]=r.emit(n,{...t,external:s})}return Object.keys(a).length>0&&(i.__shared={["draft-2020-12"===r.target?"$defs":"definitions"]:a}),{schemas:i}}let r=new n(t);return r.process(e),r.emit(e,t)}},201988:function(e,t,r){"use strict";function a(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function i(e,t){return"bigint"==typeof t?t.toString():t}r.d(t,{$W:()=>i,B8:()=>a,G$:()=>c,Ko:()=>l,d9:()=>s,de:()=>o,zw:()=>n});let n=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function s(e,t,r){let a=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(a._zod.parent=e),a}function o(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function l(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function u(e){return"string"==typeof e?e:e?.message}function c(e,t,r){let a={...e,path:e.path??[]};return e.message||(a.message=u(e.inst?._zod.def?.error?.(e))??u(t?.error?.(e))??u(r.customError?.(e))??u(r.localeError?.(e))??"Invalid input"),delete a.inst,delete a.continue,t?.reportInput||delete a.input,a}}}]);