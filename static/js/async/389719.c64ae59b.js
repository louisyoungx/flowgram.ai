"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["389719"],{352823:function(s,e,n){n.r(e),n.d(e,{default:()=>c});var r=n(110239),i=n(437562);let o=n.p+"static/image/weaving.422fab53.png";function l(s){let e={a:"a",code:"code",div:"div",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...(0,i.a)(),...s.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.h1,{id:"ioc",children:[(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#ioc",children:"#"}),"IOC"]}),"\n",(0,r.jsxs)(e.h2,{id:"为什么需要-ioc",children:[(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#为什么需要-ioc",children:"#"}),"为什么需要 IOC"]}),"\n",(0,r.jsxs)(e.div,{className:"rspress-directive warning",children:[(0,r.jsx)(e.div,{className:"rspress-directive-title",children:"几个概念"}),(0,r.jsx)(e.div,{className:"rspress-directive-content",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"控制反转： Inversion of Control， 是面向对象中的一种设计原则，可以用来降低代码模块之间的耦合度，其中最常见的方式叫做依赖注入（Dependency Injection，简称DI）"}),"\n",(0,r.jsx)(e.li,{children:"领域逻辑：Domain Logic，也可以叫 业务逻辑（Business Logic），这些业务逻辑与特定的产品功能相关"}),"\n",(0,r.jsx)(e.li,{children:"面向切面编程：AOP （Aspect-Oriented Programming），最核心的设计原则是将软件系统拆分为公用逻辑 (横切，有贯穿的意味) 和 领域逻辑 （纵切）的多个个方面 (Aspect)，横切部分可以被所有的 纵切 部分 “按需消费”"}),"\n"]})})]}),"\n",(0,r.jsx)(e.p,{children:"回答这个问题之前先了解切面编程，切面编程目的是将领域逻辑的粒度拆的更细，横切部分可被纵切 “按需消费” ，横切和纵切的连接也叫 织入 (Weaving)，而 IOC 就是扮演 Weaving 注入到纵切的角色"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"切面编程",src:o})}),"\n",(0,r.jsx)(e.p,{children:"理想的切面编程"}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,r.jsxs)(e.code,{className:"language-ts",children:[(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" myAppliation 提供业务逻辑"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" service 特定的业务逻辑服务"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"     -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" customDomainLogicService"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" contributionImplement 钩子的注册实例化"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"    -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" MyApplicationContributionImpl"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" component 业务组件"})]}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" core 提供通用逻辑"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" model 通用模型"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" contribution 钩子接口"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"     -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" LifecycleContribution 应用的生命周期"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"     -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" CommandContribution"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" service 公用的service的服务"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"     -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" CommandService"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"     -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" ClipboardService"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  -"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" component 公用的组件"})]})]})})}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,r.jsxs)(e.code,{className:"language-ts",children:[(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// IOC 的注入"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"@"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"injectable"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" class"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" CustomDomainLogicService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"@"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"inject"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"(FlowContextService) "}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"protected"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" flowContextService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" FlowContextService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"@"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"inject"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"(CommandService) "}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"protected"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" commandService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" CommandService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"@"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"inject"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"(SelectionService) "}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"protected"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" selectionService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" SelectionService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"}"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// IOC 的接口声明"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"interface"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" LifecycleContribution"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" onInit"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" void"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" onStart"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" void"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" onDispose"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" void"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"}"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// IOC 的接口实现"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"@"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"injectable"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" class"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" MyApplicationContributionImpl"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" implements"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" LifecycleContribution"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"  onStart"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" void"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"    // 特定的业务逻辑代码"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"}"})}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 手动挂在到生命周期钩子"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"bind"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"(LifecycleContribution)"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".toService"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"(MyApplicationContributionImpl)"})]})]})})}),"\n",(0,r.jsxs)(e.div,{className:"rspress-directive warning",children:[(0,r.jsx)(e.div,{className:"rspress-directive-title",children:"IOC是切面编程的一种手段，引入后，底层模块可以以接口形式暴露给外部注册，带来的好处："}),(0,r.jsx)(e.div,{className:"rspress-directive-content",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"实现微内核 + 插件化的设计，实现插件的可插拔按需消费"}),"\n",(0,r.jsx)(e.li,{children:"可以让包拆得更干净，实现 feature 式的拆包"}),"\n"]})})]})]})}function c(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...(0,i.a)(),...s.components};return e?(0,r.jsx)(e,{...s,children:(0,r.jsx)(l,{...s})}):l(s)}c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["zh%2Fguide%2Fconcepts%2Fioc.mdx"]={toc:[{id:"为什么需要-ioc",text:"为什么需要 IOC",depth:2}],title:"IOC",headingTitle:"IOC",frontmatter:{}}}}]);