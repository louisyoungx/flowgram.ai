"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["334122"],{302953:function(e,t,r){r.d(t,{TaskCancelAPI:()=>eJ,TaskReportAPI:()=>eH,TaskResultAPI:()=>eU,TaskRunAPI:()=>eF,TaskValidateAPI:()=>eY});var s,o,a,n,i,u,l,d,c,p,h,g,f,m=r(196130),y=r(863875),b=r(868977),w=r(418856),E=r(778168),T=r(383909),k=r(969134),N=m.ZP.record(m.ZP.string(),m.ZP.any()),I=m.ZP.object({id:m.ZP.string(),nodeID:m.ZP.string(),inputs:N,outputs:N.optional(),data:N,branch:m.ZP.string().optional()}),v={status:m.ZP.string(),terminated:m.ZP.boolean(),startTime:m.ZP.number(),endTime:m.ZP.number().optional(),timeCost:m.ZP.number()},S=m.ZP.object(v),P=m.ZP.object({id:m.ZP.string(),...v,snapshots:m.ZP.array(I)}),_=m.ZP.record(m.ZP.string(),P),x=m.ZP.object({id:m.ZP.string(),type:m.ZP.enum(["log","info","debug","error","warning"]),message:m.ZP.string(),nodeID:m.ZP.string().optional(),timestamp:m.ZP.number()}),C=m.ZP.record(m.ZP.enum(["log","info","debug","error","warning"]),m.ZP.array(x)),$=((s=$||{}).ServerInfo="ServerInfo",s.TaskRun="TaskRun",s.TaskReport="TaskReport",s.TaskResult="TaskResult",s.TaskCancel="TaskCancel",s.TaskValidate="TaskValidate",s),O=(m.ZP.object({schema:m.ZP.string(),inputs:N}),m.ZP.object({valid:m.ZP.boolean(),errors:m.ZP.array(m.ZP.string()).optional()}),m.ZP.object({schema:m.ZP.string(),inputs:N}),m.ZP.object({taskID:m.ZP.string()}),m.ZP.object({taskID:m.ZP.string()}),{name:"TaskReport",method:"GET",path:"/task/report",module:"Task",schema:{input:m.ZP.object({taskID:m.ZP.string()}),output:m.ZP.object({id:m.ZP.string(),inputs:N,outputs:N,workflowStatus:S,reports:_,messages:C})}}),A=(m.ZP.object({taskID:m.ZP.string()}),m.ZP.object({success:m.ZP.boolean()}),m.ZP.undefined(),m.ZP.object({name:m.ZP.string(),runtime:m.ZP.string(),version:m.ZP.string(),time:m.ZP.string()}),(o=A||{}).Input="input",o.Output="output",o),Z=((a=Z||{}).String="string",a.Integer="integer",a.Number="number",a.Boolean="boolean",a.Object="object",a.Array="array",a.Null="null",a),j=((n=j||{}).Root="root",n.Start="start",n.End="end",n.LLM="llm",n.Code="code",n.Condition="condition",n.Loop="loop",n.Comment="comment",n.Group="group",n.BlockStart="block-start",n.BlockEnd="block-end",n.HTTP="http",n.Break="break",n.Continue="continue",n),D=((i=D||{}).EQ="eq",i.NEQ="neq",i.GT="gt",i.GTE="gte",i.LT="lt",i.LTE="lte",i.IN="in",i.NIN="nin",i.CONTAINS="contains",i.NOT_CONTAINS="not_contains",i.IS_EMPTY="is_empty",i.IS_NOT_EMPTY="is_not_empty",i.IS_TRUE="is_true",i.IS_FALSE="is_false",i),M=((u=M||{}).None="none",u.FormData="form-data",u.XWwwFormUrlencoded="x-www-form-urlencoded",u.RawText="raw-text",u.JSON="JSON",u.Binary="binary",u),V=Symbol.for("Engine"),L=Symbol.for("Executor"),R=((l=R||{}).Pending="pending",l.Processing="processing",l.Succeeded="succeeded",l.Failed="failed",l.Canceled="canceled",l),W=Symbol.for("Validation"),B=((d=B||{}).Log="log",d.Info="info",d.Debug="debug",d.Error="error",d.Warn="warning",d),q=class{async execute(e){return{outputs:e.runtime.ioCenter.inputs}}constructor(){this.type=j.Start}},Y=b.Z;function F(e,t){let r=new Set,s=[],o=e=>{for(let a of t(e))r.has(a.id)||(r.add(a.id),s.push(a),o(a))};return o(e),s}(c=p||(p={})).getWorkflowType=e=>null==e?Z.Null:"string"==typeof e?Z.String:"boolean"==typeof e?Z.Boolean:"number"==typeof e?Number.isInteger(e)?Z.Integer:Z.Number:Array.isArray(e)?Z.Array:"object"==typeof e?Z.Object:null,c.isMatchWorkflowType=(e,t)=>{let r=(0,c.getWorkflowType)(e);return!!r&&r===t},c.isTypeEqual=(e,t)=>e===Z.Number&&t===Z.Integer||e===Z.Integer&&t===Z.Number||e===t,c.getArrayItemsType=e=>{let t=e[0];return e.forEach(e=>{if(e!==t)throw Error(`Array items type must be same, expect ${t}, but got ${e}`)}),t};var U="root",H=e=>e===U,J=(e,t,r)=>{if(t.$ref)return{result:!0};if(t.enum&&t.enum.length>0&&!t.enum.includes(e))return{result:!1,errorMessage:`Value at ${r} must be one of: ${t.enum.join(", ")}, but got: ${JSON.stringify(e)}`};switch(t.type){case"boolean":return Q(e,r);case"string":return G(e,r);case"integer":return X(e,r);case"number":return z(e,r);case"object":return K(e,t,r);case"array":return ee(e,t,r);case"map":return et(e,t,r);default:return{result:!1,errorMessage:`Unknown type "${t.type}" at ${r}`}}},Q=(e,t)=>"boolean"!=typeof e?{result:!1,errorMessage:`Expected boolean at ${t}, but got: ${typeof e}`}:{result:!0},G=(e,t)=>"string"!=typeof e?{result:!1,errorMessage:`Expected string at ${t}, but got: ${typeof e}`}:{result:!0},X=(e,t)=>Number.isInteger(e)?{result:!0}:{result:!1,errorMessage:`Expected integer at ${t}, but got: ${JSON.stringify(e)}`},z=(e,t)=>"number"!=typeof e||isNaN(e)?{result:!1,errorMessage:`Expected number at ${t}, but got: ${JSON.stringify(e)}`}:{result:!0},K=(e,t,r)=>{if(null==e)return{result:!1,errorMessage:`Expected object at ${r}, but got: ${e}`};if("object"!=typeof e||Array.isArray(e))return{result:!1,errorMessage:`Expected object at ${r}, but got: ${Array.isArray(e)?"array":typeof e}`};if(t.required&&t.required.length>0){for(let s of t.required)if(!(s in e))return{result:!1,errorMessage:`Missing required property "${s}" at ${r}`}}if(t.properties)for(let[o]of Object.entries(t.properties)){var s;if((null==(s=t.required)?void 0:s.includes(o))&&!(o in e))return{result:!1,errorMessage:`Missing required property "${o}" at ${r}`}}if(t.properties){for(let[s,o]of Object.entries(t.properties))if(s in e){let t=H(r)?s:`${r}.${s}`,a=J(e[s],o,t);if(!a.result)return a}}if(t.additionalProperties){let s=new Set(Object.keys(t.properties||{}));for(let[o,a]of Object.entries(e))if(!s.has(o)){let e=H(r)?o:`${r}.${o}`,s=J(a,t.additionalProperties,e);if(!s.result)return s}}return{result:!0}},ee=(e,t,r)=>{if(!Array.isArray(e))return{result:!1,errorMessage:`Expected array at ${r}, but got: ${typeof e}`};if(t.items)for(let[s,o]of e.entries()){let e=`${r}[${s}]`,a=J(o,t.items,e);if(!a.result)return a}return{result:!0}},et=(e,t,r)=>{if(null==e)return{result:!1,errorMessage:`Expected map at ${r}, but got: ${e}`};if("object"!=typeof e||Array.isArray(e))return{result:!1,errorMessage:`Expected map at ${r}, but got: ${Array.isArray(e)?"array":typeof e}`};if(t.additionalProperties)for(let[s,o]of Object.entries(e)){let e=H(r)?s:`${r}.${s}`,a=J(o,t.additionalProperties,e);if(!a.result)return a}return{result:!0}},er=class{async execute(e){let t=e.node.id,r=e.container.get(V),{value:s,itemsType:o}=this.getLoopArrayVariable(e),a=e.node.children.find(e=>e.type===j.BlockStart);if(!a)throw Error("Loop block start node not found");let n=[];for(let i=0;i<s.length;i++){let u=s[i],l=e.runtime.sub();l.variableStore.setVariable({nodeID:`${t}_locals`,key:"item",type:o,value:u}),l.variableStore.setVariable({nodeID:`${t}_locals`,key:"index",type:Z.Number,value:i});try{await r.executeNode({context:l,node:a})}catch(e){throw Error("Loop block execute error")}if(this.isBreak(l))break;if(this.isContinue(l))continue;let d=this.getBlockOutput(e,l);n.push(d)}return this.setLoopNodeOutputs(e,n),{outputs:this.combineBlockOutputs(e,n)}}getLoopArrayVariable(e){let t=e.node.data,r=e.runtime.state.parseRef(t.loopFor);return this.checkLoopArray(r),r}checkLoopArray(e){let t=null==e?void 0:e.value;if(!t||(0,y.Z)(t)||!Array.isArray(t))throw Error('Loop "loopFor" is required');if(e.type!==Z.Array)throw Error('Loop "loopFor" must be an array');let r=e.itemsType;if((0,y.Z)(r))throw Error('Loop "loopFor.items" must be array items')}getBlockOutput(e,t){return Object.entries(this.getLoopOutputsDeclare(e)).reduce((e,r)=>{let[s,o]=r,a=t.state.parseRef(o);return a?{...e,[s]:a}:e},{})}setLoopNodeOutputs(e,t){let r=e.node;Object.keys(this.getLoopOutputsDeclare(e)).forEach(s=>{let o=t.map(e=>e[s]),a=o.map(e=>e.type),n=p.getArrayItemsType(a),i=o.map(e=>e.value);e.runtime.variableStore.setVariable({nodeID:r.id,key:s,type:Z.Array,itemsType:n,value:i})})}combineBlockOutputs(e,t){return Object.keys(this.getLoopOutputsDeclare(e)).reduce((e,r)=>({...e,[r]:t.map(e=>e[r].value)}),{})}getLoopOutputsDeclare(e){return e.node.data.loopOutputs??{}}isBreak(e){return!0===e.cache.get("loop-break")}isContinue(e){return!0===e.cache.get("loop-continue")}constructor(){this.type=j.Loop}},es=class{async execute(e){let t,r=e.inputs;this.checkInputs(r);let{modelName:s,temperature:o,apiKey:a,apiHost:n,systemPrompt:i,prompt:u}=r,l=new w.z7({modelName:s,temperature:o,apiKey:a,configuration:{baseURL:n},maxRetries:3}),d=[];i&&d.push(new E.jN(i)),d.push(new E.xk(u));try{t=await l.invoke(d)}catch(e){if("Connection error."===(null==e?void 0:e.message))throw Error(`Network error: unreachable api "${n}"`);throw e}return{outputs:{result:t.content}}}checkInputs(e){let{modelName:t,temperature:r,apiKey:s,apiHost:o,prompt:a}=e,n=[];if(t||n.push("modelName"),(0,y.Z)(r)&&n.push("temperature"),s||n.push("apiKey"),o||n.push("apiHost"),a||n.push("prompt"),n.length>0)throw Error(`LLM node missing required inputs: "${n.join('", "')}"`);this.checkApiHost(o)}checkApiHost(e){if(!e||"string"!=typeof e)throw Error(`Invalid API host format - ${e}`);let t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)throw Error(`Invalid API host protocol - ${t.protocol}`)}constructor(){this.type=j.LLM}},eo=class{async execute(e){let t=this.parseInputs(e),r=await this.request(t),s={};r.headers.forEach((e,t)=>{s[t]=e});let o=await r.text();return{outputs:{headers:s,statusCode:r.status,body:o}}}async request(e){let{method:t,url:r,headers:s,params:o,bodyType:a,body:n,retryTimes:i,timeout:u}=e,l=this.buildUrlWithParams(r,o),d={method:t,headers:this.prepareHeaders(s,a),signal:AbortSignal.timeout(u)};"GET"!==t&&"HEAD"!==t&&n&&(d.body=this.prepareBody(n,a));let c=null;for(let e=0;e<=i;e++)try{return await fetch(l,d)}catch(t){c=t,e<i&&await new Promise(t=>setTimeout(t,1e3*Math.pow(2,e)))}throw c||Error("HTTP request failed after all retry attempts")}parseInputs(e){let t=e.node,r=t.data.api.method,s=e.runtime.state.parseTemplate(t.data.api.url);if(!s)throw Error("HTTP url is required");let o=s.value,a=e.runtime.state.parseInputs({values:t.data.headersValues,declare:t.data.headers}),n=e.runtime.state.parseInputs({values:t.data.paramsValues,declare:t.data.params}),i=this.parseBody(e),u=t.data.timeout.retryTimes,l=t.data.timeout.timeout,d={method:r,url:o,headers:a,params:n,bodyType:i.bodyType,body:i.body,retryTimes:u,timeout:l};return e.snapshot.update({inputs:JSON.parse(JSON.stringify(d))}),d}parseBody(e){let t=e.node,r=t.data.body.bodyType;if(r===M.None)return{bodyType:r,body:""};if(r===M.JSON){if(!t.data.body.json)throw Error("HTTP json body is required");let s=e.runtime.state.parseTemplate(t.data.body.json);if(!s)throw Error("HTTP json body is required");return{bodyType:r,body:s.value}}if(r===M.FormData){if(!t.data.body.formData||!t.data.body.formDataValues)throw Error("HTTP form-data body is required");return{bodyType:r,body:JSON.stringify(e.runtime.state.parseInputs({values:t.data.body.formDataValues,declare:t.data.body.formData}))}}if(r===M.RawText){if(!t.data.body.json)throw Error("HTTP json body is required");let s=e.runtime.state.parseTemplate(t.data.body.json);if(!s)throw Error("HTTP json body is required");return{bodyType:r,body:s.value}}if(r===M.Binary){if(!t.data.body.binary)throw Error("HTTP binary body is required");let s=e.runtime.state.parseTemplate(t.data.body.binary);if(!s)throw Error("HTTP binary body is required");return{bodyType:r,body:s.value}}if(r===M.XWwwFormUrlencoded){if(!t.data.body.xWwwFormUrlencoded||!t.data.body.xWwwFormUrlencodedValues)throw Error("HTTP x-www-form-urlencoded body is required");return{bodyType:r,body:JSON.stringify(e.runtime.state.parseInputs({values:t.data.body.xWwwFormUrlencodedValues,declare:t.data.body.xWwwFormUrlencoded}))}}throw Error(`HTTP invalid body type "${r}"`)}buildUrlWithParams(e,t){let r=new URL(e);return Object.entries(t).forEach(e=>{let[t,s]=e;null!=s&&""!==s&&r.searchParams.set(t,s)}),r.toString()}prepareHeaders(e,t){let r={...e};if(!r["Content-Type"]&&!r["content-type"])switch(t){case M.JSON:r["Content-Type"]="application/json";break;case M.FormData:break;case M.XWwwFormUrlencoded:r["Content-Type"]="application/x-www-form-urlencoded";break;case M.RawText:r["Content-Type"]="text/plain";break;case M.Binary:r["Content-Type"]="application/octet-stream"}return r}prepareBody(e,t){switch(t){case M.JSON:return e;case M.FormData:let r=new FormData;try{let t=JSON.parse(e);Object.entries(t).forEach(e=>{let[t,s]=e;r.append(t,String(s))})}catch(e){throw Error("Invalid FormData body format")}return r;case M.XWwwFormUrlencoded:try{let t=JSON.parse(e),r=new URLSearchParams;return Object.entries(t).forEach(e=>{let[t,s]=e;r.append(t,String(s))}),r.toString()}catch(e){throw Error("Invalid x-www-form-urlencoded body format")}case M.RawText:case M.Binary:default:return e}}constructor(){this.type=j.HTTP}},ea=class{async execute(e){return e.runtime.ioCenter.setOutputs(e.inputs),{outputs:e.inputs}}constructor(){this.type=j.End}},en=class{async execute(e){return{outputs:{}}}constructor(){this.type=j.BlockStart}},ei=class{async execute(e){return{outputs:{}}}constructor(){this.type=j.BlockEnd}},eu=class{async execute(e){return e.runtime.cache.set("loop-continue",!0),{outputs:{}}}constructor(){this.type=j.Continue}},el={[Z.String]:{[D.EQ]:Z.String,[D.NEQ]:Z.String,[D.CONTAINS]:Z.String,[D.NOT_CONTAINS]:Z.String,[D.IN]:Z.Array,[D.NIN]:Z.Array,[D.IS_EMPTY]:Z.String,[D.IS_NOT_EMPTY]:Z.String},[Z.Number]:{[D.EQ]:Z.Number,[D.NEQ]:Z.Number,[D.GT]:Z.Number,[D.GTE]:Z.Number,[D.LT]:Z.Number,[D.LTE]:Z.Number,[D.IN]:Z.Array,[D.NIN]:Z.Array,[D.IS_EMPTY]:Z.Null,[D.IS_NOT_EMPTY]:Z.Null},[Z.Integer]:{[D.EQ]:Z.Integer,[D.NEQ]:Z.Integer,[D.GT]:Z.Integer,[D.GTE]:Z.Integer,[D.LT]:Z.Integer,[D.LTE]:Z.Integer,[D.IN]:Z.Array,[D.NIN]:Z.Array,[D.IS_EMPTY]:Z.Null,[D.IS_NOT_EMPTY]:Z.Null},[Z.Boolean]:{[D.EQ]:Z.Boolean,[D.NEQ]:Z.Boolean,[D.IS_TRUE]:Z.Null,[D.IS_FALSE]:Z.Null,[D.IN]:Z.Array,[D.NIN]:Z.Array,[D.IS_EMPTY]:Z.Null,[D.IS_NOT_EMPTY]:Z.Null},[Z.Object]:{[D.IS_EMPTY]:Z.Null,[D.IS_NOT_EMPTY]:Z.Null},[Z.Array]:{[D.IS_EMPTY]:Z.Null,[D.IS_NOT_EMPTY]:Z.Null},[Z.Null]:{[D.EQ]:Z.Null,[D.IS_EMPTY]:Z.Null,[D.IS_NOT_EMPTY]:Z.Null}},ed=e=>{let{operator:t}=e,r=e.leftValue;return t===D.EQ?r===e.rightValue:t===D.NEQ?r!==e.rightValue:t===D.GT?r>e.rightValue:t===D.GTE?r>=e.rightValue:t===D.LT?r<e.rightValue:t===D.LTE?r<=e.rightValue:t===D.IN?e.rightValue.includes(r):t===D.NIN?!e.rightValue.includes(r):t===D.IS_EMPTY?(0,y.Z)(r):t===D.IS_NOT_EMPTY&&!(0,y.Z)(r)},ec={[Z.String]:e=>{let{operator:t}=e,r=e.leftValue;if(t===D.EQ)return r===e.rightValue;if(t===D.NEQ)return r!==e.rightValue;if(t===D.CONTAINS){let t=e.rightValue;return r.includes(t)}if(t===D.NOT_CONTAINS){let t=e.rightValue;return!r.includes(t)}return t===D.IN?e.rightValue.includes(r):t===D.NIN?!e.rightValue.includes(r):t===D.IS_EMPTY?(0,y.Z)(r):t===D.IS_NOT_EMPTY&&!(0,y.Z)(r)},[Z.Number]:ed,[Z.Integer]:ed,[Z.Boolean]:e=>{let{operator:t}=e,r=e.leftValue;return t===D.EQ?r===e.rightValue:t===D.NEQ?r!==e.rightValue:t===D.IS_TRUE?!0===r:t===D.IS_FALSE?!1===r:t===D.IN?e.rightValue.includes(r):t===D.NIN?!e.rightValue.includes(r):t===D.IS_EMPTY?(0,y.Z)(r):t===D.IS_NOT_EMPTY&&!(0,y.Z)(r)},[Z.Object]:e=>{let{operator:t}=e,r=e.leftValue;return t===D.IS_EMPTY?(0,y.Z)(r):t===D.IS_NOT_EMPTY&&!(0,y.Z)(r)},[Z.Array]:e=>{let{operator:t}=e,r=e.leftValue;return t===D.IS_EMPTY?(0,y.Z)(r):t===D.IS_NOT_EMPTY&&!(0,y.Z)(r)},[Z.Null]:e=>{let{operator:t}=e,r=e.leftValue;return t===D.EQ?(0,y.Z)(r)&&(0,y.Z)(e.rightValue):t===D.IS_EMPTY?(0,y.Z)(r):t===D.IS_NOT_EMPTY&&!(0,y.Z)(r)}},ep=[q,ea,es,class{async execute(e){var t;let r=null==(t=e.node.data)?void 0:t.conditions;if(!r)return{outputs:{}};let s=r.map(t=>this.parseCondition(t,e)).filter(e=>this.checkCondition(e)).find(e=>this.handleCondition(e));if(!s)throw Error("No condition is activated");return{outputs:{},branch:s.key}}parseCondition(e,t){let{key:r,value:s}=e,{left:o,operator:a,right:n}=s,i=t.runtime.state.parseRef(o),u=(null==i?void 0:i.value)??null,l=(null==i?void 0:i.type)??Z.Null,d=n?t.runtime.state.parseValue(n):null;return{key:r,leftValue:u,leftType:l,rightValue:(null==d?void 0:d.value)??null,rightType:(null==d?void 0:d.type)??Z.Null,operator:a}}checkCondition(e){let t=el[e.leftType];if((0,y.Z)(t))throw Error(`Condition left type "${e.leftType}" is not supported`);let r=t[e.operator];if((0,y.Z)(r))throw Error(`Condition left type "${e.leftType}" has no operator "${e.operator}"`);return!!p.isTypeEqual(r,e.rightType)}handleCondition(e){let t=ec[e.leftType];if(!t)throw Error(`Condition left type ${e.leftType} is not supported`);return t(e)}constructor(){this.type=j.Condition}},er,en,ei,eo,class{async execute(e){let t=this.parseInputs(e);if("javascript"===t.script.language)return this.javascript(t);throw Error(`Unsupported code language "${t.script.language}"`)}parseInputs(e){let t=e.node,r=e.inputs,{language:s,content:o}=t.data.script;if(!o)throw Error("Code content is required");return{params:r,script:{language:s,content:o}}}async javascript(e){let{params:t={},script:r}=e;try{let e=Function("params",`
        'use strict';

        ${r.content}

        // Ensure main function exists
        if (typeof main !== 'function') {
          throw new Error('main function is required in the script');
        }

        // Execute main function with params
        return main({ params });
        `),s=new Promise((e,t)=>{setTimeout(()=>{t(Error("Code execution timeout: exceeded 1 minute"))},6e4)}),o=await Promise.race([e(t),s]);return{outputs:o&&"object"==typeof o&&!Array.isArray(o)?o:{result:o}}}catch(e){throw Error(`Code execution failed: ${e.message}`)}}constructor(){this.type=j.Code}},class{async execute(e){return e.runtime.cache.set("loop-break",!0),{outputs:{}}}constructor(){this.type=j.Break}},eu],eh=e=>{var t;let r,{nodes:s,edges:o}=e,a=new Map,n=new Set(s.map(e=>e.id));n.forEach(e=>{a.set(e,[])}),o.forEach(e=>{let t=a.get(e.sourceNodeID);t&&t.push(e.targetNodeID)}),(t=r||(r={}))[t.Unvisited=0]="Unvisited",t[t.Visiting=1]="Visiting",t[t.Visited=2]="Visited";let i=new Map;n.forEach(e=>{i.set(e,0)});let u=e=>{for(let t of(i.set(e,1),a.get(e)||[])){let e=i.get(t);if(1===e||0===e&&u(t))return!0}return i.set(e,2),!1};for(let e of n)if(0===i.get(e)&&u(e))throw Error("Workflow schema contains a cycle, which is not allowed");s.forEach(e=>{e.blocks&&eh({nodes:e.blocks,edges:e.edges??[]})})},eg=e=>{let{blockStartNodes:t,blockEndNodes:r}=e.nodes.reduce((e,t)=>(t.type===j.BlockStart?e.blockStartNodes.push(t):t.type===j.BlockEnd&&e.blockEndNodes.push(t),e),{blockStartNodes:[],blockEndNodes:[]});if(!t.length&&!r.length)throw Error("Workflow block schema must have a block-start node and a block-end node");if(!t.length)throw Error("Workflow block schema must have a block-start node");if(!r.length)throw Error("Workflow block schema must have an block-end node");if(t.length>1)throw Error("Workflow block schema must have only one block-start node");if(r.length>1)throw Error("Workflow block schema must have only one block-end node");e.nodes.forEach(e=>{e.blocks&&eg({nodes:e.blocks,edges:e.edges??[]})})},ef=e=>{let{nodes:t,edges:r}=e,s=new Set(t.map(e=>e.id));r.forEach(e=>{if(!s.has(e.sourceNodeID))throw Error(`Workflow schema edge source node "${e.sourceNodeID}" not exist`);if(!s.has(e.targetNodeID))throw Error(`Workflow schema edge target node "${e.targetNodeID}" not exist`)}),t.forEach(e=>{e.blocks&&ef({nodes:e.blocks,edges:e.edges??[]})})},em=e=>{if(!e||"object"!=typeof e)throw Error("Workflow schema must be a valid object");if(!Array.isArray(e.nodes))throw Error("Workflow schema must have a valid nodes array");if(!Array.isArray(e.edges))throw Error("Workflow schema must have a valid edges array");e.nodes.forEach((e,t)=>{ey(e,`nodes[${t}]`)}),e.edges.forEach((e,t)=>{eb(e,`edges[${t}]`)}),e.nodes.forEach((e,t)=>{if(e.blocks){if(!Array.isArray(e.blocks))throw Error(`Node nodes[${t}].blocks must be an array`);em({nodes:e.blocks,edges:e.edges||[]})}})},ey=(e,t)=>{if(!e||"object"!=typeof e)throw Error(`${t} must be a valid object`);if("string"!=typeof e.id||!e.id.trim())throw Error(`${t}.id must be a non-empty string`);if("string"!=typeof e.type||!e.type.trim())throw Error(`${t}.type must be a non-empty string`);if(!e.meta||"object"!=typeof e.meta)throw Error(`${t}.meta must be a valid object`);if(!e.data||"object"!=typeof e.data)throw Error(`${t}.data must be a valid object`);if(void 0!==e.blocks&&!Array.isArray(e.blocks))throw Error(`${t}.blocks must be an array if present`);if(void 0!==e.edges&&!Array.isArray(e.edges))throw Error(`${t}.edges must be an array if present`);if(void 0!==e.data.inputs&&("object"!=typeof e.data.inputs||null===e.data.inputs))throw Error(`${t}.data.inputs must be a valid object if present`);if(void 0!==e.data.outputs&&("object"!=typeof e.data.outputs||null===e.data.outputs))throw Error(`${t}.data.outputs must be a valid object if present`);if(void 0!==e.data.inputsValues&&("object"!=typeof e.data.inputsValues||null===e.data.inputsValues))throw Error(`${t}.data.inputsValues must be a valid object if present`);if(void 0!==e.data.title&&"string"!=typeof e.data.title)throw Error(`${t}.data.title must be a string if present`)},eb=(e,t)=>{if(!e||"object"!=typeof e)throw Error(`${t} must be a valid object`);if("string"!=typeof e.sourceNodeID||!e.sourceNodeID.trim())throw Error(`${t}.sourceNodeID must be a non-empty string`);if("string"!=typeof e.targetNodeID||!e.targetNodeID.trim())throw Error(`${t}.targetNodeID must be a non-empty string`);if(void 0!==e.sourcePortID&&"string"!=typeof e.sourcePortID)throw Error(`${t}.sourcePortID must be a string if present`);if(void 0!==e.targetPortID&&"string"!=typeof e.targetPortID)throw Error(`${t}.targetPortID must be a string if present`)},ew=class{invoke(e){let{schema:t,inputs:r}=e,s=this.schema(t);if(!s.valid)return s;let o=this.inputs(this.getWorkflowInputsDeclare(t),r);return o.valid?{valid:!0}:o}schema(e){let t=[];return[()=>em(e),()=>eh(e),()=>ef(e),()=>(e=>{let{startNodes:t,endNodes:r}=e.nodes.reduce((e,t)=>(t.type===j.Start?e.startNodes.push(t):t.type===j.End&&e.endNodes.push(t),e),{startNodes:[],endNodes:[]});if(!t.length&&!r.length)throw Error("Workflow schema must have a start node and an end node");if(!t.length)throw Error("Workflow schema must have a start node");if(!r.length)throw Error("Workflow schema must have an end node");if(t.length>1)throw Error("Workflow schema must have only one start node");if(r.length>1)throw Error("Workflow schema must have only one end node");e.nodes.forEach(e=>{e.blocks&&eg({nodes:e.blocks,edges:e.edges??[]})})})(e)].forEach(e=>{try{e()}catch(e){t.push(e instanceof Error?e.message:String(e))}}),{valid:0===t.length,errors:t.length>0?t:void 0}}inputs(e,t){let{result:r,errorMessage:s}=(e=>{let{schema:t,value:r}=e;try{return J(r,t,U)}catch(e){return{result:!1,errorMessage:`Validation error: ${e instanceof Error?e.message:String(e)}`}}})({schema:e,value:t});return r?{valid:!0}:{valid:!1,errors:[`JSON Schema validation failed: ${s}`]}}getWorkflowInputsDeclare(e){let t=e.nodes.find(e=>e.type===j.Start);if(!t)throw Error("Workflow schema must have a start node");return t.data.outputs}},eE=class{register(e){this.nodeExecutors.set(e.type,e)}async execute(e){let t=e.node.type,r=this.nodeExecutors.get(t);if(!r)throw Error(`No executor found for node type ${t}`);return await r.execute(e)}constructor(e){this.nodeExecutors=new Map,e.forEach(e=>{this.register(new e)})}},eT=class e{cancel(){this.context.statusCenter.workflow.cancel(),this.context.statusCenter.getStatusNodeIDs(R.Processing).forEach(e=>{this.context.statusCenter.nodeStatus(e).cancel()})}static create(t){return new e(t)}constructor(e){this.id=Y(),this.context=e.context,this.processing=e.processing}};(h||(h={})).create=e=>{let t={id:Y(),...e};return e.timestamp||(t.timestamp=Date.now()),t};var ek=class{init(){this.messages={[B.Log]:[],[B.Info]:[],[B.Debug]:[],[B.Error]:[],[B.Warn]:[]}}dispose(){}log(e){let t=h.create({type:B.Log,...e});return this.messages[B.Log].push(t),t}info(e){let t=h.create({type:B.Info,...e});return this.messages[B.Info].push(t),t}debug(e){let t=h.create({type:B.Debug,...e});return this.messages[B.Debug].push(t),t}error(e){let t=h.create({type:B.Error,...e});return this.messages[B.Error].push(t),t}warn(e){let t=h.create({type:B.Warn,...e});return this.messages[B.Warn].push(t),t}export(){return{[B.Log]:this.messages[B.Log].slice(),[B.Info]:this.messages[B.Info].slice(),[B.Debug]:this.messages[B.Debug].slice(),[B.Error]:this.messages[B.Error].slice(),[B.Warn]:this.messages[B.Warn].slice()}}},eN=class{init(){this.map=new Map}dispose(){this.map.clear()}get(e){return this.map.get(e)}set(e,t){return this.map.set(e,t),this}delete(e){return this.map.delete(e)}has(e){return this.map.has(e)}};(g||(g={})).create=e=>({id:Y(),...e});var eI=class{init(){this.store=new Map}dispose(){this.store.clear()}setParent(e){this.parent=e}globalGet(e){let t=this.store.get(e);return!t&&this.parent?this.parent.globalGet(e):t}setVariable(e){let{nodeID:t,key:r,value:s,type:o,itemsType:a}=e;this.store.has(t)||this.store.set(t,new Map);let n=this.store.get(t),i=g.create({nodeID:t,key:r,value:s,type:o,itemsType:a});n.set(r,i)}setValue(e){let{nodeID:t,variableKey:r,variablePath:s,value:o}=e;this.store.has(t)||this.store.set(t,new Map);let a=this.store.get(t);if(!a.has(r)){let e=g.create({nodeID:t,key:r,value:{},type:Z.Object});a.set(r,e)}let n=a.get(r);if(!s){n.value=o;return}(0,T.Z)(n.value,s,o)}getValue(e){var t;let{nodeID:r,variableKey:s,variablePath:o}=e,a=null==(t=this.globalGet(r))?void 0:t.get(s);if(!a)return null;if(!o||0===o.length)return{value:a.value,type:a.type,itemsType:a.itemsType};let n=(0,k.Z)(a.value,o),i=p.getWorkflowType(n);if(!i)return null;if(i===Z.Array&&Array.isArray(n)){let e=p.getWorkflowType(n[0]);return e?{value:n,type:i,itemsType:e}:null}return{value:n,type:i}}constructor(){this.id=Y()}},ev=class e{get status(){return this._status}get terminated(){return[R.Succeeded,R.Failed,R.Canceled].includes(this.status)}get startTime(){return this._startTime}get endTime(){return this._endTime}get timeCost(){return this.startTime?this.endTime?this.endTime-this.startTime:Date.now()-this.startTime:0}process(){this._status=R.Processing,this._startTime=Date.now(),this._endTime=void 0}success(){this.terminated||(this._status=R.Succeeded,this._endTime=Date.now())}fail(){this.terminated||(this._status=R.Failed,this._endTime=Date.now())}cancel(){this.terminated||(this._status=R.Canceled,this._endTime=Date.now())}export(){return{status:this.status,terminated:this.terminated,startTime:this.startTime,endTime:this.endTime,timeCost:this.timeCost}}static create(){return new e}constructor(){this.id=Y(),this._status=R.Pending}},eS=class{init(){this._workflowStatus=ev.create(),this._nodeStatus=new Map}dispose(){}get workflow(){return this._workflowStatus}get workflowStatus(){return this._workflowStatus}nodeStatus(e){return this._nodeStatus.has(e)||this._nodeStatus.set(e,ev.create()),this._nodeStatus.get(e)}getStatusNodeIDs(e){return Array.from(this._nodeStatus.entries()).filter(t=>{let[,r]=t;return r.status===e}).map(e=>{let[t]=e;return t})}exportNodeStatus(){return Object.fromEntries(Array.from(this._nodeStatus.entries()).map(e=>{let[t,r]=e;return[t,r.export()]}))}},eP=class{init(){this.executedNodes=new Set}dispose(){this.executedNodes.clear()}getNodeInputs(e){let t=e.declare.inputs,r=e.declare.inputsValues;return this.parseInputs({values:r,declare:t})}setNodeOutputs(e){let{node:t,outputs:r}=e,s=t.declare.outputs;s&&Object.entries(r).forEach(e=>{var r,o;let[a,n]=e,i=null==(r=s.properties)?void 0:r[a];if(!i)return;let u=i.type,l=null==(o=i.items)?void 0:o.type;this.variableStore.setVariable({nodeID:t.id,key:a,value:n,type:u,itemsType:l})})}parseInputs(e){let{values:t,declare:r}=e;return r&&t?Object.entries(t).reduce((e,t)=>{var s;let[o,a]=t,n=null==(s=r.properties)?void 0:s[o];if(!n)return e;let i=n.type,u=this.parseValue(a);if(!u)return e;let{value:l,type:d}=u;return p.isTypeEqual(d,i)&&(e[o]=l),e},{}):{}}parseRef(e){if((null==e?void 0:e.type)!=="ref")throw Error(`Invalid ref value: ${e}`);if(!e.content||e.content.length<2)return null;let[t,r,...s]=e.content,o=this.variableStore.getValue({nodeID:t,variableKey:r,variablePath:s});return o||null}parseTemplate(e){if((null==e?void 0:e.type)!=="template")throw Error(`Invalid template value: ${e}`);if(!e.content)return null;let t=e.content.replace(/\{\{([^\}]+)\}\}/g,(e,t)=>{let r=t.trim().split("."),s=this.parseRef({type:"ref",content:r});return s?s.value:""});return{type:Z.String,value:t}}parseValue(e){if(!(null==e?void 0:e.type))throw Error(`Invalid flow value type: ${e.type}`);if("constant"===e.type){let t=e.content,r=p.getWorkflowType(t);return(0,y.Z)(t)||!r?null:{value:t,type:r}}if("ref"===e.type)return this.parseRef(e);if("template"===e.type)return this.parseTemplate(e);throw Error(`Unknown flow value type: ${e.type}`)}isExecutedNode(e){return this.executedNodes.has(e.id)}addExecutedNode(e){this.executedNodes.add(e.id)}constructor(e){this.variableStore=e,this.id=Y()}},e_=class e{update(e){Object.assign(this.data,e)}validate(){return["nodeID","inputs","outputs","data"].every(e=>void 0!==this.data[e])}export(){return{id:this.id,...this.data}}static create(t){return new e(t)}constructor(e){this.id=Y(),this.data=e}},ex=class{create(e){let t=e_.create(e);return this.snapshots.push(t),t}init(){this.snapshots=[]}dispose(){}exportAll(){return this.snapshots.slice().map(e=>e.export())}export(){let e={};return this.exportAll().forEach(t=>{e[t.nodeID]?e[t.nodeID].push(t):e[t.nodeID]=[t]}),e}constructor(){this.id=Y()}};(f||(f={})).create=e=>({id:Y(),...e});var eC=class{init(){}dispose(){}export(){return f.create({inputs:this.ioCenter.inputs,outputs:this.ioCenter.outputs,workflowStatus:this.statusCenter.workflow.export(),reports:this.nodeReports(),messages:this.messageCenter.export()})}nodeReports(){let e={},t=this.statusCenter.exportNodeStatus(),r=this.snapshotCenter.export();return Object.keys(t).forEach(s=>{let o=t[s],a=r[s]||[],n={id:s,...o,snapshots:a};e[s]=n}),e}constructor(e,t,r,s){this.ioCenter=e,this.snapshotCenter=t,this.statusCenter=r,this.messageCenter=s}},e$=class{init(e){this.setInputs(e)}dispose(){}get inputs(){return this._inputs??{}}get outputs(){return this._outputs??{}}setInputs(e){this._inputs=e}setOutputs(e){this._outputs=e}export(){return{inputs:this._inputs,outputs:this._outputs}}},eO=class{get fromPort(){return this._fromPort}set fromPort(e){this._fromPort=e}get toPort(){return this._toPort}set toPort(e){this._toPort=e}static createID(e){let{sourceNodeID:t,sourcePortID:r,targetNodeID:s,targetPortID:o}=e,a=r?`${t}:${r}`:t,n=o?`${s}:${o}`:s;return`${a}-${n}`}constructor(e){let{id:t,from:r,to:s}=e;this.id=t,this.from=r,this.to=s}},eA=class{get ports(){return{inputs:this._ports.filter(e=>e.type===A.Input),outputs:this._ports.filter(e=>e.type===A.Output)}}get edges(){return{inputs:this._inputEdges,outputs:this._outputEdges}}get parent(){return this._parent}set parent(e){this._parent=e}get children(){return this._children}addChild(e){this._children.push(e)}addPort(e){this._ports.push(e)}addInputEdge(e){this._inputEdges.push(e),this._prev.push(e.from)}addOutputEdge(e){this._outputEdges.push(e),this._next.push(e.to)}get prev(){return this._prev}get next(){return this._next}get successors(){return F(this,e=>e.next)}get predecessors(){return F(this,e=>e.prev)}get isBranch(){return this.ports.outputs.length>1}constructor(e){let{id:t,type:r,name:s,position:o,variable:a,data:n}=e;this.id=t,this.type=r,this.name=s,this.position=o,this.declare=a??{},this.data=n??{},this._parent=null,this._children=[],this._ports=[],this._inputEdges=[],this._outputEdges=[],this._prev=[],this._next=[]}},eZ=class{get edges(){return this._edges}addEdge(e){this._edges.push(e)}constructor(e){let{id:t,node:r}=e;this.id=t,this.node=r,this.type=e.type,this._edges=[]}},ej=(e,t)=>{let{blocks:r,edges:s}=t;if(r){e.flattenSchema.nodes.push(...r);let s=[];r.forEach(t=>{s.push(t.id),t.blocks&&ej(e,t)}),e.nodeBlocks.set(t.id,s),delete t.blocks}if(s){e.flattenSchema.edges.push(...s);let r=[];s.forEach(e=>{let t=eO.createID(e);r.push(t)}),e.nodeEdges.set(t.id,r),delete t.edges}},eD=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{nodes:[],edges:[]},t=e.nodes??[],r=e.edges??[],s={flattenSchema:{nodes:[],edges:[]},nodeBlocks:new Map,nodeEdges:new Map};return ej(s,{id:j.Root,type:j.Root,blocks:t,edges:r,meta:{position:{x:0,y:0}},data:{}}),s},eM=(e,t)=>{let r=new eA(t);return e.nodes.set(r.id,r),r},eV=(e,t)=>{let r=e.ports.get(t.id);if(r)return r;let s=new eZ(t);return e.ports.set(s.id,s),s},eL=class{get root(){let e=this.getNode(j.Root);if(!e)throw Error("Root node not found");return e}get start(){let e=this.nodes.find(e=>e.type===j.Start);if(!e)throw Error("Start node not found");return e}get end(){let e=this.nodes.find(e=>e.type===j.End);if(!e)throw Error("End node not found");return e}getNode(e){return this.store.nodes.get(e)??null}getEdge(e){return this.store.edges.get(e)??null}get nodes(){return Array.from(this.store.nodes.values())}get edges(){return Array.from(this.store.edges.values())}init(e){let t=eD(e);this.store=(e=>{let{flattenSchema:t,nodeBlocks:r}=e,{nodes:s,edges:o}=t,a={nodes:new Map,edges:new Map,ports:new Map};return eM(a,{id:j.Root,type:j.Root,name:j.Root,position:{x:0,y:0}}),s.forEach(e=>{let t=e.id,r=e.type,{title:s=`${r}-${t}-untitled`,inputsValues:o,inputs:n,outputs:i,...u}=e.data??{};eM(a,{id:t,type:r,name:s,position:e.meta.position,variable:{inputsValues:o,inputs:n,outputs:i},data:u})}),r.forEach((e,t)=>{let r=a.nodes.get(t);e.map(e=>a.nodes.get(e)).filter(Boolean).forEach(e=>{e.parent=r,r.addChild(e)})}),o.forEach(e=>{let t=eO.createID(e),{sourceNodeID:r,targetNodeID:s,sourcePortID:o="defaultOutput",targetPortID:n="defaultInput"}=e,i=a.nodes.get(r),u=a.nodes.get(s);if(!i||!u)throw Error(`Invalid edge schema ID: ${t}, from: ${r}, to: ${s}`);let l=((e,t)=>{let r=new eO(t);return e.edges.set(r.id,r),r})(a,{id:t,from:i,to:u}),d=eV(a,{node:i,id:o,type:A.Output});d.addEdge(l),l.fromPort=d,i.addPort(d),i.addOutputEdge(l);let c=eV(a,{node:u,id:n,type:A.Input});c.addEdge(l),l.toPort=c,u.addPort(c),u.addInputEdge(l)}),a})(t)}dispose(){this.store.edges.clear(),this.store.nodes.clear(),this.store.ports.clear()}constructor(){this.id=Y()}},eR=class e{init(e){let{schema:t,inputs:r}=e;this.cache.init(),this.document.init(t),this.variableStore.init(),this.state.init(),this.ioCenter.init(r),this.snapshotCenter.init(),this.statusCenter.init(),this.messageCenter.init(),this.reporter.init()}dispose(){this.subContexts.forEach(e=>{e.dispose()}),this.subContexts=[],this.cache.dispose(),this.document.dispose(),this.variableStore.dispose(),this.state.dispose(),this.ioCenter.dispose(),this.snapshotCenter.dispose(),this.statusCenter.dispose(),this.messageCenter.dispose(),this.reporter.dispose()}sub(){let t=new eN,r=new eI;r.setParent(this.variableStore);let s=new eP(r),o=new e({cache:t,document:this.document,ioCenter:this.ioCenter,snapshotCenter:this.snapshotCenter,statusCenter:this.statusCenter,messageCenter:this.messageCenter,reporter:this.reporter,variableStore:r,state:s});return this.subContexts.push(o),o.cache.init(),o.variableStore.init(),o.state.init(),o}static create(){let t=new eN,r=new eL,s=new eI,o=new eP(s),a=new e$,n=new ex,i=new eS,u=new ek,l=new eC(a,n,i,u);return new e({cache:t,document:r,variableStore:s,state:o,ioCenter:a,snapshotCenter:n,statusCenter:i,messageCenter:u,reporter:l})}constructor(e){this.subContexts=[],this.id=Y(),this.cache=e.cache,this.document=e.document,this.variableStore=e.variableStore,this.state=e.state,this.ioCenter=e.ioCenter,this.snapshotCenter=e.snapshotCenter,this.statusCenter=e.statusCenter,this.messageCenter=e.messageCenter,this.reporter=e.reporter}},eW=class{invoke(e){let t=eR.create();if(t.init(e),!this.validate(e,t))return eT.create({processing:Promise.resolve({}),context:t});let r=this.process(t);return r.then(()=>{t.dispose()}),eT.create({processing:r,context:t})}async executeNode(e){let{node:t,context:r}=e;if(!this.canExecuteNode({node:t,context:r}))return;r.statusCenter.nodeStatus(t.id).process();let s=r.snapshotCenter.create({nodeID:t.id,data:t.data}),o=[];try{let e=r.state.getNodeInputs(t);s.update({inputs:e});let a=await this.executor.execute({node:t,inputs:e,runtime:r,container:eB.instance,snapshot:s});if(r.statusCenter.workflow.terminated)return;let{outputs:n,branch:i}=a;s.update({outputs:n,branch:i}),r.state.setNodeOutputs({node:t,outputs:n}),r.state.addExecutedNode(t),r.statusCenter.nodeStatus(t.id).success(),o=this.getNextNodes({node:t,branch:i,context:r})}catch(o){let e=o instanceof Error?o.message:"An unknown error occurred";throw s.update({error:e}),r.messageCenter.error({nodeID:t.id,message:e}),r.statusCenter.nodeStatus(t.id).fail(),console.error(o),o}await this.executeNext({node:t,nextNodes:o,context:r})}async process(e){let t=e.document.start;e.statusCenter.workflow.process();try{await this.executeNode({node:t,context:e});let r=e.ioCenter.outputs;return e.statusCenter.workflow.success(),r}catch(t){return e.statusCenter.workflow.fail(),{}}}validate(e,t){let{valid:r,errors:s}=this.validation.invoke(e);return!!r||(null==s||s.forEach(e=>{t.messageCenter.error({message:e})}),t.statusCenter.workflow.fail(),!1)}canExecuteNode(e){let{node:t,context:r}=e,s=t.prev;return 0===s.length||s.every(e=>r.state.isExecutedNode(e))}getNextNodes(e){let{node:t,branch:r,context:s}=e,o=t.next;if(!r)return o;let a=t.ports.outputs.find(e=>e.id===r);if(!a)throw Error(`Engine branch ${r} not found`);let n=new Set(a.edges.map(e=>e.to.id)),i=o.filter(e=>n.has(e.id)),u=o.filter(e=>!n.has(e.id)),{uniqueToB:l}=function(e,t){let r=e.flat(),s=new Map;r.forEach(e=>{s.set(e.id,e)});let o=t.flat(),a=new Map;o.forEach(e=>{a.set(e.id,e)});let n=[],i=[],u=[];return s.forEach((e,t)=>{a.has(t)?n.push(e):i.push(e)}),a.forEach((e,t)=>{s.has(t)||u.push(e)}),{common:n,uniqueToA:i,uniqueToB:u}}(i.map(e=>[e,...e.successors]),u.map(e=>[e,...e.successors]));return l.forEach(e=>{s.state.addExecutedNode(e)}),i}async executeNext(e){let{context:t,node:r,nextNodes:s}=e;if(![j.End,j.BlockEnd,j.Break,j.Continue].includes(r.type)){if(0===s.length)throw Error(`Node ${r.id} has no next nodes`);await Promise.all(s.map(e=>this.executeNode({node:e,context:t})))}}constructor(e){this.validation=e.Validation,this.executor=e.Executor}},eB=class e{get(e){return this.services[e]}static get instance(){if(this._instance)return this._instance;let t=this.create();return this._instance=new e(t),this._instance}static create(){let e=new ew,t=new eE(ep),r=new eW({Validation:e,Executor:t});return{[W]:e,[L]:t,[V]:r}}constructor(e){this.services=e}},eq=class e{run(e){let t=this.container.get(V).invoke(e);return this.tasks.set(t.id,t),console.log("> POST TaskRun - taskID: ",t.id),console.log(e.inputs),t.processing.then(e=>{console.log("> LOG Task finished: ",t.id),console.log(e)}),t.id}cancel(e){console.log("> PUT TaskCancel - taskID: ",e);let t=this.tasks.get(e);return!!t&&(t.cancel(),!0)}report(e){let t=this.tasks.get(e);if(console.log("> GET TaskReport - taskID: ",e),t)return t.context.reporter.export()}result(e){console.log("> GET TaskResult - taskID: ",e);let t=this.tasks.get(e);if(t&&t.context.statusCenter.workflow.terminated)return t.context.ioCenter.outputs}validate(e){let t=this.container.get(W).invoke(e);return console.log("> POST TaskValidate - valid: ",t.valid),t}static get instance(){return this._instance||(this._instance=new e),this._instance}constructor(){this.container=eB.instance,this.tasks=new Map}},eY=async e=>{let t=eq.instance,{schema:r,inputs:s}=e,o=JSON.parse(r);return t.validate({schema:o,inputs:s})},eF=async e=>{let t=eq.instance,{schema:r,inputs:s}=e,o=JSON.parse(r);return{taskID:t.run({schema:o,inputs:s})}},eU=async e=>{let t=eq.instance,{taskID:r}=e;return t.result(r)},eH=async e=>{let t=eq.instance,{taskID:r}=e,s=t.report(r);try{O.schema.output.parse(s)}catch(e){console.log("> TaskReportAPI - output: ",JSON.stringify(s)),console.error(e)}return s},eJ=async e=>{let t=eq.instance,{taskID:r}=e;return{success:t.cancel(r)}};$.ServerInfo,$.TaskRun,$.TaskReport,$.TaskResult,$.TaskCancel,$.TaskValidate}}]);