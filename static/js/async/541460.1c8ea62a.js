"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["541460"],{640898:function(e,t,o){o.d(t,{f3M:()=>i.f3M,b2C:()=>i.b2C,qRT:()=>i.qRT,fin:()=>i.fin,iwM:()=>a.iw,bQo:()=>tu,dmf:()=>a.dm,Jbc:()=>eK.Jb,R6T:()=>i.R6T,xFV:()=>i.xFV,kmj:()=>i.kmj,Dcz:()=>i.Dcz,erw:()=>tm,sXE:()=>ts,JAk:()=>i.JAk,VDr:()=>i.VDr,PFB:()=>a.PF,eGM:()=>i.eGM,L4w:()=>a.L4,qoQ:()=>i.qoQ,gNt:()=>i.gNt,zEJ:()=>i.zEJ,C$T:()=>i.C$T,rQR:()=>i.rQR,e2M:()=>a.e2,VOn:()=>i.VOn,Psq:()=>i.Psq,oci:()=>i.oci,G2Z:()=>i.G2Z,IxS:()=>tp,Q5$:()=>i.Q5$,M1y:()=>i.M1y,EhS:()=>tg,qpv:()=>l.qp,SyX:()=>i.SyX,HoL:()=>i.HoL,Nj8:()=>l.Nj,SPu:()=>a.SP,UJL:()=>i.UJL,ERL:()=>i.ERL,z2R:()=>i.z2R,l09:()=>i.l09,CTO:()=>a.CT,oJU:()=>a.oJ,n2P:()=>a.n2,x0q:()=>a.x0,sX$:()=>tv,PVB:()=>a.PV,XQj:()=>i.XQj,AeJ:()=>i.AeJ,F26:()=>i.F26,v2K:()=>i.v2K,mh4:()=>i.mh4,XHk:()=>a.XH,gw0:()=>i.gw0}),o(543789);var n,r,i=o(950454),a=o(336330),s=o(908600),l=o(201063),d=o(9163),h=o(66298),u=o(308387),c=o(893740),g=o(832176),p=o(579962),f=Object.defineProperty,y=Object.getOwnPropertyDescriptor,v=(e,t,o,n)=>{for(var r,i=n>1?void 0:n?y(t,o):t,a=e.length-1;a>=0;a--)(r=e[a])&&(i=(n?r(t,o,i):r(i))||i);return n&&i&&f(t,o,i),i},m=class{dequeue(){let e=this._sentinel,t=e._prev;if(t!==e)return b(t),t}enqueue(e){let t=this._sentinel;e._prev&&e._next&&b(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t}toString(){let e=[],t=this._sentinel,o=t._prev;for(;o!==t;)e.push(JSON.stringify(o,E)),o=o._prev;return"["+e.join(", ")+"]"}constructor(){let e={};e._next=e._prev=e,this._sentinel=e}};function b(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function E(e,t){if("_next"!==e&&"_prev"!==e)return t}var w=()=>1;function x(e,t,o,n,r){let i=r?[]:void 0;return e.inEdges(n.v).forEach(n=>{let a=e.edge(n),s=e.node(n.v);r&&i.push({v:n.v,w:n.w}),s.out-=a,L(t,o,s)}),e.outEdges(n.v).forEach(n=>{let r=e.edge(n),i=n.w,a=e.node(i);a.in-=r,L(t,o,a)}),e.removeNode(n.v),i}function L(e,t,o){o.out?o.in?e[o.out-o.in+t].enqueue(o):e[e.length-1].enqueue(o):e[0].enqueue(o)}var N={addBorderNode:function(e,t,o,n){let r={width:0,height:0};return arguments.length>=4&&(r.rank=o,r.order=n),S(e,"border",r,t)},addDummyNode:S,applyWithChunking:O,asNonCompoundGraph:function(e){let t=new u.Graph({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(o=>{e.children(o).length||t.setNode(o,e.node(o))}),e.edges().forEach(o=>{t.setEdge(o,e.edge(o))}),t},buildLayerMatrix:function(e){let t=_(M(e)+1).map(()=>[]);return e.nodes().forEach(o=>{let n=e.node(o),r=n.rank;void 0!==r&&(t[r][n.order]=o)}),t},intersectRect:function(e,t){let o,n,r=e.x,i=e.y,a=t.x-r,s=t.y-i,l=e.width/2,d=e.height/2;if(!a&&!s)throw Error("Not possible to find intersection inside of the rectangle");return Math.abs(s)*l>Math.abs(a)*d?(s<0&&(d=-d),o=d*a/s,n=d):(a<0&&(l=-l),o=l,n=l*s/a),{x:r+o,y:i+n}},mapValues:function(e,t){let o=t;return"string"==typeof t&&(o=e=>e[t]),Object.entries(e).reduce((e,t)=>{let[n,r]=t;return e[n]=o(r,n),e},{})},maxRank:M,normalizeRanks:C,notime:function(e,t){return t()},partition:function(e,t){let o={lhs:[],rhs:[]};return e.forEach(e=>{t(e)?o.lhs.push(e):o.rhs.push(e)}),o},pick:function(e,t){let o={};for(let n of t)void 0!==e[n]&&(o[n]=e[n]);return o},predecessorWeights:function(e){let t=e.nodes().map(t=>{let o={};return e.inEdges(t).forEach(t=>{o[t.v]=(o[t.v]||0)+e.edge(t).weight}),o});return R(e.nodes(),t)},range:_,removeEmptyRanks:D,simplify:k,successorWeights:function(e){let t=e.nodes().map(t=>{let o={};return e.outEdges(t).forEach(t=>{o[t.w]=(o[t.w]||0)+e.edge(t).weight}),o});return R(e.nodes(),t)},time:function(e,t){let o=Date.now();try{return t()}finally{console.log(e+" time: "+(Date.now()-o)+"ms")}},uniqueId:T,zipObject:R};function S(e,t,o,n){let r;do r=T(n);while(e.hasNode(r));return o.dummy=t,e.setNode(r,o),r}function k(e){let t=new u.Graph().setGraph(e.graph());return e.nodes().forEach(o=>t.setNode(o,e.node(o))),e.edges().forEach(o=>{let n=t.edge(o.v,o.w)||{weight:0,minlen:1},r=e.edge(o);t.setEdge(o.v,o.w,{weight:n.weight+r.weight,minlen:Math.max(n.minlen,r.minlen)})}),t}function C(e){let t=O(Math.min,e.nodes().map(t=>{let o=e.node(t).rank;return void 0===o?Number.MAX_VALUE:o}));e.nodes().forEach(o=>{let n=e.node(o);Object.hasOwn(n,"rank")&&(n.rank-=t)})}function D(e){let t=O(Math.min,e.nodes().map(t=>e.node(t).rank)),o=[];e.nodes().forEach(n=>{let r=e.node(n).rank-t;o[r]||(o[r]=[]),o[r].push(n)});let n=0,r=e.graph().nodeRankFactor;Array.from(o).forEach((t,o)=>{void 0===t&&o%r!=0?--n:void 0!==t&&n&&t.forEach(t=>e.node(t).rank+=n)})}function O(e,t){if(!(t.length>65535))return e.apply(null,t);{let o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:65535,o=[];for(let n=0;n<e.length;n+=t){let r=e.slice(n,n+t);o.push(r)}return o}(t);return e.apply(null,o.map(t=>e.apply(null,t)))}}function M(e){return O(Math.max,e.nodes().map(t=>{let o=e.node(t).rank;return void 0===o?5e-324:o}))}var P=0;function T(e){var t=++P;return toString(e)+t}function _(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;null==t&&(t=e,e=0);let n=e=>e<t;o<0&&(n=e=>t<e);let r=[];for(let t=e;n(t);t+=o)r.push(t);return r}function R(e,t){return e.reduce((e,o,n)=>(e[o]=t[n],e),{})}function I(e){var t={};e.sources().forEach(function o(n){var r=e.node(n);if(Object.hasOwn(t,n))return r.rank;t[n]=!0;var i=O(Math.min,e.outEdges(n).map(t=>null==t?1/0:o(t.w)-e.edge(t).minlen));return i===1/0&&(i=0),r.rank=i})}function A(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}function $(e){var t,o,n,r,i=new u.Graph({directed:!1}),a=e.nodes()[0],s=e.nodeCount();for(i.setNode(a,{});t=i,o=e,t.nodes().forEach(function e(n){o.nodeEdges(n).forEach(r=>{var i=r.v,a=n===i?r.w:i;t.hasNode(a)||A(o,r)||(t.setNode(a,{}),t.setEdge(n,a,{}),e(a))})}),t.nodeCount()<s;)n=function(e,t){return t.edges().reduce((o,n)=>{let r=1/0;return(e.hasNode(n.v)!==e.hasNode(n.w)&&(r=A(t,n)),r<o[0])?[r,n]:o},[1/0,null])[1]}(i,e),r=i.hasNode(n.v)?A(e,n):-A(e,n),function(e,t,o){e.nodes().forEach(e=>t.node(e).rank+=o)}(i,e,r);return i}var{preorder:j,postorder:V}=u.alg;function F(e){I(e=k(e));var t,o,n=$(e);for(G(n),B(n,e);t=J(n);)o=U(n,e,t),z(n,e,t,o)}function B(e,t){var o=V(e,e.nodes());(o=o.slice(0,o.length-1)).forEach(o=>{var n,r,i,a;return n=e,r=t,i=o,a=n.node(i).parent,void(n.edge(i,a).cutvalue=H(n,r,i))})}function H(e,t,o){var n=e.node(o).parent,r=!0,i=t.edge(o,n),a=0;return i||(r=!1,i=t.edge(n,o)),a=i.weight,t.nodeEdges(o).forEach(i=>{var s=i.v===o,l=s?i.w:i.v;if(l!==n){var d,h,u,c=s===r,g=t.edge(i).weight;if(a+=c?g:-g,d=e,h=o,u=l,d.hasEdge(h,u)){var p=e.edge(o,l).cutvalue;a+=c?-p:p}}}),a}function G(e,t){arguments.length<2&&(t=e.nodes()[0]),function e(t,o,n,r,i){var a=n,s=t.node(r);return o[r]=!0,t.neighbors(r).forEach(i=>{Object.hasOwn(o,i)||(n=e(t,o,n,i,r))}),s.low=a,s.lim=n++,i?s.parent=i:delete s.parent,n}(e,{},1,t)}function J(e){return e.edges().find(t=>e.edge(t).cutvalue<0)}function U(e,t,o){var n=o.v,r=o.w;t.hasEdge(n,r)||(n=o.w,r=o.v);var i=e.node(n),a=e.node(r),s=i,l=!1;return i.lim>a.lim&&(s=a,l=!0),t.edges().filter(t=>l===W(e,e.node(t.v),s)&&l!==W(e,e.node(t.w),s)).reduce((e,o)=>A(t,o)<A(t,e)?o:e)}function z(e,t,o,n){var r,i,a,s,l=o.v,d=o.w;e.removeEdge(l,d),e.setEdge(n.v,n.w,{}),G(e),B(e,t),r=e,i=t,a=r.nodes().find(e=>!i.node(e).parent),(s=(s=j(r,a)).slice(1)).forEach(e=>{var t=r.node(e).parent,o=i.edge(e,t),n=!1;o||(o=i.edge(t,e),n=!0),i.node(e).rank=i.node(t).rank+(n?o.minlen:-o.minlen)})}function W(e,t,o){return o.low<=t.lim&&t.lim<=o.lim}F.initLowLimValues=G,F.initCutValues=B,F.calcCutValue=H,F.leaveEdge=J,F.enterEdge=U,F.exchangeEdges=z;var q=I;function X(e,t,o,n,r,i){let a=r[t][i-1],s=N.addDummyNode(e,"border",{width:0,height:0,rank:i,borderType:t},o);r[t][i]=s,e.setParent(s,n),a&&e.setEdge(a,s,{weight:1})}function Z(e){e.nodes().forEach(t=>Y(e.node(t))),e.edges().forEach(t=>Y(e.edge(t)))}function Y(e){let t=e.width;e.width=e.height,e.height=t}function K(e){e.y=-e.y}function Q(e){let t=e.x;e.x=e.y,e.y=t}var ee=function(e,t){let o=0;for(let n=1;n<t.length;++n)o+=function(e,t,o){let n=R(o,o.map((e,t)=>t)),r=t.flatMap(t=>e.outEdges(t).map(t=>({pos:n[t.w],weight:e.edge(t).weight})).sort((e,t)=>e.pos-t.pos)),i=1;for(;i<o.length;)i<<=1;let a=2*i-1;i-=1;let s=Array(a).fill(0),l=0;return r.forEach(e=>{let t=e.pos+i;s[t]+=e.weight;let o=0;for(;t>0;)t%2&&(o+=s[t+1]),t=t-1>>1,s[t]+=e.weight;l+=e.weight*o}),l}(e,t[n-1],t[n]);return o};function et(e,t,o){let n;for(;t.length&&(n=t[t.length-1]).i<=o;)t.pop(),e.push(n.vs),o++;return o}function eo(e,t,o){return t.map(function(t){var n,r,i;let a,s;return n=e,r=t,i=o,a=function(e){for(var t;e.hasNode(t=N.uniqueId("_root")););return t}(n),s=new u.Graph({compound:!0}).setGraph({root:a}).setDefaultNodeLabel(e=>n.node(e)),n.nodes().forEach(e=>{let t=n.node(e),o=n.parent(e);(t.rank===r||t.minRank<=r&&r<=t.maxRank)&&(s.setNode(e),s.setParent(e,o||a),n[i](e).forEach(t=>{let o=t.v===e?t.w:t.v,r=s.edge(o,e),i=void 0!==r?r.weight:0;s.setEdge(o,e,{weight:n.edge(t).weight+i})}),Object.hasOwn(t,"minRank")&&s.setNode(e,{borderLeft:t.borderLeft[r],borderRight:t.borderRight[r]}))}),s})}function en(e,t){Object.values(t).forEach(t=>t.forEach((t,o)=>e.node(t).order=o))}function er(e,t,o){if(t>o){let e=t;t=o,o=e}let n=e[t];n||(e[t]=n={}),n[o]=!0}var ei=["nodesep","edgesep","ranksep","marginx","marginy"],ea={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},es=["acyclicer","ranker","rankdir","align"],el=["width","height"],ed={width:0,height:0},eh=["minlen","weight","width","height","labeloffset"],eu={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},ec=["labelpos"];function eg(e,t){return N.mapValues(N.pick(e,t),Number)}function ep(e){var t={};return e&&Object.entries(e).forEach(e=>{let[o,n]=e;"string"==typeof o&&(o=o.toLowerCase()),t[o]=n}),t}var ef=function(e){let t=new u.Graph({multigraph:!0,compound:!0}),o=ep(e.graph());return t.setGraph(Object.assign({},ea,eg(o,ei),N.pick(o,es))),e.nodes().forEach(o=>{let n=eg(ep(e.node(o)),el);Object.keys(ed).forEach(e=>{void 0===n[e]&&(n[e]=ed[e])}),t.setNode(o,n),t.setParent(o,e.parent(o))}),e.edges().forEach(o=>{let n=ep(e.edge(o));t.setEdge(o,Object.assign({},eu,eg(n,eh),N.pick(n,ec)))}),t},ey=function(e,t){e.nodes().forEach(o=>{let n=e.node(o),r=t.node(o);n&&(n.x=r.x,n.y=r.y,n.rank=r.rank,t.children(o).length&&(n.width=r.width,n.height=r.height))}),e.edges().forEach(o=>{let n=e.edge(o),r=t.edge(o);n.points=r.points,Object.hasOwn(r,"x")&&(n.x=r.x,n.y=r.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},ev=function(e){let t=e.graph();t.ranksep/=2,e.edges().forEach(o=>{let n=e.edge(o);n.minlen*=2,"c"!==n.labelpos.toLowerCase()&&("TB"===t.rankdir||"BT"===t.rankdir?n.width+=n.labeloffset:n.height+=n.labeloffset)})},em=function(e){e.edges().forEach(t=>{if(t.v===t.w){var o=e.node(t.v);o.selfEdges||(o.selfEdges=[]),o.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})},eb=function(e){var t,o;let n,r,i;("greedy"===e.graph().acyclicer?function(e,t){var o,n;let r,i,a,s,l;if(1>=e.nodeCount())return[];let d=(o=e,n=t||w,r=new u.Graph,i=0,a=0,o.nodes().forEach(e=>{r.setNode(e,{v:e,in:0,out:0})}),o.edges().forEach(e=>{let t=r.edge(e.v,e.w)||0,o=n(e);r.setEdge(e.v,e.w,t+o),a=Math.max(a,r.node(e.v).out+=o),i=Math.max(i,r.node(e.w).in+=o)}),s=(function(e){let t=[];for(let o=0;o<e;o++)t.push(o);return t})(a+i+3).map(()=>new m),l=i+1,r.nodes().forEach(e=>{L(s,l,r.node(e))}),{graph:r,buckets:s,zeroIdx:l});return(function(e,t,o){let n,r=[],i=t[t.length-1],a=t[0];for(;e.nodeCount();){for(;n=a.dequeue();)x(e,t,o,n);for(;n=i.dequeue();)x(e,t,o,n);if(e.nodeCount()){for(let i=t.length-2;i>0;--i)if(n=t[i].dequeue()){r=r.concat(x(e,t,o,n,!0));break}}}return r})(d.graph,d.buckets,d.zeroIdx).flatMap(t=>e.outEdges(t.v,t.w))}(e,(t=e,e=>t.edge(e).weight)):(n=[],r={},i={},(o=e).nodes().forEach(function e(t){Object.hasOwn(i,t)||(i[t]=!0,r[t]=!0,o.outEdges(t).forEach(t=>{Object.hasOwn(r,t.w)?n.push(t):e(t.w)}),delete r[t])}),n)).forEach(t=>{let o=e.edge(t);e.removeEdge(t),o.forwardName=t.name,o.reversed=!0,e.setEdge(t.w,t.v,o,T("rev"))})},eE=function(e){e.edges().forEach(t=>{let o=e.edge(t);if(o.reversed){e.removeEdge(t);let n=o.forwardName;delete o.reversed,delete o.forwardName,e.setEdge(t.w,t.v,o,n)}})},ew=function(e){var t,o,n;let r=N.addDummyNode(e,"root",{},"_root"),i=(o={},(t=e).children().forEach(e=>(function e(n,r){var i=t.children(n);i&&i.length&&i.forEach(t=>e(t,r+1)),o[n]=r})(e,1)),o),a=Object.values(i),s=N.applyWithChunking(Math.max,a)-1,l=2*s+1;e.graph().nestingRoot=r,e.edges().forEach(t=>e.edge(t).minlen*=l);let d=(n=e).edges().reduce((e,t)=>e+n.edge(t).weight,0)+1;e.children().forEach(t=>(function e(t,o,n,r,i,a,s){let l=t.children(s);if(!l.length){s!==o&&t.setEdge(o,s,{weight:0,minlen:n});return}let d=N.addBorderNode(t,"_bt"),h=N.addBorderNode(t,"_bb"),u=t.node(s);t.setParent(d,s),u.borderTop=d,t.setParent(h,s),u.borderBottom=h,l.forEach(l=>{e(t,o,n,r,i,a,l);let u=t.node(l),c=u.borderTop?u.borderTop:l,g=u.borderBottom?u.borderBottom:l,p=u.borderTop?r:2*r,f=c!==g?1:i-a[s]+1;t.setEdge(d,c,{weight:p,minlen:f,nestingEdge:!0}),t.setEdge(g,h,{weight:p,minlen:f,nestingEdge:!0})}),t.parent(s)||t.setEdge(o,d,{weight:0,minlen:i+a[s]})})(e,r,l,d,s,i,t)),e.graph().nodeRankFactor=l},ex=function(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(t=>{e.edge(t).nestingEdge&&e.removeEdge(t)})},eL=function(e){switch(e.graph().ranker){case"network-simplex":default:F(e);break;case"tight-tree":var t;I(t=e),$(t);break;case"longest-path":q(e)}},eN=function(e){e.edges().forEach(t=>{let o=e.edge(t);if(o.width&&o.height){let o=e.node(t.v),n={rank:(e.node(t.w).rank-o.rank)/2+o.rank,e:t};N.addDummyNode(e,"edge-proxy",n,"_ep")}})},eS=function(e){let t=0;e.nodes().forEach(o=>{let n=e.node(o);n.borderTop&&(n.minRank=e.node(n.borderTop).rank,n.maxRank=e.node(n.borderBottom).rank,t=Math.max(t,n.maxRank))}),e.graph().maxRank=t},ek=function(e){e.nodes().forEach(t=>{let o=e.node(t);"edge-proxy"===o.dummy&&(e.edge(o.e).labelRank=o.rank,e.removeNode(t))})},eC=function(e){e.graph().dummyChains=[],e.edges().forEach(t=>(function(e,t){let o,n,r,i=t.v,a=e.node(i).rank,s=t.w,l=e.node(s).rank,d=t.name,h=e.edge(t),u=h.labelRank;if(l!==a+1){for(e.removeEdge(t),r=0,++a;a<l;++r,++a)h.points=[],n={width:0,height:0,edgeLabel:h,edgeObj:t,rank:a},o=N.addDummyNode(e,"edge",n,"_d"),a===u&&(n.width=h.width,n.height=h.height,n.dummy="edge-label",n.labelpos=h.labelpos),e.setEdge(i,o,{weight:h.weight},d),0===r&&e.graph().dummyChains.push(o),i=o;e.setEdge(i,s,{weight:h.weight},d)}})(e,t))},eD=function(e){e.graph().dummyChains.forEach(t=>{let o,n=e.node(t),r=n.edgeLabel;for(e.setEdge(n.edgeObj,r);n.dummy;)o=e.successors(t)[0],e.removeNode(t),r.points.push({x:n.x,y:n.y}),"edge-label"===n.dummy&&(r.x=n.x,r.y=n.y,r.width=n.width,r.height=n.height),t=o,n=e.node(t)})},eO=function(e){var t;let o,n,r=(o={},n=0,(t=e).children().forEach(function e(r){let i=n;t.children(r).forEach(e),o[r]={low:i,lim:n++}}),o);e.graph().dummyChains.forEach(t=>{let o=e.node(t),n=o.edgeObj,i=function(e,t,o,n){let r,i,a=[],s=[],l=Math.min(t[o].low,t[n].low),d=Math.max(t[o].lim,t[n].lim);r=o;do a.push(r=e.parent(r));while(r&&(t[r].low>l||d>t[r].lim));for(i=r,r=n;(r=e.parent(r))!==i;)s.push(r);return{path:a.concat(s.reverse()),lca:i}}(e,r,n.v,n.w),a=i.path,s=i.lca,l=0,d=a[0],h=!0;for(;t!==n.w;){if(o=e.node(t),h){for(;(d=a[l])!==s&&e.node(d).maxRank<o.rank;)l++;d===s&&(h=!1)}if(!h){for(;l<a.length-1&&e.node(d=a[l+1]).minRank<=o.rank;)l++;d=a[l]}e.setParent(t,d),t=e.successors(t)[0]}})},eM=function(e){e.children().forEach(function t(o){let n=e.children(o),r=e.node(o);if(n.length&&n.forEach(t),Object.hasOwn(r,"minRank")){r.borderLeft=[],r.borderRight=[];for(let t=r.minRank,n=r.maxRank+1;t<n;++t)X(e,"borderLeft","_bl",o,r,t),X(e,"borderRight","_br",o,r,t)}})},eP=function e(t,o){var n;let r,i,a,s,l;if(o&&"function"==typeof o.customOrder)return void o.customOrder(t,e);let d=N.maxRank(t),h=eo(t,N.range(1,d+1),"inEdges"),c=eo(t,N.range(d-1,-1,-1),"outEdges"),g=(r={},a=(i=(n=t).nodes().filter(e=>!n.children(e).length)).map(e=>n.node(e).rank),s=N.applyWithChunking(Math.max,a),l=N.range(s+1).map(()=>[]),i.sort((e,t)=>n.node(e).rank-n.node(t).rank).forEach(function e(t){r[t]||(r[t]=!0,l[n.node(t).rank].push(t),n.successors(t).forEach(e))}),l);if(en(t,g),o&&o.disableOptimalOrderHeuristic)return;let p=1/0,f;for(let e=0,o=0;o<4;++e,++o){(function(e,t){let o=new u.Graph;e.forEach(function(e){let n=e.graph().root,r=function e(t,o,n,r){let i=t.children(o),a=t.node(o),s=a?a.borderLeft:void 0,l=a?a.borderRight:void 0,d={};s&&(i=i.filter(e=>e!==s&&e!==l));let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map(t=>{let o=e.inEdges(t);if(!o.length)return{v:t};{let n=o.reduce((t,o)=>{let n=e.edge(o),r=e.node(o.v);return{sum:t.sum+n.weight*r.order,weight:t.weight+n.weight}},{sum:0,weight:0});return{v:t,barycenter:n.sum/n.weight,weight:n.weight}}})}(t,i);h.forEach(o=>{if(t.children(o.v).length){var i,a;let s=e(t,o.v,n,r);d[o.v]=s,Object.hasOwn(s,"barycenter")&&(i=o,a=s,void 0!==i.barycenter?(i.barycenter=(i.barycenter*i.weight+a.barycenter*a.weight)/(i.weight+a.weight),i.weight+=a.weight):(i.barycenter=a.barycenter,i.weight=a.weight))}});let u=function(e,t){let o={};return e.forEach((e,t)=>{let n=o[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};void 0!==e.barycenter&&(n.barycenter=e.barycenter,n.weight=e.weight)}),t.edges().forEach(e=>{let t=o[e.v],n=o[e.w];void 0!==t&&void 0!==n&&(n.indegree++,t.out.push(o[e.w]))}),function(e){let t=[];for(;e.length;){let o=e.pop();t.push(o),o.in.reverse().forEach(function(e){return t=>{!t.merged&&(void 0===t.barycenter||void 0===e.barycenter||t.barycenter>=e.barycenter)&&function(e,t){let o=0,n=0;e.weight&&(o+=e.barycenter*e.weight,n+=e.weight),t.weight&&(o+=t.barycenter*t.weight,n+=t.weight),e.vs=t.vs.concat(e.vs),e.barycenter=o/n,e.weight=n,e.i=Math.min(t.i,e.i),t.merged=!0}(e,t)}}(o)),o.out.forEach(function(t){return o=>{o.in.push(t),0==--o.indegree&&e.push(o)}}(o))}return t.filter(e=>!e.merged).map(e=>N.pick(e,["vs","i","barycenter","weight"]))}(Object.values(o).filter(e=>!e.indegree))}(h,n);!function(e,t){e.forEach(e=>{e.vs=e.vs.flatMap(e=>t[e]?t[e].vs:e)})}(u,d);let c=function(e,t){let o=N.partition(e,e=>Object.hasOwn(e,"barycenter")),n=o.lhs,r=o.rhs.sort((e,t)=>t.i-e.i),i=[],a=0,s=0,l=0;n.sort(function(e){return(t,o)=>t.barycenter<o.barycenter?-1:t.barycenter>o.barycenter?1:e?o.i-t.i:t.i-o.i}(!!t)),l=et(i,r,l),n.forEach(e=>{l+=e.vs.length,i.push(e.vs),a+=e.barycenter*e.weight,s+=e.weight,l=et(i,r,l)});let d={vs:i.flat(!0)};return s&&(d.barycenter=a/s,d.weight=s),d}(u,r);if(s&&(c.vs=[s,c.vs,l].flat(!0),t.predecessors(s).length)){let e=t.node(t.predecessors(s)[0]),o=t.node(t.predecessors(l)[0]);Object.hasOwn(c,"barycenter")||(c.barycenter=0,c.weight=0),c.barycenter=(c.barycenter*c.weight+e.order+o.order)/(c.weight+2),c.weight+=2}return c}(e,n,o,t);r.vs.forEach((t,o)=>e.node(t).order=o),function(e,t,o){let n={},r;o.forEach(o=>{let i=e.parent(o),a,s;for(;i;){if((a=e.parent(i))?(s=n[a],n[a]=i):(s=r,r=i),s&&s!==i)return void t.setEdge(s,i);i=a}})}(e,o,r.vs)})})(e%2?h:c,e%4>=2),g=N.buildLayerMatrix(t);let n=ee(t,g);n<p&&(o=0,f=Object.assign({},g),p=n)}en(t,f)},eT=function(e){N.buildLayerMatrix(e).forEach(t=>{var o=0;t.forEach((t,n)=>{var r=e.node(t);r.order=n+o,(r.selfEdges||[]).forEach(t=>{N.addDummyNode(e,"selfedge",{width:t.label.width,height:t.label.height,rank:r.rank,order:n+ ++o,e:t.e,label:t.label},"_se")}),delete r.selfEdges})})},e_=function(e){let t=e.graph().rankdir.toLowerCase();("lr"===t||"rl"===t)&&Z(e)},eR=function(e){var t,o;let n=e.graph().rankdir.toLowerCase();("bt"===n||"rl"===n)&&((t=e).nodes().forEach(e=>K(t.node(e))),t.edges().forEach(e=>{let o=t.edge(e);o.points.forEach(K),Object.hasOwn(o,"y")&&K(o)})),("lr"===n||"rl"===n)&&((o=e).nodes().forEach(e=>Q(o.node(e))),o.edges().forEach(e=>{let t=o.edge(e);t.points.forEach(Q),Object.hasOwn(t,"x")&&Q(t)}),Z(e))},eI=function(e){var t,o,n;let r,i,a,s,l,d,h,c,g,p,f,y;n=e=N.asNonCompoundGraph(e),p=N.buildLayerMatrix(n),f=n.graph().ranksep,y=0,p.forEach(e=>{let t=e.reduce((e,t)=>{let o=n.node(t).height;return e>o?e:o},0);e.forEach(e=>n.node(e).y=y+t/2),y+=t+f}),Object.entries((t=e,i=N.buildLayerMatrix(t),s=Object.assign((a={},i.length&&i.reduce(function(e,o){let n=0,r=0,i=e.length,s=o[o.length-1];return o.forEach((e,l)=>{let d=function(e,t){if(e.node(t).dummy)return e.predecessors(t).find(t=>e.node(t).dummy)}(t,e),h=d?t.node(d).order:i;(d||e===s)&&(o.slice(r,l+1).forEach(e=>{t.predecessors(e).forEach(o=>{let r=t.node(o),i=r.order;(i<n||h<i)&&!(r.dummy&&t.node(e).dummy)&&er(a,o,e)})}),r=l+1,n=h)}),o}),a),function(e,t){let o={};function n(t,n,r,i,a){let s;N.range(n,r).forEach(n=>{s=t[n],e.node(s).dummy&&e.predecessors(s).forEach(t=>{let n=e.node(t);n.dummy&&(n.order<i||n.order>a)&&er(o,t,s)})})}return t.length&&t.reduce(function(t,o){let r=-1,i,a=0;return o.forEach((s,l)=>{if("border"===e.node(s).dummy){let t=e.predecessors(s);t.length&&(i=e.node(t[0]).order,n(o,a,l,r,i),a=l,r=i)}n(o,a,o.length,i,t.length)}),o}),o}(t,i)),l={},["u","d"].forEach(e=>{r="u"===e?i:Object.values(i).reverse(),["l","r"].forEach(o=>{var n;let i,a,d;"r"===o&&(r=r.map(e=>Object.values(e).reverse()));let h=("u"===e?t.predecessors:t.successors).bind(t),c=(i={},a={},d={},(n=r).forEach(e=>{e.forEach((e,t)=>{i[e]=e,a[e]=e,d[e]=t})}),n.forEach(e=>{let t=-1;e.forEach(e=>{let o=h(e);if(o.length){let n=((o=o.sort((e,t)=>d[e]-d[t])).length-1)/2;for(let r=Math.floor(n),l=Math.ceil(n);r<=l;++r){let n=o[r];a[e]===e&&t<d[n]&&!function(e,t,o){if(t>o){let e=t;t=o,o=e}return!!e[t]&&Object.hasOwn(e[t],o)}(s,e,n)&&(a[n]=e,a[e]=i[e]=i[n],t=d[n])}}})}),{root:i,align:a}),g=function(e,t,o,n,r){var i,a,s,l,d,h,c;let g,p,f,y={},v=(i=e,a=t,s=o,l=r,g=new u.Graph,f=(d=(p=i.graph()).nodesep,h=p.edgesep,c=l,(e,t,o)=>{let n,r,i=e.node(t),a=e.node(o);if(n=0+i.width/2,Object.hasOwn(i,"labelpos"))switch(i.labelpos.toLowerCase()){case"l":r=-i.width/2;break;case"r":r=i.width/2}if(r&&(n+=c?r:-r),r=0,n+=(i.dummy?h:d)/2,n+=(a.dummy?h:d)/2,n+=a.width/2,Object.hasOwn(a,"labelpos"))switch(a.labelpos.toLowerCase()){case"l":r=a.width/2;break;case"r":r=-a.width/2}return r&&(n+=c?r:-r),r=0,n}),a.forEach(e=>{let t;e.forEach(e=>{let o=s[e];if(g.setNode(o),t){var n=s[t],r=g.edge(n,o);g.setEdge(n,o,Math.max(f(i,e,t),r||0))}t=e})}),g),m=r?"borderLeft":"borderRight";function b(e,t){let o=v.nodes(),n=o.pop(),r={};for(;n;)r[n]?e(n):(r[n]=!0,o.push(n),o=o.concat(t(n))),n=o.pop()}return b(function(e){y[e]=v.inEdges(e).reduce((e,t)=>Math.max(e,y[t.v]+v.edge(t)),0)},v.predecessors.bind(v)),b(function(t){let o=v.outEdges(t).reduce((e,t)=>Math.min(e,y[t.w]-v.edge(t)),1/0),n=e.node(t);o!==1/0&&n.borderType!==m&&(y[t]=Math.max(y[t],o))},v.successors.bind(v)),Object.keys(n).forEach(e=>y[e]=y[o[e]]),y}(t,r,c.root,c.align,"r"===o);"r"===o&&(g=N.mapValues(g,e=>-e)),l[e+o]=g})}),d=Object.values(l).reduce((e,o)=>{let n=-1/0,r=1/0;Object.entries(o).forEach(e=>{var o,i;let[a,s]=e,l=(o=t,i=a,o.node(i).width/2);n=Math.max(s+l,n),r=Math.min(s-l,r)});let i=n-r;return i<e[0]&&(e=[i,o]),e},[1/0,null])[1],h=Object.values(d),c=N.applyWithChunking(Math.min,h),g=N.applyWithChunking(Math.max,h),["u","d"].forEach(e=>{["l","r"].forEach(t=>{let o=e+t,n=l[o];if(n===d)return;let r=Object.values(n),i=c-N.applyWithChunking(Math.min,r);"l"!==t&&(i=g-N.applyWithChunking(Math.max,r)),i&&(l[o]=N.mapValues(n,e=>e+i))})}),o=t.graph().align,N.mapValues(l.ul,(e,t)=>{if(o)return l[o.toLowerCase()][t];{let e=Object.values(l).map(e=>e[t]).sort((e,t)=>e-t);return(e[1]+e[2])/2}}))).forEach(t=>{let[o,n]=t;return e.node(o).x=n})},eA=function(e){e.nodes().forEach(t=>{var o=e.node(t);if("selfedge"===o.dummy){var n=e.node(o.e.v),r=n.x+n.width/2,i=n.y,a=o.x-r,s=n.height/2;e.setEdge(o.e,o.label),e.removeNode(t),o.label.points=[{x:r+2*a/3,y:i-s},{x:r+5*a/6,y:i-s},{x:r+a,y:i},{x:r+5*a/6,y:i+s},{x:r+2*a/3,y:i+s}],o.label.x=o.x,o.label.y=o.y}})},e$=function(e){e.nodes().forEach(t=>{if(e.children(t).length){let o=e.node(t),n=e.node(o.borderTop),r=e.node(o.borderBottom),i=e.node(o.borderLeft[o.borderLeft.length-1]),a=e.node(o.borderRight[o.borderRight.length-1]);o.width=Math.abs(a.x-i.x),o.height=Math.abs(r.y-n.y),o.x=i.x+o.width/2,o.y=n.y+o.height/2}}),e.nodes().forEach(t=>{"border"===e.node(t).dummy&&e.removeNode(t)})},ej=function(e){e.edges().forEach(t=>{let o=e.edge(t);if(Object.hasOwn(o,"x"))switch(("l"===o.labelpos||"r"===o.labelpos)&&(o.width-=o.labeloffset),o.labelpos){case"l":o.x-=o.width/2+o.labeloffset;break;case"r":o.x+=o.width/2+o.labeloffset}})},eV=function(e){let t=1/0,o=0,n=1/0,r=0,i=e.graph(),a=i.marginx||0,s=i.marginy||0;function l(e){let i=e.x,a=e.y,s=e.width,l=e.height;t=Math.min(t,i-s/2),o=Math.max(o,i+s/2),n=Math.min(n,a-l/2),r=Math.max(r,a+l/2)}e.nodes().forEach(t=>l(e.node(t))),e.edges().forEach(t=>{let o=e.edge(t);Object.hasOwn(o,"x")&&l(o)}),t-=a,n-=s,e.nodes().forEach(o=>{let r=e.node(o);r.x-=t,r.y-=n}),e.edges().forEach(o=>{let r=e.edge(o);r.points.forEach(e=>{e.x-=t,e.y-=n}),Object.hasOwn(r,"x")&&(r.x-=t),Object.hasOwn(r,"y")&&(r.y-=n)}),i.width=o-t+a,i.height=r-n+s},eF=function(e){e.edges().forEach(t=>{let o,n,r=e.edge(t),i=e.node(t.v),a=e.node(t.w);r.points?(o=r.points[0],n=r.points[r.points.length-1]):(r.points=[],o=a,n=i),r.points.unshift(N.intersectRect(i,o)),r.points.push(N.intersectRect(a,n))})},eB=function(e){e.edges().forEach(t=>{let o=e.edge(t);o.reversed&&o.points.reverse()})},eH={rankdir:"LR",align:void 0,nodesep:100,edgesep:10,ranksep:100,marginx:0,marginy:0,acyclicer:void 0,ranker:"network-simplex"},eG={filterNode:void 0,getFollowNode:void 0,disableFitView:!1,enableAnimation:!1,animationDuration:300},eJ=class{get initialized(){return this.init}getNode(e){if(e)return this.store.nodes.get(e)}getNodeByIndex(e){let t=this.indexMap.get(e);return t?this.getNode(t):void 0}getEdge(e){return this.store.edges.get(e)}get nodes(){return Array.from(this.store.nodes.values())}get edges(){return Array.from(this.store.edges.values())}create(e,t){this.container=e.container,this.store=this.createStore(e),this.indexMap=this.createIndexMap(),this.setOptions(t),this.init=!0}createStore(e){let{layoutNodes:t,layoutEdges:o}=e,n=this.createVirtualEdges(e),r={nodes:new Map,edges:new Map};return t.forEach(e=>r.nodes.set(e.id,e)),o.concat(n).forEach(e=>r.edges.set(e.id,e)),r}createVirtualEdges(e){let{layoutNodes:t,layoutEdges:o}=e,n=t.map(e=>e.entity),r=o.map(e=>e.entity);return n.filter(e=>e.flowNodeType===p.Sy.GROUP).map(e=>{let{id:t,blocks:o=[]}=e,n=new Set(o.map(e=>e.id));return[...r.filter(e=>{var t;return n.has((null==(t=e.to)?void 0:t.id)??"")}).map(e=>{let{from:o,to:n}=e.info;if(!o||!n||e.vertical)return;let r=`virtual_${t}_${n}`;return{id:r,entity:e,from:o,to:t,fromIndex:"",toIndex:"",name:r}}).filter(Boolean),...r.filter(e=>{var t;return n.has((null==(t=e.from)?void 0:t.id)??"")}).map(e=>{let{from:o,to:n}=e.info;if(!o||!n||e.vertical)return;let r=`virtual_${t}_${o}`;return{id:r,entity:e,from:t,to:n,fromIndex:"",toIndex:"",name:r}}).filter(Boolean)]}).flat()}createIndexMap(){let e=this.sortNodes(),t=new Map;e.forEach((e,o)=>{let n=this.getNode(e);if(!n)return;let r=String(1e5+o);t.set(n.id,r),n.index=r}),this.edges.forEach(e=>{let o=t.get(e.from),n=t.get(e.to);if(!o||!n)return void this.store.edges.delete(e.id);e.fromIndex=o,e.toIndex=n});let o=new Map;return t.forEach((e,t)=>{o.set(e,t)}),o}sortNodes(){let e=[];this.nodes.forEach(t=>{e.push(t.id)}),this.edges.forEach(t=>{e.push(t.to)});let t=new Set,o=n=>{if(!n||t.has(n.id))return;t.add(n.id),e.push(n.id),n.blocks.forEach(e=>{o(e)});let{outputLines:r}=n.lines;r.sort((e,t)=>{var o,n;let r=this.getNode(null==(o=e.to)?void 0:o.id),i=this.getNode(null==(n=t.to)?void 0:n.id),a=e.fromPort,s=t.fromPort;return a===s&&r&&i?r.position.y-i.position.y:a&&s?a.point.y-s.point.y:0}).forEach(e=>{let{to:t}=e;t&&o(t)})};return o(this.container.entity),e.reduceRight((e,t)=>(e.includes(t)||e.unshift(t),e),[])}setOptions(e){this.options=e,this.setFollowNode(e.getFollowNode)}setFollowNode(e){if(!e)return;let t={store:this};this.nodes.forEach(o=>{var n;let r=null==(n=e(o,t))?void 0:n.followTo;if(!r)return;let i=this.getNode(r);i&&(i.followedBy||(i.followedBy=[]),i.followedBy.push(o.id),o.followTo=r)})}constructor(e){this.config=e,this.init=!1}},eU=class{async position(){return this.store.options.enableAnimation?this.positionWithAnimation():this.positionDirectly()}positionDirectly(){this.store.nodes.forEach(e=>{this.updateNodePosition({layoutNode:e,step:100})})}async positionWithAnimation(){return new Promise(e=>{(0,c.p4)({from:{d:0},to:{d:100},duration:this.store.options.animationDuration??0,onUpdate:e=>{this.store.nodes.forEach(t=>{this.updateNodePosition({layoutNode:t,step:e.d})})},onComplete:()=>{e()}})})}updateNodePosition(e){let{layoutNode:t,step:o}=e,{transform:n}=t.entity.transform,r={x:t.position.x+t.offset.x,y:t.position.y-t.size.height/2+t.offset.y},i=(r.x-n.position.x)*o/100,a=(r.y-n.position.y)*o/100,s={x:n.position.x+i,y:n.position.y+a};n.update({position:s}),t.entity.document.layout.updateAffectedTransform(t.entity)}constructor(e){this.store=e}},ez=class{layout(){this.graphSetData(),this.dagreLayout(),this.layoutSetPosition()}dagreLayout(){let e=ef(this.graph);this.runLayout(e),ey(this.graph,e)}runLayout(e){ev(e),em(e),eb(e),ew(e),eL(N.asNonCompoundGraph(e)),eN(e),D(e),ex(e),C(e),eS(e),ek(e),eC(e),eO(e),eM(e),eP(e),this.setOrderAndRank(e),eT(e),e_(e),eI(e),eA(e),e$(e),eD(e),ej(e),eR(e),eV(e),eF(e),eB(e),eE(e)}createGraph(){let e=new u.Graph({multigraph:!0});return e.setDefaultEdgeLabel(()=>({})),e.setGraph(this.store.config),e}graphSetData(){let{nodes:e,edges:t}=this.store;e.forEach(e=>{this.graph.setNode(e.index,{originID:e.id,width:e.size.width,height:e.size.height})}),t.sort((e,t)=>e.fromIndex===t.fromIndex?e.toIndex<t.toIndex?-1:1:e.fromIndex<t.fromIndex?-1:1).forEach(e=>{this.graph.setEdge({v:e.fromIndex,w:e.toIndex,name:e.name})})}layoutSetPosition(){this.store.nodes.forEach(e=>{let t=this.getOffsetX(e),o=this.graph.node(e.index);if(!o){e.rank=-1,e.position={x:e.position.x+t,y:e.position.y};return}e.rank=o.rank??-1,e.position={x:this.normalizeNumber(o.x)+t,y:this.normalizeNumber(o.y)}})}normalizeNumber(e){return Number.isNaN(e)?0:e}getOffsetX(e){if(0===e.layoutNodes.length)return 0;let{padding:t}=e;return-e.size.width/2+t.left}setOrderAndRank(e){return this.followAdjust(e),this.normalizeOrder(e),e}followAdjust(e){let t=this.rankGroup(e);e.nodes().forEach(o=>{let n=e.node(o),r=this.store.getNodeByIndex(o);if(!n||!(null==r?void 0:r.followedBy))return;let{followedBy:i}=r,{rank:a,order:s}=n,l=i.map(e=>{var t;return null==(t=this.store.getNode(e))?void 0:t.index}).filter(Boolean),d=new Set(l),h=t.get(a);h&&(Array.from(h).filter(t=>!d.has(t)&&e.node(t).order>s).forEach(t=>{let o=e.node(t);o.order=o.order+i.length}),l.forEach((o,n)=>{var r,i;let l=e.node(o);l.order=s+n+1;let d=l.rank;l.rank=a,null==(r=t.get(d))||r.delete(o),null==(i=t.get(a))||i.add(o)}))})}normalizeOrder(e){this.rankGroup(e).forEach((t,o)=>{let n=Array.from(t).map(t=>e.node(t));n.sort((e,t)=>e.order-t.order),n.forEach((e,t)=>{e.order=t})})}rankGroup(e){let t=new Map;return e.nodes().forEach(o=>{var n;let r=e.node(o).rank;t.has(r)||t.set(r,new Set),null==(n=t.get(r))||n.add(o)}),t}constructor(e){this.store=e,this.graph=this.createGraph()}},eW=class{init(e,t){this._store.create(e,t)}layout(){this._store.initialized&&this._layout.layout()}async position(){if(this._store.initialized)return await this._position.position()}constructor(e){this._store=new eJ(e),this._layout=new ez(this._store),this._position=new eU(this._store)}},eq=class{init(e){this.layoutConfig={...this.layoutConfig,...e.layoutConfig}}async layout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={...eG,...e},o=t.containerNode??this.document.root,n=this.createLayoutNode(o,e),r=await this.layoutNode(n,t),i=this.getLayoutNodeRect(n),a=r.map(e=>e.position()),s=this.fitView(t,i);await Promise.all([...a,s])}async fitView(e,t){if(!0!==e.disableFitView)return this.playground.config.fitView(t,e.enableAnimation,30)}async layoutNode(e,t){let{layoutNodes:o,layoutEdges:n}=e;if(0===o.length)return[];let r=(await Promise.all(o.map(e=>this.layoutNode(e,t)))).flat(),i=new eW({...this.layoutConfig,...t.layoutConfig});i.init({container:e,layoutNodes:o,layoutEdges:n},t),i.layout();let a=this.getLayoutNodeRect(e);return e.size={width:a.width,height:a.height},[...r,i]}createLayoutNodes(e,t){return e.map(e=>this.createLayoutNode(e,t))}createLayoutNode(e,t){let o=e.blocks.filter(o=>{var n;return!t.filterNode||(null==(n=t.filterNode)?void 0:n.call(t,{node:o,parent:e.parent}))}),n=this.getNodesAllLines(o),r=this.createLayoutNodes(o,t),i=this.createLayoutEdges(n),{bounds:a,padding:s}=e.transform,{width:l,height:d,center:h}=a,{x:u,y:c}=h;return{id:e.id,entity:e,index:"",rank:-1,order:-1,position:{x:u,y:c},offset:{x:0,y:0},padding:s,size:{width:l,height:d},layoutNodes:r,layoutEdges:i}}createLayoutEdges(e){return e.map(e=>this.createLayoutEdge(e)).filter(Boolean)}createLayoutEdge(e){let{from:t,to:o}=e.info;if(t&&o&&!e.vertical)return{id:e.id,entity:e,from:t,to:o,fromIndex:"",toIndex:"",name:e.id}}getNodesAllLines(e){return e.map(e=>{let t=e.getData(a.Z1);return[...t.outputLines.filter(Boolean),...t.inputLines.filter(Boolean)]}).flat()}getLayoutNodeRect(e){let t=e.layoutNodes.map(e=>this.layoutNodeRect(e)),o=g.Ae.enlarge(t),{padding:n}=e,r=o.width+n.left+n.right,i=o.height+n.top+n.bottom,a=o.x-n.left,s=o.y-n.top;return new g.Ae(a,s,r,i)}layoutNodeRect(e){let{width:t,height:o}=e.size,n=e.position.x-t/2,r=e.position.y-o/2;return new g.Ae(n,r,t,o)}constructor(){this.layoutConfig=eH}};v([(0,d.f3)(c.XQ)],eq.prototype,"playground",2),v([(0,d.f3)(a.L4)],eq.prototype,"document",2),eq=v([(0,d.b2)()],eq);var eX=(0,c.M1)({onBind:e=>{let{bind:t}=e;t(eq).toSelf().inSingletonScope()},onInit:(e,t)=>{e.get(eq).init(t)},singleton:!0}),eZ=o(324067),eY=o(854343),eK=o(697495),eQ=o(438024),e0=Object.defineProperty,e1=Object.getOwnPropertyDescriptor,e2=(e,t,o,n)=>{for(var r,i=n>1?void 0:n?e1(t,o):t,a=e.length-1;a>=0;a--)(r=e[a])&&(i=(n?r(t,o,i):r(i))||i);return n&&i&&e0(t,o,i),i};(n||(n={})).DEFAULT={canHovered:()=>!0};var e3=class extends c.mh{autorun(){let{activatedNode:e}=this.selectionService;this.nodeTransformsWithSort=this.nodeTransforms.filter(e=>"root"!==e.entity.id&&e.entity.flowNodeType!==p.Sy.GROUP).reverse().sort(t=>t.entity===e?-1:0)}get isDrawing(){return this.linesManager.isDrawing}onReady(){this.options={...n.DEFAULT,...this.options},this.toDispose.pushAll([this.hoverService.onUpdateHoverPosition(e=>{let{position:t,target:o}=e,n=this.config.getPosFromMouseEvent({clientX:t.x,clientY:t.y});this.updateHoveredState(n,o)}),this.listenPlaygroundEvent("mousemove",e=>{if(this.hoverService.hoveredPos=this.config.getPosFromMouseEvent(e),!this.isEnabled()||!this.options.canHovered(e,this.hoverService))return;let t=this.config.getPosFromMouseEvent(e);this.updateHoveredState(t,null==e?void 0:e.target)}),this.selectionService.onSelectionChanged(()=>this.autorun()),this.listenPlaygroundEvent("touchstart",e=>{if(this.isEnabled()&&!this.isDrawing)return this.handleDragLine(e)}),this.listenPlaygroundEvent("mousedown",e=>{if(!this.isEnabled()||this.isDrawing)return;let{hoveredNode:t}=this.hoverService;if(this.handleDragLine(e))return!0;let o=this.config.getPosFromMouseEvent(e),n=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=e.filter(e=>e instanceof a.CT);return o.length>+!!t?g.Ae.enlarge(o.map(e=>e.getData(p.eG).bounds)).pad(2):g.Ae.EMPTY}(this.selectionService.selection,!0);if(n.width>0&&n.contains(o.x,o.y)){var r;return null==(r=this.dragService.startDragSelectedNodes(e))||r.then(o=>{o||(t&&t instanceof a.CT?e.shiftKey?this.selectionService.toggleSelect(t):this.selectionService.selectNode(t):this.selectionService.clear())}),!0}t||this.selectionService.clear()})])}updateHoveredState(e,t){var o,n,r;let{hoverService:i}=this,a=this.nodeTransformsWithSort,s=this.linesManager.getPortFromMousePos(e,"output"),l=this.linesManager.getPortFromMousePos(e,"input"),d=s||l,h=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-line")].some(e=>e.contains(t));if(d){if(this.document.options.twoWayConnection)i.updateHoveredKey(d.id);else if("output"===d.portType)i.updateHoveredKey(d.id);else if(h||(null==t||null==(r=t.className)||null==(n=r.includes)?void 0:n.call(r,"workflow-port-bg"))){let t=this.linesManager.getCloseInLineFromMousePos(e);t&&this.updateHoveredKey(t.id)}return}if(this.isDrawing)return;let u=null==(o=a.find(t=>t.bounds.contains(e.x,e.y)))?void 0:o.entity,g=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-node")].some(e=>e.contains(t));(u||g)&&(null==u?void 0:u.id)&&this.updateHoveredKey(u.id);let p=h?this.linesManager.getCloseInLineFromMousePos(e):void 0;return u&&p?u.renderData.stackIndex>p.stackIndex?this.updateHoveredKey(u.id):this.updateHoveredKey(p.id):u?this.updateHoveredKey(u.id):p?this.updateHoveredKey(p.id):void(i.clearHovered(),this.editorStateConfig.getCurrentState()===c.yy.STATE_MOUSE_FRIENDLY_SELECT&&!this.editorStateConfig.isPressingShift&&this.configEntity.updateCursor("grab"))}updateHoveredKey(e){this.configEntity.updateCursor("default"),this.hoverService.updateHoveredKey(e)}isEnabled(){let e=this.editorStateConfig.getCurrentState();return(e===c.yy.STATE_SELECT||e===c.yy.STATE_MOUSE_FRIENDLY_SELECT)&&!this.selectorBoxConfigEntity.isStart&&!this.dragService.isDragging}handleDragLine(e){let{someHovered:t}=this.hoverService;return t&&t instanceof a.e2?(this.dragService.resetLine(t,e),!0):t&&t instanceof a.FD&&!t.disabled&&1!==e.button?(e.stopPropagation(),e.preventDefault(),this.dragService.startDrawingLine(t,e),!0):void 0}constructor(){super(...arguments),this.nodeTransformsWithSort=[]}};e3.type="HoverLayer",e2([(0,d.f3)(a.L4)],e3.prototype,"document",2),e2([(0,d.f3)(a.oJ)],e3.prototype,"selectionService",2),e2([(0,d.f3)(a.iw)],e3.prototype,"dragService",2),e2([(0,d.f3)(a.XH)],e3.prototype,"hoverService",2),e2([(0,d.f3)(a.dm)],e3.prototype,"linesManager",2),e2([(0,c.O0)(c.Zs)],e3.prototype,"editorStateConfig",2),e2([(0,c.O0)(eQ.NQ)],e3.prototype,"selectorBoxConfigEntity",2),e2([(0,d.f3)(c.ER)],e3.prototype,"configEntity",2),e2([(0,c.aI)(a.CT,p.eG)],e3.prototype,"nodeTransforms",2),e2([(0,c.RX)(a.e2)],e3.prototype,"lines",2),e3=e2([(0,d.b2)()],e3);var e6=(0,c.M1)({onInit(e){e.playground.registerLayer(e3)}}),e4=o(65881),e5=Object.defineProperty,e9=Object.getOwnPropertyDescriptor,e8=Object.getOwnPropertyNames,e7=Object.prototype.hasOwnProperty,te=(e,t)=>{for(var o in t)e5(e,o,{get:t[o],enumerable:!0})},tt=(e,t,o,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of e8(t))e7.call(e,r)||r===o||e5(e,r,{get:()=>t[r],enumerable:!(n=e9(t,r))||n.enumerable});return e},to=(e,t,o)=>(tt(e,t,"default"),o&&tt(o,t,"default")),tn=(e,t,o,n)=>{for(var r,i=n>1?void 0:n?e9(t,o):t,a=e.length-1;a>=0;a--)(r=e[a])&&(i=(n?r(t,o,i):r(i))||i);return n&&i&&e5(t,o,i),i},tr={};te(tr,{FreeLayoutEditor:()=>tf,FreeLayoutEditorProvider:()=>tg,FreeLayoutPluginContext:()=>tu,FreeLayoutProps:()=>r,WorkflowAutoLayoutTool:()=>ts,WorkflowNodeRenderer:()=>tp,WorkflowPortRender:()=>eK.Jb,createFreeLayoutPreset:()=>tc,useAutoLayout:()=>ty,useClientContext:()=>tv,usePlaygroundTools:()=>tm});var ti={};te(ti,{FreeLayoutEditor:()=>tf,FreeLayoutEditorProvider:()=>tg,WorkflowNodeRenderer:()=>tp,WorkflowPortRender:()=>eK.Jb});var ta=Symbol("WorkflowOperationService"),ts=class{async handle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.playground.config.readonly?()=>{}:await this.autoLayout(e)}async autoLayout(e){let t=this.document.getAllNodes(),o=t.map(this.getNodePosition);await this.autoLayoutService.layout(e);let n=t.map(this.getNodePosition);return this.updateHistory({nodes:t,startPositions:o,endPositions:n}),this.createResetFn({nodes:t,startPositions:o})}getNodePosition(e){let t=e.getData(i.VOn);return{x:t.position.x,y:t.position.y}}createResetFn(e){let{nodes:t,startPositions:o}=e;return()=>{t.forEach((e,t)=>{let n=e.getData(i.VOn),r=o[t];n.update({position:r})})}}updateHistory(e){var t;let{nodes:o,startPositions:n,endPositions:r}=e,i=o.map(e=>e.id);null==(t=this.historyService)||t.pushOperation({type:l.Nj.dragNodes,value:{ids:i,value:r,oldValue:n}},{noApply:!0})}};tn([(0,d.f3)(a.L4)],ts.prototype,"document",2),tn([(0,d.f3)(i.XQj)],ts.prototype,"playground",2),tn([(0,d.f3)(eq)],ts.prototype,"autoLayoutService",2),tn([(0,d.f3)(h.qp),(0,d.jt)()],ts.prototype,"historyService",2),ts=tn([(0,d.b2)()],ts);var tl=class extends a.sJ{startTransaction(){}endTransaction(){}};tl=tn([(0,d.b2)()],tl);var td=class extends tl{startTransaction(){this.historyService.startTransaction()}endTransaction(){this.historyService.endTransaction()}fromJSON(e){this.startTransaction();try{super.fromJSON(e)}catch(e){console.log("fromJSON error",e)}this.endTransaction()}};tn([(0,d.f3)(h.qp)],td.prototype,"historyService",2),td=tn([(0,d.b2)()],td);var th=(0,i.M1y)({onBind:(e,t)=>{var o;let{bind:n}=e;n(ta).to((null==t||null==(o=t.history)?void 0:o.enable)?td:tl).inSingletonScope()},onDispose:e=>{e.container.get(ta).dispose()}}),tu=i.Zn3;(r||(r={})).DEFAULT={...i.nYJ.DEFAULT};function tc(e){return t=>{var o,n;e={...r.DEFAULT,...e,playground:{...e.playground,get hoverService(){return t.get(a.XH)}}};let s=[];return s.push((0,i.cL)({registerShortcuts(o){var n;let r=t.get(i.z2R);if(o.addHandlers({commandId:a.uB.DELETE_NODES,shortcuts:["backspace","delete"],isEnabled:()=>r.selection.length>0&&!t.playground.config.readonlyOrDisabled,execute:()=>{r.selection.forEach(e=>{if(e instanceof a.CT){var o;if(!t.document.canRemove(e))return;let n=e.getNodeMeta(),r=null==(o=n.subCanvas)?void 0:o.call(n,e);if(null==r?void 0:r.isCanvas)return void r.parentNode.dispose();e.dispose()}else if(e instanceof a.e2){if(!t.document.linesManager.canRemove(e))return;e.dispose()}}),r.selection=r.selection.filter(e=>!e.disposed)}}),null==e||null==(n=e.history)?void 0:n.enable){let n=t.get(l.qp);e.history.disableShortcuts||(o.addHandlers({commandId:i.mYg.Default.UNDO,shortcuts:["meta z","ctrl z"],isEnabled:()=>!0,execute:()=>{n.undo()}}),o.addHandlers({commandId:i.mYg.Default.REDO,shortcuts:["meta shift z","ctrl shift z"],isEnabled:()=>!0,execute:()=>{n.redo()}}))}}})),s=(0,i.Fu1)(e,s)(t),(null==(o=e.variableEngine)?void 0:o.enable)&&s.push((0,i.Ys9)({...e.variableEngine,layout:"free"})),(null==(n=e.history)?void 0:n.enable)&&s.push((0,l.ou)(e.history)),s.push((0,i.d3V)({onBind:o=>{var n,r,s,l,d,h,u,c,g,p,f,y,v,m,b;o.bind(ts).toSelf().inSingletonScope(),o.rebind(a.fY).toConstantValue({canAddLine:null==(n=e.canAddLine)?void 0:n.bind(null,t),canDeleteLine:null==(r=e.canDeleteLine)?void 0:r.bind(null,t),isErrorLine:null==(s=e.isErrorLine)?void 0:s.bind(null,t),isErrorPort:null==(l=e.isErrorPort)?void 0:l.bind(null,t),isDisabledPort:null==(d=e.isDisabledPort)?void 0:d.bind(null,t),isReverseLine:null==(h=e.isReverseLine)?void 0:h.bind(null,t),isHideArrowLine:null==(u=e.isHideArrowLine)?void 0:u.bind(null,t),isFlowingLine:null==(c=e.isFlowingLine)?void 0:c.bind(null,t),isDisabledLine:null==(g=e.isDisabledLine)?void 0:g.bind(null,t),onDragLineEnd:null==(p=e.onDragLineEnd)?void 0:p.bind(null,t),setLineRenderType:null==(f=e.setLineRenderType)?void 0:f.bind(null,t),setLineClassName:null==(y=e.setLineClassName)?void 0:y.bind(null,t),canDeleteNode:null==(v=e.canDeleteNode)?void 0:v.bind(null,t),canResetLine:null==(m=e.canResetLine)?void 0:m.bind(null,t),canDropToNode:null==(b=e.canDropToNode)?void 0:b.bind(null,t),cursors:e.cursors??a.jg.cursors,lineColor:e.lineColor??a.jg.lineColor,allNodesDefaultExpanded:e.allNodesDefaultExpanded,twoWayConnection:e.twoWayConnection??!0,toNodeJSON:t=>(function(e,t){let o,n=t.getData(i.Psq),r=t.transform.position;if(o=n?a.jg.toNodeJSON(t):{id:t.id,type:t.flowNodeType,meta:{position:{x:r.x,y:r.y}},data:t.getExtInfo()},t.flowNodeType===i.SyX.GROUP){var s;let e=(null==(s=t.parent)?void 0:s.id)??i.SyX.ROOT,n=t.blocks.map(e=>e.id)??[];o.data={...o.data,parentID:e,blockIDs:n}}return e.toNodeJSON?e.toNodeJSON(t,o):o})(e,t),fromNodeJSON:(t,o,n)=>(function(e,t,o,n){if(o=e.fromNodeJSON?e.fromNodeJSON(t,o,n):o,!t.getData(i.Psq)){o.data&&t.updateExtInfo(o.data,!0),n&&t.onExtInfoChange(()=>{t.document.fireContentChange({type:a.fT.NODE_DATA_CHANGE,toJSON:()=>t.getExtInfo(),entity:t})});return}return a.jg.fromNodeJSON(t,o,n)})(e,t,o,n)})},onInit:t=>{var o,n,r;t.playground.registerLayer(i.Emw),t.playground.registerLayer(i.V7e,{renderElement:()=>(e=>{let t=e.get(eY.StackingContextManager);if(t.node)return t.node})(t)}),(null==(o=e.scroll)?void 0:o.enableScrollLimit)&&t.playground.registerLayer(i.qq0),(null==(n=e.scroll)?void 0:n.disableScrollBar)||t.playground.registerLayer(i.lVg),(null==(r=e.scroll)?void 0:r.disableScroll)&&(t.playground.config.scrollDisable=!0),e.onContentChange&&t.document.onContentChange(o=>e.onContentChange(t,o))},containerModules:[a._s]}),th(e),(0,eY.createFreeStackPlugin)({}),(0,eK.J2)({}),e6({}),eX({}),(0,eZ.Y)({canSelect:e=>{if(0!==e.button)return!1;let o=e.target;if(o){if(o.classList.contains("gedit-flow-background-layer")||o.closest('[data-flow-editor-selectable="true"]'))return!0;if(o.closest('[data-flow-editor-selectable="false"]'))return!1}return!t.get(a.XH).isSomeHovered()},ignoreOneSelect:!0,ignoreChildrenLength:!0,...e.selectBox||{}})),(0,i.esp)(e,s)(t)}}var tg=(0,s.forwardRef)(function(e,t){let{children:o,...n}=e,r=(0,s.useMemo)(()=>tc(n),[]),d=(0,s.useCallback)(e=>({...(0,i.FwO)(e),get document(){return e.get(a.L4)},get clipboard(){return e.get(i.YvH)},get selection(){return e.get(i.z2R)},get history(){return e.get(l.qp)},get operation(){return e.get(ta)},get tools(){let t=e.get(ts);return{autoLayout:t.handle.bind(t),fitView:t=>(0,a.Qu)(e.get(a.L4),e.get(i.XQj).config,t)}}}),[]);return s.createElement(i.W6u,{ref:t,plugins:r,customPluginContext:d},o)}),tp=e=>{let{selected:t,activated:o,startDrag:n,ports:r,selectNode:i,nodeRef:l,onFocus:d,onBlur:h}=(0,a.PV)(),u=(0,e4.Z)(e.className||"",{activated:o,selected:t});return s.createElement(s.Fragment,null,s.createElement("div",{className:u,style:e.style,ref:l,draggable:!0,onDragStart:n,onClick:i,onFocus:d,onBlur:h,"data-node-selected":String(t)},e.children),r.map(t=>s.createElement(eK.Jb,{key:t.id,entity:t,onClick:e.onPortClick?o=>e.onPortClick(t,o):void 0,className:e.portClassName,style:e.portStyle,primaryColor:e.portPrimaryColor,secondaryColor:e.portSecondaryColor,errorColor:e.portErrorColor,backgroundColor:e.portBackgroundColor})))},tf=(0,s.forwardRef)(function(e,t){let{children:o,...n}=e;return s.createElement(tg,{ref:t,...n},s.createElement(i.R6T,null,o))});to(ti,eY),to(tr,ti);var ty=()=>{let e=(0,a.G2)(ts);return e.handle.bind(e)};function tv(){return(0,i.G2Z)(i.Zn3)}function tm(e){let{maxZoom:t,minZoom:o}=e||{},n=(0,a.Dc)(),r=(0,a.G2)(a.L4),[l,d]=(0,s.useState)(1),[h,u]=(0,s.useState)(r.linesManager.lineType),[c,g]=(0,s.useState)(a.YC.SELECT),[p,f]=(0,s.useState)(a.v6.PAD),y=(0,s.useCallback)(e=>{null==n||n.config.zoomout(e)},[l,n]),v=(0,s.useCallback)(e=>{null==n||n.config.zoomin(e)},[l,n]),m=(0,s.useCallback)(e=>{let t=r.linesManager.switchLineType(e);return u(t),t},[r]),b=(0,s.useCallback)(e=>{(0,a.Qu)(r,n.config,e)},[r,n]),E=ty();return(0,s.useEffect)(()=>{let e=null;return n&&(e=n.onZoom(e=>d(e))),()=>{e&&e.dispose()}},[n]),(0,s.useEffect)(()=>{let e=n.editorState.onStateChange(e=>{g(e.state===i.yyW.STATE_GRAB||e.state===i.yyW.STATE_MOUSE_FRIENDLY_SELECT?a.YC.GRAB:a.YC.SELECT),f(e.state===i.yyW.STATE_MOUSE_FRIENDLY_SELECT?a.v6.MOUSE:a.v6.PAD)});return()=>{e.dispose()}},[n]),(0,s.useEffect)(()=>{let e=n.config.config;n.config.updateConfig({maxZoom:void 0!==t?t:e.maxZoom,minZoom:void 0!==o?o:e.minZoom})},[n,t,o]),{zoomin:v,zoomout:y,fitView:b,autoLayout:E,switchLineType:m,zoom:l,lineType:h,cursorState:c,setCursorState:function(e){let t;void 0!==(t="function"==typeof e?e({isPressingSpaceBar:n.editorState.isPressingSpaceBar,cursorState:c}):e)&&(t===a.YC.GRAB?(n.editorState.changeState(i.yyW.STATE_GRAB.id),g(t)):(t=a.YC.SELECT)&&(n.editorState.changeState(i.yyW.STATE_SELECT.id),g(t)))},interactiveType:p,setInteractiveType:function(e){e===a.v6.MOUSE?(n.editorState.changeState(i.yyW.STATE_MOUSE_FRIENDLY_SELECT.id),g(a.YC.GRAB)):e===a.v6.PAD&&(n.editorState.changeState(i.yyW.STATE_SELECT.id),g(a.YC.SELECT)),f(e)},setMouseScrollDelta:function(e){n.config.updateConfig({mouseScrollDelta:e})}}}},201063:function(e,t,o){o.d(t,{Nj:()=>y,ou:()=>A,qp:()=>r.qp});var n,r=o(66298),i=o(893740),a=o(952893),s=o(938573),l=o(9163),d=o(832176),h=o(336330),u=o(579962);o(908600);var c=Object.defineProperty,g=Object.getOwnPropertyDescriptor,p=(e,t,o,n)=>{for(var r,i=n>1?void 0:n?g(t,o):t,a=e.length-1;a>=0;a--)(r=e[a])&&(i=(n?r(t,o,i):r(i))||i);return n&&i&&c(t,o,i),i},f=class{addEntityData(e){this._entityDataValues.set(e,(0,a.Z)(e.toJSON())),this._toDispose.push(e.onWillChange(t=>{let o=t.toJSON(),n=this._entityDataValues.get(e);(0,s.Z)(o,n)||this._entityDataValues.set(e,(0,a.Z)(o))}))}getValue(e){return this._entityDataValues.get(e)}setValue(e,t){return this._entityDataValues.set(e,t)}dispose(){this._entityDataValues.clear(),this._toDispose.dispose()}constructor(){this._entityDataValues=new Map,this._toDispose=new d.K4}};f=p([(0,l.b2)()],f);var y=((n=y||{}).addLine="addLine",n.deleteLine="deleteLine",n.changeLineData="changeLineData",n.moveNode="moveNode",n.addNode="addNode",n.deleteNode="deleteNode",n.changeNodeData="changeNodeData",n.resetLayout="resetLayout",n.dragNodes="dragNodes",n.moveChildNodes="moveChildNodes",n),v=class{handle(e){"onDragEnd"===e.type&&this._dragNode(e)}_dragNode(e){this._historyService.pushOperation({type:"dragNodes",value:{ids:e.nodes.map(e=>e.id),value:e.nodes.map(e=>{let{x:t,y:o}=e.getData(i.VO).position;return{x:t,y:o}}),oldValue:e.startPositions}},{noApply:!0})}};p([(0,l.f3)(r.qp)],v.prototype,"_historyService",2),v=p([(0,l.b2)()],v);var m=class{init(e,t){this.enable=!!(null==t?void 0:t.enable),t.nodeToJSON&&(this.nodeToJSON=t.nodeToJSON(e)),t.getNodeLabelById&&(this.getNodeLabelById=t.getNodeLabelById(e)),t.getNodeLabel&&(this.getNodeLabel=t.getNodeLabel(e)),t.getBlockLabel&&(this.getBlockLabel=t.getBlockLabel(e)),t.getNodeURI&&(this.getNodeURI=t.getNodeURI(e)),t.getLineURI&&(this.getLineURI=t.getLineURI(e)),void 0!==t.enableChangeNode&&(this.enableChangeNode=t.enableChangeNode),void 0!==t.enableChangeLineData&&(this.enableChangeLineData=t.enableChangeLineData)}constructor(){this.enableChangeNode=!0,this.enableChangeLineData=!0,this.enable=!1,this.nodeToJSON=e=>e.toJSON(),this.getNodeLabelById=e=>e,this.getNodeLabel=e=>e.id,this.getBlockLabel=e=>e.id,this.getNodeURI=e=>`node:${e}`,this.getLineURI=e=>`line:${e}`}};m=p([(0,l.b2)()],m);var b={type:h.fT.DELETE_NODE,toOperation:(e,t)=>{var o;let n=t.get(m),r=e.entity;return{type:"deleteNode",value:{node:e.toJSON(),parentID:null==(o=r.parent)?void 0:o.id},uri:n.getNodeURI(r.id)}}},E={type:h.fT.DELETE_LINE,toOperation:(e,t)=>{let o=t.get(m),n=e.entity;return{type:"deleteLine",value:{from:n.info.from,to:n.info.to||"",fromPort:n.info.fromPort||"",toPort:n.info.toPort||"",data:n.info.data,id:n.id},uri:o.getNodeURI(n.id)}}},w={type:h.fT.LINE_DATA_CHANGE,toOperation:(e,t)=>{let o=t.get(m),n=e.entity;return{type:"changeLineData",value:{id:n.id,oldValue:e.oldValue,newValue:n.lineData},uri:o.getLineURI(n.id)}}},x={type:h.fT.ADD_NODE,toOperation:(e,t)=>{var o;let n=t.get(m),r=t.get(h.L4),i=e.entity,a=null==(o=i.parent)?void 0:o.id;return{type:"addNode",value:{node:r.toNodeJSON(i),parentID:a},uri:n.getNodeURI(i.id)}}},L=[{type:h.fT.ADD_LINE,toOperation:(e,t)=>{let o=t.get(m),n=e.entity;return{type:"addLine",value:{from:n.info.from,to:n.info.to||"",fromPort:n.info.fromPort||"",toPort:n.info.toPort||"",data:n.info.data,id:n.id},uri:o.getLineURI(n.id)}}},E,x,b,w],N=class{handle(e,t){if(!this._historyService.undoRedoService.canPush()||!this._historyConfig.enableChangeLineData&&e.type===h.fT.LINE_DATA_CHANGE)return;let o=L.find(t=>t.type===e.type);if(!o)return;let n=o.toOperation(e,t);n&&this._historyService.pushOperation(n,{noApply:!0})}};p([(0,l.f3)(r.qp)],N.prototype,"_historyService",2),p([(0,l.f3)(m)],N.prototype,"_historyConfig",2),N=p([(0,l.b2)()],N);var S={shouldMerge:(e,t,o)=>!!t&&Date.now()-o.getTimestamp()<500},k={...S,type:"resetLayout",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:async(e,t)=>{let o=t.get(h.ZO);await o.layoutToPositions(e.value.ids,e.value.value)},shouldMerge:()=>!1},C={...S,type:u.C8.moveChildNodes,inverse:e=>({...e,value:{...e.value,fromIndex:e.value.toIndex,toIndex:e.value.fromIndex,fromParentId:e.value.toParentId,toParentId:e.value.fromParentId}}),apply:(e,t)=>{let o=t.get(h.L4);o.moveChildNodes(e.value);let n=o.getNode(e.value.fromParentId);requestAnimationFrame(()=>{n&&n.flowNodeType!==u.Sy.ROOT&&n.getData(i.VO).fireChange()})}},D={...S,type:"dragNodes",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:(e,t)=>{e.value.ids.forEach((o,n)=>{let r=t.get(h.L4),a=r.getNode(o);if(!a)return;let s=a.getData(i.VO),l=e.value.value[n];s.update({position:{x:l.x,y:l.y}}),r.layout.updateAffectedTransform(a)})}},O={...S,type:"deleteNode",inverse:e=>({...e,type:"addNode"}),apply:(e,t)=>{let o=t.get(h.L4).getNode(e.value.node.id);o&&o.dispose()},getLabel:(e,t)=>{let o=t.get(m);return`Delete Node ${o.getNodeLabel(e.value.node)}`},getDescription:(e,t)=>{var o;let n=t.get(m),r=`Delete Node ${n.getNodeLabel(e.value.node)}`;return(null==(o=e.value.node.meta)?void 0:o.position)&&(r+=` at ${e.value.node.meta.position.x},${e.value.node.meta.position.y}`),r}},M={...S,type:"deleteLine",inverse:e=>({...e,type:"addLine"}),apply:(e,t)=>{t.get(h.L4).removeNode(e.value.id)},getLabel:(e,t)=>"Delete Line",getDescription:(e,t)=>{let o=t.get(m),{value:n}=e;if(!n.from||!n.to)return"Delete Line";let r=o.getNodeLabelById(n.from),i=o.getNodeLabelById(n.to);return`Delete Line from ${r} to ${i}`}},P={...S,type:"changeLineData",inverse:e=>({...e,value:{...e.value,newValue:e.value.oldValue,oldValue:e.value.newValue}}),apply:(e,t)=>{let o=t.get(h.dm).getLineById(e.value.id);o&&(o.lineData=e.value.newValue)},shouldMerge:(e,t,o)=>!!t&&!!(Date.now()-o.getTimestamp()<500)&&(e.type!==t.type||e.value.id!==t.value.id||{type:e.type,value:{...e.value,newValue:e.value.newValue,oldValue:t.value.oldValue}})},T={...S,type:"addNode",inverse:e=>({...e,type:"deleteNode"}),apply:async(e,t)=>{let o=t.get(h.L4);await o.createWorkflowNode((0,a.Z)(e.value.node),!1,e.value.parentID)},getLabel:(e,t)=>{let o=t.get(m);return`Create Node ${o.getNodeLabel(e.value.node)}`},getDescription:(e,t)=>{var o;let n=t.get(m),r=`Create Node ${n.getNodeLabel(e.value.node)}`;return(null==(o=e.value.node.meta)?void 0:o.position)&&(r+=` at ${e.value.node.meta.position.x},${e.value.node.meta.position.y}`),r}},_=[{...S,type:"addLine",inverse:e=>({...e,type:"deleteLine"}),apply:(e,t)=>{t.get(h.dm).createLine({...e.value,key:e.value.id})},getLabel:(e,t)=>"Create Line",getDescription:(e,t)=>{let o=t.get(m),{value:n}=e;if(!n.from||!n.to)return"Create Line";let r=o.getNodeLabelById(n.from),i=o.getNodeLabelById(n.to);return`Create Line from ${r} to ${i}`}},M,T,O,k,D,C,P],R=class{registerOperationMeta(e){_.forEach(t=>{e.registerOperationMeta(t)})}};R=p([(0,l.b2)()],R);var I=class{onInit(e,t){let o=e.get(h.L4),n=e.get(r.qp),a=e.get(h.iw),s=e.get(h.ZO);(null==t?void 0:t.limit)&&n.limit(t.limit),n.context.source=e,this._toDispose.pushAll([a.onNodesDrag(async e=>{"onDragEnd"===e.type&&this._dragNodesHandler.handle(e)}),o.onNodeCreate(e=>{let{node:t,data:o}=e,n=t.getData(i.WV);n&&this._entityManager.addEntityData(n)}),o.onContentChange(t=>{this._changeContentHandler.handle(t,e)}),o.onReload(e=>{n.clear()}),s.onResetLayout(e=>{n.pushOperation({type:"resetLayout",value:{ids:e.nodeIds,value:e.positionMap,oldValue:e.oldPositionMap}},{noApply:!0})}),this._operationService.onNodeMove(e=>{let{node:t,fromParent:o,fromIndex:r,toParent:i,toIndex:a}=e;n.pushOperation({type:u.C8.moveChildNodes,value:{fromParentId:o.id,fromIndex:r,nodeIds:[t.id],toParentId:i.id,toIndex:a}},{noApply:!0})}),this._operationService.onNodePostionUpdate(e=>{let t={ids:[e.node.id],value:[e.newPosition],oldValue:[e.oldPosition]};n.pushOperation({type:"dragNodes",value:t},{noApply:!0})})])}dispose(){this._entityManager.dispose(),this._toDispose.dispose()}constructor(){this._toDispose=new d.K4}};p([(0,l.f3)(v)],I.prototype,"_dragNodesHandler",2),p([(0,l.f3)(N)],I.prototype,"_changeContentHandler",2),p([(0,l.f3)(f)],I.prototype,"_entityManager",2),p([(0,l.f3)(h.xV)],I.prototype,"_operationService",2),I=p([(0,l.b2)()],I);var A=(0,i.M1)({onBind:e=>{let{bind:t}=e;(0,i.KV)(t,R,[r.FU]),t(m).toSelf().inSingletonScope(),t(I).toSelf().inSingletonScope(),t(f).toSelf().inSingletonScope(),t(v).toSelf().inSingletonScope(),t(N).toSelf().inSingletonScope()},onInit(e,t){e.get(m).init(e,t),t.enable&&e.get(I).onInit(e,t)},onDispose(e){e.get(f).dispose()},containerModules:[r.Xn]})},697495:function(e,t,o){o.d(t,{J2:()=>R,Jb:()=>E});var n,r=o(89802),i=o(908600),a=o(65881),s=o(336330),l=o(893740),d=o(461249),h=o(9163),u=o(832176),c=o(438024),g=o(854343),p=o(564085),f=Object.defineProperty,y=Object.getOwnPropertyDescriptor,v=(e,t,o,n)=>{for(var r,i=n>1?void 0:n?y(t,o):t,a=e.length-1;a>=0;a--)(r=e[a])&&(i=(n?r(t,o,i):r(i))||i);return n&&i&&f(t,o,i),i},m=d.ZP.div`
  width: 20px;
  height: 20px;
  border-radius: 50%;
  margin-top: -10px;
  margin-left: -10px;
  left: 50%;
  top: 50%;
  position: absolute;
  //  hover 
  border: none;

  & > .symbol {
    opacity: 0;
  }

  .bg-circle {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    background-color: var(--g-workflow-port-color-background, #fff);
    transform: scale(0.5);
    transition: all 0.2s linear 0s;
  }

  .bg {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: var(--g-workflow-port-color-secondary, #9197f1);
    transform: scale(0.4, 0.4);
    transition: all 0.2s linear 0s;

    &.hasError {
      background: var(--g-workflow-port-color-error, red);
    }

    .symbol {
      position: absolute;
      width: 14px;
      height: 14px;
      opacity: 0;
      pointer-events: none;
      color: var(--g-workflow-port-color-background, #fff);
      transition: opacity 0.2s linear 0s;

      & > svg {
        width: 14px;
        height: 14px;
      }
    }

    .focus-circle {
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 8px;
      height: 8px;
      opacity: 0;
      background: var(--g-workflow-port-color-secondary, #9197f1);
      border-radius: 50%;
      transition: opacity 0.2s linear 0s;
    }
  }

  &.linked .bg:not(.hasError) {
    background: var(--g-workflow-port-color-primary, #4d53e8);
  }

  &.hovered .bg:not(.hasError) {
    border: none;
    cursor: crosshair;
    transform: scale(1, 1);
    background: var(--g-workflow-port-color-primary, #4d53e8);

    & > .symbol {
      opacity: 1;
    }
  }

  .cross-hair {
    position: relative;
    left: 2px;
    top: 2px;

    &::after,
    &::before {
      content: '';
      background: var(--g-workflow-port-color-background, #fff);
      border-radius: 2px;
      position: absolute;
    }

    &::after {
      left: 4px;
      width: 2px;
      height: 6px;
      box-shadow: 0 4px var(--g-workflow-port-color-background, #fff);
    }

    &::before {
      top: 4px;
      width: 6px;
      height: 2px;
      box-shadow: 4px 0 var(--g-workflow-port-color-background, #fff);
    }
`;function b(){return i.createElement("div",{className:"symbol"},i.createElement("div",{className:"cross-hair"}))}var E=i.memo(e=>{var t;let o=(0,l.G2)(s.XH),n=(0,l.G2)(s.dm),{entity:d,onClick:h}=e,{relativePosition:u,disabled:c}=d,[g,p]=(0,i.useState)(d.targetElement),[f,y]=(0,i.useState)(u.x),[v,E]=(0,i.useState)(u.y),[w,x]=(0,i.useState)(!1),[L,N]=(0,i.useState)(!!(null==d||null==(t=d.lines)?void 0:t.length)),[S,k]=(0,i.useState)(e.entity.hasError),C=(0,s.gO)();(0,i.useEffect)(()=>{d.validate(),k(d.hasError);let e=d.onEntityChange(()=>{if(d.targetElement){d.targetElement!==g&&p(d.targetElement);return}let e=d.relativePosition;y(Math.round(e.x)),E(Math.round(e.y))}),t=o.onHoveredChange(e=>{x(o.isHovered(d.id))}),r=d.onErrorChanged(()=>{k(d.hasError)}),i=n.onAvailableLinesChange(()=>{setTimeout(()=>{n.disposed||d.disposed||N(!!d.lines.length)},0)});return()=>{e.dispose(),t.dispose(),r.dispose(),i.dispose()}},[o,d,g]);let D=(0,a.Z)("workflow-port-render",e.className||"",{hovered:!C&&w&&!c,linked:L}),O={};e.primaryColor&&(O["--g-workflow-port-color-primary"]=e.primaryColor),e.secondaryColor&&(O["--g-workflow-port-color-secondary"]=e.secondaryColor),e.errorColor&&(O["--g-workflow-port-color-error"]=e.errorColor),e.backgroundColor&&(O["--g-workflow-port-color-background"]=e.backgroundColor);let M=g?{...e.style,...O}:{...e.style,...O,left:f,top:v},P=i.createElement(m,{className:D,style:M,onClick:e=>null==h?void 0:h(e,d),onTouchStart:e=>{h&&l.UJ.onTouched(e,e=>{h(e,d)})},"data-port-entity-id":d.id,"data-port-entity-type":d.portType,"data-testid":"sdk.workflow.canvas.node.port"},i.createElement("div",{className:(0,a.Z)("bg-circle","workflow-bg-circle")}),i.createElement("div",{className:(0,a.Z)({bg:!0,"workflow-port-bg":!0,"workflow-point-bg":!0,hasError:S})},i.createElement(b,null)),i.createElement("div",{className:"focus-circle"}));return g?r.createPortal(P,g):P});function w(e,t){return{x:e.x-t.x+12,y:e.y-t.y+12}}function x(e,t,o){let n=function(e,t){switch(e){case"left":return{x:-t,y:0};case"right":return{x:t,y:0};case"bottom":return{x:0,y:t};case"top":return{x:0,y:-t}}}(t,o);return{x:e.x+n.x,y:e.y+n.y}}var L=d.ZP.div`
  position: absolute;

  @keyframes flowingDash {
    to {
      stroke-dashoffset: -13;
    }
  }

  .dashed-line {
    stroke-dasharray: 8, 5;
  }

  .flowing-line {
    animation: flowingDash 0.5s linear infinite;
  }
`;function N(e){let{id:t,pos:o,strokeWidth:n,location:r,hide:a}=e;if(a)return null;let s=function(e,t){switch(t){case"left":return`M ${e.x-6},${e.y-6} L ${e.x},${e.y} L ${e.x-6},${e.y+6}`;case"right":return`M ${e.x+6},${e.y+6} L ${e.x},${e.y} L ${e.x+6},${e.y-6}`;case"bottom":return`M ${e.x-6},${e.y+6} L ${e.x},${e.y} L ${e.x+6},${e.y+6}`;case"top":return`M ${e.x-6},${e.y-6} L ${e.x},${e.y} L ${e.x+6},${e.y-6}`}}(o,r);return i.createElement("path",{d:s,strokeLinecap:"round",stroke:`url(#${t})`,fill:"none",strokeWidth:n})}var S=(0,i.memo)(e=>{var t;let{line:o,color:n,selected:r,children:l,strokePrefix:d,rendererRegistry:h}=e,{position:u,reverse:c,hideArrow:g,vertical:p}=o,{bounds:f,path:y}=o.getData(s.ps),v=e=>({x:e.x-f.x+12,y:e.y-f.y+12}),m=v(u.from),b=x(v(u.to),u.to.location,o.uiState.shrink),E=x(m,u.from.location,o.uiState.shrink),w=r?o.uiState.strokeWidthSelected??3:o.uiState.strokeWidth??2,S=d?`${d}-${o.id}`:o.id,k=null==h||null==(t=h.tryToGetRendererComponent("arrow-renderer"))?void 0:t.renderer,C=i.createElement("path",{d:y,fill:"none",stroke:`url(#${S})`,strokeWidth:w,className:o.processing||o.flowing?"dashed-line flowing-line":""});return i.createElement(L,{className:(0,a.Z)("gedit-flow-activity-edge",o.className),style:{...o.uiState.style,left:f.x-12,top:f.y-12,position:"absolute"}},l,i.createElement("svg",{width:f.width+24,height:f.height+24},i.createElement("defs",null,i.createElement("linearGradient",{x1:p?"100%":"0%",y1:p?"0%":"100%",x2:"100%",y2:"100%",id:S,gradientUnits:"userSpaceOnUse"},i.createElement("stop",{stopColor:n,offset:"0%"}),i.createElement("stop",{stopColor:n,offset:"100%"}))),i.createElement("g",null,C,i.createElement(k||N,{id:S,pos:c?E:b,strokeWidth:w,location:c?u.from.location:u.to.location,hide:g,line:o}))))},(e,t)=>e.version===t.version),k=class extends l.mh{onZoom(e){this.node.style.transform=`scale(${e})`}onReady(){this.pipelineNode.appendChild(this.node),this.toDispose.pushAll([this.selectService.onSelectionChanged(()=>this.render()),this.hoverService.onHoveredChange(()=>this.render()),this.workflowDocument.linesManager.onForceUpdate(()=>{this.mountedLines.clear(),this.bumpVersion(),this.render()})])}dispose(){this.mountedLines.clear()}render(){let[,e]=(0,i.useState)({});(0,i.useLayoutEffect)(()=>{let t=requestAnimationFrame(()=>{let t=!1;this.lines.forEach(e=>{let o=e.getData(s.ps),n=o.renderVersion;o.update(),o.renderVersion!==n&&(t=!0)}),t&&e({})});return()=>cancelAnimationFrame(t)},[this.lines]);let t=this.lines.map(e=>this.renderLine(e));return i.createElement(i.Fragment,null,t)}bumpVersion(){this._version=this._version+1,this._version===Number.MAX_SAFE_INTEGER&&(this._version=0)}lineProps(e){let{lineType:t}=this.workflowDocument.linesManager,o=this.selectService.isSelected(e.id),n=this.hoverService.isHovered(e.id),r=this.lineVersion(e);return{key:e.id,color:e.color,selected:o,hovered:n,line:e,lineType:t,version:r,strokePrefix:this.layerID,rendererRegistry:this.rendererRegistry}}lineVersion(e){let{renderVersion:t}=e.getData(s.ps),o=this.selectService.isSelected(e.id),n=this.hoverService.isHovered(e.id),{version:r,color:i}=e;return`v:${this._version},lv:${r},rv:${t},c:${i},s:${o?"T":"F"},h:${n?"T":"F"}`}lineComponent(e){let t=this.options.renderInsideLine??(()=>i.createElement(i.Fragment,null));return i.createElement(S,{...e},i.createElement(t,{...e}))}renderLine(e){let t=this.lineProps(e),o=this.mountedLines.get(e.id),n=void 0!==o,{portal:i,version:a}=o??{};if(n&&a===t.version)return i;n||(this.renderElement.appendChild(e.node),e.onDispose(()=>{this.mountedLines.delete(e.id),e.node.remove()}));let s=r.createPortal(this.lineComponent(t),e.node);return this.mountedLines.set(e.id,{line:e,portal:s,version:t.version}),s}get renderElement(){return this.stackContext.node}constructor(){super(...arguments),this.layerID=(0,s.x0)(),this.mountedLines=new Map,this._version=0,this.node=u.xF.createDivWithClass("gedit-playground-layer gedit-flow-lines-layer")}};function C(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function D(e){let{location:t,x1:o,y1:n,x2:r,y2:i,curvature:a}=e;switch(t){case"left":return{x:o-C(o-r,a),y:n};case"right":return{x:o+C(r-o,a),y:n};case"top":return{x:o,y:n-C(n-i,a)};case"bottom":return{x:o,y:n+C(i-n,a)}}}k.type="WorkflowLinesLayer",v([(0,h.f3)(s.XH)],k.prototype,"hoverService",2),v([(0,h.f3)(s.oJ)],k.prototype,"selectService",2),v([(0,h.f3)(g.StackingContextManager)],k.prototype,"stackContext",2),v([(0,h.f3)(c.Rf)],k.prototype,"rendererRegistry",2),v([(0,l.RX)(s.e2)],k.prototype,"lines",2),v([(0,l.RX)(s.FD)],k.prototype,"ports",2),v([(0,l.aI)(s.CT,l.VO)],k.prototype,"trans",2),v([(0,h.f3)(s.L4)],k.prototype,"workflowDocument",2),k=v([(0,h.b2)()],k);var O=class{get path(){var e;return(null==(e=this.data)?void 0:e.path)??""}calcDistance(e){return this.data?u.E9.getDistance(e,this.data.bezier.project(e)):Number.MAX_SAFE_INTEGER}get bounds(){return this.data?this.data.bbox:u.Ae.EMPTY}get center(){var e;return null==(e=this.data)?void 0:e.center}update(e){this.data=this.calcBezier(e.fromPos,e.toPos)}calcBezier(e,t){let{controls:o,center:n}=function(e,t){var o,n,r,i;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.25,s=D({location:e.location,x1:e.x,y1:e.y,x2:t.x,y2:t.y,curvature:a}),l=D({location:t.location,x1:t.x,y1:t.y,x2:e.x,y2:e.y,curvature:a}),d=(o=e,n=t,r=s,i=l,{x:.125*o.x+.375*r.x+.375*i.x+.125*n.x,y:.125*o.y+.375*r.y+.375*i.y+.125*n.y});return{controls:[s,l],center:d}}(e,t,this.entity.uiState.curvature),r=new p.D([e,...o,t]),i=r.bbox(),a=new u.Ae(i.x.min,i.y.min,i.x.max-i.x.min,i.y.max-i.y.min),s=w(n,a),l=this.getPath({bbox:a,fromPos:e,toPos:t,controls:o});return this.data={fromPos:e,toPos:t,bezier:r,bbox:a,controls:o,path:l,center:{...n,labelX:s.x,labelY:s.y}},this.data}getPath(e){let{bbox:t}=e,o=w(e.fromPos,t),n=w(e.toPos,t),r=e.controls.map(e=>w(e,t)),i=this.entity.uiState.shrink,a=x(o,e.fromPos.location,i),s=x(n,e.toPos.location,i),l=r.map(e=>`${e.x} ${e.y}`).join(",");return`M${a.x} ${a.y} C ${l}, ${s.x} ${s.y}`}constructor(e){this.entity=e}};O.type=s.SP.BEZIER;var M=n||(n={});let P={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1}};M.getPoints=function(e){let t,o,{source:n,target:r}=e,i=P[n.location],a=P[r.location],s={x:n.x+20*i.x,y:n.y+20*i.y,location:n.location},l={x:r.x+20*a.x,y:r.y+20*a.y,location:r.location},d=(e=>{let{source:t,target:o}=e;return"left"===t.location||"right"===t.location?t.x<o.x?{x:1,y:0}:{x:-1,y:0}:t.y<o.y?{x:0,y:1}:{x:0,y:-1}})({source:s,target:l}),h=0!==d.x?"x":"y",u=d[h],c=[],[g,p]=function(e){let{source:t,target:o}=e,n=Math.abs(o.x-t.x)/2,r=o.x<t.x?o.x+n:o.x-n,i=Math.abs(o.y-t.y)/2;return[r,o.y<t.y?o.y+i:o.y-i]}({source:n,target:r});if(i[h]*a[h]==-1){t=g,o=p;let e=[{x:t,y:s.y},{x:t,y:l.y}],n=[{x:s.x,y:o},{x:l.x,y:o}];c=i[h]===u?"x"===h?e:n:"x"===h?n:e}else{let e=[{x:s.x,y:l.y}],n=[{x:l.x,y:s.y}];c="x"===h?i.x===u?n:e:i.y===u?e:n;let r="x"===h?"y":"x",d=i[h]===a[r],g=s[r]>l[r],p=s[r]<l[r];(1===i[h]&&(!d&&g||d&&p)||1!==i[h]&&(!d&&p||d&&g))&&(c="x"===h?e:n);let f={x:s.x,y:s.y},y={x:l.x,y:l.y};Math.max(Math.abs(f.x-c[0].x),Math.abs(y.x-c[0].x))>=Math.max(Math.abs(f.y-c[0].y),Math.abs(y.y-c[0].y))?(t=(f.x+y.x)/2,o=c[0].y):(t=c[0].x,o=(f.y+y.y)/2)}return{points:[n,{x:s.x,y:s.y},...c,{x:l.x,y:l.y},r],center:{x:t,y:o}}},M.getSmoothStepPath=function(e){return e.reduce((t,o,n)=>t+(n>0&&n<e.length-1?function(e,t,o){let n=Math.min(u.E9.getDistance(e,t)/2,u.E9.getDistance(t,o)/2,5),{x:r,y:i}=t;if(e.x===r&&r===o.x||e.y===i&&i===o.y)return`L${r} ${i}`;if(e.y===i){let t=e.x<o.x?-1:1,a=e.y<o.y?1:-1;return`L ${r+n*t},${i}Q ${r},${i} ${r},${i+n*a}`}let a=e.x<o.x?1:-1,s=e.y<o.y?-1:1;return`L ${r},${i+n*s}Q ${r},${i} ${r+n*a},${i}`}(e[n-1],o,e[n+1]):`${0===n?"M":"L"}${o.x} ${o.y}`),"")},M.getBounds=function(e){let t=e.map(e=>e.x),o=e.map(e=>e.y),n=Math.min(...t),r=Math.max(...t),i=Math.min(...o),a=Math.max(...o);return u.Ae.createRectangleWithTwoPoints({x:n,y:i},{x:r,y:a})},M.getFoldLineToPointDistance=(e,t)=>{if(0===e.length)return 1/0;if(1===e.length)return u.E9.getDistance(e[0],t);let o=[];for(let t=0;t<e.length-1;t++)o.push([e[t],e[t+1]]);return Math.min(...o.map(e=>{let[o,n]=e;return((e,t,o)=>{let n,r,{x:i,y:a}=e,{x:s,y:l}=t,{x:d,y:h}=o,u=d-s,c=h-l,g=u*u+c*c,p=0===g?-1:((i-s)*u+(a-l)*c)/g;p<0?(n=s,r=l):p>1?(n=d,r=h):(n=s+p*u,r=l+p*c);let f=i-n,y=a-r;return Math.sqrt(f*f+y*y)})(t,o,n)}))};var T=class{get path(){var e;return(null==(e=this.data)?void 0:e.path)??""}calcDistance(e){return this.data?n.getFoldLineToPointDistance(this.data.points,e):Number.MAX_SAFE_INTEGER}get bounds(){return this.data?this.data.bbox:new u.Ae}get center(){var e;return null==(e=this.data)?void 0:e.center}update(e){let{fromPos:t,toPos:o}=e,r=this.entity.uiState.shrink,i=x(t,t.location,r),a=x(o,o.location,r),{points:s,center:l}=n.getPoints({source:{...i,location:t.location},target:{...a,location:o.location}}),d=n.getBounds(s),h=s.map(e=>w(e,d)),u=n.getSmoothStepPath(h),c=w(l,d);this.data={points:s,path:u,bbox:d,center:{x:l.x,y:l.y,labelX:c.x,labelY:c.y}}}constructor(e){this.entity=e}};T.type=s.SP.LINE_CHART;var _=class{get path(){var e;return(null==(e=this.data)?void 0:e.path)??""}calcDistance(e){if(!this.data)return Number.MAX_SAFE_INTEGER;let[t,o]=this.data.points;return u.E9.getDistance(e,function(e,t,o){let n=o.x-t.x,r=o.y-t.y;if(0===n)return{x:t.x,y:e.y};if(0===r)return{x:e.x,y:t.y};let i=Math.max(0,Math.min(1,((e.x-t.x)*n+(e.y-t.y)*r)/(n*n+r*r)));return{x:t.x+i*n,y:t.y+i*r}}(e,t,o))}get bounds(){return this.data?this.data.bbox:new u.Ae}get center(){var e;return null==(e=this.data)?void 0:e.center}update(e){let{fromPos:t,toPos:o}=e,n=this.entity.uiState.shrink,r=[x(t,t.location,n),x(o,o.location,n)],i=u.Ae.createRectangleWithTwoPoints(r[0],r[1]),a=r.map(e=>({x:e.x-i.x+12,y:e.y-i.y+12})),l=`M ${a[0].x} ${a[0].y} L ${a[1].x} ${a[1].y}`;this.data={points:r,path:l,bbox:i,center:(0,s.KH)(t,o,i,12)}}constructor(e){this.entity=e}};_.type=s.SP.STRAIGHT;var R=(0,l.M1)({singleton:!0,onInit:(e,t)=>{e.playground.registerLayer(k,{...t})},onReady:(e,t)=>{let o=e.container.get(s.dm);o.registerContribution(O).registerContribution(T).registerContribution(_),t.contributions&&t.contributions.forEach(e=>{o.registerContribution(e)}),t.defaultLineType&&o.switchLineType(t.defaultLineType)}})},854343:function(e,t,o){o.r(t),o.d(t,{BASE_Z_INDEX:()=>g,StackingComputing:()=>c,StackingContextManager:()=>p,createFreeStackPlugin:()=>f});var n=o(893740),r=o(827656),i=o(9163),a=o(832176),s=o(336330),l=o(579962),d=Object.defineProperty,h=Object.getOwnPropertyDescriptor,u=(e,t,o,n)=>{for(var r,i=n>1?void 0:n?h(t,o):t,a=e.length-1;a>=0;a--)(r=e[a])&&(i=(n?r(t,o,i):r(i))||i);return n&&i&&d(t,o,i),i},c=class{compute(e){this.clearCache();let{root:t,nodes:o,context:n}=e;return this.context=n,this.nodeIndexes=this.computeNodeIndexesMap(o),this.selectedNodeParentSet=this.computeSelectedNodeParentSet(o),this.topLevel=this.computeTopLevel(o),this.maxLevel=2*this.topLevel,this.layerHandler(t.blocks),{nodeLevel:this.nodeLevel,lineLevel:this.lineLevel,topLevel:this.topLevel,maxLevel:this.maxLevel}}clearCache(){this.currentLevel=0,this.topLevel=0,this.maxLevel=0,this.nodeIndexes=new Map,this.nodeLevel=new Map,this.lineLevel=new Map}computeNodeIndexesMap(e){let t=new Map;return e.forEach((e,o)=>{t.set(e.id,o)}),t}computeSelectedNodeParentSet(e){return new Set(this.context.selectedNodes.flatMap(e=>this.getNodeParents(e)).map(e=>e.id))}getNodeParents(e){let t=[],o=e;for(;o&&o.flowNodeType!==l.Sy.ROOT;)t.unshift(o),o=o.parent;return t}computeTopLevel(e){let t=e.filter(e=>e.id!==l.Sy.ROOT),o=t.reduce((e,t)=>t.blocks.length>0?e+1:e,0);return t.length+o+1}layerHandler(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.sortNodes(e);this.getNodesAllLines(o).forEach(e=>{e.isDrawing||this.context.hoveredEntityID===e.id||this.context.selectedIDs.has(e.id)?this.lineLevel.set(e.id,this.maxLevel):this.lineLevel.set(e.id,this.getLevel(t))}),this.levelIncrease(),o.forEach(e=>{let o=this.context.selectedIDs.has(e.id);o?this.nodeLevel.set(e.id,this.topLevel):this.nodeLevel.set(e.id,this.getLevel(t)),this.levelIncrease(),e.blocks.length>0&&this.layerHandler(e.blocks,t||o)})}sortNodes(e){let t=e.sort((e,t)=>{let o=this.nodeIndexes.get(e.id),n=this.nodeIndexes.get(t.id);return void 0===o||void 0===n?0:o-n});return this.context.sortNodes(t).sort((e,t)=>{let o=this.selectedNodeParentSet.has(e.id),n=this.selectedNodeParentSet.has(t.id);return o&&!n?1:!o&&n?-1:0})}getNodesAllLines(e){return e.map(e=>{let t=e.getData(s.Z1);return[...t.outputLines.filter(Boolean),...t.inputLines.filter(Boolean)]}).flat().filter(e=>void 0===this.lineLevel.get(e.id)||this.isHigherFirstLine(e))}isHigherFirstLine(e){var t,o;return(null==(t=e.to)?void 0:t.parent)===e.from||(null==(o=e.from)?void 0:o.parent)===e.to}getLevel(e){return e?this.topLevel+this.currentLevel:this.currentLevel}levelIncrease(){this.currentLevel+=1}},g=8,p=class{init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options={...this.options,...e},this.pipelineRenderer.node.appendChild(this.node),this.mountListener()}ready(){this.compute()}dispose(){this.disposers.forEach(e=>e.dispose())}_compute(){let e=this.context,{nodeLevel:t,lineLevel:o}=new c().compute({root:this.document.root,nodes:this.nodes,context:e});this.nodes.forEach(e=>{let o=t.get(e.id),n=e.getData(l.Lz),r=n.node;if(r.style.position="absolute",void 0===o){n.stackIndex=0,r.style.zIndex="auto";return}n.stackIndex=o,r.style.zIndex=String(g+o)}),this.lines.forEach(e=>{let t=o.get(e.id),n=e.node;if(n.style.position="absolute",void 0===t){e.stackIndex=0,n.style.zIndex="auto";return}e.stackIndex=t,n.style.zIndex=String(g+t)})}get nodes(){return this.entityManager.getEntities(s.CT)}get lines(){return this.entityManager.getEntities(s.e2)}get context(){var e;return{hoveredEntityID:null==(e=this.hoverService.someHovered)?void 0:e.id,selectedNodes:this.selectService.selectedNodes,selectedIDs:new Set(this.selectService.selection.map(e=>e.id)),sortNodes:this.options.sortNodes}}mountListener(){let e=this.onEntityChange(),t=this.onZoom(),o=this.onHover(),n=this.onSelect();this.disposers=[e,t,o,n]}onZoom(){return this.pipelineRegistry.onZoom(e=>{this.node.style.transform=`scale(${e})`})}onHover(){return this.hoverService.onHoveredChange(()=>{this.compute()})}onEntityChange(){return this.entityManager.onEntityChange(()=>{this.compute()})}onSelect(){return this.selectService.onSelectionChanged(()=>{this.compute()})}constructor(){this.node=a.xF.createDivWithClass("gedit-playground-layer gedit-flow-render-layer"),this.options={sortNodes:e=>e},this.disposers=[],this.compute=(0,r.Z)(this._compute,10)}};u([(0,i.f3)(s.L4)],p.prototype,"document",2),u([(0,i.f3)(n.v2)],p.prototype,"entityManager",2),u([(0,i.f3)(n.Tj)],p.prototype,"pipelineRenderer",2),u([(0,i.f3)(n.Rm)],p.prototype,"pipelineRegistry",2),u([(0,i.f3)(s.XH)],p.prototype,"hoverService",2),u([(0,i.f3)(s.oJ)],p.prototype,"selectService",2),p=u([(0,i.b2)()],p);var f=(0,n.M1)({singleton:!0,onBind(e){let{bind:t}=e;t(p).toSelf().inSingletonScope()},onInit(e,t){e.get(p).init(t)},onReady(e){e.get(p).ready()},onDispose(e){e.get(p).dispose()}})}}]);