"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["102767"],{491470:function(e,n,r){r.r(n),r.d(n,{default:()=>o});var s=r(110239),i=r(437562),a=r(321896),t=r(852271);function l(e){let n={a:"a",code:"code",div:"div",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"validatewhenvariablesync",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#validatewhenvariablesync",children:"#"}),"validateWhenVariableSync"]}),"\n",(0,s.jsxs)(n.p,{children:["When accessible variables of a field change, re-trigger validation for the specified ",(0,s.jsx)(n.strong,{children:"error fields"}),"."]}),"\n",(0,s.jsxs)(n.div,{className:"rspress-directive note",children:[(0,s.jsx)(n.div,{className:"rspress-directive-title",children:"Why error fields?"}),(0,s.jsxs)(n.div,{className:"rspress-directive-content",children:[(0,s.jsx)(n.p,{children:"Error messages for error fields may be derived from the validity of variable references."}),(0,s.jsxs)(n.p,{children:["If the ",(0,s.jsx)(n.strong,{children:"accessible variables of a field change, making the variable references of the field change from invalid to valid"}),", there's a need to re-validate the current field to clear previous error messages."]})]})]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Before Introduction"}),(0,s.jsx)(n.th,{children:"After Introduction"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)("img",{loading:"lazy",src:"/materials/validate-when-variable-sync-without-effect.gif",alt:"syncVariableTitle not introduced",style:{width:500}})," ",(0,s.jsx)(n.em,{children:"Variable changes from invalid to valid, error message persists"})]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)("img",{loading:"lazy",src:"/materials/validate-when-variable-sync-with-effect.gif",alt:"syncVariableTitle introduced",style:{width:500}})," ",(0,s.jsx)(n.em,{children:"Variable changes from invalid to valid, error message automatically cleared"})]})]})})]}),"\n",(0,s.jsxs)(n.h2,{id:"example-demonstration",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#example-demonstration",children:"#"}),"Example Demonstration"]}),"\n",(0,s.jsxs)(n.h3,{id:"basic-usage",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#basic-usage",children:"#"}),"Basic Usage"]}),"\n",(0,s.jsx)(t.w,{}),"\n",(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(n.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",title:"form-meta.tsx",children:(0,s.jsxs)(n.code,{className:"language-tsx",children:[(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" formMeta"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  effect"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    value"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" validateWhenVariableSync"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"()"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  validate"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"    value"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ({ value"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" context }) "}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"      validateFlowValue"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(value"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        node"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" context"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".node"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        errorMessages"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"          unknownVariable"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'Unknown Variable'"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        }"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"      })"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"};"})})]})})}),"\n",(0,s.jsxs)(n.h2,{id:"api-reference",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#api-reference",children:"#"}),"API Reference"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"validateWhenVariableSync(options?: { scope?: 'private' | 'public' })"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Default Value"}),(0,s.jsx)(n.th,{children:"Required"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"options.scope"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'private' | 'public'"})}),(0,s.jsx)(n.td,{children:"Variable scope type, specifies whether to listen for changes in private or public variables"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"No"})]})})]}),"\n",(0,s.jsxs)(n.h2,{id:"source-code-guide",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#source-code-guide",children:"#"}),"Source Code Guide"]}),"\n",(0,s.jsx)(a.ZB,{href:"https://github.com/bytedance/flowgram.ai/tree/main/packages/materials/form-materials/src/effects/validate-when-variable-sync/index.ts"}),"\n",(0,s.jsx)(n.p,{children:"Use the CLI command to copy the source code to local:"}),"\n",(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(n.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,s.jsx)(n.code,{className:"language-bash",children:(0,s.jsxs)(n.span,{className:"line",children:[(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"npx"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:" @flowgram.ai/cli@latest"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:" materials"}),(0,s.jsx)(n.span,{style:{color:"var(--shiki-token-string)"},children:" effects/validate-when-variable-sync"})]})})})}),"\n",(0,s.jsxs)(n.h3,{id:"directory-structure",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#directory-structure",children:"#"}),"Directory Structure"]}),"\n",(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(n.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,s.jsxs)(n.code,{className:"language-txt",children:[(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{children:"packages/materials/form-materials/src/effects/validate-when-variable-sync/"})}),"\n",(0,s.jsx)(n.span,{className:"line",children:(0,s.jsx)(n.span,{children:"└── index.ts           # Core implementation and export"})})]})})}),"\n",(0,s.jsxs)(n.h3,{id:"core-implementation-explanation",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#core-implementation-explanation",children:"#"}),"Core Implementation Explanation"]}),"\n",(0,s.jsx)(n.p,{children:"This effect automatically triggers validation for error fields by listening to changes in accessible variables of the field, ensuring that error messages are cleared promptly when variable references change from invalid to valid."}),"\n",(0,s.jsx)(n.p,{children:"Main process:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Listen for form initialization event ",(0,s.jsx)(n.code,{children:"DataEvent.onValueInit"})]}),"\n",(0,s.jsx)(n.li,{children:"Get the corresponding node scope (private or public) based on configuration"}),"\n",(0,s.jsxs)(n.li,{children:["Listen to the variable change event in the scope ",(0,s.jsx)(n.code,{children:"available.onListOrAnyVarChange"})]}),"\n",(0,s.jsx)(n.li,{children:"When variables change, filter out error fields that include the current field name"}),"\n",(0,s.jsx)(n.li,{children:"Re-validate the filtered error fields"}),"\n",(0,s.jsx)(n.li,{children:"Return a cleanup function to release event listeners"}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"dependency-overview",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#dependency-overview",children:"#"}),"Dependency Overview"]}),"\n",(0,s.jsxs)(n.h4,{id:"flowgram-api",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#flowgram-api",children:"#"}),"flowgram API"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/bytedance/flowgram.ai/tree/main/packages/variable-engine/variable-core",rel:"noopener noreferrer",target:"_blank",children:(0,s.jsx)(n.strong,{children:"@flowgram.ai/variable-core"})})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"scope.available.onListOrAnyVarChange"}),": Listen for changes in available variables in the scope"]}),"\n"]})]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["en%2Fmaterials%2Feffects%2Fvalidate-when-variable-sync.mdx"]={toc:[{id:"example-demonstration",text:"Example Demonstration",depth:2},{id:"basic-usage",text:"Basic Usage",depth:3},{id:"api-reference",text:"API Reference",depth:2},{id:"source-code-guide",text:"Source Code Guide",depth:2},{id:"directory-structure",text:"Directory Structure",depth:3},{id:"core-implementation-explanation",text:"Core Implementation Explanation",depth:3},{id:"dependency-overview",text:"Dependency Overview",depth:3},{id:"flowgram-api",text:"flowgram API",depth:4}],title:"validateWhenVariableSync",headingTitle:"validateWhenVariableSync",frontmatter:{}}},852271:function(e,n,r){r.d(n,{w:()=>h});var s=r(110239),i=r(908600),a=r(640898),t=r(183173),l=r(38643),o=r(653378),c=r(132288);let d=i.lazy(()=>Promise.all([r.e("386212"),r.e("227692"),r.e("135674"),r.e("942362"),r.e("254129"),r.e("260790"),r.e("46854"),r.e("795751"),r.e("735347")]).then(r.bind(r,929024)).then(e=>({default:e.DynamicValueInput}))),h=()=>(0,s.jsx)(c.y,{filterEndNode:!0,transformInitialNode:{custom_0:e=>(e.data.value={type:"ref",content:["start_0","query"]},e)},formMeta:{effect:{value:(0,t.S)()},validate:{value:e=>{let{value:n,context:r}=e;return(0,l.W)(n,{node:r.node,errorMessages:{unknownVariable:"Unknown Variable"}})}},render:e=>{let{form:n}=e;return(0,i.useEffect)(()=>{n.validate()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.p,{}),(0,s.jsx)("b",{children:"Add 'query' in Start"}),(0,s.jsx)(a.gNt,{name:"value",children:e=>{var n;let{field:r,fieldState:i}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d,{value:r.value,onChange:e=>r.onChange(e)}),(0,s.jsx)("span",{style:{color:"red"},children:null==(n=i.errors)?void 0:n.map(e=>e.message).join("\n")})]})}}),(0,s.jsx)("br",{}),(0,s.jsx)(o.Button,{onClick:()=>n.validate(),children:"Trigger Validate"})]})}}})},132288:function(e,n,r){r.d(n,{p:()=>t,y:()=>l});var s=r(110239),i=r(908600);let a=i.lazy(()=>Promise.all([r.e("386212"),r.e("717802"),r.e("234079"),r.e("633566"),r.e("688975"),r.e("133914"),r.e("227692"),r.e("135674"),r.e("254129"),r.e("475509"),r.e("541460"),r.e("428647"),r.e("260790"),r.e("46854"),r.e("787220")]).then(r.bind(r,654296)).then(e=>({default:e.FreeFormMetaStoryBuilder}))),t=i.lazy(()=>Promise.all([r.e("386212"),r.e("717802"),r.e("234079"),r.e("633566"),r.e("688975"),r.e("133914"),r.e("227692"),r.e("135674"),r.e("254129"),r.e("475509"),r.e("541460"),r.e("428647"),r.e("260790"),r.e("46854"),r.e("787220")]).then(r.bind(r,654296)).then(e=>({default:e.FormHeader}))),l=e=>(0,s.jsx)("div",{style:{position:"relative",height:e.height||400},children:(0,s.jsx)(a,{...e})})},183173:function(e,n,r){r.d(n,{S:()=>i});var s=r(950454);let i=function(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{event:s.zEJ.onValueInit,effect:n=>{let{context:r,form:i,name:a}=n,t=("private"===e?(0,s.u$R)(r.node):(0,s.k6H)(r.node)).available.onListOrAnyVarChange(()=>{Object.entries(i.state.errors||{}).filter(e=>{let[n,r]=e;return(null==r?void 0:r.length)>0}).filter(e=>{let[n]=e;return n.startsWith(a)||a.startsWith(n)}).map(e=>{let[n]=e;return n}).length>0&&i.validate()});return()=>t.dispose()}}]}},687252:function(e,n,r){r.d(n,{U:()=>s});var s,i=r(111886),a=r(13721),t=r(721855),l=r(325486),o=r(937643),c=r(123387);let d=c.ZP.object({index:c.ZP.number().optional()}).optional(),h=c.ZP.object({type:c.ZP.literal("constant"),content:c.ZP.any().optional(),schema:c.ZP.any().optional(),extra:d}),p=c.ZP.object({type:c.ZP.literal("ref"),content:c.ZP.array(c.ZP.string()).optional(),extra:d}),u=c.ZP.object({type:c.ZP.literal("expression"),content:c.ZP.string().optional(),extra:d}),x=c.ZP.object({type:c.ZP.literal("template"),content:c.ZP.string().optional(),extra:d});!function(e){function n(e){return h.safeParse(e).success}function r(e){return p.safeParse(e).success}function s(e){return u.safeParse(e).success}function c(e){return x.safeParse(e).success}function d(e){return(null==e?void 0:e.schema)?e.schema:"string"==typeof e.content?{type:"string"}:"number"==typeof e.content?{type:"number"}:"boolean"==typeof e.content?{type:"boolean"}:(0,l.Z)(e.content)?{type:"object"}:void 0}e.isConstant=n,e.isRef=r,e.isExpression=s,e.isTemplate=c,e.isConstantOrRef=function(e){return n(e)||r(e)},e.isFlowValue=function(e){return n(e)||r(e)||s(e)||c(e)},e.traverse=function* e(t,l){let{includeTypes:o=["ref","template","expression","constant"],path:d="",pathArr:h=[]}=l||{};if((0,i.Z)(t)){if(r(t)&&o.includes("ref")||c(t)&&o.includes("template")||s(t)&&o.includes("expression")||n(t)&&o.includes("constant"))return void(yield{value:t,path:d,pathArr:h});for(let[n,r]of Object.entries(t))yield*e(r,{...l,path:d?`${d}.${n}`:n,pathArr:[...h,n]});return}if((0,a.Z)(t))for(let[n,r]of t.entries())yield*e(r,{...l,path:d?`${d}[${n}]`:`[${n}]`,pathArr:[...h,`[${n}]`]})},e.getTemplateKeyPaths=function(e){var n;return(0,t.Z)((null==(n=e.content)?void 0:n.match(/\{\{([^\}\{]+)\}\}/g))||[]).map(e=>e.slice(2,-2).split("."))},e.inferConstantJsonSchema=d,e.inferJsonSchema=function e(s,a){if((0,i.Z)(s)){if(n(s))return d(s);if(r(s)){let e=a.available.getByKeyPath(null==s?void 0:s.content);return(null==e?void 0:e.type)?o.Kz.astToSchema(null==e?void 0:e.type):void 0}return c(s)?{type:"string"}:{type:"object",properties:Object.keys(s).reduce((n,r)=>{let i=e(s[r],a);return i&&(n[r]=i),n},{})}}}}(s||(s={}))},38643:function(e,n,r){r.d(n,{W:()=>t});var s=r(863875),i=r(950454),a=r(687252);function t(e,n){let{node:r,required:t,errorMessages:l}=n,{required:o="Field is required",unknownVariable:c="Unknown Variable"}=l||{};if(t&&((0,s.Z)(e)||(0,s.Z)(null==e?void 0:e.content)||(null==e?void 0:e.content)===""))return{level:i.Odm.Error,message:o};if((null==e?void 0:e.type)==="ref"&&!(0,i.k6H)(r).available.getByKeyPath((null==e?void 0:e.content)||[]))return{level:i.Odm.Error,message:c};if((null==e?void 0:e.type)==="template"){for(let n of a.U.getTemplateKeyPaths(e))if(!(0,i.k6H)(r).available.getByKeyPath(n))return{level:i.Odm.Error,message:c}}}}}]);