"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["578935"],{592087:function(e,s,n){n.r(s),n.d(s,{default:()=>c});var r=n(110239),i=n(437562),l=n(441332),o=n(944529),a=n(491898);function t(e){let s={a:"a",code:"code",div:"div",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.h1,{id:"inferinputsplugin",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#inferinputsplugin",children:"#"}),"inferInputsPlugin"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"inferInputsPlugin"}),"是一个用于",(0,r.jsx)(s.strong,{children:"自动推断输入参数 JSON Schema 的表单插件"}),"，它能",(0,r.jsx)(s.strong,{children:"在数据传送到后端运行时前"}),"，根据 IFlowValue 类型 (常量或变量引用) 自动生成对应的 JSON Schema 结构，为后端的运行时类型验证和后端接口提供类型信息。"]}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)("div",{children:[(0,r.jsx)("img",{loading:"lazy",src:"/materials/infer-inputs-plugin.png",alt:"Schema 推断",style:{width:"75%"}}),(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:"传到后端运行时时，inputs 字段的 JSON Schema 根据 inputsValues 中的值定义推导"})})]}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive tip",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"适用场景"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"HTTP 节点"}),"：推断请求头 (headers)、查询参数 (params) 的 Schema"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"代码节点"}),"：推断代码输入参数的类型结构"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"函数调用节点"}),"：推断函数参数的 Schema"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"任何接受动态输入的节点"}),"：需要为后端提供输入类型信息"]}),"\n"]})})]}),"\n",(0,r.jsxs)(s.h2,{id:"案例演示",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#案例演示",children:"#"}),"案例演示"]}),"\n",(0,r.jsxs)(s.h3,{id:"基本使用",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#基本使用",children:"#"}),"基本使用"]}),"\n",(0,r.jsxs)(s.h3,{id:"基本使用-1",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#基本使用-1",children:"#"}),"基本使用"]}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive tip",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"TIP"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsx)(s.p,{children:"点开 demo 右上角的 Debug 面板，查看传到后端的 JSON 数据"})})]}),"\n",(0,r.jsx)(a.w,{}),"\n",(0,r.jsx)(s.p,{children:"推断 HTTP 请求的 headers 和 body 的 Schema:"}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",title:"form-meta.tsx",children:(0,r.jsxs)(s.code,{className:"language-tsx",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" { createInferInputsPlugin"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" InputsValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" InputsValuesTree } "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" '@flowgram.ai/form-materials'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" { Field } "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" '@flowgram.ai/editor'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsx)(s.span,{className:"line"}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" HttpFormRender"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" ({ form }) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"  return"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" ("})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    <>"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"      <"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"FormHeader"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" />"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"      <"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"FormContent"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"        <"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"<"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Record"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"<"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" IFlowValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">> "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"name"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"headersValues"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"          {({ field }) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" ("})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"            <"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"InputsValues"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"              value"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"{"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:".value}"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"              onChange"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"{(val) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".onChange"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"(val)}"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"            />"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"          )}"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"        </"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"        <"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"<"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Record"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"<"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" IFlowValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">> "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"name"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"bodyValues"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"          {({ field }) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" ("})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"            <"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"InputsValuesTree"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"              value"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"{"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:".value}"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"              onChange"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"{(val) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".onChange"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"(val)}"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"            />"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"          )}"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"        </"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Field"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"      </"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"FormContent"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    </>"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  );"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"};"})}),"\n",(0,r.jsx)(s.span,{className:"line"}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" formMeta"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" FormMeta"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  render"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" HttpFormRender"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  plugins"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" ["})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"    // 推断 headers 的 Schema"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"    createInferInputsPlugin"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"      sourceKey"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'headersValues'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"      targetKey"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'headersSchema'"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    })"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"    // 推断 body 的 Schema"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"    createInferInputsPlugin"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"      sourceKey"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'bodyValues'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"      targetKey"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'bodySchema'"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    })"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  ]"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"};"})})]})})}),"\n",(0,r.jsxs)(s.h2,{id:"api-参考",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#api-参考",children:"#"}),"API 参考"]}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-typescript",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" createInferInputsPlugin"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"(options"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  sourceKey"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  targetKey"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  scope"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?:"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'private'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" |"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'public'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"  ignoreConstantSchema"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?:"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" boolean"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"})"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" FormPlugin"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]})]})})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"属性名"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"类型"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"默认值"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"说明"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"sourceKey"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"-"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"表单中存储输入值的字段路径，值类型为包含 IFlowValue 的对象或数组"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"targetKey"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"-"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"推断的 JSON Schema 存储位置的字段路径"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"scope"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"'private' | 'public'"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"public"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"指定用于变量解析的作用域类型"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"ignoreConstantSchema"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"boolean"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"false"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"是否在提交时剥离常量值的 Schema(仅保留变量引用的 Schema)"})]})]})]}),"\n",(0,r.jsxs)(s.h2,{id:"源码导读",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#源码导读",children:"#"}),"源码导读"]}),"\n",(0,r.jsx)(o.ZB,{href:"https://github.com/bytedance/flowgram.ai/tree/main/packages/materials/form-materials/src/form-plugins/infer-inputs-plugin/index.ts"}),"\n",(0,r.jsx)(s.p,{children:"使用 CLI 命令可以复制源代码到本地："}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,r.jsx)(s.code,{className:"language-bash",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"npx"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:" @flowgram.ai/cli@latest"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:" materials"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:" form-plugins/infer-inputs-plugin"})]})})})}),"\n",(0,r.jsxs)(s.h3,{id:"目录结构讲解",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#目录结构讲解",children:"#"}),"目录结构讲解"]}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-plaintext",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{children:"infer-inputs-plugin/"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{children:"└── index.tsx  # 插件完整实现，包含 Schema 推断和双向转换逻辑"})})]})})}),"\n",(0,r.jsxs)(s.h3,{id:"核心实现说明",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#核心实现说明",children:"#"}),"核心实现说明"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"inferInputsPlugin"})," 的核心功能是从 IFlowValue 对象推断 JSON Schema。对于常量值，直接使用其 ",(0,r.jsx)(s.code,{children:"schema"})," 字段；对于变量引用，从作用域中查询变量类型；对于表达式和模板，推断为相应的基础类型。插件还支持 ",(0,r.jsx)(s.code,{children:"ignoreConstantSchema"})," 优化，在提交时剥离常量 Schema，在初始化时自动恢复。"]}),"\n",(0,r.jsxs)(s.h4,{id:"工作流程时序图",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#工作流程时序图",children:"#"}),"工作流程时序图"]}),"\n",(0,r.jsx)(l.Z,{code:"sequenceDiagram\n    participant Form as 表单\n    participant Plugin as inferInputsPlugin\n    participant Scope as 变量作用域\n    participant Backend as 后端\n\n    Note over Form: 表单提交\n    Form->>Plugin: onSubmit 触发\n    Plugin->>Plugin: 读取 sourceKey 数据\n\n    loop 遍历每个 IFlowValue\n        alt 类型为 constant\n            Plugin->>Plugin: 使用 value.schema\n            opt ignoreConstantSchema = true\n                Plugin->>Plugin: 剥离 schema\n            end\n        else 类型为 ref\n            Plugin->>Scope: 查询变量类型\n            Scope->>Plugin: 返回变量 Schema\n        else 类型为 expression/template\n            Plugin->>Plugin: 推断为 any/string 类型\n        end\n    end\n\n    Plugin->>Plugin: 合并所有 Schema\n    Plugin->>Form: 设置到 targetKey\n    Form->>Backend: 提交包含 Schema 的数据\n\n    Note over Form: 表单初始化\n    Backend->>Form: 返回数据(可能缺少常量 Schema)\n    Form->>Plugin: onInit 触发\n    opt ignoreConstantSchema = true\n        Plugin->>Plugin: 从 sourceKey 恢复常量 Schema\n        Plugin->>Form: 更新 targetKey\n    end",config:{}}),"\n",(0,r.jsx)(s.p,{children:"核心功能特点："}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"自动 Schema 推断"}),"：扫描表单数据中的 IFlowValue 对象，自动推断其 JSON Schema"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"变量类型解析"}),"：对于变量引用，从作用域中解析变量的实际类型"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"常量 Schema 优化"}),"：可选地在提交时剥离常量的 Schema，减少后端数据负载"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"双向转换"}),"：在表单初始化时恢复 Schema，在表单提交时生成 Schema"]}),"\n"]}),"\n",(0,r.jsxs)(s.h3,{id:"依赖梳理",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#依赖梳理",children:"#"}),"依赖梳理"]}),"\n",(0,r.jsxs)(s.h4,{id:"flowgram-api",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#flowgram-api",children:"#"}),"flowgram API"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/bytedance/flowgram.ai/tree/main/packages/client/editor",rel:"noopener noreferrer",target:"_blank",children:(0,r.jsx)(s.strong,{children:"@flowgram.ai/editor"})})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"defineFormPluginCreator"}),": 定义表单插件的工厂函数"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"FormPlugin"}),": 表单插件类型定义"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"FormPluginSetupMetaCtx"}),": 插件设置上下文，提供 ",(0,r.jsx)(s.code,{children:"addFormatOnInit"}),"、",(0,r.jsx)(s.code,{children:"addFormatOnSubmit"})," 方法"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/bytedance/flowgram.ai/tree/main/packages/variable-engine/variable-core",rel:"noopener noreferrer",target:"_blank",children:(0,r.jsx)(s.strong,{children:"@flowgram.ai/variable-core"})})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/bytedance/flowgram.ai/tree/main/packages/variable-engine/json-schema",rel:"noopener noreferrer",target:"_blank",children:(0,r.jsx)(s.strong,{children:"@flowgram.ai/json-schema"})})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IJsonSchema"}),": JSON Schema 类型定义"]}),"\n"]}),"\n",(0,r.jsxs)(s.h4,{id:"依赖的其他物料",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#依赖的其他物料",children:"#"}),"依赖的其他物料"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"/materials/common/flow-value.html",children:(0,r.jsx)(s.strong,{children:"FlowValue"})})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"FlowValueUtils.inferJsonSchema()"}),": 推断 IFlowValue 的 JSON Schema"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"FlowValueUtils.traverse()"}),": 遍历嵌套的 FlowValue 结构"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"FlowValueUtils.isConstant()"}),", ",(0,r.jsx)(s.code,{children:"FlowValueUtils.isRef()"}),": 类型判断工具"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IFlowValue"}),": Flow 值的联合类型"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IFlowConstantValue"}),": 常量类型，包含 ",(0,r.jsx)(s.code,{children:"schema"})," 字段"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IFlowRefValue"}),": 变量引用类型，包含变量路径"]}),"\n"]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["zh%2Fmaterials%2Fform-plugins%2Finfer-inputs-plugin.mdx"]={toc:[{id:"案例演示",text:"案例演示",depth:2},{id:"基本使用",text:"基本使用",depth:3},{id:"基本使用-1",text:"基本使用",depth:3},{id:"api-参考",text:"API 参考",depth:2},{id:"源码导读",text:"源码导读",depth:2},{id:"目录结构讲解",text:"目录结构讲解",depth:3},{id:"核心实现说明",text:"核心实现说明",depth:3},{id:"工作流程时序图",text:"工作流程时序图",depth:4},{id:"依赖梳理",text:"依赖梳理",depth:3},{id:"flowgram-api",text:"flowgram API",depth:4},{id:"依赖的其他物料",text:"依赖的其他物料",depth:4}],title:"inferInputsPlugin",headingTitle:"inferInputsPlugin",frontmatter:{}}},491898:function(e,s,n){n.d(s,{w:()=>h});var r=n(110239),i=n(908600),l=n(640898),o=n(401255),a=n(132288);let t=i.lazy(()=>Promise.all([n.e("386212"),n.e("133914"),n.e("227692"),n.e("933451"),n.e("942362"),n.e("135691"),n.e("46854"),n.e("232558"),n.e("673693"),n.e("564864")]).then(n.bind(n,261548)).then(e=>({default:e.InputsValues}))),c=i.lazy(()=>Promise.all([n.e("386212"),n.e("133914"),n.e("227692"),n.e("933451"),n.e("942362"),n.e("135691"),n.e("46854"),n.e("232558"),n.e("673693"),n.e("564864")]).then(n.bind(n,261548)).then(e=>({default:e.InputsValuesTree}))),h=()=>(0,r.jsx)(a.y,{filterEndNode:!0,height:500,formMeta:{render:()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.p,{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{children:"Headers"}),(0,r.jsx)(l.gNt,{name:"headersValues",defaultValue:{"Content-Type":{type:"constant",content:"application/json",schema:{type:"string"}},Authorization:{type:"ref",content:["start_0","str"]}},children:e=>{let{field:s}=e;return(0,r.jsx)(t,{value:s.value,onChange:e=>s.onChange(e)})}})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{children:"Body"}),(0,r.jsx)(l.gNt,{name:"bodyValues",defaultValue:{page:{index:{type:"ref",content:["start_0","obj","obj2","num"]},size:{type:"constant",content:10,schema:{type:"number"}}},query:{type:"ref",content:["start_0","obj"]}},children:e=>{let{field:s}=e;return(0,r.jsx)(c,{value:s.value,onChange:e=>s.onChange(e)})}})]})]})]}),plugins:[(0,o.k)({sourceKey:"headersValues",targetKey:"headersSchema"}),(0,o.k)({sourceKey:"bodyValues",targetKey:"bodySchema"})]}})},132288:function(e,s,n){n.d(s,{p:()=>o,y:()=>a});var r=n(110239),i=n(908600);let l=i.lazy(()=>Promise.all([n.e("386212"),n.e("133914"),n.e("227692"),n.e("933451"),n.e("917828"),n.e("428647"),n.e("135691"),n.e("46854"),n.e("690536")]).then(n.bind(n,654296)).then(e=>({default:e.FreeFormMetaStoryBuilder}))),o=i.lazy(()=>Promise.all([n.e("386212"),n.e("133914"),n.e("227692"),n.e("933451"),n.e("917828"),n.e("428647"),n.e("135691"),n.e("46854"),n.e("690536")]).then(n.bind(n,654296)).then(e=>({default:e.FormHeader}))),a=e=>(0,r.jsx)("div",{style:{position:"relative",height:e.height||400},children:(0,r.jsx)(l,{...e})})},401255:function(e,s,n){n.d(s,{k:()=>h});var r=n(969134),i=n(383909),l=n(492320),o=n(631952),a=n(950454),t=n(687252);let{produce:c}=new o.Ve({autoFreeze:!1}),h=(0,a.CR5)({onSetupFormMeta(e,s){let{addFormatOnSubmit:n,addFormatOnInit:o}=e,{sourceKey:h,targetKey:d,scope:x,ignoreConstantSchema:p}=s;h&&d&&(n((e,s)=>c(e,n=>{let o=(0,r.Z)(e,h);if((0,i.Z)(n,d,t.U.inferJsonSchema(o,"private"===x?(0,a.u$R)(s.node):(0,a.k6H)(s.node))),p)for(let{value:s,path:n}of t.U.traverse(o,{includeTypes:["constant"]}))t.U.isConstant(s)&&(null==s?void 0:s.schema)&&(0,i.Z)(e,`${h}.${n}`,(0,l.Z)(s,["schema"]))})),p&&o((e,s)=>{let n=(0,r.Z)(e,d);if(!n)return e;for(let{value:s,pathArr:l}of t.U.traverse((0,r.Z)(e,h),{includeTypes:["constant"]}))if(t.U.isConstant(s)&&!(null==s?void 0:s.schema)){let e=l.map(e=>`properties.${e}`).join("."),o=(0,r.Z)(n,e);o&&(0,i.Z)(s,"schema",o)}return e}))}})},687252:function(e,s,n){n.d(s,{U:()=>r});var r,i=n(111886),l=n(13721),o=n(721855),a=n(325486),t=n(937643),c=n(123387);let h=c.ZP.object({index:c.ZP.number().optional()}).optional(),d=c.ZP.object({type:c.ZP.literal("constant"),content:c.ZP.any().optional(),schema:c.ZP.any().optional(),extra:h}),x=c.ZP.object({type:c.ZP.literal("ref"),content:c.ZP.array(c.ZP.string()).optional(),extra:h}),p=c.ZP.object({type:c.ZP.literal("expression"),content:c.ZP.string().optional(),extra:h}),j=c.ZP.object({type:c.ZP.literal("template"),content:c.ZP.string().optional(),extra:h});!function(e){function s(e){return d.safeParse(e).success}function n(e){return x.safeParse(e).success}function r(e){return p.safeParse(e).success}function c(e){return j.safeParse(e).success}function h(e){return(null==e?void 0:e.schema)?e.schema:"string"==typeof e.content?{type:"string"}:"number"==typeof e.content?{type:"number"}:"boolean"==typeof e.content?{type:"boolean"}:(0,a.Z)(e.content)?{type:"object"}:void 0}e.isConstant=s,e.isRef=n,e.isExpression=r,e.isTemplate=c,e.isConstantOrRef=function(e){return s(e)||n(e)},e.isFlowValue=function(e){return s(e)||n(e)||r(e)||c(e)},e.traverse=function* e(o,a){let{includeTypes:t=["ref","template","expression","constant"],path:h="",pathArr:d=[]}=a||{};if((0,i.Z)(o)){if(n(o)&&t.includes("ref")||c(o)&&t.includes("template")||r(o)&&t.includes("expression")||s(o)&&t.includes("constant"))return void(yield{value:o,path:h,pathArr:d});for(let[s,n]of Object.entries(o))yield*e(n,{...a,path:h?`${h}.${s}`:s,pathArr:[...d,s]});return}if((0,l.Z)(o))for(let[s,n]of o.entries())yield*e(n,{...a,path:h?`${h}[${s}]`:`[${s}]`,pathArr:[...d,`[${s}]`]})},e.getTemplateKeyPaths=function(e){var s;return(0,o.Z)((null==(s=e.content)?void 0:s.match(/\{\{([^\}\{]+)\}\}/g))||[]).map(e=>e.slice(2,-2).split("."))},e.inferConstantJsonSchema=h,e.inferJsonSchema=function e(r,l){if((0,i.Z)(r)){if(s(r))return h(r);if(n(r)){let e=l.available.getByKeyPath(null==r?void 0:r.content);return(null==e?void 0:e.type)?t.Kz.astToSchema(null==e?void 0:e.type):void 0}return c(r)?{type:"string"}:{type:"object",properties:Object.keys(r).reduce((s,n)=>{let i=e(r[n],l);return i&&(s[n]=i),s},{})}}}}(r||(r={}))},383909:function(e,s,n){n.d(s,{Z:()=>i});var r=n(221145);let i=function(e,s,n){return null==e?e:(0,r.Z)(e,s,n)}}}]);