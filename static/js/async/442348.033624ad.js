"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["442348"],{649414:function(e,t,i){i.r(t),i.d(t,{fieldWrapperCss:()=>m,DEFAULT_FORM_META:()=>c,FieldTitle:()=>d,DEFAULT_DEMO_REGISTRY:()=>g,DEFAULT_INITIAL_DATA:()=>p,defaultInitialDataTs:()=>E,fieldWrapperTs:()=>y,Editor:()=>f,FieldWrapper:()=>u});var r=i(110239),n=i(640898),o=i(908600),s=i(330893),a=i(773898),l=i(245803),h=i(261513);let d=h.ZP.div`
  padding-bottom: 4px;
`;i(695496);let u=e=>{let{required:t,title:i,children:n,error:o,note:s}=e;return(0,r.jsxs)("div",{className:"field-wrapper",children:[(0,r.jsxs)("div",{className:"field-title",children:[i,s?(0,r.jsx)("p",{className:"field-note",children:s}):null,t?(0,r.jsx)("span",{className:"required",children:"*"}):null]}),n,(0,r.jsx)("p",{className:"error-message",children:o}),s?(0,r.jsx)("br",{}):null]})},c={render:()=>(0,r.jsxs)("div",{className:"demo-node-content",children:[(0,r.jsx)("div",{className:"demo-node-title",children:"Basic Node"}),(0,r.jsx)(n.gNt,{name:"name",children:e=>{var t,i;let{field:n,fieldState:o}=e;return(0,r.jsx)(u,{required:!0,title:"Name",error:null==(i=o.errors)||null==(t=i[0])?void 0:t.message,children:(0,r.jsx)(l.II,{size:"small",...n})})}}),(0,r.jsx)(n.gNt,{name:"city",children:e=>{var t,i;let{field:n,fieldState:o}=e;return(0,r.jsx)(u,{required:!0,title:"City",error:null==(i=o.errors)||null==(t=i[0])?void 0:t.message,children:(0,r.jsx)(l.II,{size:"small",...n})})}})]}),defaultValues:{name:"Tina",city:"Hangzhou"},validateTrigger:n.C$T.onChange,validate:{name:e=>{let{value:t}=e;if(!t)return"Name is required"},city:e=>{let{value:t}=e;if(!t)return"City is required"}}},g={type:"custom",meta:{},defaultPorts:[{type:"output"},{type:"input"}],formMeta:c},p={nodes:[{id:"node_0",type:"custom",meta:{position:{x:400,y:0}}}],edges:[]};i(324681),i(960068);let f=e=>{let{registry:t,initialData:i}=e,l=(e=>{let{registries:t=[g],initialData:i=p}=e;return(0,o.useMemo)(()=>({background:!0,readonly:!1,initialData:i,nodeRegistries:t,getNodeDefaultRegistry:e=>({type:e,meta:{defaultExpanded:!0},formMeta:{render:()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.gNt,{name:"title",children:e=>{let{field:t}=e;return(0,r.jsx)("div",{className:"demo-free-node-title",children:t.value})}}),(0,r.jsx)("div",{className:"demo-free-node-content",children:(0,r.jsx)(n.gNt,{name:"content",children:(0,r.jsx)("input",{})})})]})}}),materials:{renderDefaultNode:e=>{let{form:t}=(0,n.PVB)();return(0,r.jsx)(n.IxS,{className:"demo-free-node",node:e.node,children:null==t?void 0:t.render()})}},onContentChange(e,t){},nodeEngine:{enable:!0},history:{enable:!0,enableChangeNode:!0},onInit:e=>{},onAllLayersRendered(e){e.document.fitView(!1)},onDispose(){console.log("---- Playground Dispose ----")},plugins:()=>[(0,s.qP)({disableLayer:!0,canvasStyle:{canvasWidth:182,canvasHeight:102,canvasPadding:50,canvasBackground:"rgba(245, 245, 245, 1)",canvasBorderRadius:10,viewportBackground:"rgba(235, 235, 235, 1)",viewportBorderRadius:4,viewportBorderColor:"rgba(201, 201, 201, 1)",viewportBorderWidth:1,viewportBorderDashLength:2,nodeColor:"rgba(255, 255, 255, 1)",nodeBorderRadius:2,nodeBorderWidth:.145,nodeBorderColor:"rgba(6, 7, 9, 0.10)",overlayColor:"rgba(255, 255, 255, 0)"},inactiveDebounceTime:1}),(0,a.Z)({edgeColor:"#00B2B2",alignColor:"#00B2B2",edgeLineWidth:1,alignLineWidth:1,alignCrossWidth:8})]}),[])})({registries:[t],initialData:i});return(0,r.jsx)(n.EhS,{...l,children:(0,r.jsx)("div",{className:"demo-free-container",children:(0,r.jsx)("div",{className:"demo-free-layout",children:(0,r.jsx)(n.R6T,{className:"demo-free-editor"})})})})},y=`import React from 'react';

import './field-wrapper.css';

interface FieldWrapperProps {
  required?: boolean;
  title?: string;
  children?: React.ReactNode;
  error?: string;
  note?: string;
}

export const FieldWrapper = ({ required, title, children, error, note }: FieldWrapperProps) => (
  <div className="field-wrapper">
    <div className="field-title">
      {title}
      {note ? <p className="field-note">{note}</p> : null}
      {required ? <span className="required">*</span> : null}
    </div>
    {children}
    <p className="error-message">{error}</p>
    {note ? <br /> : null}
  </div>
);
`,m=`.error-message {
  color: #f5222d !important;
}

.required {
  color: #f5222d !important;
  padding-left: 4px
}

.field-wrapper {
  width: 100%;
  margin-bottom: 12px;
}

.field-title {
  margin-bottom: 6px;
}

.field-note{
  color: #a3a0a0 !important;
  font-size: 12px;
  margin: 6px 0;
}
`,E=`import { WorkflowJSON } from '@flowgram.ai/free-layout-editor';

export const DEFAULT_INITIAL_DATA: WorkflowJSON = {
  nodes: [
    {
      id: 'node_0',
      type: 'custom',
      meta: {
        position: { x: 400, y: 0 },
      },
    },
  ],
  edges: [],
};`},767134:function(e,t,i){i.d(t,{M:()=>r});let r=i(908600).lazy(()=>Promise.resolve().then(i.bind(i,649414)).then(e=>({default:e.Editor})))},954272:function(e,t,i){i.d(t,{g:()=>a});var r=i(110239),n=i(908600),o=i(744260),s=i(150349);let a=e=>{let{files:t,children:i,previewStyle:a,dependencies:l,editorStyle:h,codeInRight:d}=e,u=(0,o.e7)(),c=(0,n.useMemo)(()=>u?"dark":"light",[u]),g=d?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(s.sp,{style:{width:"100%",display:"flex"},children:[(0,r.jsx)("div",{className:"light-mode",style:a,children:i}),(0,r.jsx)(s._V,{style:h,readOnly:!0})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.sp,{style:a,children:(0,r.jsx)("div",{className:"light-mode",children:i})}),(0,r.jsx)(s.sp,{children:(0,r.jsx)(s._V,{style:h,readOnly:!0})})]});return(0,r.jsx)(s.oT,{template:"react",theme:c,customSetup:{dependencies:l},files:{...t,"/App.js":{code:"",hidden:!0}},onChange:e=>{console.log("debugger",e)},children:g})}},893740:function(e,t,i){i.d(t,{yT:()=>te,Fw:()=>t5,YZ:()=>g,Lk:()=>tS,Qc:()=>E.Qc,z2:()=>tb,JA:()=>E.JA,Ho:()=>T,UJ:()=>p,ER:()=>tP,Zs:()=>tk,WV:()=>$,Yv:()=>tC,wY:()=>tV,Tj:()=>tA,yy:()=>y,VO:()=>J,Wi:()=>ia,JH:()=>F,XQ:()=>t3,VD:()=>A,mh:()=>tz,s5:()=>q,nn:()=>tv,W6:()=>t7,iX:()=>il,qY:()=>tX,p4:()=>et,v2:()=>ta,KV:()=>E.KV,M1:()=>tq,cv:()=>ts,W4:()=>tH,yb:()=>E.yb,_z:()=>W,km:()=>ii,Zn:()=>tZ,Rm:()=>tU,H$:()=>ir,KU:()=>it,G2:()=>io,Dc:()=>ie,RX:()=>tf,JW:()=>tR,RD:()=>Y,bP:()=>is,xm:()=>tt,mY:()=>u,rQ:()=>tW,el:()=>tr,aI:()=>ty,O0:()=>tp,d3:()=>t0});var r,n,o,s,a,l,h,d,u,c,g,p,f,y,m,E=i(832176),b=i(433210),D=i(461932),N=i(661881),C=i(550570);i(543789);var M=i(908600),S=i(473732),x=i(89802),w=Object.defineProperty,_=Object.getOwnPropertyDescriptor,I=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?_(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&w(t,i,o),o};(n=(r=u||(u={})).Default||(r.Default={})).ZOOM_IN="ZOOM_IN",n.ZOOM_OUT="ZOOM_OUT",n.DELETE="DELETE",n.COPY="COPY",n.PASTE="PASTE",n.UNDO="UNDO",n.REDO="REDO",n.VIEW_CLOSE_ALL_WIDGET="view.closeAllWidget",n.VIEW_CLOSE_CURRENT_WIDGET="view.closeCurrentWidget",n.VIEW_REOPEN_LAST_WIDGET="view.reopenLastWidget",n.VIEW_CLOSE_OTHER_WIDGET="view.closeOtherWidget",n.VIEW_CLOSE_BOTTOM_PANEL="view.closeBottomPannel",n.VIEW_OPEN_NEXT_TAB="view.openNextTab",n.VIEW_OEPN_LAST_TAB="view.openLastTab",n.VIEW_FULL_SCREEN="view.fullScreen",n.VIEW_SAVING_WIDGET_CLOSE_CONFIRM="view.savingWidgetCloseConfirm",n.VIEW_SHORTCUTS="view.shortcuts",n.VIEW_PREFERENCES="view.preferences",n.VIEW_LOG="view.log",n.VIEW_PROBLEMS="view.problems",r.is=function(e){return!!e&&e===Object(e)&&"id"in e};var L=Symbol("CommandContribution");(c||(c={})).findSimple=function(e,t){for(let i of e.values())if(i.id===t.id&&i.args.length===t.args.length&&i.args.every((e,i)=>t[i]===e))return i};var T=class{init(){for(let e of this.contributions)e.registerCommands(this)}get commands(){let e=[];for(let t of this.commandIds){let i=this.getCommand(t);i&&e.push(i)}return e}get commandIds(){return Object.keys(this._commands)}registerCommand(e,t){let i="string"==typeof e?{id:e}:e;if(this._commands[i.id])return console.warn(`A command ${i.id} is already registered.`),E.JT.NULL;let r=new E.K4(this.doRegisterCommand(i));return t&&r.push(this.registerHandler(i.id,t)),this.toUnregisterCommands.set(i.id,r),r.push(E.JT.create(()=>this.toUnregisterCommands.delete(i.id))),r}unregisterCommand(e){let t=u.is(e)?e.id:e,i=this.toUnregisterCommands.get(t);i&&i.dispose()}registerHandler(e,t){let i=this._handlers[e];return i||(this._handlers[e]=i=[]),i.unshift(t),{dispose:()=>{let e=i.indexOf(t);e>=0&&i.splice(e,1)}}}isVisible(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return void 0!==this.getVisibleHandler(e,...i)}isEnabled(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return void 0!==this.getActiveHandler(e,...i)}isToggled(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return void 0!==this.getToggledHandler(e,...i)}async executeCommand(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let n=this.getActiveHandler(e,...i),o={id:e,args:i};if(c.findSimple(this._commandExecutings,o))return o.promise;if(n)try{this._commandExecutings.add(o),this.onWillExecuteCommandEmitter.fire({commandId:e,args:i});let t=n.execute(...i);o.promise=t;let r=await t;return this.onDidExecuteCommandEmitter.fire({commandId:e,args:i}),r}finally{this._commandExecutings.delete(o)}}getVisibleHandler(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let n=this._handlers[e];if(n)for(let e of n)try{if(!e.isVisible||e.isVisible(...i))return e}catch(e){console.error(e)}}getActiveHandler(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let n=this._handlers[e];if(n)for(let e of n)try{if(!e.isEnabled||e.isEnabled(...i))return e}catch(e){console.error(e)}}getAllHandlers(e){let t=this._handlers[e];return t?t.slice():[]}getToggledHandler(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let n=this._handlers[e];if(n)for(let e of n)try{if(e.isToggled&&e.isToggled(...i))return e}catch(e){console.error(e)}}getCommand(e){return this._commands[e]}doRegisterCommand(e){return this._commands[e.id]=e,{dispose:()=>{delete this._commands[e.id]}}}updateCommand(e,t){this._commands[e]&&(this._commands[e]={...this._commands[e],...t})}dispose(){this.onWillExecuteCommandEmitter.dispose(),this.onDidExecuteCommandEmitter.dispose()}constructor(){this._handlers={},this._commands={},this._commandExecutings=new Set,this.toUnregisterCommands=new Map,this.onDidExecuteCommandEmitter=new E.Q5,this.onDidExecuteCommand=this.onDidExecuteCommandEmitter.event,this.onWillExecuteCommandEmitter=new E.Q5,this.onWillExecuteCommand=this.onWillExecuteCommandEmitter.event}};I([(0,D.nx)(L),(0,D.jt)()],T.prototype,"contributions",2),T=I([(0,D.b2)()],T);var A=Symbol("CommandService"),O=new D.nZ(e=>{(0,E.yb)(e,L),e(T).toSelf().inSingletonScope(),e(A).toService(T),e("CommandRegistryFactory").toFactory(e=>()=>e.container.get(T))}),k=i(658639),R=Object.defineProperty,P=Object.getOwnPropertyDescriptor,j=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?P(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&R(t,i,o),o},z=(e,t)=>(i,r)=>t(i,r,e),V=Object.__proto__,B=0,F=class{getDefaultDataRegistries(){return[]}get changeLocked(){return this._changeLockedTimes>0}set changeLocked(e){this._changeLockedTimes=e?this._changeLockedTimes+1:this._changeLockedTimes-1,this._changeLockedTimes<0&&(this._changeLockedTimes=0)}get type(){if(!this.constructor.type)throw Error(`Entity Registry need a type: ${this.constructor.name}`);return this.constructor.type}get context(){return this.entityManager.context}addInitializeData(e,t){this.isInitialized=!0,e.forEach(e=>this.addData(e,t)),this.isInitialized=!1}get version(){return this._version}toJSON(){let e=[];for(let t of this.dataManager.values())e.push({type:t.type,data:t.toJSON()});return{type:this.type,id:this.id,dataList:e}}fromJSON(e){e&&e.id&&e.type&&(this.changeLocked=!0,this.reset(),e.dataList&&e.dataList.forEach(e=>{let t=this.entityManager.getDataRegistryByType(e.type);t&&this.addData(t).update(e.data)}),this.changeLocked=!1,this.fireChange())}get id(){return this._id}dispose(){this.preDispose.dispose(),this.toDispose.dispose()}get disposed(){return this.toDispose.disposed}reset(){for(let e of(this.changeLocked=!0,this.dataManager.values()))this.initializeDataKeys.includes(e.type)||e.dispose();this.register(),this.changeLocked=!1,this.fireChange()}get onDispose(){return this.toDispose.onDispose}fireChange(){this.changeLocked||this.isInitialized||this.disposed||(this._version++,this._version>=Number.MAX_SAFE_INTEGER&&(this._version=0),this.onEntityChangeEmitter.fire(this))}addData(e,t){this.entityManager.registerEntityData(e);let i=this.dataManager.get(e.type);if(i)return t&&this.updateData(e,t),i;let r=this.entityManager.getDataInjector(e);i=new e(this,null==r?void 0:r()),this.isInitialized&&this.initializeDataKeys.push(i.type),this.dataManager.set(e.type,i),this.toDispose.push(i),i.onDataChange(()=>{let e={type:"update",data:i,entity:this};this.onDataChangeEmitter.fire(e),this.fireChange()}),i.toDispose.push(E.JT.create(()=>{this.initializeDataKeys.includes(e.type)||this.dataManager.delete(e.type);let t={type:"delete",data:i,entity:this};this.onDataChangeEmitter.fire(t),this.fireChange()})),i.changeLocked=!0,this.updateData(e,t||i.getDefaultData()),i.changeLocked=!1;let n={type:"add",data:i,entity:this};return this.onDataChangeEmitter.fire(n),i}get savedInManager(){return this._savedInManager}updateData(e,t){let i=this.dataManager.get(e.type);i&&i.update(t)}getData(e){return this.dataManager.get(e.type)}hasData(e){return this.dataManager.has(e.type)}removeData(e){if(this.initializeDataKeys.includes(e.type))return;let t=this.dataManager.get(e.type);t&&t.dispose()}getService(e){return this.entityManager.getService(e)}register(){this.getDefaultDataRegistries().forEach(e=>this.addData(e))}constructor(e){this.onEntityChangeEmitter=new E.Q5,this.onDataChangeEmitter=new E.Q5,this.initializeDataKeys=[],this.dataManager=new Map,this.toDispose=new E.K4,this.preDispose=new E.K4,this.onEntityChange=this.onEntityChangeEmitter.event,this.onDataChange=this.onDataChangeEmitter.event,this._changeLockedTimes=0,this.isInitialized=!0,this._version=B++,this._savedInManager=!0,this.entityManager=e.entityManager,this._id=e.id||(0,b.x0)(),this._savedInManager=void 0===e.savedInManager||e.savedInManager,this.isInitialized=!0,this.toDispose.push(this.onEntityChangeEmitter),this.toDispose.push(this.onDataChangeEmitter),this.register(),e.datas&&e.datas.forEach(e=>this.addData(e.registry,e.data)),this.isInitialized=!1}};F.type="Entity",(o=F||(F={})).getType=function(e){return e.type},o.checkDataChanged=function(e,t){return E.XJ.isChanged(e,t)},o.isRegistryOf=function(e,t){if(e===t)return!0;let i=e.__proto__;for(;i&&i!==V;){if(i.prototype===t.prototype)return!0;i=i.__proto__}return!1};var Y=class extends E.Pq{get type(){if(!this.constructor.type)throw Error(`Entity Data Registry need a type: ${this.constructor.name}`);return this.constructor.type}get data(){return this._data}update(e,t){2==arguments.length?this._data[e]!==t&&(this.fireWillChange(),this._data[e]=t,this.fireChange()):this.checkChanged(e)&&(this.fireWillChange(),"object"!=typeof e?this._data=e:this._data={...this._data,...e},this.fireChange())}fullyUpdate(e){E.XJ.isChanged(this._data,e,1,!1)&&(this.fireWillChange(),this._data=e,this.fireChange())}checkChanged(e){return F.checkDataChanged(this._data,e)}toJSON(){return this.data}fromJSON(e){this.update(e)}get changeLocked(){return this._changeLocked}set changeLocked(e){this._changeLocked=e}fireWillChange(){this.onWillChangeEmitter.fire(this)}fireChange(){this._changeLocked||(this._version++,this._version>=Number.MAX_SAFE_INTEGER&&(this._version=0),this.onDataChangeEmitter.fire(this))}bindChange(e,t){this.toDispose.push(e.onDataChange(()=>{t&&t(),this.fireChange()}))}get version(){return this._version}constructor(e,t){super(),this.opts=t,this.onDataChangeEmitter=new E.Q5,this.onWillChangeEmitter=new E.Q5,this._changeLocked=!1,this._version=0,this.onDataChange=this.onDataChangeEmitter.event,this.onWillChange=this.onWillChangeEmitter.event,this.entity=e,this._data=this.getDefaultData(),this.toDispose.push(this.onDataChangeEmitter),this.toDispose.push(this.onWillChangeEmitter)}};Y.type="EntityData";var U=class extends Y{getDefaultData(){return E.V_.createDefault(E.i1)}get x(){return this.data.x}get y(){return this.data.y}set x(e){this.update("x",e)}set y(e){this.update("y",e)}};U.type="OriginData";var $=class extends Y{getDefaultData(){return E.V_.createDefault(E.Zp)}get x(){return this.data.x}get y(){return this.data.y}set x(e){this.update("x",e)}set y(e){this.update("y",e)}};$.type="PositionData";var G=class extends Y{getDefaultData(){return E.V_.createDefault(E.z)}};G.type="RotationData";var Q=class extends Y{getDefaultData(){return E.V_.createDefault(E.Of)}get x(){return this.data.x}get y(){return this.data.y}set x(e){this.update("x",e)}set y(e){this.update("y",e)}};Q.type="ScaleData";var W=class extends Y{getDefaultData(){return E.V_.createDefault(E.gE)}get width(){return this.data.width}get height(){return this.data.height}set width(e){this.update("width",e)}set height(e){this.update("height",e)}get locked(){return!!this.data.locked}set locked(e){this.update("locked",e)}};W.type="SizeData";var H=class extends Y{getDefaultData(){return E.V_.createDefault(E.S9)}get x(){return this.data.x}get y(){return this.data.y}set x(e){this.update("x",e)}set y(e){this.update("y",e)}};H.type="SkewData";var{fixZero:X}=E.E9;(e=>{function t(e,t){return t&&t.apply(e,e),X(e),e}function i(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x),y:-(r.height*n.y)},i)}function r(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x)+r.width,y:-(r.height*n.y)},i)}function n(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x),y:-(r.height*n.y)+r.height},i)}function o(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x)+r.width,y:-(r.height*n.y)+r.height},i)}e.getPointWithMatrix=t,e.getBounds=function(e,t){let s=new E.Ae;if(!t||t.isSimple()){let{size:i,origin:r}=e;s.x=-(i.width*r.x)+((null==t?void 0:t.tx)||0),s.y=-(i.height*r.y)+((null==t?void 0:t.ty)||0),s.width=i.width,s.height=i.height,X(s)}else{let a=i(e,t),l=r(e,t),h=n(e,t),d=o(e,t);s.x=Math.min(a.x,l.x,h.x,d.x),s.y=Math.min(a.y,l.y,h.y,d.y),s.width=Math.max(a.x,l.x,h.x,d.x)-s.x,s.height=Math.max(a.y,l.y,h.y,d.y)-s.y}return s},e.applyMatrix=function(e,i){let r=new E.Ae;if(i.isSimple())r.x=e.x+i.tx,r.y=e.y+i.ty,r.width=e.width,r.height=e.height,X(r);else{let n=t(e.leftTop,i),o=t(e.rightTop,i),s=t(e.leftBottom,i),a=t(e.rightBottom,i);r.x=Math.min(n.x,o.x,s.x,a.x),r.y=Math.min(n.y,o.y,s.y,a.y),r.width=Math.max(n.x,o.x,s.x,a.x)-r.x,r.height=Math.max(n.y,o.y,s.y,a.y)-r.y}return r},e.getLeftPointFromBounds=function(e,t){let s=i(e,t),a=r(e,t);return[s,a,n(e,t),o(e,t)].sort((e,t)=>e.x-t.x)[0]},e.getTopPointFromBounds=function(e,t){let s=i(e,t),a=r(e,t);return[s,a,n(e,t),o(e,t)].sort((e,t)=>e.y-t.y)[0]},e.getCenter=function(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x)+r.width/2,y:-(r.height*n.y)+r.height/2},i)},e.getTopLeft=i,e.getTopCenter=function(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x)+r.width/2,y:-(r.height*n.y)},i)},e.getTopRight=r,e.getLeftCenter=function(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x),y:-(r.height*n.y)+r.height/2},i)},e.getRightCenter=function(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x)+r.width,y:-(r.height*n.y)+r.height/2},i)},e.getBottomLeft=n,e.getBottomCenter=function(e,i){let{size:r,origin:n}=e;return t({x:-(r.width*n.x)+r.width/2,y:-(r.height*n.y)+r.height},i)},e.getBottomRight=o})(g||(g={}));var J=class extends Y{get children(){return this._children||[]}clearChildren(){this._children&&this._children.slice().forEach(e=>{e.setParent(void 0)})}get isContainer(){return!!this._children&&this._children.length>0}fireChange(){this.changeLocked||(this._localID++,this.mutationCache.clear(),super.fireChange())}get localTransform(){return this.updateLocalTransformMatrix(),this._localTransform}get worldTransform(){return this.updateTransformMatrix(),this._worldTransform}getDefaultData(){return E.V_.createDefault(E.hY)}update(e){e.position&&this.entity.updateData($,e.position),e.size&&this.entity.updateData(W,e.size),e.origin&&this.entity.updateData(U,e.origin),e.scale&&this.entity.updateData(Q,e.scale),e.skew&&this.entity.updateData(H,e.skew),void 0!==e.rotation&&this.entity.updateData(G,e.rotation)}get position(){return this.entity.getData($)}set position(e){this.entity.updateData($,e)}get size(){return this.entity.getData(W)}set size(e){this.entity.updateData(W,e)}get origin(){return this.entity.getData(U)}set origin(e){this.entity.updateData(U,e)}get scale(){return this.entity.getData(Q)}set scale(e){this.entity.updateData(Q,e)}get skew(){return this.entity.getData(H)}set skew(e){this.entity.updateData(H,e)}get rotation(){return this.entity.getData(G).data}set rotation(e){this.entity.updateData(G,e)}get data(){return E.pL.toJSON(this)}updateSkew(){let{rotation:e}=this;this._cx=Math.cos(e+this.skew.y),this._sx=Math.sin(e+this.skew.y),this._cy=-Math.sin(e-this.skew.x),this._sy=Math.cos(e-this.skew.x),this._localID++}updateLocalTransformMatrix(){let e=this._localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x,e.ty=this.position.y,this._currentLocalID=this._localID,this._parentID=-1)}get localID(){return this._localID}get worldID(){return this._worldID}updateTransformMatrix(){let e=this._localTransform;this.updateLocalTransformMatrix();let t=E.y3.TEMP_MATRIX,i=0;if(this.parent&&(t=this.parent.worldTransform,i=this.parent._worldID),this._parentID!==i){let r=t,n=this._worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=i,this._worldID++}}setFromMatrix(e){let{a:t,b:i,c:r,d:n}=e,o=-Math.atan2(-r,n),s=Math.atan2(i,t),a=Math.abs(o+s);a<1e-5||1e-5>Math.abs(E._b-a)?(this.rotation=s,this.skew.x=this.skew.y=0):(this.rotation=0,this.skew.x=o,this.skew.y=s),this.scale.x=Math.sqrt(t*t+i*i),this.scale.y=Math.sqrt(r*r+n*n),this.position.x=e.tx,this.position.y=e.ty,this.fireChange()}getMutationCache(e,t){if(this.mutationCache.has(e))return this.mutationCache.get(e);let i=t();return this.mutationCache.set(e,i),i}get bounds(){if(this.isContainer){let e=this._children;return E.Ae.enlarge(e.map(e=>e.bounds))}return g.getBounds(this,this.worldTransform)}get boundsWithoutRotation(){let{center:e}=this.bounds,{worldScale:t}=this,i=this.localSize,r=t.x*i.width,n=t.y*i.height,o={x:e.x-r/2,y:e.y-n/2};return new E.Ae(o.x,o.y,r,n)}get localSize(){let{size:e}=this;if(this.isContainer){let t=E.Ae.enlarge(this.children.map(e=>e.localBounds));e={width:t.width,height:t.height}}return{width:e.width,height:e.height}}get worldSize(){let{localSize:e}=this,{worldScale:t}=this;return{width:e.width*t.x,height:e.height*t.y}}get localBounds(){if(this.isContainer){let e=this._children,t=E.Ae.enlarge(e.map(e=>e.localBounds));return g.applyMatrix(t,this.localTransform)}return this.getMutationCache("localBounds",()=>g.getBounds(this,this.localTransform))}contains(e,t,i){if(this.isContainer)return this.bounds.contains(e,t);let r=this.worldTransform.applyInverse({x:e,y:t}),{width:n,height:o}=this.size;if(0===n||0===o)return!1;let s=-n*this.origin.x,a=-o*this.origin.y;return i?new E.Cd(s+n/2,a+o/2,Math.min(n/2,o/2)).contains(r.x,r.y):!!(r.x>=s)&&!!(r.x<s+n)&&!!(r.y>=a)&&!!(r.y<a+o)}get parent(){return this._parent}isParent(e){let t=this.parent;for(;t;){if(t===e)return!0;t=t.parent}return!1}isParentTransform(e){let t=this.parent;for(;t;){if(t===e)return!0;t=t.parent}return!1}setParent(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._parent!==e&&(this.entityDispose&&(this.entityDispose.dispose(),this.entityDispose=void 0),this._parentChangedDispose&&(this._parentChangedDispose.dispose(),this._parentChangedDispose=void 0),this._parentID=-1,e&&t&&(e._children||(e._children=[]),e._children.push(this),this._parentChangedDispose=new E.K4,this.toDispose.push(this._parentChangedDispose),this.entityDispose=this.entity.onDispose(()=>{e.fireChange()}),this._parentChangedDispose.pushAll([e.onDispose(()=>{this.setParent(void 0)}),E.JT.create(()=>{let t=e._children.indexOf(this);-1!==t&&e._children.splice(t,1)})])),this._parent=e,this.fireChange())}intersects(e){return(!!this.isContainer||0!==this.size.width&&0!==this.size.height)&&E.Ae.intersectsWithRotation(this.boundsWithoutRotation,this.worldRotation,e,0)}get worldScale(){let{parent:e}=this,t=e?e.worldScale:{x:1,y:1};return{x:this.scale.x*t.x,y:this.scale.y*t.y}}get worldRotation(){let{parent:e}=this;return e?E.RZ.wrap(this.rotation+e.worldRotation):E.RZ.wrap(this.rotation)}get worldDegree(){return Math.round(this.worldRotation*E.jl)}get localOrigin(){let e=this.localTransform,t=this.localBounds;return e.apply({x:this.origin.x*t.width,y:this.origin.y*t.height})}get worldOrigin(){let e=this.worldTransform,{bounds:t}=this;return e.apply({x:this.origin.x*t.width,y:this.origin.y*t.height})}widthToScaleX(e,t){return e/(t&&this.parent?this.parent.worldScale.x:1)/this.localSize.width}heightToScaleY(e,t){return e/(t&&this.parent?this.parent.worldScale.y:1)/this.localSize.height}sizeToScaleValue(e,t){return{x:this.widthToScaleX(e.width,t),y:this.heightToScaleY(e.height,t)}}constructor(e){super(e),this._worldTransform=new E.y3,this._localTransform=new E.y3,this.mutationCache=new Map,this.sizeToScale=!1,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0,this.bindChange(this.entity.addData($)),this.bindChange(this.entity.addData(W)),this.bindChange(this.entity.addData(U)),this.bindChange(this.entity.addData(Q)),this.bindChange(this.entity.addData(H),()=>this.updateSkew()),this.bindChange(this.entity.addData(G),()=>this.updateSkew())}};J.type="TransformData",(s=J||(J={})).isParentOrChildrenTransform=function(e,t){let i=t.getData(s);if(!i)return!1;for(let t of e.values()){let e=t.getData(s);if(e&&(e.isParent(i)||i.isParent(e)))return!0}return!1};var Z=class{push(e,t){let{execMap:i}=this,r=i.get(e);r||(r=(0,N.Z)(t,0),i.set(e,r)),r()}dispose(){this.execMap.clear()}constructor(){this.execMap=new Map}};function K(e,t,i){let r=document.createEvent("MouseEvent");return r.initMouseEvent(e,!0,!0,void 0,0,0,0,t,i,!1,!1,!1,!1,0,null),r}(a=p||(p={})).isTouchEvent=e=>"touches"in e,a.touchToMouseEvent=e=>{if(!(0,a.isTouchEvent)(e))return e;let t=e.touches[0]||e.changedTouches[0];"touchmove"===e.type&&(0,a.preventDefault)(e);let i={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touchcancel:"mouseup"}[e.type];if(!i)throw Error(`Unknown touch event type: ${e.type}`);return new MouseEvent(i,{bubbles:e.bubbles,cancelable:e.cancelable,view:e.view,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})},a.getEventCoord=e=>(0,a.isTouchEvent)(e)?0===e.touches.length?{clientX:0,clientY:0}:{clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}:(e instanceof MouseEvent,{clientX:e.clientX,clientY:e.clientY}),a.preventDefault=e=>{e.cancelable&&e.preventDefault()},a.onTouched=(e,t)=>{let i=e.changedTouches[0],r=e=>{let n=e.changedTouches[0],o=n.clientX-i.clientX,s=n.clientY-i.clientY;5>Math.abs(o)&&5>Math.abs(s)&&t((0,a.touchToMouseEvent)(e)),document.removeEventListener("touchend",r),document.removeEventListener("touchcancel",r)};document.addEventListener("touchend",r),document.addEventListener("touchcancel",r)};var q=class{get isStarted(){return!!this._promise}start(e,t,i,r){if(this._disposed)return Promise.resolve();if(this._promise)return this._promise;this.context=r,this.localId=(0,E.oN)(),this._addListeners(),this._promise=new Promise(e=>{this._resolve=e}),this._playgroundConfigEntity=i;let n=K("mousedown",e,t);return this._startPos=this.getRelativePos(n),this.onDragStartEmitter.fire(this.getDragEvent(n)),this._promise}stop(e,t){if(this._disposed||!this._promise)return;let i=K("mouseup",e,t);this.handleEvent(i)}dispose(){this._disposed||(this._stopScrollX(),this._stopScrollY(),this._disposed=!0,this.onDragEmitter.dispose(),this.onDragStartEmitter.dispose(),this.onDragEndEmitter.dispose(),this._finalize())}handleEvent(e){let t=p.touchToMouseEvent(e);switch(t.type){case"mousemove":this._evtMouseMove(t);break;case"mouseup":this._stopScrollX(),this._stopScrollY(),this._evtMouseUp(t);break;case"keydown":this._evtKeyDown(t);break;case"contextmenu":let i=K("mouseup",t.clientX,t.clientY);this._evtMouseUp(i);break;default:p.preventDefault(t),t.stopPropagation()}}get scale(){return this._playgroundConfigEntity?this._playgroundConfigEntity.finalScale:1}getRelativePos(e){return this._playgroundConfigEntity?this._playgroundConfigEntity.getPosFromMouseEvent(e,!1):{x:e.clientX,y:e.clientY}}getDragEvent(e){let t=this._startPos,{scale:i}=this;switch(e.type){case"mousedown":return this._lastPos=t,Object.assign(e,{id:this.localId,startPos:t,endPos:t,scale:i,movingDelta:{x:0,y:0},isStart:!0,isMoving:!1});case"mousemove":let r=this.getRelativePos(e),n={x:r.x-this._lastPos.x,y:r.y-this._lastPos.y};return this._lastPos=r,Object.assign(e,{id:this.localId,startPos:t,endPos:r,scale:i,isStart:!0,movingDelta:n,isMoving:!0});case"mouseup":return this._lastPos={x:0,y:0},Object.assign(e,{id:this.localId,startPos:t,endPos:this.getRelativePos(e),movingDelta:{x:0,y:0},scale:i,isStart:!1,isMoving:!1});default:throw Error("unknown event")}}_finalize(){let e=this._resolve;this._removeListeners(),this._startPos=void 0,this._promise=void 0,this._resolve=void 0,e&&e()}_evtMouseMove(e){e.preventDefault(),e.stopPropagation(),this._lastMouseMoveEvent=e;let t=this.getDragEvent(e);this._updateDragScroll(t),this.onDragEmitter.fire(t)}_evtMouseUp(e){this._lastMouseMoveEvent=void 0,e.preventDefault(),e.stopPropagation(),(0===e.button||1===e.button)&&(this.onDragEndEmitter.fire(this.getDragEvent(e)),this._finalize())}_evtKeyDown(e){e.preventDefault(),e.stopPropagation(),27===e.keyCode&&this.stop(NaN,NaN)}_addListeners(){document.addEventListener("mousedown",this,!0),document.addEventListener("mousemove",this,!0),document.addEventListener("mouseup",this,!0),document.addEventListener("touchstart",this,!0),document.addEventListener("touchmove",this,{passive:!1}),document.addEventListener("touchend",this,!0),document.addEventListener("touchcancel",this,!0),this._stopGlobalEventNames.forEach(e=>{document.addEventListener(e,this,!0)})}_removeListeners(){document.removeEventListener("mousedown",this,!0),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),document.removeEventListener("touchstart",this,!0),document.removeEventListener("touchmove",this),document.removeEventListener("touchend",this,!0),document.removeEventListener("touchcancel",this,!0),this._stopGlobalEventNames.forEach(e=>{document.removeEventListener(e,this,!0)})}_startScrollX(e,t){if(this._scrollXInterval)return;let i=window.setInterval(()=>{this._scrollXInterval&&this.fireScroll("scrollX",t)},20);this._scrollXInterval={interval:i,origin:e}}_stopScrollX(){this._scrollXInterval&&(clearInterval(this._scrollXInterval.interval),this._scrollXInterval=void 0)}_startScrollY(e,t){if(this._scrollYInterval)return;let i=window.setInterval(()=>{this.fireScroll("scrollY",t)},20);this._scrollYInterval={interval:i,origin:e}}_stopScrollY(){this._scrollYInterval&&(clearInterval(this._scrollYInterval.interval),this._scrollYInterval=void 0)}fireScroll(e,t){let i="scrollY"===e?this._scrollYInterval:this._scrollXInterval;if(!i)return;let r=i.origin=t?i.origin+4:i.origin-4,n=this._playgroundConfigEntity.config[e];this._playgroundConfigEntity.updateConfig({[e]:r});let o=this._playgroundConfigEntity.config[e];if(o!==n){let t=this._lastMouseMoveEvent,r={x:"scrollX"===e?o-i.origin:0,y:"scrollY"===e?o-i.origin:0},n=K("mousemove",t.clientX+r.x,t.clientY+r.y),s=this.getDragEvent(n);this.onDragEmitter.fire(s)}}constructor(e={}){this.onDragStartEmitter=new E.Q5,this.onDragEndEmitter=new E.Q5,this.onDragEmitter=new E.Q5,this._stopGlobalEventNames=["mouseenter","mouseleave","mouseover","mouseout","contextmenu"],this.onDrag=this.onDragEmitter.event,this.onDragStart=this.onDragStartEmitter.event,this.onDragEnd=this.onDragEndEmitter.event,this._lastPos={x:0,y:0},this._updateDragScroll=e=>{if(!this._playgroundConfigEntity)return;let t=this._playgroundConfigEntity.config,i=e.endPos,{scrollX:r,width:n,height:o,scrollY:s}=t;i.x>n+r-20?this._startScrollX(r,!0):i.x<r+20?this._startScrollX(r,!1):this._stopScrollX(),i.y>o+s-20?this._startScrollY(s,!0):i.y<s+20?this._startScrollY(s,!1):this._stopScrollY()},this._disposed=!1,e.onDragStart&&this.onDragStart(t=>e.onDragStart(t,this.context)),e.onDrag&&this.onDrag(t=>e.onDrag(t,this.context)),e.onDragEnd&&this.onDragEnd(t=>e.onDragEnd(t,this.context)),e.stopGlobalEventNames&&(this._stopGlobalEventNames=e.stopGlobalEventNames)}};(l=q||(q={})).startDrag=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};f&&f.stop(NaN,NaN);let r=f=new l({onDragStart(e,t){i.onDragStart&&i.onDragStart(e,t)},onDrag(e,t){i.onDrag&&i.onDrag(e,t)},onDragEnd(e,t){i.onDragEnd&&i.onDragEnd(e,t),r.dispose(),f===r&&(f=void 0)}});return r.start(e,t,i.config,i.context),E.JT.create(()=>{r.stop(0,0),r.dispose(),f===r&&(f=void 0)})};var ee=0;function et(e){ee++,requestAnimationFrame(function e(t){ee<=0||(requestAnimationFrame(e),C.ZP.update(t))});let t=!1,i=new C.ZP.Tween(e.from).to(e.to,e.duration).easing(e.easing||C.ZP.Easing.Quadratic.Out).onUpdate(()=>{!t&&e.onUpdate&&e.onUpdate(e.from)}).onComplete(()=>{!t&&(t=!0,ee--,e.onComplete&&e.onComplete(e.from))}).start();return E.JT.create(()=>{!t&&(t=!0,ee--,i.stop(),e.onDispose&&e.onDispose(e.from))})}function ei(e){let[t,i]=e.overflow,[r,n]=e._delta,[o,s]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(i<0&&n>0&&s<0||i>0&&n<0&&s>0)&&(e._movement[1]=e._movementBound[1])}var er={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function en(e,t,i){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*i):e*t*i/(t+i*e)}function eo(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.15;return 0===r?Math.max(t,Math.min(e,i)):e<t?-en(t-e,i-t,r)+t:e>i?+en(e-i,i-t,r)+i:e}var es={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function ea(e){return e?e[0].toUpperCase()+e.slice(1):""}var el=["enter","leave"],eh=["gotpointercapture","lostpointercapture"];function ed(e){return"touches"in e}function eu(e){return ed(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function ec(e){return ed(e)?("touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches)[0]:e}function eg(e,t){try{let i=t.clientX-e.clientX,r=t.clientY-e.clientY,n=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2,s=Math.hypot(i,r);return{angle:-(180*Math.atan2(i,r))/Math.PI,distance:s,origin:[n,o]}}catch{}return null}function ep(e,t){let[i,r]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return eg(i,r)}function ef(e){let t=ec(e);return ed(e)?t.identifier:t.pointerId}function ey(e){let t=ec(e);return[t.clientX,t.clientY]}function em(e){let{deltaX:t,deltaY:i,deltaMode:r}=e;return 1===r?(t*=40,i*=40):2===r&&(t*=800,i*=800),[t,i]}function ev(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return"function"==typeof e?e(...i):e}function eE(){}function eb(e,t){return Object.assign({},t,e||{})}var eD=class{get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:i,args:r}=this;t[i]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,i=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=i.from?ev(i.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:i,shared:r}=this;t.args=this.args;let n=0;if(e&&(t.event=e,i.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:i,altKey:r,metaKey:n,ctrlKey:o}=e;Object.assign(t,{shiftKey:i,altKey:r,metaKey:n,ctrlKey:o})}return t}(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,n=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);er.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[o,s]=t._movement,[a,l]=i.threshold,{_step:h,values:d}=t;if(i.hasCustomTransform?(!1===h[0]&&(h[0]=Math.abs(o)>=a&&d[0]),!1===h[1]&&(h[1]=Math.abs(s)>=l&&d[1])):(!1===h[0]&&(h[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===h[1]&&(h[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==h[0]||!1!==h[1],!t.intentional)return;let u=[0,0];if(i.hasCustomTransform){let[e,t]=d;u[0]=!1!==h[0]?e-h[0]:0,u[1]=!1!==h[1]?t-h[1]:0}else u[0]=!1!==h[0]?o-h[0]:0,u[1]=!1!==h[1]?s-h[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(u);let c=t.offset,g=t._active&&!t._blocked||t.active;g&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in i&&(t._bounds=ev(i.bounds,t)),this.setup&&this.setup()),t.movement=u,this.computeOffset()));let[p,f]=t.offset,[[y,m],[E,b]]=t._bounds;t.overflow=[p<y?-1:+(p>m),f<E?-1:+(f>b)],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let D=t._active&&i.rubberband||[0,0];if(t.offset=function(e,t,i){let[r,n]=t,[o,s]=i,[[a,l],[h,d]]=e;return[eo(r,a,l,o),eo(n,h,d,s)]}(t._bounds,t.offset,D),t.delta=er.sub(t.offset,c),this.computeMovement(),g&&(!t.last||n>32)){t.delta=er.sub(t.offset,c);let e=t.delta.map(Math.abs);er.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&n>0&&(t.velocity=[e[0]/n,e[1]/n],t.timeDelta=n)}}emit(){let e=this.state,t=this.shared,i=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!i.triggerAllEvents)return;let r=this.handler({...t,...e,[this.aliasKey]:e.values});void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}constructor(e,t,i){this.ctrl=e,this.args=t,this.key=i,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}},eN=class extends eD{reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=er.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=er.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,i=this.config;if(!t.axis&&e){let r="object"==typeof i.axisThreshold?i.axisThreshold[eu(e)]:i.axisThreshold;t.axis=function(e,t){let[i,r]=e,n=Math.abs(i),o=Math.abs(r);return n>o&&n>t?"x":o>n&&o>t?"y":void 0}(t._movement,r)}t._blocked=(i.lockDirection||!!i.axis)&&!t.axis||!!i.axis&&i.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}constructor(){super(...arguments),this.aliasKey="xy"}},eC=class extends eN{wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=em(e),er.addTo(t._movement,t._delta),ei(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}constructor(){super(...arguments),this.ingKey="wheeling"}},eM=class extends eN{scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();let t=this.state,i=function(e){let{scrollX:t,scrollY:i,scrollLeft:r,scrollTop:n}=e.currentTarget;return[t??r??0,i??n??0]}(e);t._delta=er.sub(i,t._values),er.addTo(t._movement,t._delta),this.computeValues(i),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}constructor(){super(...arguments),this.ingKey="scrolling"}},eS=class extends eD{init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:i}=this.state;"wheel"===e?this.state.offset=er.add(t,i):this.state.offset=[(1+t[0])*i[0],t[1]+i[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,i]=e._movement;if(!e.axis){let r=30*Math.abs(t)-Math.abs(i);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,i=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>i.has(e))||i.size<2)return;this.start(e),t._touchIds=Array.from(i).slice(0,2);let r=ep(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,i=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(i.keys()).every(e=>r.has(e))||(i.size<2&&i.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let n=eg(...Array.from(i.values()));n&&this.pinchStart(e,n)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=ep(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let i=eg(...Array.from(t.values()));i&&this.pinchMove(e,i)}pinchMove(e,t){let i=this.state,r=i._values[1],n=t.angle-r,o=0;Math.abs(n)>270&&(o+=Math.sign(n)),this.computeValues([t.distance,t.angle-360*o]),i.origin=t.origin,i.turns=o,i._movement=[i._values[0]/i._initial[0]-1,i._values[1]-i._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let i=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=er.sub(t._movement,i),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();let t=this.state,i=-em(e)[1]/100*t.offset[0];Math.abs(i)>.1&&(i=.1*Math.sign(i)),t._delta=[i,0],er.addTo(t._movement,t._delta),ei(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}constructor(){super(...arguments),this.ingKey="pinching",this.aliasKey="da"}},ex=class extends eN{move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(ey(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;let t=ey(e),i=this.state;i._delta=er.sub(t,i._values),er.addTo(i._movement,i._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}constructor(){super(...arguments),this.ingKey="moving"}},ew=class extends eN{enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(ey(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;let t=this.state;if(!t._active)return;t._active=!1;let i=ey(e);t._movement=t._delta=er.sub(i,t._values),this.computeValues(i),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}constructor(){super(...arguments),this.ingKey="hovering"}},e_=e=>e,eI={enabled(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e},eventOptions:(e,t,i)=>({...i.shared.eventOptions,...e}),preventDefault(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e},triggerAllEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e},rubberband(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return er.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?er.toVector(e):void 0,transform(e,t,i){let r=e||i.shared.transform;return this.hasCustomTransform=!!r,r||e_},threshold:e=>er.toVector(e,0)},eL={...eI,axis(e,t,i){let{axis:r}=i;if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e},bounds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("function"==typeof e)return t=>eL.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:i=1/0,top:r=-1/0,bottom:n=1/0}=e;return[[t,i],[r,n]]}},eT={ArrowRight:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[e*t,0]},ArrowLeft:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[-1*e*t,0]},ArrowUp:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[0,-1*e*t]},ArrowDown:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[0,e*t]}},eA=class extends eN{reset(){super.reset();let e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){let e=this.state;if(e._bounds instanceof HTMLElement){let t=e._bounds.getBoundingClientRect(),i=e.currentTarget.getBoundingClientRect(),r={left:t.left-i.left+e.offset[0],right:t.right-i.right+e.offset[0],top:t.top-i.top+e.offset[1],bottom:t.bottom-i.bottom+e.offset[1]};e._bounds=eL.bounds(r)}}cancel(){let e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){let t=this.config,i=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;let r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),r&&r.size>1&&i._pointerActive||(this.start(e),this.setupPointer(e),i._pointerId=ef(e),i._pointerActive=!0,this.computeValues(ey(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==eu(e)?(i._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){let t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){let t=this.state,i=this.config;if(!t._pointerActive)return;let r=ef(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;let n=ey(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=er.sub(n,t._values),this.computeValues(n)),er.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(i.preventScrollAxis&&!t._preventScroll)if(!t.axis)return;else if(t.axis===i.preventScrollAxis||"xy"===i.preventScrollAxis){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}let t=this.state,i=this.config;if(!t._active||!t._pointerActive)return;let r=ef(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);let[n,o]=t._distance;if(t.tap=n<=i.tapsThreshold&&o<=i.tapsThreshold,t.tap&&i.filterTaps)t._force=!0;else{let[e,r]=t._delta,[n,o]=t._movement,[s,a]=i.swipe.velocity,[l,h]=i.swipe.distance,d=i.swipe.duration;if(t.elapsedTime<d){let i=Math.abs(e/t.timeDelta),d=Math.abs(r/t.timeDelta);i>s&&Math.abs(n)>l&&(t.swipe[0]=Math.sign(e)),d>a&&Math.abs(o)>h&&(t.swipe[1]=Math.sign(r))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){let t=this.config,i=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,i,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){var t;this.state._preventScroll=!1,"persist"in(t=e)&&"function"==typeof t.persist&&t.persist();let i=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",i),this.eventStore.add(this.sharedConfig.window,"touch","cancel",i),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){let t=eT[e.key];if(t){let i=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),i._delta=t(this.config.keyboardDisplacement,r),i._keyboardActive=!0,er.addTo(i._movement,i._delta),this.compute(e),this.emit()}}keyUp(e){e.key in eT&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){let t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}constructor(){super(...arguments),this.ingKey="dragging"}},eO="undefined"!=typeof window&&window.document&&window.document.createElement;function ek(){return eO&&"ontouchstart"in window}var eR={isBrowser:eO,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:ek(),touchscreen:ek()||eO&&window.navigator.maxTouchPoints>1,pointer:eO&&"onpointerdown"in window,pointerLock:eO&&"exitPointerLock"in window.document},eP={...eI,device(e,t,i){let{shared:r,pointer:{touch:n=!1}={}}=i;if(r.target&&!eR.touch&&eR.gesture)return"gesture";if(eR.touch&&n)return"touch";if(eR.touchscreen){if(eR.pointer)return"pointer";if(eR.touch)return"touch"}},bounds(e,t,i){let{scaleBounds:r={},angleBounds:n={}}=i,o=e=>{let t=eb(ev(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},s=e=>{let t=eb(ev(n,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof n?[o(),s()]:e=>[o(e),s(e)]},threshold(e,t,i){return this.lockDirection="lock"===i.axis,er.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e}},ej={...eL,mouseOnly:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e}},ez={...eL,mouseOnly:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e}},eV={mouse:0,touch:0,pen:8},eB={...eL,device(e,t,i){let{pointer:{touch:r=!1,lock:n=!1,mouse:o=!1}={}}=i;return(this.pointerLock=n&&eR.pointerLock,eR.touch&&r)?"touch":this.pointerLock?"mouse":eR.pointer&&!o?"pointer":eR.touch?"touch":"mouse"},preventScrollAxis(e,t,i){let{preventScroll:r}=i;if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?250:void 0,eR.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,i){let{pointer:{capture:r=!0,buttons:n=1,keys:o=!0}={}}=i;return this.pointerButtons=n,this.keys=o,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,i){let{filterTaps:r=!1,tapsThreshold:n=3,axis:o}=i,s=er.toVector(e,r?n:+!!o);return this.filterTaps=r,this.tapsThreshold=n,s},swipe(){let{velocity:e=.5,distance:t=50,duration:i=250}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{velocity:this.transform(er.toVector(e)),distance:this.transform(er.toVector(t)),duration:i}},delay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?{...eV,...e}:eV,keyboardDisplacement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return e}},eF=new Map,eY=new Map;function eU(e){eF.set(e.key,e.engine),eY.set(e.key,e.resolver)}var e$={key:"drag",engine:eA,resolver:eB},eG={key:"hover",engine:ew,resolver:ez},eQ={key:"move",engine:ex,resolver:ej},eW={key:"pinch",engine:eS,resolver:eP},eH={key:"scroll",engine:eM,resolver:eL},eX={key:"wheel",engine:eC,resolver:eL},eJ=class{add(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:140;for(var r=arguments.length,n=Array(r>3?r-3:0),o=3;o<r;o++)n[o-3]=arguments[o];this.remove(e),this._timeouts.set(e,window.setTimeout(t,i,...n))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}constructor(){this._timeouts=new Map}},eZ=class{add(e,t,i,r,n){let o=this._listeners,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=es[e];return e+(i&&i[t]||t)}(t,i),a={...this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},...n};e.addEventListener(s,r,a);let l=()=>{e.removeEventListener(s,r,a),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}constructor(e,t){this._listeners=new Set,this._ctrl=e,this._gestureKey=t}},eK={target(e){if(e)return()=>"current"in e?e.current:e},enabled(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e},window(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eR.isBrowser?window:void 0;return e},eventOptions(){let{passive:e=!0,capture:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{passive:e,capture:t}},transform:e=>e};function eq(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i={};for(let[r,n]of Object.entries(t))switch(typeof n){case"function":i[r]=n.call(i,e[r],r,e);break;case"object":i[r]=eq(e[r],n);break;case"boolean":n&&(i[r]=e[r])}return i}var e0=class{setEventIds(e){if(ed(e))return this.touchIds=new Set(Array.from(e.touches).filter(t=>{var i,r;return t.target===e.currentTarget||(null==(r=e.currentTarget)||null==(i=r.contains)?void 0:i.call(r,t.target))}).map(e=>e.identifier)),this.touchIds;if("pointerId"in e)return"pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{target:r,eventOptions:n,window:o,enabled:s,transform:a,...l}=e;if(i.shared=eq({target:r,eventOptions:n,window:o,enabled:s,transform:a},eK),t){let e=eY.get(t);i[t]=eq({shared:i.shared,...l},e)}else for(let e in l){let t=eY.get(e);t&&(i[e]=eq({shared:i.shared,...l[e]},t))}return i}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(){let e;for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];let n=this.config.shared,o={};if(!n.target||(e=n.target())){if(n.enabled){for(let t of this.gestures){let r=this.config[t],n=e2(o,r.eventOptions,!!e);r.enabled&&new(eF.get(t))(this,i,t).bind(n)}let t=e2(o,n.eventOptions,!!e);for(let e in this.nativeHandlers)t(e,"",t=>this.nativeHandlers[e]({...this.state.shared,event:t,args:i}),void 0,!0)}for(let e in o)o[e]=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?eE:1===t.length?t[0]:function(){let e;for(let i of t)e=i.apply(this,arguments)||e;return e}}(...o[e]);if(!e)return o;for(let t in o){let{device:i,capture:r,passive:n}=function(e){let t=e.substring(2).toLowerCase(),i=!!~t.indexOf("passive");i&&(t=t.replace("passive",""));let r=eh.includes(t)?"capturecapture":"capture",n=!!~t.indexOf(r);return n&&(t=t.replace("capture","")),{device:t,capture:n,passive:i}}(t);this._targetEventStore.add(e,i,"",o[t],{capture:r,passive:n})}}}constructor(e){this.gestures=new Set,this._targetEventStore=new eZ(this),this.gestureEventStores={},this.gestureTimeoutStores={},this.handlers={},this.config={},this.pointerIds=new Set,this.touchIds=new Set,this.state={shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}},function(e,t){t.drag&&e1(e,"drag"),t.wheel&&e1(e,"wheel"),t.scroll&&e1(e,"scroll"),t.move&&e1(e,"move"),t.pinch&&e1(e,"pinch"),t.hover&&e1(e,"hover")}(this,e)}};function e1(e,t){e.gestures.add(t),e.gestureEventStores[t]=new eZ(e,t),e.gestureTimeoutStores[t]=new eJ}var e2=(e,t,i)=>function(r,n,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=s.capture??t.capture,h=s.passive??t.passive,d=a?r:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=es[e],n=r&&r[t]||t;return"on"+ea(e)+ea(n)+(!function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return e&&!el.includes(t)}(i,n)?"":"Capture")}(r,n,l);i&&h&&(d+="Passive"),e[d]=e[d]||[],e[d].push(o)},e4=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function e3(e,t,i,r,n,o){if(!e.has(i)||!eF.has(r))return;let s=i+"Start",a=i+"End";n[r]=e=>{let r;return e.first&&s in t&&t[s](e),i in t&&(r=t[i](e)),e.last&&a in t&&t[a](e),r},o[r]=o[r]||{}}var e5=class{destroy(){this._ctrl.clean()}setConfig(e){this._ctrl.clean(),this._ctrl.applyConfig({...e,target:this._target},this._gestureKey),this._ctrl.effect()}constructor(e,t,i,r,n){this._target=e,this._gestureKey=r,this._ctrl=new e0(t),this._ctrl.applyHandlers(t,n),this._ctrl.applyConfig({...i,target:e},r),this._ctrl.effect()}},e9=function(e,t,i){return([e$,eW,eH,eX,eQ,eG].forEach(eU),function(e,t,i){let{handlers:r,nativeHandlers:n,config:o}=function(e,t){let[i,r,n]=function(e){let t={},i={},r=new Set;for(let n in e)e4.test(n)?(r.add(RegExp.lastMatch),i[n]=e[n]):t[n]=e[n];return[i,t,r]}(e),o={};return e3(n,i,"onDrag","drag",o,t),e3(n,i,"onWheel","wheel",o,t),e3(n,i,"onScroll","scroll",o,t),e3(n,i,"onPinch","pinch",o,t),e3(n,i,"onMove","move",o,t),e3(n,i,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}(t,i||{});return new e5(e,r,o,void 0,n)})(e,t,i||{})},e6=class extends E.Pq{handlePinch(e){let{first:t,last:i,originX:r,originY:n,newScale:o}=e;if(Number.isNaN(e.newScale))return;t&&(this._pinching=!0),i&&(this._pinching=!1);let s=this.config.finalScale,a=this.config.getPosFromMouseEvent({clientX:r,clientY:n},!1),l={x:a.x/s*o,y:a.y/s*o};this.config.updateConfig({scrollX:this.config.config.scrollX+l.x-a.x,scrollY:this.config.config.scrollY+l.y-a.y,zoom:o})}getScaleBounds(){return{min:this.config.config.minZoom,max:this.config.config.maxZoom}}preventDefault(){let e=e=>e.preventDefault();document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),this.toDispose.push(E.JT.create(()=>{document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e)}))}get pinching(){return this._pinching}constructor(e,t){super(),this.target=e,this.config=t,this._pinching=!1,this.preventDefault();let i=new e9(e,{onPinch:e=>{let{origin:[t,i],first:r,last:n,movement:[o],offset:[s,a]}=e;this.handlePinch({first:r,last:n,originX:t,originY:i,newScale:s})}},{pinch:{scaleBounds:()=>this.getScaleBounds(),from:()=>[this.config.finalScale,0],modifierKey:["metaKey","ctrlKey"]}});this.toDispose.push(E.JT.create(()=>{i.destroy()}))}},e8=Symbol("LazyInjectContext"),e7=Symbol("IS_LAZY_INJECT_CONTEXT_INJECTED"),te=e=>function(t,i){if(!e)throw Error(`ServiceIdentifier ${e} in @lazyInject is Empty, it might be caused by file circular dependency, please check it.`);return Reflect.hasMetadata(e7,t)||((0,D.f3)(e8)(t,e8),Reflect.defineMetadata(e7,!0,t)),{get(){return this[e8].get(e)},set(){},configurable:!0,enumerable:!0}},tt=Symbol("PlaygroundContext"),ti=Symbol("PlaygroundContextProvider"),tr=()=>function(e,t){let i=`${t}Provider`;return(0,D.f3)(ti)(e,i),(0,D.jt)()(e,i),{get(){var e;return null==(e=this[i])?void 0:e.call(this)},configurable:!0,enumerable:!0}},tn=Symbol("PlaygroundContainerFactory"),to=Symbol("EntityManagerContribution"),ts=class extends F{getDefaultConfig(){return{}}checkChanged(e,t){return F.checkDataChanged(e,t)}get config(){return this.getData(this.ConfigDataRegistry).data}updateConfig(e){this.updateData(this.ConfigDataRegistry,e)}onConfigChanged(e){return this.getData(this.ConfigDataRegistry).onDataChange(t=>e(t.data))}constructor(e){super(e),this.isInitialized=!0,this.ConfigDataRegistry=function(e){class t extends Y{getDefaultData(){return e.getDefaultConfig()}checkChanged(t){return e.checkChanged(this.data,t)}toJSON(){return super.toJSON()}}return Object.defineProperty(t,"type",{value:`_${e.type}DataMixin`}),t}(this),this.addData(this.ConfigDataRegistry),this.isInitialized=!1}};ts.type="ConfigEntity";var ta=class{init(){this.contributions.forEach(e=>{var t;return null==(t=e.registerEntityManager)?void 0:t.call(e,this)})}createEntity(e,t){if(!e.type)throw Error(`[EntityManager] createEntity need a type: ${e}`);if(this.configEntities.has(e.type))return this.configEntities.get(e.type);let i={entityManager:this,savedInManager:!0,...t},r=new e(i);return i.savedInManager&&this.saveEntity(r),r}isConfigEntity(e){return this.configEntities.has(e)}removeEntities(e){for(let t of this.getEntities(e).values())t.dispose()}removeEntityById(e){let t=this.getEntityById(e);return!!t&&(t.dispose(),!0)}resetEntities(e){this.getEntities(e).forEach(e=>{e.reset()})}resetEntity(e,t){let i=this.getEntity(e,t);null==i||i.reset()}updateConfigEntity(e,t){let i=this.configEntities.get(e.type);i&&i.updateConfig(t)}getRegistryByType(e){return this.registryMap.get(e)}registerEntity(e){if(!e.type)throw Error(`Registry entity need a type: ${e.name}`);let t=this.registryMap.get(e.type);if(t){if(t!==e)throw Error(`Entity registry ${e.type} need a new type`);return}this.registryMap.set(e.type,e)}registerEntityData(e,t){if(!e.type)throw Error(`Registry entity data need a type: ${e.name}`);this.dataRegistryMap.get(e.type)||this.dataRegistryMap.set(e.type,e),!this.dataInjectorMap.get(e.type)&&t&&this.dataInjectorMap.set(e.type,t)}getDataRegistryByType(e){return this.dataRegistryMap.get(e)}getEntityById(e){return this.entityInstanceMap.get(e)}getEntity(e,t){let i=this.getEntities(e)[0];return!i&&t?this.createEntity(e):i}getEntities(e){return this.entityInstanceMapByType.get(e.type)||[]}getEntityDatas(e,t){return this.getEntities(e).map(e=>e.getData(t)).filter(e=>!!e)}hasEntity(e){return!!this.getEntity(e)}storeState(){let{configOnly:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];for(let i of this.entityInstanceMap.values())if((!e||i instanceof ts)&&i.toJSON&&i.toJSON){let e=i.toJSON();e&&t.push(e)}return t}restoreState(e){e&&Array.isArray(e)&&e.forEach(e=>{if(!e||!e.type||!e.id)return;let t=this.getRegistryByType(e.type);if(!t)return void console.warn(`Playground entity registry lost: ${e.type}`);let i=this.createEntity(t,{id:e.id});i.fromJSON&&i.fromJSON(e)})}saveEntity(e){let{id:t}=e;if(t&&this.entityInstanceMap.has(t))return void console.error(`Entity ${e.type} ${t} is created before`);this.entityInstanceMap.set(e.id,e);let i=this.entityInstanceMapByType.get(e.type);i||(i=[],this.entityInstanceMapByType.set(e.type,i)),e instanceof ts&&this.configEntities.set(e.type,e),i.push(e),e.onEntityChange(e=>{this.fireEntityChanged(e),this.fireEntityLifeCycleChanged({type:"update",entity:e})}),e.onDataChange(t=>{this.fireEntityDataChanged(e.type,t.data.type)}),e.toDispose.push(E.JT.create(()=>{this.removeEntity(e),this.fireEntityLifeCycleChanged({type:"delete",entity:e})})),e.getDefaultDataRegistries().forEach(t=>this.fireEntityDataChanged(e.type,t.type)),this.fireEntityChanged(e),this.fireEntityLifeCycleChanged({type:"add",entity:e})}removeEntity(e){if(this.entityInstanceMap.has(e.id)&&this.entityInstanceMapByType.has(e.type)){let t=this.entityInstanceMapByType.get(e.type);-1!==t.indexOf(e)&&(this.entityInstanceMapByType.set(e.type,t.filter(t=>t!==e)),this.entityInstanceMap.delete(e.id),this.configEntities.has(e.type)&&this.configEntities.delete(e.type),this.fireEntityChanged(e))}}reset(){for(let e of this.entityInstanceMap.values())e.reset()}getEntityVersion(e){return this.entityVersionMap.get("string"==typeof e?e:e.type)||0}getEntityDataVersion(e){return this.entityDataVersionMap.get("string"==typeof e?e:e.type)||0}dispose(){this.toDispose.dispose()}getDataInjector(e){return this.dataInjectorMap.get("string"==typeof e?e:e.type)}getService(e){var t;return null==(t=this.containerFactory)?void 0:t.get(e)}constructor(){this.toDispose=new E.K4,this.onEntityChangeEmitter=new E.Q5,this.onEntityLifeCycleEmitter=new E.Q5,this.onEntityDataChangeEmitter=new E.Q5,this.registryMap=new Map,this.dataRegistryMap=new Map,this.dataInjectorMap=new Map,this.entityInstanceMap=new Map,this.entityVersionMap=new Map,this.entityDataVersionMap=new Map,this.entityInstanceMapByType=new Map,this.configEntities=new Map,this.onEntityChange=this.onEntityChangeEmitter.event,this.onEntityDataChange=this.onEntityDataChangeEmitter.event,this.onEntityLifeCycleChange=this.onEntityLifeCycleEmitter.event,this.changeEntityLocked=!1,this.schedule=new Z,this.fireEntityChanged=e=>{let t="string"==typeof e?e:e.type,i=this.entityVersionMap.get(t)||0;i===Number.MAX_SAFE_INTEGER&&(i=0),this.entityVersionMap.set(t,i+1),this.changeEntityLocked||this.schedule.push(t,()=>{this.onEntityChangeEmitter.fire(t)})},this.fireEntityDataChanged=(e,t)=>{let i=this.entityDataVersionMap.get(t)||0;i===Number.MAX_SAFE_INTEGER&&(i=0),this.entityDataVersionMap.set(t,i+1),this.schedule.push(`${e}/${t}`,()=>{this.onEntityDataChangeEmitter.fire({entityType:e,entityDataType:t})})},this.fireEntityLifeCycleChanged=e=>{let{type:t,entity:i}=e;this.schedule.push(`${t}/${i.id}`,()=>{this.onEntityLifeCycleEmitter.fire({type:t,entity:i})})},this.toDispose.pushAll([this.onEntityChangeEmitter,this.schedule])}};j([(0,D.nx)(to),(0,D.jt)()],ta.prototype,"contributions",2),j([tr()],ta.prototype,"context",2),j([(0,D.f3)(tn),(0,D.jt)()],ta.prototype,"containerFactory",2),j([(0,D.zY)()],ta.prototype,"init",1),ta=j([(0,D.b2)()],ta);var tl=Symbol("EntitiesDecorator"),th=Symbol("EntitiesByDataDecorator"),td=Symbol("PropertiesInjected");function tu(e,t){return Reflect.getMetadata(t,e.prototype)||[]}function tc(e){return Reflect.getMetadata(td,e)||[]}function tg(e,t,i,r){return(n,o)=>{let s=Reflect.getMetadata(e,n);if(s||Reflect.defineMetadata(e,s=[],n),Array.isArray(t)||(t=[t]),t.forEach(e=>{s.includes(e)||s.push(e)}),r&&r(n,o),o&&i){let e=tc(n);return e.push(o),Reflect.defineMetadata(td,e,n),{enumerable:!1,configurable:!1,get(){return i(this,o)}}}}}function tp(e){return tg(tl,e,t=>t.observeManager.get(e))}function tf(e){return tg(tl,e,t=>t.observeManager.getEntities(e))}function ty(e,t){return tg(th,{entity:e,data:t},i=>i.observeManager.getEntityDatas(e,t))}var tm=Symbol("ProtectWheelArea"),tv=((h=tv||{})[h.BASE_LAYER=-2]="BASE_LAYER",h[h.TOOL_LAYER=-1]="TOOL_LAYER",h[h.NORMAL_LAYER=0]="NORMAL_LAYER",h),tE=Symbol("PipelineLayerFactory"),tb=class{get selection(){return this.currentSelection}isEmpty(){return 0===this.currentSelection.length}set selection(e){E.XJ.isArrayShallowChanged(this.currentSelection,e)&&(this.disposers.forEach(e=>e.dispose()),this.changeSelection(e),this.disposers=this.currentSelection.map(e=>e.onDispose(()=>{let t=this.currentSelection.filter(t=>t!==e);this.changeSelection(t)})))}changeSelection(e){this.currentSelection=e,this.onSelectionChangedEmitter.fire(this.currentSelection)}dispose(){this.onSelectionChangedEmitter.dispose()}constructor(){this.onSelectionChangedEmitter=new E.Q5,this.onSelectionChanged=this.onSelectionChangedEmitter.event,this.currentSelection=[],this.disposers=[]}};tb=j([(0,D.b2)()],tb);var tD=Symbol("StorageService"),tN=class{setData(e,t){this.storage[this.prefix(e)]=JSON.stringify(t)}getData(e,t){let i=this.storage[this.prefix(e)];return void 0===i?t:JSON.parse(i)}prefix(e){return`${this._prefix}${e}`}setPrefix(e){this._prefix=e}init(){"undefined"!=typeof window&&window.localStorage?this.storage=window.localStorage:this.storage={}}constructor(){this._prefix="__gedit:"}};j([(0,D.zY)()],tN.prototype,"init",1),tN=j([(0,D.b2)()],tN);var tC=Symbol("ClipboardService"),tM=class{readText(){return this._currentData}writeText(e){this._currentData!==e&&(this._currentData=e,this.onClipboardChangedEmitter.fire(e))}constructor(){this.onClipboardChangedEmitter=new E.Q5,this.onClipboardChanged=this.onClipboardChangedEmitter.event}};tM=j([(0,D.b2)()],tM);var tS=class{get rightPanelVisible(){return this.isRightPanelVisible}set rightPanelVisible(e){this.isRightPanelVisible=e}};tS=j([(0,D.b2)()],tS);var tx=class{onAllLayersRendered(){this.onLoggerEmitter.fire({event:0})}onFlushRequest(e){e<=0||this.onLoggerEmitter.fire({event:1,props:{rfi:e,fps:1e3/e}})}dispose(){this.onLoggerEmitter.dispose()}constructor(){this.onLoggerEmitter=new E.Q5,this.onLogger=this.onLoggerEmitter.event}};function tw(e){let{originRenderer:t,renderedCb:i}=e;return(0,M.useEffect)(()=>{i()},[]),t()||null}tx=j([(0,D.b2)()],tx);var t_=class{subscribeEntities(e,t){let i=this.getSelector(e);t.forEach(t=>{i.entities.includes(t)||i.entities.push(t);let r=this.entityLayerMap.get(t.type);r||(r=new Set,this.entityLayerMap.set(t.type,r)),r.add(e)})}subscribleEntityByData(e,t,i){let r=this.getSelector(e),n=this.entityLayerMap.get(t.type);n||(n=new Set,this.entityLayerMap.set(t.type,n)),n.add(e);let o=[t,i];r.datas.find(e=>e[0]===t&&e[1]===i)||r.datas.push(o)}getSelector(e){let t=this.layerEntitiesSelectorMap.get(e);return t||(t={entities:[],datas:[]},this.layerEntitiesSelectorMap.set(e,t)),t}getLayerEntities(e){let t=this.layerEntitiesSelectorMap.get(e);if(!t)return{entities:[],changed:!1};let i=new Set,r=new Map,n=!1;t.entities.forEach(e=>{let t=this.entityManager.getEntities(e),n=this.entityManager.getEntityVersion(e);for(let o of(r.set(e.type,n),t))i.add(o)});let o=[];for(let e of i.values())o.push(e);return tI(r,t.lastEntityVersion)&&(t.lastEntityVersion=r,n=!0),{entities:o,changed:n}}getLayerEntityDatas(e){let t=this.layerEntitiesSelectorMap.get(e);if(!t)return{datas:[],changed:!1};let i=[],r=new Map,n=!1;return t.datas.forEach(e=>{let[t,n]=e,o=this.entityManager.getEntityDatas(t,n),s=this.entityManager.getEntityDataVersion(n);for(let e of(r.set(n.type,s),o))i.push(e)}),tI(r,t.lastDataVersion)&&(t.lastDataVersion=r,n=!0),{datas:i,changed:n}}getLayerData(e){let t=this.getLayerEntities(e),i=this.getLayerEntityDatas(e);return{observeEntities:t.entities,observeDatas:i.datas,changed:i.changed||t.changed}}constructor(){this.layerEntitiesSelectorMap=new WeakMap,this.entityLayerMap=new Map,this.ableLayerMap=new Map}};function tI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Map,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(e.size!==t.size)return!0;for(let i of e.keys())if(e.get(i)!==t.get(i))return!0;return!1}j([(0,D.f3)(ta)],t_.prototype,"entityManager",2),t_=j([(0,D.b2)()],t_);var tL=0,tT=class extends S.ConflatableMessage{constructor(e){super(`flush-layer-request_layer${tL++}`),this.layer=e}},tA=class{reportLayerRendered(e){this.layerRenderedMap.set(e,!0),Array.from(this.layerRenderedMap.values()).every(e=>e)&&(this.loggerService.onAllLayersRendered(),this.onAllLayersRenderedEmitter.fire(),window.REPORT_TTI_FOR_E2E&&window.REPORT_TTI_FOR_E2E(performance.now(),performance.getEntriesByType("resource")))}addLayer(e){if(this.layers.push(e),this.toDispose.push(e),this.layerFlushMessages.set(e,new tT(e)),e.pipelineNode=this.node,e.playgroundNode=this.node.parentElement,(e.autorun||e.render)&&!e.node&&(e.node=document.createElement("div")),e.node&&(this.node.appendChild(e.node),e.node.classList.add("gedit-playground-layer")),e.autorun){let t=e.autorun.bind(e);this.layerAutorunMap.set(e,t),e.autorun=()=>{this.updateLayer(e,!0)}}else if(e.render){this.layerRenderedMap.set(e,!1);let t=e.render.bind(e),i=function(e,t,i,r){let n=E.dG;function o(){let o,[,s]=(0,M.useState)({}),a=(0,M.useCallback)(()=>{i(e)},[e]);(0,M.useEffect)(()=>(n=()=>s({}),()=>{n=E.dG}));try{o=r.isReady?M.createElement(tw,{originRenderer:t,renderedCb:a}):M.createElement(M.Fragment,null)}catch(t){console.error(`Render Layer "${e.constructor.name}" error `,t),o=M.createElement(M.Fragment,null)}return x.createPortal(o,e.node)}return{autorun:()=>n(),portal:e.renderWithReactMemo?M.memo(o):o}}(e,t,this.reportLayerRendered.bind(this),this);this.reactPortals.push(i.portal),this.layerAutorunMap.set(e,i.autorun),e.render=()=>{this.updateLayer(e,!0)}}}flush(e){this.layers.forEach(t=>{this.updateLayer(t,e)})}ready(){this.layers.forEach(e=>{this.loadLayerEntities(e),e.onReady&&e.onReady()}),this.isReady=!0,this.flush(!0)}dispose(){this.toDispose.dispose(),this.node.remove()}processMessage(e){e instanceof tT&&this.onFlushRequest(e.layer)}loadLayerEntities(e){let t=this.selector.getLayerData(e);return t.changed&&e.observeManager.load(t.observeEntities,t.observeDatas),t.changed}onFlushRequest(e){if(!this.isReady||this.toDispose.disposed)return!1;let t=performance.now(),i=()=>{let e=performance.now()-t;e<4||this.loggerService.onFlushRequest(e)},r=this.layerAutorunMap.get(e),n=this.loadLayerEntities(e);if(r&&(n||this.forceUpdates.has(e))){this.forceUpdates.delete(e);try{r()}catch(e){console.error(e)}return i(),!0}return i(),!1}updateLayer(e,t){t&&this.forceUpdates.add(e),S.MessageLoop.postMessage(this,this.layerFlushMessages.get(e))}toReactComponent(){if(this.reactComp)return this.reactComp;let e=this.reactPortals,t=()=>M.createElement(M.Fragment,null,e.map((e,t)=>M.createElement(e,{key:t})));return this.reactComp=t,t}constructor(e,t){this.selector=e,this.isReady=!1,this.onAllLayersRenderedEmitter=new E.Q5,this.toDispose=new E.K4,this.layers=[],this.forceUpdates=new Set,this.layerAutorunMap=new Map,this.layerRenderedMap=new Map,this.layerFlushMessages=new Map,this.reactPortals=[],this.node=E.xF.createDivWithClass("gedit-playground-pipeline"),this.onAllLayersRendered=this.onAllLayersRenderedEmitter.event,this.toDispose.push(t.onEntityChange(e=>{let t=this.selector.entityLayerMap.get(e);t&&t.forEach(e=>this.updateLayer(e))})),this.toDispose.push(this.onAllLayersRenderedEmitter)}};j([(0,D.f3)(tx)],tA.prototype,"loggerService",2),tA=j([(0,D.b2)(),z(0,(0,D.f3)(t_)),z(1,(0,D.f3)(ta))],tA),(d=y||(y={})).STATE_SELECT={id:"STATE_SELECT",cursor:"",shortcut:"",cancelMode:"hold"},d.STATE_MOUSE_FRIENDLY_SELECT={id:"STATE_MOUSE_FRIENDLY_SELECT",cursor:"grab",shortcut:"",cancelMode:"hold"},d.STATE_GRAB={id:"STATE_GRAB",cursor:"grab",shortcut:"SPACE",shortcutAutoEsc:!0,shortcutWorksOnlyOnStateChanged:!0,cancelMode:"hold"};var tO=[y.STATE_SELECT,y.STATE_MOUSE_FRIENDLY_SELECT,y.STATE_GRAB],tk=class extends ts{get isPressingSpaceBar(){return this._isPressingSpaceBar}set isPressingSpaceBar(e){this._isPressingSpaceBar=e}get isPressingShift(){return this._isPressingShift}set isPressingShift(e){this._isPressingShift=e}onCancel(e,t){return this.onStateChange(i=>{i.lastState&&i.lastState.id===e&&t()})}getCurrentState(){return this.states.find(e=>e.id===this.selected)}is(e){return this.selected===e}changeState(e,t){let i=this.states.find(t=>t.id===e);if(!i)throw Error(`Unknown editor state ${e}`);if(this.selected!==e){let r=this.getCurrentState();this.selected=e,this.onStateChangeEmitter.fire({state:i,event:t,lastState:r}),this.fireChange()}}toDefaultState(){this.changeState(y.STATE_SELECT.id)}registerState(e){this.states.push(e),this.fireChange()}getStates(){return this.states}isMouseFriendlyMode(){return this.getCurrentState()===y.STATE_MOUSE_FRIENDLY_SELECT}getStateFromShortcut(e){return this.states.find(t=>{if(("SPACE"===t.shortcut?" ":(t.shortcut||"").toLowerCase())===e.key.toLowerCase())return t})}constructor(e){super(e),this._isPressingSpaceBar=!1,this._isPressingShift=!1,this.states=tO.slice(),this.selected=y.STATE_SELECT.id,this.onStateChangeEmitter=new E.Q5,this.onStateChange=this.onStateChangeEmitter.event,this.toDispose.push(this.onStateChangeEmitter)}};tk.type="EditorStateConfigEntity";var tR=0,tP=class extends ts{get grabDisable(){return this.config.grabDisable}set grabDisable(e){this.updateConfig({grabDisable:e})}get scrollDisable(){return this.config.scrollDisable}set scrollDisable(e){this.updateConfig({scrollDisable:e})}get zoomDisable(){return this.config.zoomDisable}set zoomDisable(e){this.updateConfig({zoomDisable:e})}getDefaultConfig(){return{scrollX:0,scrollY:0,originX:0,originY:0,width:0,height:0,minZoom:.25,maxZoom:2,zoom:1,clientX:0,clientY:0,reverseScroll:!0,overflowX:"scroll",overflowY:"scroll",disabled:!1,readonly:!1,grabDisable:!1,scrollDisable:!1,zoomDisable:!1,mouseScrollDelta:.05}}addScrollLimit(e){this._scrollLimitFn=e}updateConfig(e){void 0!==e.zoom&&(e={...e,zoom:this.normalizeZoom(e.zoom)}),!(e={...this.config,...e}).reverseScroll&&(e.scrollX<this.config.originX&&(e.scrollX=this.config.originX),e.scrollY<this.config.originY&&(e.scrollY=this.config.originY)),void 0!==e.scrollLimitX&&e.scrollX<e.scrollLimitX&&(e.scrollX=e.scrollLimitX),void 0!==e.scrollLimitY&&e.scrollY<e.scrollLimitY&&(e.scrollY=e.scrollLimitY),"hidden"===e.overflowX&&(e.scrollX=this.config.originX),"hidden"===e.overflowY&&(e.scrollY=this.config.originY);let t=e.scrollDisable||this.scrollDisable,{readonly:i,disabled:r,grabDisable:n}=this;t&&(e.scrollX=this.config.scrollX,e.scrollY=this.config.scrollY),super.updateConfig(this._scrollLimitFn?{...e,...this._scrollLimitFn({scrollX:e.scrollX,scrollY:e.scrollY})}:e),(i!==this.readonly||r!==this.disabled)&&this._onReadonlyOrDisabledChangeEmitter.fire({readonly:this.readonly,disabled:this.disabled}),n!==this.grabDisable&&this._onGrabDisableChangeEmitter.fire(this.grabDisable)}get finalScale(){return this.zoomEnable?this.config.zoom:1}get zoom(){return this.zoomEnable?this.config.zoom:1}get scrollData(){return{scrollX:this.config.scrollX,scrollY:this.config.scrollY}}normalizeZoom(e){return this.zoomEnable?this.zoomDisable?this.config.zoom:(e<this.config.minZoom?e=this.config.minZoom:e>this.config.maxZoom&&(e=this.config.maxZoom),e):1}updateCursor(e){this.cursor!==e&&(this.cursor=e,this.fireChange())}getPosFromMouseEvent(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{config:i}=this,r=t?this.zoom:1,{clientX:n,clientY:o}=p.getEventCoord(e);return{x:(n+i.scrollX-i.clientX)/r,y:(o+i.scrollY-i.clientY)/r}}toFixedPos(e){let{config:t}=this;return{x:e.x-t.scrollX+t.clientX,y:e.y-t.scrollY+t.clientY}}getViewport(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{config:t}=this,i=e?this.finalScale:1;return new E.Ae(t.scrollX/i,t.scrollY/i,t.width/i,t.height/i)}isViewportVisible(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return E.Ae.isViewportVisible(e,this.getViewport(),t,i)}scrollToView(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scrollDelta:i,position:r,easing:n=!0,easingDuration:o=300,entities:s}=t,{config:a}=this,l=t.zoom?t.zoom:this.finalScale;if(s&&s.length>0){let t=s.map(e=>{let t=e.getData(J);if(t)return t.bounds;let i=e.getData($),r=e.getData(W)||{width:0,height:0};if(i)return new E.Ae(i.x,i.y,r.width,r.height||0)}).filter(e=>!!e);t.length>0&&(e=E.Ae.enlarge(t))}else r?e=new E.Ae(r.x,r.y,0,0):t.bounds&&(e=t.bounds);if(!e){let t=this.getDefaultConfig();e=new E.Ae((t.scrollX+a.width/2)/l,(t.scrollY+a.height/2)/l,0,0)}if(!t.scrollToCenter&&this.getViewport().containsRectangle(e))return Promise.resolve();let h={scrollX:(e.x+e.width/2+(i?i.x:0))*l-a.width/2,scrollY:(e.y+e.height/2+(i?i.y:0))*l-a.height/2,zoom:t.zoom};return this.scroll(h,n,o)}setPageBounds(e){this.updateConfig({pageBounds:{x:e.x,y:e.y,width:e.width,height:e.height}})}getPageBounds(){let{pageBounds:e}=this.config;if(e)return new E.Ae(e.x,e.y,e.width,e.height)}scrollPageBoundsToCenter(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=this.getPageBounds();if(r){let n,o=2*t;return e&&(n=E.rM.fixSize({width:r.width,height:r.height},{width:o>this.config.width?o:this.config.width-o,height:o>this.config.height?o:this.config.height-o})),this.scrollToView({bounds:r,zoom:n,scrollToCenter:!0,easing:i})}return this.scrollToView({easing:i})}scroll(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,r=new E.cO;if(this.cancelScrollTeeen&&this.cancelScrollTeeen.dispose(),t){let t={scrollX:this.config.scrollX,scrollY:this.config.scrollY,zoom:this.config.zoom};this.cancelScrollTeeen=et({from:t,to:{...t,...e},onUpdate:e=>{this.updateConfig(e)},onComplete:()=>{this.cancelScrollTeeen=void 0,r.resolve()},onDispose:()=>{r.resolve()},duration:i})}else this.updateConfig(e),r.resolve();return r.promise}fixLayerPosition(e){E.xF.setStyle(e,{left:this.config.scrollX,top:this.config.scrollY})}get loading(){return this._loading}set loading(e){this.loading!==e&&(this._loading=e,this.fireChange())}get zoomEnable(){return this._zoomEnable}set zoomEnable(e){this._zoomEnable!==e&&(this._zoomEnable=e,this.fireChange())}zoomin(e,t){let i=this.config.zoom/10,r=Math.ceil((this.config.zoom+i)*10)/10;this.updateZoom(r,e,t)}zoomout(e,t){let i=this.config.zoom/10,r=Math.floor((this.config.zoom-i)*10)/10;this.updateZoom(r,e,t)}updateZoom(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;e=this.normalizeZoom(e);let{center:r}=this.getViewport(),n=this.finalScale,o=this.zoomEnable?e:n;if(o!==n){let s={x:r.x*o-r.x*n,y:r.y*o-r.y*n};this.scroll({scrollX:this.config.scrollX+s.x,scrollY:this.config.scrollY+s.y,zoom:e},t,i)}}get disabled(){return this.config.disabled}get readonly(){return this.config.readonly}get readonlyOrDisabled(){return this.config.readonly||this.config.disabled}set readonly(e){this.updateConfig({readonly:e})}set disabled(e){this.updateConfig({disabled:e})}fitView(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300,n=this.getViewport(!1),o=E.rM.fixSize(e.clone().pad(i,i),n);return this.scrollToView({bounds:e,zoom:o,easing:t,easingDuration:r,scrollToCenter:!0})}constructor(e){super(e),this._loading=!1,this._zoomEnable=!0,this._onReadonlyOrDisabledChangeEmitter=new E.Q5,this._onGrabDisableChangeEmitter=new E.Q5,this.onGrabDisableChange=this._onGrabDisableChangeEmitter.event,this.onReadonlyOrDisabledChange=this._onReadonlyOrDisabledChangeEmitter.event,this.cursor="default",this.toDispose.push(this._onReadonlyOrDisabledChangeEmitter)}};tP.type="PlaygroundConfigEntity";var tj=Symbol("LayerOptions"),tz=class{dispose(){this.toDispose.dispose()}createDOMCache(e,t){if(!this.node)throw Error("DomCache need a parent dom node.");return E.xF.createDOMCache(this.node,e,t)}getPosFromMouseEvent(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=this.config.getPosFromMouseEvent(e,t);return{x:i.x,y:i.y}}constructor(){this.toDispose=new E.K4,this.renderWithReactMemo=!0}};j([(0,D.f3)(tj)],tz.prototype,"options",2),j([(0,D.f3)(ta)],tz.prototype,"entityManager",2),j([tr()],tz.prototype,"context",2),tz=j([(0,D.b2)()],tz);var tV=class extends tz{onReady(){if(this.options={preventGlobalGesture:!1,...this.options},this.options.preventGlobalGesture){let e=new e9(document.body,{onPinch:()=>{}});document.documentElement&&(document.documentElement.style.overscrollBehaviorX="none"),document.body.style.overscrollBehaviorX="none",this.toDispose.push(E.JT.create(()=>e.destroy()))}this.toDispose.pushAll([this.config.onGrabDisableChange(e=>{e&&this.grabDragger.stop(0,0)}),E.xF.addStandardDisposableListener(this.playgroundNode,"wheel",e=>{this.getScrollParent(e.target)||(e.preventDefault(),e.stopPropagation())}),this.listenPlaygroundEvent("wheel",this.handleWheelEvent.bind(this),-2,{passive:!0}),this.listenPlaygroundEvent("touchstart",e=>{var t,i;let{clientX:r,clientY:n}=p.getEventCoord(e);(null==(t=this.options)?void 0:t.hoverService)&&(this.options.hoverService.updateHoverPosition({x:r,y:n},e.target),(null==(i=this.options.hoverService)?void 0:i.isSomeHovered())||this.grabDragger.start(r,n))},0),this.listenPlaygroundEvent("touchend",e=>{var t;null==(t=this.options.hoverService)||t.clearHovered()}),this.listenPlaygroundEvent("touchcancel",e=>{var t;null==(t=this.options.hoverService)||t.clearHovered()}),this.listenPlaygroundEvent("mousedown",e=>{let t=1===e.button;t&&!this.isMouseMode()&&this.editorStateConfig.changeState(y.STATE_GRAB.id),this.isGrab()&&(this.editorStateConfig.isPressingSpaceBar||t)&&this.grabDragger.start(e.clientX,e.clientY)},-2),this.listenPlaygroundEvent("mousedown",e=>{var t,i;let r=null==(i=this.options)||null==(t=i.hoverService)?void 0:t.isSomeHovered();!this.isMouseMode()||r||this.editorStateConfig.isPressingShift||this.grabDragger.start(e.clientX,e.clientY)},0),this.editorStateConfig.onStateChange(this.onStateChanged.bind(this)),this.listenGlobalEvent("keydown",e=>{e.shiftKey&&(this.editorStateConfig.isPressingShift=!0,this.isMouseMode()&&this.config.updateCursor(""))},-2),this.listenGlobalEvent("keypress",e=>{if(!this.isFocused||e.target!==this.playgroundNode||this.isMouseMode())return;let t=this.editorStateConfig.getStateFromShortcut(e);" "===e.key&&(this.editorStateConfig.isPressingSpaceBar=!0),((null==t?void 0:t.shortcutWorksOnlyOnStateChanged)!==!0||t!==this.editorStateConfig.getCurrentState())&&(this.lastShortcutState=t,t&&this.editorStateConfig.changeState(t.id))},-2),this.listenGlobalEvent("keyup",e=>{" "===e.key&&(this.editorStateConfig.isPressingSpaceBar=!1),this.editorStateConfig.isPressingShift=!1,this.lastShortcutState&&this.lastShortcutState.shortcutAutoEsc&&this.editorStateConfig.toDefaultState(),this.lastShortcutState=void 0}),{dispose:()=>{this.maskNode.parentNode&&this.maskNode.parentNode.removeChild(this.maskNode),this.cursorStyle.parentNode&&this.cursorStyle.parentNode.removeChild(this.cursorStyle)}}]),"MOUSE"===this.options.ineractiveType&&this.editorStateConfig.changeState(y.STATE_MOUSE_FRIENDLY_SELECT.id)}getCursor(e){var t,i,r;return e?(null==(i=(r=this.playgroundConfigEntity).getCursors)||null==(t=i.call(r))?void 0:t[e])??e:""}isMouseMode(){return this.editorStateConfig.isMouseFriendlyMode()}onStateChanged(e){let{state:t}=e;if(this.cancelStateListen&&(this.cancelStateListen.dispose(),this.cancelStateListen=void 0),t.handle&&t.handle(this.config,e),t.cursor?(this.playgroundConfigEntity.updateCursor(t.cursor),this.currentGesture&&this.currentGesture.target.parentNode&&(this.currentGesture.target.parentNode.style.cursor=this.getCursor(t.cursor))):(this.playgroundConfigEntity.updateCursor(""),this.currentGesture&&this.currentGesture.target.parentNode&&(this.currentGesture.target.parentNode.style.cursor="")),"grab"===t.cursor||"grabbing"===t.cursor){if(t===y.STATE_MOUSE_FRIENDLY_SELECT)return;this.maskNode.style.cssText=`
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 100;
      `,this.playgroundNode.appendChild(this.maskNode)}else this.maskNode.parentNode&&this.maskNode.parentNode.removeChild(this.maskNode);"esc"===t.cancelMode?this.cancelStateListen=E.xF.addStandardDisposableListener(document.body,"keydown",e=>{("Escape"===e.key||"Enter"===e.key)&&this.editorStateConfig.toDefaultState()},!0):"once"===t.cancelMode&&this.editorStateConfig.toDefaultState()}isGrab(){let e=this.editorStateConfig.getCurrentState();return e===y.STATE_GRAB||e===y.STATE_MOUSE_FRIENDLY_SELECT}createGesture(){this.currentGesture||(this.currentGesture=new e6(this.pipelineNode.parentElement,this.config),this.currentGesture.onDispose(()=>{this.currentGesture=void 0}),this.toDispose.push(this.currentGesture))}onResize(e){this.size={...e},this.updateSizeWithRulerConfig()}updateSizeWithRulerConfig(){let{size:e}=this;e&&this.config.updateConfig({width:e.width,height:e.height,clientX:e.clientX,clientY:e.clientY})}handleScrollEvent(e){let{playgroundConfigEntity:t}=this,i=t.config.scrollX+e.deltaX,r=t.config.scrollY+e.deltaY;t.updateConfig({scrollX:i,scrollY:r})}getMouseScaleDelta(){let{mouseScrollDelta:e,zoom:t}=this.config.config;return"function"==typeof e?e(t):e??.05}handleWheelEvent(e){if((!this.currentGesture||!this.currentGesture.pinching)&&!e.ctrlKey&&!e.metaKey&&!this.getScrollParent(e.target)){if(this.isMouseMode()){let{zoom:t,minZoom:i,maxZoom:r,scrollX:n,scrollY:o}=this.playgroundConfigEntity.config,s=this.getMouseScaleDelta(),a=(Math.abs(e.deltaY)>0?e.deltaY:e.deltaX)>0?-s:s,l=this.config.finalScale,h=e.clientX,d=e.clientY,u=Math.max(i,Math.min(r,t+a)),c=this.config.getPosFromMouseEvent({clientX:h,clientY:d},!1),g={x:c.x/l*u,y:c.y/l*u};this.config.updateConfig({scrollX:n+g.x-c.x,scrollY:o+g.y-c.y,zoom:u});return}this.handleScrollEvent(e)}}getScrollParent(e){var t;if(!e||e===this.pipelineNode.parentElement)return null;let i=e.scrollWidth>e.clientWidth,r=e.scrollHeight>e.clientHeight,n=window.getComputedStyle(e).overflowX,o=window.getComputedStyle(e).overflowY,s=["auto","scroll","overlay"].includes(n),a=["auto","scroll","overlay"].includes(o);return i&&s||r&&a||(null==(t=this.protectWheelArea)?void 0:t.call(this,e))?e:this.getScrollParent(e.parentElement)}autorun(){let e=this.playgroundConfigEntity.config,{cursor:t}=this.playgroundConfigEntity,i=this.getCursor(t);if(this.config.zoomEnable?this.createGesture():this.currentGesture&&this.currentGesture.dispose(),E.xF.setStyle(this.pipelineNode,{left:-e.scrollX,top:-e.scrollY,width:e.width,height:e.height}),this.pipelineNode.parentElement.style.cursor=i,"grab"===t||"grabbing"===t){let e="";this.playgroundNode.classList.forEach(t=>{e+=`.${t}`}),this.cursorStyle.innerText=`.${e} * { cursor: ${i} }`,this.cursorStyle.parentNode||document.head.appendChild(this.cursorStyle)}else this.cursorStyle.parentNode&&this.cursorStyle.parentNode.removeChild(this.cursorStyle)}constructor(){super(...arguments),this.startGrabScroll={scrollX:0,scrollY:0},this.cursorStyle=document.createElement("style"),this.maskNode=document.createElement("div"),this.grabDragger=new q({onDragStart:e=>{this.config.grabDisable||(this.config.updateCursor("grabbing"),this.startGrabScroll={scrollX:this.config.config.scrollX,scrollY:this.config.config.scrollY})},onDrag:e=>{this.config.grabDisable||this.config.updateConfig({scrollX:this.startGrabScroll.scrollX-e.endPos.x+e.startPos.x,scrollY:this.startGrabScroll.scrollY-e.endPos.y+e.startPos.y})},onDragEnd:e=>{this.isGrab()&&this.config.updateCursor("grab"),1===e.button&&(this.isMouseMode()?(this.editorStateConfig.changeState(y.STATE_MOUSE_FRIENDLY_SELECT.id),this.config.updateCursor("grab")):(this.editorStateConfig.toDefaultState(),this.config.updateCursor("")))}})}};j([tp(tP)],tV.prototype,"playgroundConfigEntity",2),j([tp(tk)],tV.prototype,"editorStateConfig",2),j([(0,D.jt)(),(0,D.f3)(tm)],tV.prototype,"protectWheelArea",2),tV=j([(0,D.b2)()],tV);var tB=class{get size(){return this.observeEntities.length}load(e,t){this.observeEntities=e,this.observeDatas=t,this.entitiesTypeCache.clear(),this.entitiesAbleCache.clear(),this.entitiyDataCache.clear()}get(e,t){let i=this.getEntities(e);return void 0!==t?i.find(e=>e.id===t):i[0]}has(e){return!!this.get(e)}getEntities(e){let t=this.entitiesTypeCache.get(e);return t||(t=[],this.observeEntities.forEach(i=>{i.type===e.type&&t.push(i)}),this.entitiesTypeCache.set(e,t)),t.filter(e=>!e.disposed)}getEntityDatas(e,t){let i=`${e.type}:${t.type}`,r=this.entitiyDataCache.get(i);return r||(r=this.observeDatas.filter(i=>i.type===t.type&&i.entity.type===e.type),this.entitiyDataCache.set(i,r)),r}updateConfig(e,t){let i=this.get(e);i&&i.updateConfig&&i.updateConfig(t)}getConfig(e){let t=this.get(e);if(t)return t.config}createEntity(e,t){return this.entityManager.createEntity(e,t)}removeEntities(e){this.entityManager.removeEntities(e)}[Symbol.iterator](){let e=0,t=this.observeEntities.length;return{next:()=>{let i=e++;return{value:this.observeEntities[i],done:i===t}}}}constructor(e){this.entityManager=e,this.observeEntities=[],this.observeDatas=[],this.entitiesTypeCache=new Map,this.entitiesAbleCache=new Map,this.entitiyDataCache=new Map}},tF=new S.ConflatableMessage("PIPELINE_ZOOM"),tY=new S.ConflatableMessage("PIPELINE_SCROLL"),tU=class{_listenEvent(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0,o=i?this.globalEvents:this.playgroundEvents,s=i?document:this.renderer.node.parentNode,a=o[e];if(!a){let t={handleEvent:e=>{let t=a.handlers;for(let i=0,r=t.length;i<r;i++)if(t[i].handle(e))return}};s.addEventListener(e,t,n),a=o[e]={handlers:[],dispose:()=>{s.removeEventListener(e,t),delete o[e]}}}let{handlers:l}=a,h={handle:t,priority:r};l.unshift(h),l.sort((e,t)=>t.priority-e.priority);let d=E.JT.create(()=>{let e=a.handlers.indexOf(h);-1!==e&&a.handlers.splice(e,1),0===a.handlers.length&&a.dispose()});return this.toDispose.push(d),d}listenPlaygroundEvent(e,t,i,r){return this._listenEvent(e,t,!1,i,r)}listenGlobalEvent(e,t,i,r){return this._listenEvent(e,t,!0,i,r)}registerLayer(e,t){if(this.allLayersMap.has(e))return;let i=this.layerFactory(e,t);this.allLayersMap.set(e,i);let r=tu(e,tl),n=tu(e,th);if(r.forEach(e=>{this.entityManager.registerEntity(e),F.isRegistryOf(e,ts)&&this.entityManager.createEntity(e)}),n.forEach(e=>{this.entityManager.registerEntity(e.entity),this.entityManager.registerEntityData(e.data)}),this.selector.subscribeEntities(i,r),n.forEach(e=>this.selector.subscribleEntityByData(i,e.entity,e.data)),i.observeManager=new tB(this.entityManager),i.reloadEntities=()=>{let e=this.selector.getLayerData(i);return e.changed&&i.observeManager.load(e.observeEntities,e.observeDatas),e.changed},i.listenPlaygroundEvent=this.listenPlaygroundEvent.bind(this),i.listenGlobalEvent=this.listenGlobalEvent.bind(this),i.config=this.configEntity,i.getOtherLayer=this.getLayer.bind(this),Object.defineProperty(i,"isFocused",{get:()=>this._isFocused}),i.onResize&&this.onResize(i.onResize.bind(i)),i.onBlur&&this.onBlurEmitter.event(i.onBlur.bind(i)),i.onFocus&&this.onFocusEmitter.event(i.onFocus.bind(i)),i.onZoom&&this.onZoomEmitter.event(i.onZoom.bind(i)),i.onScroll&&this.onScrollEmitter.event(i.onScroll.bind(i)),i.onViewportChange){let e=i.onViewportChange.bind(i);this.onResize(e),this.onZoomEmitter.event(e),this.onScrollEmitter.event(e)}i.onReadonlyOrDisabledChange&&this.configEntity.onReadonlyOrDisabledChange(i.onReadonlyOrDisabledChange.bind(i)),this.renderer.addLayer(i)}getLayer(e){return this.allLayersMap.get(e)}get configEntity(){return this.entityManager.getEntity(tP,!0)}ready(){let e=this.configEntity,t=e.finalScale,i=e.scrollData;e.onConfigChanged(()=>{let r=e.finalScale,n=e.scrollData;r!==t&&(t=r,S.MessageLoop.postMessage(this,tF)),(i.scrollX!==n.scrollX||i.scrollY!==n.scrollY)&&(i=n,S.MessageLoop.postMessage(this,tY))})}processMessage(e){let t=this.configEntity;switch(e.type){case"PIPELINE_SCROLL":this.onScrollEmitter.fire(t.scrollData);break;case"PIPELINE_ZOOM":this.onZoomEmitter.fire(t.finalScale)}}dispose(){this.toDispose.dispose()}constructor(){this._isFocused=!1,this.toDispose=new E.K4,this.allLayersMap=new Map,this.onResizeEmitter=new E.Q5,this.onFocusEmitter=new E.Q5,this.onBlurEmitter=new E.Q5,this.onZoomEmitter=new E.Q5,this.onScrollEmitter=new E.Q5,this.onFocus=this.onFocusEmitter.event,this.onBlur=this.onBlurEmitter.event,this.onZoom=this.onZoomEmitter.event,this.onScroll=this.onScrollEmitter.event,this.playgroundEvents={},this.globalEvents={},this.onResize=this.onResizeEmitter.event,this.toDispose.pushAll([this.onResizeEmitter,this.onFocusEmitter,this.onZoomEmitter,this.onBlurEmitter,this.onScrollEmitter]),this.onFocusEmitter.event(()=>{this._isFocused=!0}),this.onBlurEmitter.event(()=>{this._isFocused=!1})}};j([(0,D.f3)(tA)],tU.prototype,"renderer",2),j([(0,D.f3)(t_)],tU.prototype,"selector",2),j([(0,D.f3)(ta)],tU.prototype,"entityManager",2),j([tr()],tU.prototype,"context",2),j([(0,D.f3)(tE)],tU.prototype,"layerFactory",2),tU=j([(0,D.b2)()],tU);var t$=M.createContext({}),tG=M.createContext({}),tQ=M.createContext({}),tW=M.createContext(void 0),tH=Symbol("PlaygroundConfig"),tX=Symbol("PlaygroundContribution"),tJ=class{config(e){Object.assign(this.playgroundConfig,e)}registerLayer(e){this.pipeline.registerLayer(e)}registerEntity(e){this.entityManager.registerEntity(e)}registerEditorState(e){let t=this.entityManager.getEntity(tk);null==t||t.registerState(e)}};j([(0,D.f3)(tU)],tJ.prototype,"pipeline",2),j([(0,D.f3)(ta)],tJ.prototype,"entityManager",2),j([(0,D.f3)(tH)],tJ.prototype,"playgroundConfig",2),tJ=j([(0,D.b2)()],tJ);var tZ=Symbol("PluginContext");Symbol("Plugin");var tK=0;function tq(e){let{contributionKeys:t,singleton:i=!1}=e;tK+=1;let r=`Playground_${tK}`;return n=>{let o=[],s=!1;return{pluginId:r,singleton:i,initPlugin:()=>{!s&&(s=!0,e.containerModules&&o.push(...e.containerModules),e.onBind&&o.push(new D.nZ((t,i,r,o)=>{e.onBind({bind:t,unbind:i,isBound:r,rebind:o},n)})),(e.onInit||e.onDispose||e.onReady||e.onAllLayersRendered)&&o.push(new D.nZ(t=>{t(tX).toDynamicValue(t=>{let i=t.container.get(tZ);return{onInit:()=>{var t;null==(t=e.onInit)||t.call(e,i,n)},onReady:()=>{var t;null==(t=e.onReady)||t.call(e,i,n)},onDispose:()=>{var t;null==(t=e.onDispose)||t.call(e,i,n)},onAllLayersRendered:()=>{var t;null==(t=e.onAllLayersRendered)||t.call(e,i,n)}}})})))},options:n,contributionKeys:t,containerModules:o}}}var t0=e=>tq(e)(void 0),t1=new Set,t2=new E.Q5,t4=new E.Q5,t3=class{static getLatest(){let e=t3.getAllInstances();return e[e.length-1]}static getAllInstances(){let e=[];for(let t of t1.values())e.push(t);return e}get context(){var e;return null==(e=this.contextProvider)?void 0:e.call(this)}get contributions(){return this.contributionProvider.getContributions()}init(){let{contributions:e}=this;for(let t of e)t.registerPlayground&&t.registerPlayground(this.registry);for(let t of e)t.onInit&&t.onInit(this);t2.fire(this)}get pipelineNode(){return this.pipelineRenderer.node}setParent(e){e.appendChild(this.node),this.resize()}get zoomEnable(){return this.config.zoomEnable}set zoomEnable(e){this.config.zoomEnable=e}flush(){this.pipelineRenderer.flush()}ready(){if(this.isReady)return;if(this.isReady=!0,this.playgroundConfig.autoResize){let e=(0,k.Z)(()=>{this.disposed||this.resize()},0);if("undefined"!=typeof ResizeObserver){let t=new ResizeObserver(e);t.observe(this.node),this.toDispose.push(E.JT.create(()=>{t.disconnect()}))}else this.toDispose.push(E.xF.addStandardDisposableListener(window.document.body,"resize",e,{passive:!0}));this.toDispose.push(E.xF.addStandardDisposableListener(window.document,"scroll",e,{passive:!0})),this.resize()}this.pipelineRegistry.ready(),this.pipelineRenderer.ready();let{contributions:e}=this;for(let t of e)t.onReady&&t.onReady(this)}scrollToView(e){return this.entityManager.getEntity(tP).scrollToView(e)}resize(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!e){let t=this.node.getBoundingClientRect();e={clientX:t.left,clientY:t.top,width:t.width,height:t.height}}let{width:i,height:r}=this.config.config;if(0===e.width||0===e.height)return;let{scrollX:n,scrollY:o}=this.config.config;t&&i&&Math.round(e.width)!==i&&(n+=(i-e.width)/2),t&&r&&Math.round(e.height)!==r&&(o+=(r-e.height)/2),this.config.updateConfig({...e,scrollX:n,scrollY:o}),this.pipelineRegistry.onResizeEmitter.fire(e)}focus(){this._focused||(this._focused=!0,this.pipelineRegistry.onFocusEmitter.fire())}blur(){this._focused&&(this._focused=!1,this.pipelineRegistry.onBlurEmitter.fire())}get focused(){return this._focused}get config(){return this.entityManager.getEntity(tP)}get editorState(){return this.entityManager.getEntity(tk)}getConfigEntity(e){return this.entityManager.getEntity(e,!0)}dispose(){if(this.disposed)return;let{contributions:e}=this;for(let t of e)t.onDispose&&t.onDispose(this);this.toDispose.dispose()}get disposed(){return this.toDispose.disposed}toReactComponent(){return this.pipelineRenderer.toReactComponent()}registerLayer(e,t){this.pipelineRegistry.registerLayer(e,t)}registerLayers(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(e=>this.pipelineRegistry.registerLayer(e))}getLayer(e){return this.pipelineRegistry.getLayer(e)}get onAllLayersRendered(){return this.pipelineRenderer.onAllLayersRendered}constructor(e,t,i,r,n,o,s,a,l){this.entityManager=e,this.registry=t,this.contextProvider=i,this.pipelineRenderer=r,this.pipelineRegistry=n,this.playgroundConfig=o,this.contributionProvider=s,this.commandService=a,this.selectionService=l,this.toDispose=new E.K4,this._focused=!1,this.playgroundClassName=(0,b.x0)(),this.isReady=!1,this.toDispose.pushAll([this.pipelineRenderer,this.pipelineRegistry,this.entityManager,this.commandService,this.selectionService,E.JT.create(()=>{t1.delete(this),this.node.remove(),t4.fire(this)}),r.onAllLayersRendered(()=>{this.contributions.forEach(e=>{var t;return null==(t=e.onAllLayersRendered)?void 0:t.call(e,this)})})]);let h=this.entityManager.createEntity(tk);if(this.entityManager.createEntity(tP),this.node=o.node||document.createElement("div"),this.toDispose.pushAll([E.xF.addStandardDisposableListener(this.node,"scroll",e=>{this.node.scrollTop=0,this.node.scrollLeft=0,e.preventDefault(),e.stopPropagation()})]),this.node.classList.add("gedit-playground"),this.node.classList.add(this.playgroundClassName),this.node.dataset.testid="sdk.workflow.canvas",o.layers&&o.layers.forEach(e=>this.registry.registerLayer(e)),o.editorStates&&o.editorStates.forEach(e=>h.registerState(e)),void 0!==o.zoomEnable&&(this.zoomEnable=o.zoomEnable),o.entityConfigs)for(let[e,t]of o.entityConfigs){let i=this.entityManager.getEntity(e,!0);null==i||i.updateConfig(t)}this.node.addEventListener("blur",()=>{this.blur()}),this.node.addEventListener("focus",()=>{this.focus()}),this.node.tabIndex=0,this.node.appendChild(this.pipelineRenderer.node),this.onBlur=this.pipelineRegistry.onBlurEmitter.event,this.onFocus=this.pipelineRegistry.onFocusEmitter.event,this.onZoom=this.pipelineRegistry.onZoomEmitter.event,this.onScroll=this.pipelineRegistry.onScrollEmitter.event,t1.add(this)}};function t5(e){return{container:e,playground:e.get(t3),get:t=>e.get(t),getAll:t=>e.getAll(t)}}function t9(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.createChild();r.bind(t).toSelf().inSingletonScope(),r.bind(tj).toConstantValue(i);let n=r.get(t);return"object"==typeof n&&tc(n.constructor.prototype).forEach(e=>{n.hasOwnProperty(e)&&void 0===n[e]&&delete n[e]}),n}t3.onInstanceCreate=t2.event,t3.onInstanceDispose=t4.event,t3=j([(0,D.b2)(),z(0,(0,D.f3)(ta)),z(1,(0,D.f3)(tJ)),z(2,(0,D.f3)(ti)),z(2,(0,D.jt)()),z(3,(0,D.f3)(tA)),z(4,(0,D.f3)(tU)),z(5,(0,D.f3)(tH)),z(6,(0,D.f3)(E.Qc)),z(6,(0,D.t6)(tX)),z(6,(0,D.jt)()),z(7,(0,D.f3)(A)),z(8,(0,D.f3)(tb))],t3);var t6=new D.nZ(e=>{e(ta).toSelf().inSingletonScope(),e(tA).toSelf().inSingletonScope(),e(tJ).toSelf().inSingletonScope(),e(t3).toSelf().inSingletonScope(),e(t_).toSelf().inSingletonScope(),e(tE).toDynamicValue(e=>(t,i)=>t9(e.container,t,i)).inSingletonScope(),e(tU).toSelf().inSingletonScope(),e(tn).toDynamicValue(e=>e.container).inSingletonScope(),e(tH).toConstantValue({autoFocus:!0,autoResize:!0,zoomEnable:!0,layers:[]}),e(tt).toConstantValue({}),e(ti).toDynamicValue(e=>()=>{if(e.container.isBound(tt))return e.container.get(tt)}),e(tx).toSelf().inSingletonScope(),e(tS).toSelf().inSingletonScope(),e(tb).toSelf().inSingletonScope(),e(tD).to(tN).inSingletonScope(),e(tC).to(tM).inSingletonScope(),e(tP).toDynamicValue(e=>e.container.get(ta).createEntity(tP)).inSingletonScope(),(0,E.yb)(e,tX),e(tZ).toDynamicValue(e=>t5(e.container)).inSingletonScope(),e(e8).toService(tZ)});function t8(e,t,i){let r=i||new D.W2({defaultScope:"Singleton"});return t&&(r.parent=t),r.load(t6),r.isBound(A)||r.load(O),e&&(r.rebind(tH).toConstantValue(e),e.context&&r.rebind(tt).toConstantValue(e.context)),r}var t7=(0,M.forwardRef)(function(e,t){let{containerModules:i,playgroundContext:r,parentContainer:n,playgroundContainer:o,plugins:s,customPluginContext:a,...l}=e,h=(0,M.useMemo)(()=>{let e;return o?e=o:(e=t8({autoFocus:!0,autoResize:!0,zoomEnable:!0,...l},n),r&&e.rebind(tt).toConstantValue(r),i&&i.forEach(t=>e.load(t))),e},[]),d=(0,M.useMemo)(()=>{let e,t=h.get(t3);return a?(e=a(h),h.rebind(tZ).toConstantValue(e)):e=h.get(tZ),s&&function(e,t){let i=new Set,r=new Set;e.reduceRight((e,t)=>{let i=t.singleton&&r.has(t.pluginId);return t.singleton&&r.add(t.pluginId),i?e:[t,...e]},[]).reduce((e,t)=>{if(i.has(t.pluginId)||(t.initPlugin(),i.add(t.pluginId)),t.containerModules&&t.containerModules.length>0)for(let i of t.containerModules)e.includes(i)||e.push(i);return e},[]).forEach(e=>t.load(e)),e.forEach(e=>{if(e.contributionKeys)for(let i of e.contributionKeys)t.bind(i).toConstantValue(e.options)})}(s(e),h),t.init(),t},[]),u=(0,M.useRef)(0);return(0,M.useEffect)(()=>(u.current+=1,()=>{d.dispose()}),[]),(0,M.useImperativeHandle)(t,()=>h.get(tZ),[]),M.createElement(tG.Provider,{value:h},M.createElement(tQ.Provider,{value:d},M.createElement(t$.Provider,{value:r},e.children)))});function ie(){return M.useContext(tQ)}function it(){return M.useContext(tG)}function ii(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=it().get(ta),i=(0,M.useContext)(tW);if(!i)throw Error('[useEntityFromContext] Unknown entity from "PlaygroundEntityContext"');let r=(0,E.JA)(i.version);return(0,M.useLayoutEffect)(()=>{let t;return e&&(t=i.onEntityChange(()=>r(i.version))),()=>null==t?void 0:t.dispose()},[t,r,i,e]),i}function ir(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=(0,E.JA)();(0,M.useLayoutEffect)(()=>{let e=new E.K4;return e.pushAll(t.map(e=>e(()=>r()))),()=>e.dispose()},[t,r])}function io(e){var t;let i=it();return null==(t=i.get)?void 0:t.call(i,e)}function is(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=it().get(ta),r=i.getEntity(e,!0),n=(0,E.JA)(r.version);return(0,M.useLayoutEffect)(()=>{let e=t?r.onEntityChange(()=>{n(r.version)}):E.JT.NULL;return()=>e.dispose()},[i,n,r,t]),r}function ia(){let e=ie();return(0,M.useMemo)(()=>({start:(t,i)=>q.startDrag(t.clientX,t.clientY,{...i,config:e.config})}),[])}var il=e=>{let t=ie(),i=io(tH),r=(0,M.useRef)();(0,M.useEffect)(()=>{t.setParent(r.current),t.ready(),i.autoFocus&&t.node.focus()},[]);let n=t.toReactComponent();return M.createElement(M.Fragment,null,M.createElement("div",{ref:r,className:`gedit-playground-container${e.className?` ${e.className}`:""}`,style:e.style}),M.createElement(n,null),e.children?x.createPortal(M.createElement(M.Fragment,null,e.children),t.node):null)};(e=>{let t=Symbol("LayerStateProvider");class i{hijackMethod(e,t){"function"==typeof e[t]&&(this[t]=vi.spyOn(e,t))}constructor(e,t,i){this.instance=e,this.playground=t,this.container=i,this.hijackMethod(e,"autorun"),this.hijackMethod(e,"render"),this.hijackMethod(e,"onReady"),this.hijackMethod(e,"onResize"),this.hijackMethod(e,"onFocus"),this.hijackMethod(e,"onBlur"),this.hijackMethod(e,"onZoom"),this.hijackMethod(e,"onScroll"),this.hijackMethod(e,"onViewportChange"),this.hijackMethod(e,"onReadonlyOrDisabledChange")}}function r(e){let r=t8();return r.bind(t).toConstantValue(new WeakMap),r.rebind(tE).toDynamicValue(e=>(n,o)=>{let s=t9(e.container,n,o);return e.container.get(t).set(n,new i(s,r.get(t3),r)),s}),e&&e.forEach(e=>r.load(e)),r}function n(e,i){return e.get(t).get(i)}e.LayerTestState=i,e.createContainer=r,e.createPlayground=function(e){return r(e).get(t3)},e.getLayerTestState=n,e.createLayerTestState=function(e,t,i){let o=r(i),s=o.get(t3);return s.registerLayer(e,t),s.init(),s.ready(),n(o,e)}})(m||(m={}))},579962:function(e,t,i){i.d(t,{C8:()=>z,D9:()=>el,GA:()=>G,IG:()=>I,JU:()=>ei,Lu:()=>A,Lw:()=>q,Lz:()=>F,OT:()=>S,QU:()=>eh,Sy:()=>M,T4:()=>T,Uy:()=>en,VH:()=>O,VO:()=>V,Vl:()=>Q,XP:()=>_,Xr:()=>$,Xs:()=>Z,cc:()=>K,d1:()=>ec,eE:()=>ea,eG:()=>U,h3:()=>J,nx:()=>L,pQ:()=>er,y3:()=>W,yI:()=>eg});var r,n,o,s,a,l,h,d,u,c,g=i(893740),p=i(832176),f=i(658639),y=i(492320),m=i(461932),E=i(433210),b=Object.defineProperty,D=Object.getOwnPropertyDescriptor,N=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?D(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&b(t,i,o),o},C=(e,t)=>(i,r)=>t(i,r,e),M=((r=M||{}).START="start",r.DEFAULT="default",r.ROOT="root",r.EMPTY="empty",r.INLINE_BLOCKS="inlineBlocks",r.BLOCK_ICON="blockIcon",r.BLOCK="block",r.BLOCK_ORDER_ICON="blockOrderIcon",r.GROUP="group",r.END="end",r.BREAK="break",r.CONDITION="condition",r.SUB_CANVAS="subCanvas",r.MULTI_INPUTS="multiInputs",r.MULTI_OUTPUTS="multiOutputs",r.INPUT="input",r.OUTPUT="output",r.SLOT="slot",r.SLOT_BLOCK="slotBlock",r),S=((n=S||{}).SIMPLE_SPLIT="simpleSplit",n.DYNAMIC_SPLIT="dynamicSplit",n.STATIC_SPLIT="staticSplit",n),x=["root","inlineBlocks","block"];Symbol("FlowLayout");var w=Symbol("FlowLayoutContribution"),_=((o=_||{}).VERTICAL_FIXED_LAYOUT="vertical-fixed-layout",o.HORIZONTAL_FIXED_LAYOUT="horizontal-fixed-layout",o);(_||(_={})).isVertical=function(e){return"vertical-fixed-layout"===e.name};var I=((s=I||{})[s.STRAIGHT_LINE=0]="STRAIGHT_LINE",s[s.DIVERGE_LINE=1]="DIVERGE_LINE",s[s.MERGE_LINE=2]="MERGE_LINE",s[s.ROUNDED_LINE=3]="ROUNDED_LINE",s[s.CUSTOM_LINE=4]="CUSTOM_LINE",s[s.DRAGGING_LINE=5]="DRAGGING_LINE",s),L=((a=L||{})[a.ADDER_LABEL=0]="ADDER_LABEL",a[a.TEXT_LABEL=1]="TEXT_LABEL",a[a.COLLAPSE_LABEL=2]="COLLAPSE_LABEL",a[a.COLLAPSE_ADDER_LABEL=3]="COLLAPSE_ADDER_LABEL",a[a.CUSTOM_LABEL=4]="CUSTOM_LABEL",a[a.BRANCH_DRAGGING_LABEL=5]="BRANCH_DRAGGING_LABEL",a),T={NODE_SPACING:"SPACING",BRANCH_SPACING:"BRANCH_SPACING",ROUNDED_LINE_X_RADIUS:"ROUNDED_LINE_X_RADIUS",ROUNDED_LINE_Y_RADIUS:"ROUNDED_LINE_Y_RADIUS",INLINE_BLOCKS_PADDING_BOTTOM:"INLINE_BLOCKS_PADDING_BOTTOM",COLLAPSED_SPACING:"COLLAPSED_SPACING",HOVER_AREA_WIDTH:"HOVER_AREA_WIDTH"},A={NULL:0,[T.NODE_SPACING]:32,[T.BRANCH_SPACING]:20,MARGIN_RIGHT:20,INLINE_BLOCK_PADDING_BOTTOM:16,INLINE_BLOCKS_PADDING_TOP:30,[T.INLINE_BLOCKS_PADDING_BOTTOM]:40.1,MIN_INLINE_BLOCK_SPACING:200,MIN_INLINE_BLOCK_SPACING_HORIZONTAL:80,[T.COLLAPSED_SPACING]:12,[T.ROUNDED_LINE_X_RADIUS]:16,[T.ROUNDED_LINE_Y_RADIUS]:20,[T.HOVER_AREA_WIDTH]:20},O=((l=O||{}).PRE_BRANCH="pre_branch",l.NORMAL_BRANCH="normal_branch",l),k={width:280,height:60},R=u||(u={});function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return 0===e.length||0===t.length?[...e,...t]:[...e.map(e=>{let i=t.find(t=>t.type===e.type);return i?j(e,i,e.type):e}),...t.filter(t=>!e.some(e=>e.type===t.type))]}function j(e,t,i){let r=e.__extends__?e.__extends__.slice():[];return e.type!==t.type&&r.unshift(e.type),{...e,...t,extendChildRegistries:P(e.extendChildRegistries,t.extendChildRegistries),meta:{...e.meta,...t.meta},extend:void 0,type:i,__extends__:r}}R.mergeChildRegistries=P,R.merge=j,R.extend=function(e,t){return t.length?t.reduce((t,i)=>j(t,i,e.type),e):e};var z=((h=z||{}).addFromNode="addFromNode",h.deleteFromNode="deleteFromNode",h.addBlock="addBlock",h.deleteBlock="deleteBlock",h.createGroup="createGroup",h.ungroup="ungroup",h.moveNodes="moveNodes",h.moveBlock="moveBlock",h.moveChildNodes="moveChildNodes",h.addNodes="addNodes",h.deleteNodes="deleteNodes",h.changeNode="changeNode",h.addChildNode="addChildNode",h.deleteChildNode="deleteChildNode",h.addNode="addNode",h.deleteNode="deleteNode",h),V=Symbol("FlowOperationBaseService"),B=class e extends g.RD{get key(){return this.entity.id}getDefaultData(){let{addable:e,expandable:t,defaultExpanded:i}=this.entity.getNodeMeta();return{addable:e,expandable:t,expanded:i||!1,activated:!1,hovered:!1,dragging:!1,stackIndex:0}}updateExtInfo(e){if(p.XJ.isChanged(this.data.extInfo,e)){let t=this.data.extInfo;this.update({extInfo:e}),this.onExtInfoChangeEmitter.fire({oldInfo:t,newInfo:e})}}getExtInfo(){return this.data.extInfo}get addable(){return this.data.addable}get expandable(){return this.data.expandable}get draggable(){let{draggable:e}=this.entity.getNodeMeta();return"function"==typeof e?e(this.entity):e}get expanded(){return this.data.expanded}set expanded(e){this.expandable&&this.data.expanded!==e&&(this.data.expanded=e,this.fireChange())}toggleExpand(){this.expanded=!this.expanded}toggleMouseEnter(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.entity.document.renderState.setNodeHovered(this.entity),t)return;let i=this.entity.getData(U);i.renderState.hidden||(this.mouseLeaveTimeout&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=void 0),i.renderState.hovered=!0,this.entity.isFirst&&(null==(e=this.entity.parent)?void 0:e.id)!=="root"?i.parent.renderState.activated=!0:i.renderState.activated=!0)}toggleMouseLeave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.entity.document.renderState.setNodeHovered(void 0),e)return;let t=this.entity.getData(U);this.mouseLeaveTimeout=setTimeout(()=>{var e;t.renderState.hovered=!1,this.entity.isFirst&&(null==(e=this.entity.parent)?void 0:e.id)!=="root"&&(t.parent.renderState.activated=!1),t.renderState.activated=!1},200)}get hidden(){return this.entity.hidden}set hovered(e){this.data.hovered=e,this.fireChange()}get hovered(){return this.data.hovered}get dragging(){return this.data.dragging}set dragging(e){this.data.dragging!==e&&(this.data.dragging=e,this.fireChange())}set activated(t){if("blockIcon"===this.entity.flowNodeType&&this.entity.parent){this.entity.parent.getData(e).activated=t;return}this.data.activated!==t&&(this.data.activated=t,this.fireChange())}get activated(){let{entity:t}=this;return!!t.parent&&!!t.parent.getData(e).activated||this.data.activated}get stackIndex(){return this.data.stackIndex}set stackIndex(e){this.data.stackIndex=e}get lineActivated(){var t,i,r;let{activated:n}=this;return!!n&&!!((null==(i=this.entity.parent)||null==(t=i.getData(e))?void 0:t.activated)||this.entity.isInlineBlock||(null==(r=this.entity.next)?void 0:r.getData(e).activated))}get node(){return this._node||(this._node=p.xF.createDivWithClass("gedit-flow-activity-node"),this._node.dataset.testid="sdk.workflow.canvas.node",this._node.dataset.nodeId=this.entity.id),this._node}dispose(){super.dispose(),this.onExtInfoChangeEmitter.dispose()}constructor(e){super(e),this.onExtInfoChangeEmitter=new p.Q5,this.onExtInfoChange=this.onExtInfoChangeEmitter.event,this.toDispose.push(p.JT.create(()=>{this._node&&this._node.remove()}))}};B.type="FlowNodeRenderData";var F=B,Y=class e extends g.RD{get origin(){return this.transform.origin}get key(){return this.entity.id}getDefaultData(){let{size:e,hidden:t}=this.entity.getNodeMeta();return{size:t?{width:0,height:0}:{...e}}}get collapsed(){return this.entity.collapsed}set collapsed(e){this.entity.collapsed=e,this.localDirty=!0,this.firstChild&&(this.firstChild.localDirty=!0),this.fireChange()}get size(){return this.entity.memoGlobal("size",()=>this.isContainer?this.transform.localSize:this.data.size)}get position(){let{position:e}=this.transform;return{x:e.x,y:e.y}}set position(e){this.transform.update({position:e})}set size(e){let{width:t,height:i}=this.data.size;this.isContainer||(e.width!==t||e.height!==i)&&(this._data.size={...e},this.localDirty=!0,this.fireChange())}get inputPoint(){return this.entity.memoGlobal("inputPoint",()=>{let{getInputPoint:e}=this.entity.getNodeRegistry();return e?e(this,this.entity.document.layout):this.defaultInputPoint})}get defaultInputPoint(){return this.entity.memoGlobal("defaultInputPoint",()=>this.entity.document.layout.getDefaultInputPoint(this.entity))}get defaultOutputPoint(){return this.entity.memoGlobal("defaultOutputPoint",()=>this.entity.document.layout.getDefaultOutputPoint(this.entity))}get outputPoint(){return this.entity.memoGlobal("outputPoint",()=>{let{getOutputPoint:e}=this.entity.getNodeRegistry();return e?e(this,this.entity.document.layout):this.defaultOutputPoint})}get originDeltaX(){return this.entity.memoLocal("originDeltaX",()=>{let{children:e}=this,{getOriginDeltaX:t}=this.entity.getNodeRegistry();return t?t(this,this.entity.document.layout):0===e.length?-this.size.width*this.origin.x:1===e.length?e[0].originDeltaX:this.entity.isInlineBlocks&&e.length>1?e[0].originDeltaX+this.transform.position.x:e.reduce((e,t)=>{let i=t.originDeltaX;return void 0===e||i<e?i:e},void 0)})}get originDeltaY(){return this.entity.memoLocal("originDeltaY",()=>{let{children:e}=this,{getOriginDeltaY:t}=this.entity.getNodeRegistry();return t?t(this,this.entity.document.layout):0===e.length?-this.size.height*this.origin.y:1===e.length?e[0].originDeltaY:this.entity.isInlineBlocks&&e.length>1?e[0].originDeltaY+this.transform.position.y:e.reduce((e,t)=>{let i=t.originDeltaY;return void 0===e||i<e?i:e},void 0)})}get bounds(){return this.entity.memoGlobal("bounds",()=>{let{transform:t}=this;if(this.isContainer){let i=t.children.map(t=>t.entity.getData(e).boundsWithPadding);return p.Ae.enlarge(i).withPadding(this.padding)}return t.bounds})}get boundsWithPadding(){return this.entity.memoGlobal("boundsWithPadding",()=>{let{transform:t}=this;if(this.isContainer){let i=t.children.map(t=>t.entity.getData(e).boundsWithPadding);return p.Ae.enlarge(i).withPadding(this.padding)}return t.bounds.clone().withPadding(this.padding)})}get isContainer(){return this.transform.isContainer}get localBounds(){return this.entity.memoLocal("localBounds",()=>{let{transform:t}=this;if(this.isContainer){let i=t.children.map(t=>t.entity.getData(e).localBounds),r=p.Ae.enlarge(i).withPadding(this.padding);return g.YZ.applyMatrix(r,t.localTransform)}return t.localBounds.clone().withPadding(this.padding)})}get padding(){return this.entity.document.layout.getPadding(this.entity)}setParentTransform(e){this.transform.parent!==(null==e?void 0:e.transform)&&(this.localDirty=!0),this.transform.setParent(null==e?void 0:e.transform)}get spacing(){let{spacing:e}=this.entity.getNodeMeta();return"function"==typeof e?e(this):e}get inlineSpacingPre(){let{inlineSpacingPre:e}=this.entity.getNodeMeta();return"function"==typeof e?e(this):e}get inlineSpacingAfter(){let{inlineSpacingAfter:e}=this.entity.getNodeMeta();return"function"==typeof e?e(this):e}get minInlineBlockSpacing(){let{minInlineBlockSpacing:e}=this.entity.getNodeMeta();return"function"==typeof e?e(this):e}get children(){return this.entity.children.map(t=>t.getData(e))}get pre(){var t;return null==(t=this.entity.pre)?void 0:t.getData(e)}get originParent(){var t;return null==(t=this.entity.originParent)?void 0:t.getData(e)}get isFirst(){return this.entity.isFirst}get isLast(){return this.entity.isLast}get lastChild(){var t;return null==(t=this.entity.lastChild)?void 0:t.getData(e)}get firstChild(){var t;return null==(t=this.entity.firstChild)?void 0:t.getData(e)}get next(){var t;return null==(t=this.entity.next)?void 0:t.getData(e)}get parent(){var t;return null==(t=this.entity.parent)?void 0:t.getData(e)}constructor(e){super(e),this.localDirty=!0;let{origin:t}=this.entity.getNodeMeta();this.transform=this.entity.addData(g.VO),this.transform.changeLocked=!0,this.transform.update({origin:{...t}}),this.transform.changeLocked=!1,this.renderState=this.entity.addData(F),this.bindChange(this.transform),this.toDispose.push(p.JT.create(()=>{let{next:e,parent:t}=this;e&&(e.localDirty=!0),t&&(t.localDirty=!0)}))}};Y.type="FlowNodeTransformData";var U=Y,$=class extends g.RD{getDefaultData(){return{}}formatLines(e){var t,i,r;return(null==(t=this.entity.document.options)?void 0:t.formatNodeLines)?null==(r=this.entity.document.options)||null==(i=r.formatNodeLines)?void 0:i.call(r,this.entity,e):e}formatLabels(e){if(this.entity.document.options.formatNodeLabels){var t,i;return null==(i=this.entity.document.options)||null==(t=i.formatNodeLabels)?void 0:t.call(i,this.entity,e)}return e}get lines(){return this.entity.memoGlobal("lines",()=>{var e;let{getChildLines:t}=(null==(e=this.entity.parent)?void 0:e.getNodeRegistry())||{};if(t)return this.formatLines(t(this,this.entity.document.layout));let{getLines:i}=this.entity.getNodeRegistry();return i?this.formatLines(i(this,this.entity.document.layout)):this.transform.entity.isInlineBlock?[]:this.formatLines([...(e=>{let{transform:t}=e,i=t.outputPoint;return t.next?[{type:0,from:i,to:t.next.inputPoint}]:[]})(this),...(e=>{var t;let{transform:i}=e,r=i.outputPoint,n=null==(t=i.parent)?void 0:t.outputPoint;return i.next||!n||new p.E9().copyFrom(r).equals(n)||e.isNodeEnd?[]:[{type:0,from:r,to:n}]})(this)])})}get labels(){return this.entity.memoGlobal("labels",()=>{var e,t;let{getChildLabels:i}=(null==(e=this.entity.parent)?void 0:e.getNodeRegistry())||{};if(i)return this.formatLabels(i(this,this.entity.document.layout));let{getLabels:r}=this.entity.getNodeRegistry();if(r)return this.formatLabels(r(this,this.entity.document.layout));if(this.transform.entity.isInlineBlock)return[];let n=this.transform.outputPoint;if(this.transform.next)return this.formatLabels([{offset:p.E9.getMiddlePoint(n,this.transform.next.inputPoint),type:0}]);let o=null==(t=this.transform.parent)?void 0:t.outputPoint;return!o||new p.E9().copyFrom(n).equals(o)||this.isNodeEnd?[]:this.formatLabels([{offset:o,type:0}])})}get collapsed(){return this.entity.collapsed}get isNodeEnd(){return this.entity.isNodeEnd}constructor(e){super(e),this.transform=this.entity.addData(U),this.renderData=this.entity.addData(F),this.bindChange(this.transform),this.bindChange(this.renderData)}};$.type="FlowNodeTransitionData";var G=class extends g.JH{initData(e){e.originParent!==this.originParent&&(this.originParent=e.originParent,this._registerCache=void 0),e.parent&&e.parent.addChild(this,e.index),e.meta!==this.metaFromJSON&&(this._metaCache=void 0,this.metaFromJSON=e.meta),this._hidden=!!(this.getNodeMeta().hidden||e.hidden)}get isStart(){return this.getNodeMeta().isStart}get isFirst(){return!this.pre}get isLast(){return!this.next}get isInlineBlocks(){let e=this.getNodeMeta().isInlineBlocks;return"function"==typeof e?e(this):e}get isInlineBlock(){let e=this.document.renderTree.getParent(this);return!!(e&&e.isInlineBlocks)}get isNodeEnd(){return this.memoLocal("isNodeEnd",()=>!!this.getNodeMeta().isNodeEnd||(this.isInlineBlocks&&this.collapsedChildren.length?this.collapsedChildren.every(e=>e.isNodeEnd):!!this.lastCollapsedChild&&this.lastCollapsedChild.isNodeEnd))}addChild(e,t){e.parent!==this&&this.document.originTree.addChild(this,e,t)}get hasChild(){return this.children.length>0}get pre(){return this.document.renderTree.getPre(this)}get next(){return this.document.renderTree.getNext(this)}get parent(){return this.document.renderTree.getParent(this)}getNodeRegistry(){return this._registerCache||(this._registerCache=this.document.getNodeRegistry(this.flowNodeType,this.originParent)),this._registerCache}getNodeRegister(){return this.getNodeRegistry()}getNodeMeta(){return this._metaCache||(this.metaFromJSON?this._metaCache={...this.getNodeRegistry().meta,...this.metaFromJSON}:this._metaCache=this.getNodeRegistry().meta),this._metaCache}get allChildren(){let e=[];for(let t of this.children)e.push(t),e.push(...t.allChildren);return e}get allCollapsedChildren(){let e=[];for(let t of this.collapsedChildren)e.push(t),e.push(...t.allCollapsedChildren);return e}get collapsedChildren(){return this.document.renderTree.getCollapsedChildren(this)}get blocks(){return this.collapsedChildren}get lastBlock(){return this.lastCollapsedChild}get lastCollapsedChild(){let{collapsedChildren:e}=this;return e[e.length-1]}get children(){return this.document.renderTree.getChildren(this)}get lastChild(){let{children:e}=this;return e[e.length-1]}get firstChild(){return this.children[0]}memoLocal(e,t){if(this._memoLocalCache.has(e))return this._memoLocalCache.get(e);let i=t();return this._memoLocalCache.set(e,i),i}memoGlobal(e,t){if(this._memoGlobalCache.has(e))return this._memoGlobalCache.get(e);let i=t();return this._memoGlobalCache.set(e,i),i}clearMemoGlobal(){this._memoGlobalCache.clear()}clearMemoLocal(){this._memoLocalCache.clear()}get childrenLength(){return this.children.length}get collapsed(){var e;return!!this.document.renderTree.isCollapsed(this)||!!(null==(e=this.parent)?void 0:e.collapsed)}set collapsed(e){this.document.renderTree.setCollapsed(this,e),this.clearMemoGlobal(),this.clearMemoLocal()}get hidden(){return this._hidden}openInsideCollapsed(){this.document.renderTree.openNodeInsideCollapsed(this)}getJSONData(){return this.getExtInfo()}toJSON(){return this.document.toNodeJSON(this)}get isVertical(){return"vertical-fixed-layout"===this.document.layout.name}updateExtInfo(e){this.getData(F).updateExtInfo(e)}getExtInfo(){return this.getData(F).getExtInfo()}get onExtInfoChange(){return this.renderData.onExtInfoChange}get renderData(){return this.getData(F)}get transform(){return this.getData(U)}get bounds(){return this.transform.bounds}isExtend(e){return this.document.isExtend(this.flowNodeType,e)}isTypeOrExtendType(e){return this.document.isTypeOrExtendType(this.flowNodeType,e)}constructor(e){super(e),this._memoLocalCache=new Map,this._memoGlobalCache=new Map,this.flowNodeType="unknown",this._hidden=!1,this.index=-1,this.document=e.document,this.flowNodeType=e.flowNodeType,this.originParent=e.originParent,this.metaFromJSON=e.meta,this.onDispose(()=>{this.document.originTree.getChildren(this).slice().forEach(e=>{e.dispose()}),this.document.originTree.remove(this,!1),this.originParent=void 0})}};G.type="FlowNodeEntity",(d=G||(G={})).is=function(e){return e instanceof d};var Q=class extends g.cv{getDefaultConfig(){return{loading:!0,treeVersion:0}}get loading(){return this.config.loading}set loading(e){this.config.loading!==e&&(this.config.loading=e,this.fireChange())}updateTransformsTree(){this.document.renderTree.traverse((e,t,i)=>{let r=e.getData(U);r.collapsed&&r.transform.clearChildren(),e.parent&&r.setParentTransform(e.parent.getData(U)),e.index=i})}clear(){this.lastTreeVersion=-1,this.lastTransformVersion=-1}isTreeDirty(){let e=this.entityManager.getEntityDataVersion(U),t=this.lastTreeVersion!==this.config.treeVersion,i=this.lastTransformVersion!==e;return t||i}refresh(){let e=this.entityManager.getEntityDataVersion(U),t=this.lastTreeVersion!==this.config.treeVersion,i=this.lastTransformVersion!==e;this.entityManager.changeEntityLocked=!0,t&&(this.document.renderTree.updateRenderStruct(),this.updateTransformsTree(),this.lastTreeVersion=this.config.treeVersion),(t||i)&&(this.document.layout.update(),this.lastTransformVersion=this.entityManager.getEntityDataVersion(U),this.lastTreeVersion=this.config.treeVersion,this.onRefreshEmitter.fire()),this.entityManager.changeEntityLocked=!1}constructor(e){super(e),this.onRefreshEmitter=new p.Q5,this.lastTransformVersion=-1,this.lastTreeVersion=-1,this.onRefresh=this.onRefreshEmitter.event,this.document=e.document,this.toDispose.push(this.document.originTree.onTreeChange(()=>{this.config.treeVersion+=1,this.fireChange()})),this.toDispose.push(this.onRefreshEmitter)}};Q.type="FlowDocumentTransformerEntity";var W=class extends g.cv{getDefaultConfig(){return{}}getNodeHovered(){return this.config.nodeHoveredId?this.entityManager.getEntityById(this.config.nodeHoveredId):void 0}setNodeHovered(e){this.updateConfig({nodeHoveredId:null==e?void 0:e.id})}getDragLabelSide(){return this.config.dragLabelSide}setDragLabelSide(e){this.updateConfig({dragLabelSide:e})}getNodeDroppingId(){return this.config.nodeDroppingId}setNodeDroppingId(e){this.updateConfig({nodeDroppingId:e})}getDragStartEntity(){let{nodeDragStartId:e}=this.config;return this.entityManager.getEntityById(e)}setDragStartEntity(e){this.updateConfig({nodeDragStartId:null==e?void 0:e.id})}getDragEntities(){let{nodeDragIds:e}=this.config;return(e||[]).map(e=>this.entityManager.getEntityById(e))}setDragEntities(e){this.updateConfig({nodeDragIds:e.map(e=>e.id),nodeDragIdsWithChildren:e.map(e=>[e.id,...e.allCollapsedChildren.map(e=>e.id)]).flat()})}onNodeHoveredChange(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return this.onConfigChanged((0,f.Z)(()=>e(this.getNodeHovered()),t))}constructor(e){super(e)}};W.type="FlowRendererStateEntity";var H=class e{dispose(){this.map.clear(),this.onTreeChangeEmitter.dispose()}getInfo(e){let t=this.map.get(e);return t||(t={children:[]},this.map.set(e,t)),t}clear(){this.map.clear()}cloneMap(){let e=new Map;for(let[t,i]of this.map)e.set(t,{...i,children:i.children.slice()});return e}clone(){let t=new e(this.root);return t.map=this.cloneMap(),t}remove(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.removeParent(e),t&&this._removeChildren(e),this.map.delete(e),this.fireTreeChange()}addChild(e,t,i){let r=this.getInfo(e),n=this.getInfo(t);if(n.parent){if(n.parent===e)return t;n.parent!==e&&this.removeParent(t)}let o=r.children.length,s=void 0===i?o-1:i-1,a=r.children[s],l=r.children[s+1];return a&&(this.getInfo(a).next=t),l&&(this.getInfo(l).pre=t),n.pre=a,n.next=l,r.children.splice(s+1,0,t),n.parent=e,this.fireTreeChange(),t}moveChilds(e,t,i){let r=this.getInfo(e),n=r.children.length,o=i??n;return t.forEach(e=>{this.getInfo(e).parent&&this.removeParent(e)}),t.forEach(t=>{let i=this.getInfo(t),n=r.children[o-1],s=r.children[o];n&&(this.getInfo(n).next=t),s&&(this.getInfo(s).pre=t),i.pre=n,i.next=s,r.children.splice(o,0,t),i.parent=e,o++}),this.fireTreeChange(),t}getById(e){for(let t of this.map.keys())if(t.id===e)return t}insertAfter(e,t){let i=this.getInfo(e),r=this.getInfo(t);if(this.removeParent(t),i.parent){let n=this.getInfo(i.parent);n.children.splice(n.children.indexOf(e)+1,0,t);let{next:o}=i;o&&(this.getInfo(o).pre=t),r.next=o,i.next=t,r.pre=e,r.parent=i.parent}this.fireTreeChange()}removeParent(e){let t=this.getInfo(e);if(!t.parent)return;let i=this.getInfo(t.parent),r=i.children.indexOf(e);i.children.splice(r,1);let{pre:n,next:o}=t;n&&(this.getInfo(n).next=o),o&&(this.getInfo(o).pre=n),this.fireTreeChange()}_removeChildren(e){let t=this.getChildren(e);t.length>0&&t.forEach(e=>{this._removeChildren(e),this.map.delete(e)})}getParent(e){return this.getInfo(e).parent}getPre(e){return this.getInfo(e).pre}getNext(e){return this.getInfo(e).next}getChildren(e){return this.getInfo(e).children}traverse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e(t,i,r)||this.getInfo(t).children.find((t,r)=>this.traverse(e,t,i+1,r)))return!0}fireTreeChange(){this.onTreeChangeEmitter.fire()}get size(){return this.map.size}toString(e){let t=[];return this.traverse((i,r)=>{0===r?t.push(i.id):t.push(`|${Array(r).fill("--").join("")} ${e?`${i.flowNodeType}(${i.id})`:i.id}`)}),`${t.join("\n")}`}constructor(e){this.root=e,this.onTreeChangeEmitter=new p.Q5,this.onTreeChange=this.onTreeChangeEmitter.event,this.map=new Map}},X=class extends H{isCollapsed(e){return this.nodesCollapsed.has(e)}get collapsedNodeList(){return Array.from(this.nodesCollapsed)}setCollapsed(e,t){t?this.nodesCollapsed.add(e):this.nodesCollapsed.delete(e),this.originTree.fireTreeChange()}openNodeInsideCollapsed(e){var t;let i=null==(t=this.originTree.getInfo(e))?void 0:t.parent;for(;i;){this.nodesCollapsed.has(i)&&this.nodesCollapsed.delete(i);let{parent:e}=this.originTree.getInfo(i)||{};i=e}this.originTree.fireTreeChange()}updateRenderStruct(){this.map=this.originTree.cloneMap(),this.document.config.get("END_NODES_REFINE_BRANCH")&&this.refineBranch(this.root),this.hideCollapsed()}hideCollapsed(){this.nodesCollapsed.forEach(e=>{let t=this.getInfo(e);if(!t)return void this.nodesCollapsed.delete(e);let i=t.children.find(e=>"blockIcon"===e.flowNodeType||"blockOrderIcon"===e.flowNodeType);if(i){let e=this.getInfo(i);e.next=void 0,e.pre=void 0,t.children=[i];return}t.children=[]})}isNodeEnd(e){if(e.getNodeMeta().isNodeEnd)return!0;let{children:t}=this.getInfo(e);return t.length>0&&e.isInlineBlocks?t.every(e=>this.isNodeEnd(e)):!!e.isInlineBlock&&this.isNodeEnd(t[t.length-1])}refineBranch(e){let t=this.getInfo(e).children[0];for(;t;){if("dynamicSplit"===t.flowNodeType||"staticSplit"===t.flowNodeType){let{next:e,children:i}=this.getInfo(t),{children:r}=this.getInfo(i[1]),n=(r||[]).filter(e=>!this.isNodeEnd(e)),o=1===n.length;if(o&&e&&this.dragNextNodesToBlock(n[0],e),null==r||r.forEach(e=>{this.refineBranch(e)}),o)break}t=t.next}}dragNextNodesToBlock(e,t){let i=this.getInfo(e),r=this.getInfo(t),n=i.children[e.children.length-1];if(r.parent){let o=this.getInfo(r.parent);r.pre&&(this.getInfo(r.pre).next=void 0),n&&(this.getInfo(n).next=t,r.pre=n);let s=o.children.indexOf(t),a=o.children.slice(s);for(let t of(o.children=o.children.slice(0,s),a)){let r=this.getInfo(t);i.children.push(t),r.parent=e}}}getInfo(e){return this.map.get(e)||this.originTree.getInfo(e)}getOriginInfo(e){return this.originTree.getInfo(e)}getCollapsedChildren(e){return this.getOriginInfo(e).children||[]}remove(){throw Error("Render Tree cannot use remove node")}addChild(){throw Error("Render tree cannot use add child")}insertAfter(){throw Error("Render tree cannot use insert after")}removeParent(){throw Error("Render tree cannot use remove parent")}constructor(e,t,i){super(e),this.root=e,this.nodesCollapsed=new Set,this.originTree=t,this.onTreeChange=this.originTree.onTreeChange,this.document=i}},J=Symbol("FlowDocumentOptions"),Z={allNodesDefaultExpanded:!1},K={...T,INLINE_SPACING_BOTTOM:"INLINE_SPACING_BOTTOM",INLINE_BLOCKS_INLINE_SPACING_TOP:"INLINE_BLOCKS_INLINE_SPACING_TOP",INLINE_BLOCKS_INLINE_SPACING_BOTTOM:"INLINE_BLOCKS_INLINE_SPACING_BOTTOM",BASE_COLOR:"BASE_COLOR",BASE_ACTIVATED_COLOR:"BASE_ACTIVATED_COLOR",INLINE_BLOCKS_PADDING_TOP:"INLINE_BLOCKS_PADDING_TOP"},q=Symbol("FlowDocumentContribution"),ee=Symbol("FlowDocumentConfigDefaultData"),et=class{get(e){return this._data[e]}set(e,t){this.get(e)!==t&&(this._data[e]=t,this.onDataChangeEmitter.fire(e))}registerConfigs(e){Object.keys(e).forEach(t=>{this.set(t,e[t])})}constructor(e={}){this._data=e,this.onDataChangeEmitter=new p.Q5,this.onChange=this.onDataChangeEmitter.event}};et=N([(0,m.b2)(),C(0,(0,m.f3)(ee)),C(0,(0,m.jt)())],et);var ei=Symbol("FlowDocumentProvider"),er=class{get disposed(){return this._disposed}init(){var e,t;this.options||(this.options=Z),this.currentLayoutKey=this.options.defaultLayout||"vertical-fixed-layout",this.contributions.forEach(e=>{var t;return null==(t=e.registerDocument)?void 0:t.call(e,this)}),this.root=this.addNode({id:"root",type:"root"}),this.originTree=new H(this.root),this.transformer=this.entityManager.createEntity(Q,{document:this}),this.renderState=this.entityManager.createEntity(W),this.renderTree=new X(this.root,this.originTree,this),null==(e=(t=this.layout).reload)||e.call(t)}fromJSON(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this._disposed)return;this.originTree.clear(),this.renderTree.clear(),this.entityManager.changeEntityLocked=!0;let i=this.entityManager.getEntities(G),r=[this.root];this.addBlocksAsChildren(this.root,e.nodes||[],r),i.forEach(e=>{r.includes(e)||e.dispose()}),this.entityManager.changeEntityLocked=!1,this.transformer.loading=!1,t&&this.fireRender()}get layout(){let e=this.layouts.find(e=>e.name==this.currentLayoutKey);if(!e)throw Error(`Unknown flow layout: ${this.currentLayoutKey}`);return e}async load(){await Promise.all(this.contributions.map(e=>{var t;return null==(t=e.loadDocument)?void 0:t.call(e,this)}))}get loading(){return this.transformer.loading}fireRender(){this.transformer.isTreeDirty()&&(this.entityManager.fireEntityChanged(G.type),this.entityManager.fireEntityChanged(Q.type))}addFromNode(e,t){let i="string"==typeof e?this.getNode(e):e;this.entityManager.changeEntityLocked=!0;let{parent:r}=i,n=this.addNode({...t,parent:r});return this.originTree.insertAfter(i,n),this.entityManager.changeEntityLocked=!1,this.entityManager.fireEntityChanged(G.type),n}removeNode(e){if("string"==typeof e){var t;null==(t=this.getNode(e))||t.dispose()}else e.dispose()}addNode(e,t){var i,r,n,o;let{id:s,type:a="block",originParent:l,parent:h,meta:d,hidden:u,index:c}=e,g=this.getNode(s),p=!1,f=this.getNodeRegistry(a,e.originParent);if(g&&g.flowNodeType!==e.type&&(g.dispose(),g=void 0),g)null==(n=(o=this.options).fromNodeJSON)||n.call(o,g,e,!1);else{let{dataRegistries:t}=f;g=this.entityManager.createEntity(G,{id:s,document:this,flowNodeType:a,originParent:l,meta:d});let n=t?this.nodeDataRegistries.concat(...t):this.nodeDataRegistries;g.addInitializeData(n),g.onDispose(()=>this.onNodeDisposeEmitter.fire({node:g})),null==(i=(r=this.options).fromNodeJSON)||i.call(r,g,e,!0),p=!0}if(g.initData({originParent:l,parent:h,meta:d,hidden:u,index:c}),g.isStart&&this.root.addChild(g),null==t||t.push(g),f.onCreate){let i=f.onCreate(g,e);i&&t&&t.push(...i)}else e.blocks&&e.blocks.length>0&&(e.blocks[0].type?this.addBlocksAsChildren(g,e.blocks,t):this.addInlineBlocks(g,e.blocks,t));return p?this.onNodeCreateEmitter.fire({node:g,data:e,json:e}):this.onNodeUpdateEmitter.fire({node:g,data:e,json:e}),g}addBlocksAsChildren(e,t,i){for(let r of t)this.addNode({...r,parent:e},i)}addInlineBlocks(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this.addNode({id:`$blockIcon$${e.id}`,type:"blockIcon",originParent:e,parent:e});i.push(r);let n=this.addNode({id:`$inlineBlocks$${e.id}`,type:"inlineBlocks",originParent:e,parent:e});return i.push(n),t.forEach(t=>{this.addBlock(e,t,i)}),i}addBlock(e,t,i,r,n){var o;let s="string"==typeof e?this.getNode(e):e,{onBlockChildCreate:a}=s.getNodeRegistry();if(a)return a(s,t,i);r=r||this.getNode(`$inlineBlocks$${s.id}`);let l=this.addNode({...(0,y.Z)(t,"blocks"),type:t.type||"block",originParent:s,parent:r,index:n});(null==(o=t.meta)?void 0:o.defaultCollapsed)&&(l.collapsed=!0);let h=this.addNode({id:`$blockOrderIcon$${t.id}`,type:"blockOrderIcon",originParent:s,meta:t.meta,data:t.data,parent:l});return null==i||i.push(l,h),t.blocks&&this.addBlocksAsChildren(l,t.blocks,i),l}getNode(e){if(e)return this.entityManager.getEntityById(e)}registerFlowNodes(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(e=>{if(!e)throw Error("[FlowDocument] registerFlowNodes parameters get undefined registry.");let t=this.registers.get(e.type);this.registers.set(e.type,{...t,...e,meta:{...null==t?void 0:t.meta,...null==e?void 0:e.meta},extendChildRegistries:u.mergeChildRegistries(null==t?void 0:t.extendChildRegistries,null==e?void 0:e.extendChildRegistries)})})}isExtend(e,t){return(this.getNodeRegistry(e).__extends__||[]).includes(t)}isTypeOrExtendType(e,t){return e===t||this.isExtend(e,t)}toJSON(){if(this.disposed)throw Error("The FlowDocument has been disposed and it is no longer possible to call toJSON.");return{nodes:this.root.toJSON().blocks}}getNodeRegister(e,t){return this.getNodeRegistry(e,t)}getNodeRegistry(e,t){var i,r,n,o,s;let a=`${e}_${(null==t?void 0:t.flowNodeType)||""}`;if(this.nodeRegistryCache.has(a))return this.nodeRegistryCache.get(a);let l=null==(i=(r=this.options).getNodeDefaultRegistry)?void 0:i.call(r,e),h=this.registers.get(e)||{type:e},d=[],c=h.extend;if(h.extend&&this.registers.has(h.extend)&&(h=u.merge(this.getNodeRegistry(h.extend),h,h.type)),t){let i=null==(s=this.getNodeRegistry(t.flowNodeType).extendChildRegistries)?void 0:s.find(t=>t.type===e);i&&(i.extend&&this.registers.has(i.extend)&&d.push(this.registers.get(i.extend)),d.push(i))}h=u.extend(h,d);let g=((e,t)=>{let i=x.includes(e);return{isStart:"start"===e,hidden:i,defaultExpanded:t.options.allNodesDefaultExpanded,size:k,origin:t.layout.getDefaultNodeOrigin(),isInlineBlocks:"inlineBlocks"===e,spacing:A.SPACING,inlineSpacingPre:0,inlineSpacingAfter:0,expandable:!0,draggable:!0,selectable:!0,renderKey:"",minInlineBlockSpacing:()=>_.isVertical(t.layout)?A.MIN_INLINE_BLOCK_SPACING:A.MIN_INLINE_BLOCK_SPACING_HORIZONTAL}})(e,this);g.spacing=(null==(o=this.options)||null==(n=o.constants)?void 0:n[K.NODE_SPACING])||g.spacing;let p={...l,...h,meta:{...g,...null==l?void 0:l.meta,...h.meta}};return c&&(p.extend=c),this.nodeRegistryCache.set(a,p),p}registerNodeDatas(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.nodeDataRegistries.push(...t)}traverse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.originTree.traverse(e,t,i)}get size(){return this.getAllNodes().length}hasNode(e){return!!this.entityManager.getEntityById(e)}getAllNodes(){return this.entityManager.getEntities(G)}toString(e){return this.originTree.toString(e)}getRenderDatas(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=[];return this.renderTree.traverse(r=>{(t||!r.hidden)&&i.push(r.getData(e))}),i}toNodeJSON(e){let t;if(this.options.toNodeJSON)return this.options.toNodeJSON(e);let i={};return this.traverse(e=>{if(e.id.startsWith("$"))return;let r=e.getJSONData(),n={id:e.id,type:e.flowNodeType};void 0!==r&&(n.data=r),t||(t=n);let{parent:o}=e;o&&o.id.startsWith("$")&&(o=o.originParent);let s=o?i[o.id]:void 0;s&&(s.blocks||(s.blocks=[]),s.blocks.push(n)),i[e.id]=n},e),t}moveNodes(e){let{dropNodeId:t,sortNodeIds:i,inside:r=!1}=e,n=this.getNode(t);if(!n)return;let o=i.map(e=>this.getNode(e));for(let e of(this.entityManager.changeEntityLocked=!0,o.reverse()))r?this.originTree.addChild(n,e,0):this.originTree.insertAfter(n,e);this.entityManager.changeEntityLocked=!1,this.fireRender()}moveChildNodes(e){let{toParentId:t,toIndex:i,nodeIds:r}=e;if(0===r.length)return;let n=this.getNode(t);n&&(this.entityManager.changeEntityLocked=!0,this.originTree.moveChilds(n,r.map(e=>this.getNode(e)),i),this.entityManager.changeEntityLocked=!1,this.fireRender())}registerLayout(e){this.layouts.push(e)}setLayout(e){var t;if(this.currentLayoutKey===e)return;let i=this.layouts.find(t=>t.name===e);i&&(this.currentLayoutKey=e,this.transformer.clear(),null==(t=i.reload)||t.call(i),this.fireRender(),this.onLayoutChangeEmitter.fire(this.layout))}toggleFixedLayout(){this.setLayout("horizontal-fixed-layout"===this.layout.name?"vertical-fixed-layout":"horizontal-fixed-layout")}dispose(){this._disposed||(this.registers.clear(),this.nodeRegistryCache.clear(),this.originTree.dispose(),this.renderTree.dispose(),this.onNodeUpdateEmitter.dispose(),this.onNodeCreateEmitter.dispose(),this.onNodeDisposeEmitter.dispose(),this.onLayoutChangeEmitter.dispose(),this._disposed=!0)}constructor(){this.contributions=[],this.registers=new Map,this.nodeRegistryCache=new Map,this.nodeDataRegistries=[],this.layouts=[],this.currentLayoutKey="",this.onNodeUpdateEmitter=new p.Q5,this.onNodeCreateEmitter=new p.Q5,this.onNodeDisposeEmitter=new p.Q5,this.onLayoutChangeEmitter=new p.Q5,this.onNodeUpdate=this.onNodeUpdateEmitter.event,this.onNodeCreate=this.onNodeCreateEmitter.event,this.onNodeDispose=this.onNodeDisposeEmitter.event,this.onLayoutChange=this.onLayoutChangeEmitter.event,this._disposed=!1}};N([(0,m.f3)(g.v2)],er.prototype,"entityManager",2),N([(0,m.f3)(et)],er.prototype,"config",2),N([(0,m.f3)(J),(0,m.jt)()],er.prototype,"options",2),N([(0,m.nx)(q),(0,m.jt)()],er.prototype,"contributions",2),N([(0,m.zY)()],er.prototype,"init",1),er=N([(0,m.b2)()],er);var en=class e{get nodes(){return this.groupNode.collapsedChildren||[]}get collapsed(){return this.groupNode.getData(U).collapsed}collapse(){this.collapsed=!0}expand(){this.collapsed=!1}get bounds(){return this.groupNode.getData(U).bounds}isStartNode(e){if(!e)return!1;let t=this.nodes;return!!t[0]&&e.id===t[0].id}isEndNode(e){if(!e)return!1;let t=this.nodes;return!!t[t.length-1]&&e.id===t[t.length-1].id}set note(e){this.groupNode.getNodeMeta().note=e}get note(){return this.groupNode.getNodeMeta().note||""}set noteHeight(e){this.groupNode.getNodeMeta().noteHeight=e}get noteHeight(){return this.groupNode.getNodeMeta().noteHeight||0}get positionConfig(){return this.groupNode.getNodeMeta().positionConfig}set collapsed(e){var t;let i=this.groupNode.getData(U);i.collapsed=e,i.localDirty=!0,i.parent&&(i.parent.localDirty=!0),(null==(t=i.parent)?void 0:t.firstChild)&&(i.parent.firstChild.localDirty=!0)}set hovered(e){let t=this.groupNode.getData(F);e?t.toggleMouseEnter():t.toggleMouseLeave(),t.hovered!==e&&(t.hovered=e)}get hovered(){return this.groupNode.getData(F).hovered}static create(t){if(t&&c.isGroupNode(t))return new e(t)}constructor(e){this.groupNode=e}},eo=c||(c={});let es=e=>{var t;return(null==e||null==(t=e.parent)?void 0:t.flowNodeType)==="group"};eo.validate=e=>{if(!e||!Array.isArray(e)||0===e.length||e.some(e=>(0,eo.isGroupNode)(e))||e.some(e=>e&&es(e)))return!1;let t=e[0].parent;return!(!e.every(e=>e.parent===t)||!e.map(e=>e.index).sort((e,t)=>e-t).every((e,t,i)=>0===t||e===i[t-1]+1)||(e=>{let t=[],i=e.parent;for(;i;)t.push(i),i=i.parent;return t})(e[0]).some(e=>es(e)))},eo.getNodeGroupController=e=>{if(!e||!es(e))return;let t=null==e?void 0:e.parent;return en.create(t)},eo.getNodeRecursionGroupController=e=>{if(!e)return;let t=(0,eo.getNodeGroupController)(e);return t||(e.parent?(0,eo.getNodeRecursionGroupController)(e.parent):void 0)},eo.isGroupNode=e=>"group"===e.flowNodeType;var ea=class{get renderState(){return this.document.renderState}get dragStartNode(){return this.renderState.getDragStartEntity()}get dragNodes(){return this.renderState.getDragEntities()}get dropNodeId(){return this.renderState.getNodeDroppingId()}get isDragBranch(){var e;return null==(e=this.dragStartNode)?void 0:e.isInlineBlock}get nodeDragIdsWithChildren(){return this.renderState.config.nodeDragIdsWithChildren||[]}get dragging(){var e;let t=null==(e=this.dragStartNode)?void 0:e.getData(F);return!!(null==t?void 0:t.dragging)}get labelSide(){return this.renderState.config.dragLabelSide}dropBranch(){this.dropNode()}dropNode(){let e=this.document.getNode(this.dropNodeId);if(!e)return;let t=[],i=this.dragStartNode;for(;i&&this.dragNodes.includes(i);)t.push(i),i=i.next;this.operationService.dragNodes({dropNode:e,nodes:t}),t.length>0&&this.onDropEmitter.fire({dropNode:e,dragNodes:t})}isDroppableNode(e){return!(!this.dragging||this.isDragBranch||this.nodeDragIdsWithChildren.includes(e.id)||e.next&&this.nodeDragIdsWithChildren.includes(e.next.id)||e.isInlineBlocks||e.isInlineBlock||this.dragNodes.some(e=>"group"===e.flowNodeType)&&c.getNodeRecursionGroupController(e))&&!0}isDroppableBranch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal_branch";if(this.isDragBranch){if(!e.isInlineBlock||e.parent!==this.dragStartNode.parent||e===this.dragStartNode)return!1;if("normal_branch"===t&&e.next!==this.dragStartNode||"pre_branch"===t&&e.pre!==this.dragStartNode)return!0}return!1}constructor(){this.onDropEmitter=new p.Q5,this.onDrop=this.onDropEmitter.event}};N([(0,m.f3)(er)],ea.prototype,"document",2),N([(0,m.f3)(V)],ea.prototype,"operationService",2),N([(0,m.f3)(g.v2)],ea.prototype,"entityManager",2),ea=N([(0,m.b2)()],ea);var el=class{init(){this.toDispose.pushAll([this.onNodeAddEmitter,this.onNodeMoveEmitter])}addNode(e){let t,i,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{parent:o,index:s,hidden:a}=n;o&&(t=this.toNodeEntity(o)),t&&(i=t.getNodeRegistry());let l={...e,type:e.type||"block"},h={...l,parent:t,index:s,hidden:a};return r=t&&(null==i?void 0:i.addChild)?i.addChild(t,l,{index:s,hidden:a}):this.document.addNode(h),this.onNodeAddEmitter.fire({node:r,data:h}),r}addFromNode(e,t){return this.document.addFromNode(e,t)}deleteNode(e){this.document.removeNode(e)}deleteNodes(e){(e||[]).forEach(e=>{this.deleteNode(e)})}addBlock(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{parent:r,index:n}=i;return this.document.addBlock(e,t,void 0,r,n)}moveNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{parent:i,index:r}=t,n=this.toNodeEntity(e),o=null==n?void 0:n.parent;if(!o)return;let s=i?this.toNodeEntity(i):o;if(!s)return void console.warn("no new parent found",i);let a=void 0===r?s.collapsedChildren.length:r;return this.doMoveNode(n,s,a)}dragNodes(e){let{dropNode:t,nodes:i}=e;if(0===i.length)return;let r=i[0],n=r.parent,o=t.parent;if(!n||!o)return;let s=n.children.findIndex(e=>e===r),a=o.children.findIndex(e=>e===t),l=a+1;n===o&&s<a&&(l-=i.length);let h={nodeIds:i.map(e=>e.id),fromParentId:n.id,toParentId:o.id,fromIndex:s,toIndex:l};return this.apply({type:"moveChildNodes",value:h})}apply(e){var t,i,r,n,o,s;let a=this.document;switch(e.type){case"addFromNode":return a.addFromNode(e.value.fromId,e.value.data);case"deleteFromNode":return null==(t=a.getNode(null==(r=e.value)||null==(i=r.data)?void 0:i.id))?void 0:t.dispose();case"addBlock":{let t;return e.value.parentId&&(t=a.getNode(e.value.parentId)),a.addBlock(e.value.targetId,e.value.blockData,void 0,t,e.value.index)}case"deleteBlock":{let t=a.getNode(null==(n=e.value)?void 0:n.blockData.id);return null==t?void 0:t.dispose()}case"createGroup":{let t=a.addFromNode(e.value.targetId,{id:e.value.groupId,type:"group"});return a.moveNodes({dropNodeId:e.value.groupId,sortNodeIds:e.value.nodeIds,inside:!0}),t}case"ungroup":return a.moveNodes({dropNodeId:e.value.groupId,sortNodeIds:e.value.nodeIds}),null==(o=a.getNode(e.value.groupId))?void 0:o.dispose();case"moveNodes":return a.moveNodes({dropNodeId:e.value.toId,sortNodeIds:e.value.nodeIds});case"moveBlock":return a.moveChildNodes({...e.value,nodeIds:[e.value.nodeId]});case"addNodes":{let t=e.value.fromId;(e.value.nodes||[]).forEach(e=>{t=a.addFromNode(t,e).id});break}case"deleteNodes":(e.value.nodes||[]).forEach(e=>{let t=a.getNode(e.id);null==t||t.dispose()});break;case"addChildNode":return a.addNode({...e.value.data,parent:e.value.parentId?a.getNode(e.value.parentId):void 0,originParent:e.value.originParentId?a.getNode(e.value.originParentId):void 0,index:e.value.index,hidden:e.value.hidden});case"deleteChildNode":return null==(s=a.getNode(e.value.data.id))?void 0:s.dispose();case"moveChildNodes":return a.moveChildNodes(e.value);default:throw Error("unknown operation type")}}transact(e){e()}dispose(){this.toDispose.dispose()}toId(e){return"string"==typeof e?e:e.id}toNodeEntity(e){return"string"==typeof e?this.document.getNode(e):e}getNodeIndex(e){let t=this.toNodeEntity(e),i=null==t?void 0:t.parent;return i?i.children.findIndex(e=>e===t):-1}doMoveNode(e,t,i){if(!e.parent)throw Error("root node cannot move");let r={node:e,fromParent:e.parent,toParent:t,fromIndex:this.getNodeIndex(e),toIndex:i};this.document.moveChildNodes({nodeIds:[this.toId(e)],toParentId:this.toId(t),toIndex:i}),this.onNodeMoveEmitter.fire(r)}constructor(){this.onNodeAddEmitter=new p.Q5,this.onNodeAdd=this.onNodeAddEmitter.event,this.toDispose=new p.K4,this.onNodeMoveEmitter=new p.Q5,this.onNodeMove=this.onNodeMoveEmitter.event}};N([(0,m.f3)(g.v2)],el.prototype,"entityManager",2),N([(0,m.f3)(er)],el.prototype,"document",2),N([(0,m.zY)()],el.prototype,"init",1),el=N([(0,m.b2)()],el);var eh=class{createGroup(e){if(!e||!Array.isArray(e)||0===e.length||!c.validate(e))return;let t=e.sort((e,t)=>e.index-t.index)[0],i=`group_${(0,E.x0)(5)}`;this.operationService.apply({type:"createGroup",value:{targetId:t.id,groupId:i,nodeIds:e.map(e=>e.id)}});let r=this.entityManager.getEntityById(i);if(!r)return;let n=this.groupController(r);if(n)return n.expand(),r}deleteGroup(e){let t=e.toJSON();e.pre&&t&&this.operationService.apply({type:"deleteNodes",value:{fromId:e.pre.id,nodes:[t]}})}ungroup(e){let t=this.groupController(e);if(!t)return;let i=t.nodes;e.pre&&(t.collapse(),this.operationService.apply({type:"ungroup",value:{groupId:e.id,targetId:e.pre.id,nodeIds:i.map(e=>e.id)}}))}getAllGroups(){return this.entityManager.getEntities(G).filter(e=>"group"===e.flowNodeType).map(e=>this.groupController(e)).filter(Boolean)}groupController(e){return en.create(e)}static validate(e){return c.validate(e)}};N([(0,m.f3)(g.v2)],eh.prototype,"entityManager",2),N([(0,m.f3)(V)],eh.prototype,"operationService",2),eh=N([(0,m.b2)()],eh);var ed=class{get document(){return this.documentProvider()}reload(){this.structDataMap=new WeakMap}update(){this.updateLocalTransform(this.document.root)}updateLocalTransform(e){var t,i,r,n;let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{children:s,parent:a,isInlineBlock:l}=e,h=e.getData(U),{getDelta:d,getOrigin:u}=e.getNodeRegistry(),c=this.structDataMap.get(e)||{childrenLength:0,index:-1};e.clearMemoGlobal();let g=h.localDirty||o,p={index:e.index,childrenLength:e.children.length};(c.childrenLength!==p.childrenLength||c.index!==p.index)&&(g=!0,this.structDataMap.set(e,p));let f=!1;if(s.length>0)for(let e of s)this.updateLocalTransform(e,f)&&(f=!0,g=!0);if(!g)return!1;e.clearMemoLocal(),h.transform.update({origin:u?u(h,this):this.getDefaultNodeOrigin()});let y=h.pre,m=(null==d?void 0:d(h,this))||{x:0,y:0},E=l&&(null==(t=h.parent)?void 0:t.inlineSpacingPre)?null==(i=h.parent)?void 0:i.inlineSpacingPre:0,b=(null==a||null==(r=(n=a.getNodeRegistry()).getChildDelta)?void 0:r.call(n,h,this))||{x:0,y:0};m.x+=b.x,m.y+=b.y;let D={x:m.x,y:m.y};return l?D.y+=E:(D.y+=(null==y?void 0:y.localBounds.bottom)||0,D.y+=(null==y?void 0:y.spacing)||0),h.transform.update({size:h.data.size,position:D}),this.onAfterUpdateLocalTransform(h),h.localDirty=!1,!0}onAfterUpdateLocalTransform(e){var t;let{onAfterUpdateLocalTransform:i}=e.entity.getNodeRegistry();null==i||i(e,this),null==(t=this.contribs)||t.forEach(t=>{var i;null==t||null==(i=t.onAfterUpdateLocalTransform)||i.call(t,e,this)})}getNodeTransform(e){return e.getData(U)}getPadding(e){let{inlineSpacingPre:t,inlineSpacingAfter:i,padding:r}=e.getNodeMeta(),n=this.getNodeTransform(e);return r?"function"==typeof r?r(n):r:{left:0,top:"function"==typeof t?t(n):t,right:0,bottom:"function"==typeof i?i(n):i}}getInitScroll(e){return{scrollX:-e.width/2,scrollY:-36}}getDefaultInputPoint(e){return this.getNodeTransform(e).bounds.topCenter}getDefaultOutputPoint(e){return this.getNodeTransform(e).bounds.bottomCenter}getDefaultNodeOrigin(){return{x:.5,y:0}}constructor(){this.name="vertical-fixed-layout",this.structDataMap=new WeakMap}};N([(0,m.f3)(ei)],ed.prototype,"documentProvider",2),N([(0,m.nx)(w),(0,m.jt)()],ed.prototype,"contribs",2),ed=N([(0,m.b2)()],ed);var eu=class{get document(){return this.documentProvider()}reload(){this.structDataMap=new WeakMap}update(){this.updateLocalTransform(this.document.root)}updateLocalTransform(e){var t,i,r,n;let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{children:s,parent:a,isInlineBlock:l}=e,h=e.getData(U),{getDelta:d,getOrigin:u}=e.getNodeRegistry(),c=this.structDataMap.get(e)||{childrenLength:0,index:-1};e.clearMemoGlobal();let g=h.localDirty||o,p={index:e.index,childrenLength:e.children.length};(c.childrenLength!==p.childrenLength||c.index!==p.index)&&(g=!0,this.structDataMap.set(e,p));let f=!1;if(s.length>0)for(let e of s)this.updateLocalTransform(e,f)&&(f=!0,g=!0);if(!g)return!1;e.clearMemoLocal(),h.transform.update({origin:u?u(h,this):this.getDefaultNodeOrigin()});let y=h.pre,m=(null==d?void 0:d(h,this))||{x:0,y:0},E=l&&(null==(t=h.parent)?void 0:t.inlineSpacingPre)?null==(i=h.parent)?void 0:i.inlineSpacingPre:0,b=(null==a||null==(r=(n=a.getNodeRegistry()).getChildDelta)?void 0:r.call(n,h,this))||{x:0,y:0};m.x+=b.x,m.y+=b.y;let D={x:m.x,y:m.y};return l?D.x+=E:(D.x+=(null==y?void 0:y.localBounds.right)||0,D.x+=(null==y?void 0:y.spacing)||0),h.transform.update({size:h.data.size,position:D}),this.onAfterUpdateLocalTransform(h),h.localDirty=!1,!0}onAfterUpdateLocalTransform(e){var t;let{onAfterUpdateLocalTransform:i}=e.entity.getNodeRegistry();null==i||i(e,this),null==(t=this.contribs)||t.forEach(t=>{var i;null==t||null==(i=t.onAfterUpdateLocalTransform)||i.call(t,e,this)})}getNodeTransform(e){return e.getData(U)}getPadding(e){let{inlineSpacingPre:t,inlineSpacingAfter:i,padding:r}=e.getNodeMeta(),n=this.getNodeTransform(e);return r?"function"==typeof r?r(n):r:{left:"function"==typeof t?t(n):t,top:0,right:"function"==typeof i?i(n):i,bottom:0}}getInitScroll(e){return{scrollX:-36,scrollY:-e.height/2}}getDefaultInputPoint(e){return this.getNodeTransform(e).bounds.leftCenter}getDefaultOutputPoint(e){return this.getNodeTransform(e).bounds.rightCenter}getDefaultNodeOrigin(){return{x:0,y:.5}}constructor(){this.name="horizontal-fixed-layout",this.structDataMap=new WeakMap}};N([(0,m.f3)(ei)],eu.prototype,"documentProvider",2),N([(0,m.nx)(w),(0,m.jt)()],eu.prototype,"contribs",2),eu=N([(0,m.b2)()],eu);var ec=new m.nZ(e=>{e(er).toSelf().inSingletonScope(),e(ei).toDynamicValue(e=>()=>e.container.get(er)).inSingletonScope(),e(et).toSelf().inSingletonScope(),e(ed).toSelf().inSingletonScope(),e(eu).toSelf().inSingletonScope(),e(ea).toSelf().inSingletonScope(),e(V).to(el).inSingletonScope(),e(eh).toSelf().inSingletonScope(),e(q).toDynamicValue(e=>({registerDocument:t=>{t.registerLayout(e.container.get(ed)),t.registerLayout(e.container.get(eu))}}))}),eg=(e,t,i)=>{var r;let n=e.getService(J);return(null==n||null==(r=n.constants)?void 0:r[t])||i||A[t]}},288216:function(e,t,i){i.d(t,{x0:()=>A,gw:()=>S.gw,gO:()=>ea,v6:()=>eg,dm:()=>J,ps:()=>Y,xV:()=>p,FD:()=>z,XH:()=>W,SP:()=>g,QW:()=>V,Qu:()=>O,uB:()=>L,iw:()=>er,PF:()=>eu,_s:()=>ef,YC:()=>ec,fY:()=>H,n2:()=>k,jg:()=>X,L4:()=>et,G2:()=>E.G2,CT:()=>j,oJ:()=>Q,e2:()=>G,PV:()=>ed,em:()=>U,Dc:()=>E.Dc,ZO:()=>eo,Z1:()=>F,fT:()=>c,KH:()=>T});var r,n,o,s,a,l,h,d,u=Symbol(""),c=((r=c||{}).ADD_NODE="ADD_NODE",r.DELETE_NODE="DELETE_NODE",r.MOVE_NODE="MOVE_NODE",r.NODE_DATA_CHANGE="NODE_DATA_CHANGE",r.ADD_LINE="ADD_LINE",r.DELETE_LINE="DELETE_LINE",r.LINE_DATA_CHANGE="LINE_DATA_CHANGE",r.META_CHANGE="META_CHANGE",r),g=((n=g||{})[n.BEZIER=0]="BEZIER",n[n.LINE_CHART=1]="LINE_CHART",n[n.STRAIGHT=2]="STRAIGHT",n),p=Symbol("WorkflowOperationBaseService"),f=Object.defineProperty,y=Object.getOwnPropertyDescriptor,m=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?y(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&f(t,i,o),o},E=i(893740),b=i(908600),D=i(875787),N=i(928079),C=i(579962),M=i(461932),S=i(832176),x=i(433210),w=i(938573),_=i(374488),I=i(57064),L=((o=L||{}).DELETE_NODES="DELETE_NODES",o.COPY_NODES="COPY_NODES",o.PASTE_NODES="PASTE_NODES",o.ZOOM_IN="ZOOM_IN",o.ZOOM_OUT="ZOOM_OUT",o.UNDO="UNDO",o.REDO="REDO",o);function T(e,t,i,r){return{x:i.center.x,y:i.center.y,labelX:i.center.x-i.x+r,labelY:i.center.y-i.y+r}}function A(e){return(0,x.x0)(e)}var O=function(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=S.Ae.enlarge(e.getAllNodes().map(e=>e.getData(E.VO).bounds));return t.fitView(r,i,30)};function k(e,t,i){let{x:r,y:n}=t;for(let t of(i?i.collapsedChildren:e.getAllNodes()).map(e=>{let t=e.getData(E.VO);return{x:t.position.x,y:t.position.y}}).sort((e,t)=>e.y-t.y)){let{x:e,y:i}=t;if(n-i<-3)break;let o=Math.abs(n-i);3>=Math.abs(r-e)&&o<=3&&(r+=30,n+=30)}return{x:r,y:n}}var R=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return`port_${t}_${e.id}_${i}`},P="WorkflowLineEntity",j=C.GA,z=class extends E.JH{static getPortEntityId(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return R(e,t,i)}get position(){return this._location}get hasError(){return this._hasError}set hasError(e){e!==this._hasError&&(this._hasError=e,this._onErrorChangedEmitter.fire())}validate(){let e=this.allLines.some(e=>!e.disposed&&!e.isHidden&&e.hasError),t=this.node.document.isErrorPort(this);this.hasError=e||t}isErrorPort(){return this.node.document.isErrorPort(this,this.hasError)}get location(){return this._location?this._location:"input"===this.portType?"left":"right"}get point(){let{targetElement:e}=this,{bounds:t}=this.node.getData(C.eG),i=this.location;if(e){var r;let t=(r=e.getBoundingClientRect(),new S.Ae(r.x,r.y,r.width,r.height)).center,n=this.entityManager.getEntity(E.ER).getPosFromMouseEvent({clientX:t.x,clientY:t.y});return{x:n.x,y:n.y,location:i}}let n={x:0,y:0},o=this._offset||{x:0,y:0};switch(i){case"left":n=t.leftCenter;break;case"top":n=t.topCenter;break;case"right":n=t.rightCenter;break;case"bottom":n=t.bottomCenter}return{x:n.x+o.x,y:n.y+o.y,location:i}}get bounds(){let{point:e}=this,t=this._size||{width:24,height:24};return new S.Ae(e.x-t.width/2,e.y-t.height/2,t.width,t.height)}isHovered(e,t){return this.bounds.contains(e,t)}get relativePosition(){let{point:e}=this,{bounds:t}=this.node.getData(C.eG);return{x:e.x-t.x,y:e.y-t.y}}updateTargetElement(e){e!==this.targetElement&&(this.targetElement=e,this.fireChange())}get disabled(){let e=this.node.document;if("function"==typeof e.options.isDisabledPort)return e.options.isDisabledPort(this);if(this._disabled)return!0;let t=this.node.getNodeMeta();return"input"===this.portType?!!t.inputDisable:!!t.outputDisable}get lines(){return this.allLines.filter(e=>!e.isDrawing)}get availableLines(){return this.allLines.filter(e=>!e.isDrawing&&!e.isHidden)}get allLines(){let e=[];return this.entityManager.getEntities({type:P}).forEach(t=>{(t.toPort===this||t.fromPort===this)&&e.push(t)}),e}update(e){let t=!1;e.targetElement!==this.targetElement&&(this.targetElement=e.targetElement,t=!0),e.location!==this._location&&(this._location=e.location,t=!0),S.XJ.isChanged(e.offset,this._offset)&&(this._offset=e.offset,t=!0),S.XJ.isChanged(e.size,this._size)&&(this._size=e.size,t=!0),e.disabled!==this._disabled&&(this._disabled=e.disabled,t=!0),t&&this.fireChange()}dispose(){this.lines.forEach(e=>e.dispose()),super.dispose()}constructor(e){super(e),this.portID="",this._hasError=!1,this._onErrorChangedEmitter=new S.Q5,this.onErrorChanged=this._onErrorChangedEmitter.event,this.portID=e.portID||"",this.portType=e.type,this._disabled=e.disabled,this._offset=e.offset,this._location=e.location,this._size=e.size,this.node=e.node,this.updateTargetElement(e.targetElement),this.toDispose.push(this.node.getData(E.VO).onDataChange(()=>this.fireChange())),this.toDispose.push(this.node.onDispose(this.dispose.bind(this)))}};z.type="WorkflowPortEntity";var V=class extends E.RD{getDefaultData(){return{}}updateAllPorts(e){let t=this.entity.getNodeMeta();e&&(this._staticPorts=e),t.useDynamicPort?this.updateDynamicPorts():this.updatePorts(this._staticPorts)}updateStaticPorts(e){this.updateAllPorts(e)}updateDynamicPorts(){let e=this.entity.getData(C.Lz).node.querySelectorAll("[data-port-id]"),t=this._staticPorts,i=[];e.length>0&&i.push(...Array.from(e).map(e=>({portID:e.getAttribute("data-port-id"),type:e.getAttribute("data-port-type"),targetElement:e}))),this.updatePorts(t.concat(i))}getPortEntityByKey(e,t){return this.getOrCreatePortEntity({type:e,portID:t})}updatePorts(e){if(!(0,w.Z)(this._prePorts,e)){let t=e.map(e=>this.getPortId(e.type,e.portID));this._portIDSet.forEach(e=>{if(!t.includes(e)){var i;null==(i=this.getPortEntity(e))||i.dispose()}}),e.forEach(e=>this.updatePortEntity(e)),this._prePorts=e,this.fireChange()}this.allPorts.forEach(e=>{e.allLines.forEach(e=>{e.validate()})})}get allPorts(){return Array.from(this._portIDSet).map(e=>this.getPortEntity(e)).filter(Boolean)}get inputPorts(){return this.allPorts.filter(e=>"input"===e.portType)}get outputPorts(){return this.allPorts.filter(e=>"output"===e.portType)}get inputPoints(){return this.inputPorts.map(e=>e.point)}get outputPoints(){return this.inputPorts.map(e=>e.point)}getInputPoint(e){return this.getPortEntityByKey("input",e).point}getOutputPoint(e){return this.getPortEntityByKey("output",e).point}getPortEntity(e){if(this._portIDSet.has(e))return this.entity.entityManager.getEntityById(e)}getPortId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return R(this.entity,e,t)}createPortEntity(e){let t=this.getPortId(e.type,e.portID),i=this.entity.entityManager.getEntityById(t);return i||(i=this.entity.entityManager.createEntity(z,{id:t,node:this.entity,...e})),i.onDispose(()=>{this._portIDSet.delete(t)}),this._portIDSet.add(t),i}getOrCreatePortEntity(e){let t=this.getPortId(e.type,e.portID);return this.getPortEntity(t)??this.createPortEntity(e)}updatePortEntity(e){let t=this.getOrCreatePortEntity(e);return t.update(e),t}constructor(e){var t;super(e),this._staticPorts=[],this._portIDSet=new Set,this.entity=e;let i=e.getNodeMeta(),r=i.useDynamicPort?[]:[{type:"input"},{type:"output"}];this._staticPorts=(null==(t=i.defaultPorts)?void 0:t.slice())||r,this.updatePorts(this._staticPorts),i.useDynamicPort&&this.toDispose.push(e.getData(E._z).onDataChange(()=>{e.getData(E._z).width&&e.getData(E._z).height&&this.updateDynamicPorts()})),this.onDispose(()=>{this.allPorts.forEach(e=>e.dispose())})}};V.type="WorkflowNodePortsData";var B=class e extends E.RD{getDefaultData(){return{inputLines:[],outputLines:[]}}get inputLines(){return this.data.inputLines}get outputLines(){return this.data.outputLines}get allLines(){return this.data.inputLines.concat(this.data.outputLines)}get availableLines(){return this.allLines.filter(e=>!e.isDrawing&&!e.isHidden)}get inputNodes(){return this.inputLines.map(e=>e.from).filter(Boolean)}get allInputNodes(){let t=new Set,i=r=>{if(t.has(r))return;t.add(r);let{inputNodes:n}=r.getData(e);n&&n.length&&n.forEach(e=>{(null==e?void 0:e.parent)!==r&&(null==r?void 0:r.parent)!==e&&i(e)})};return i(this.entity),t.delete(this.entity),Array.from(t)}get outputNodes(){return this.outputLines.map(e=>e.to).filter(Boolean)}get allOutputNodes(){let t=new Set,i=r=>{if(t.has(r))return;t.add(r);let{outputNodes:n}=r.getData(e);n&&n.length&&n.forEach(e=>{(null==e?void 0:e.parent)!==r&&(null==r?void 0:r.parent)!==e&&i(e)})};return i(this.entity),t.delete(this.entity),Array.from(t)}addLine(e){e.from===this.entity?this.outputLines.push(e):this.inputLines.push(e),this.fireChange()}removeLine(e){let{inputLines:t,outputLines:i}=this,r=t.indexOf(e),n=i.indexOf(e);-1!==r&&(t.splice(r,1),this.fireChange()),-1!==n&&(i.splice(n,1),this.fireChange())}constructor(e){super(e),this.entity=e,this.entity.preDispose.push(S.JT.create(()=>{this.inputLines.slice().forEach(e=>e.dispose()),this.outputLines.slice().forEach(e=>e.dispose())}))}};B.type="WorkflowNodeLinesData";var F=B,Y=class extends E.RD{getDefaultData(){return{version:"",contributions:new Map,position:{from:{x:0,y:0,location:"right"},to:{x:0,y:0,location:"left"}}}}get renderVersion(){return this.data.version}get position(){return this.data.position}get path(){var e;return(null==(e=this.currentLine)?void 0:e.path)??""}calcDistance(e){var t;return(null==(t=this.currentLine)?void 0:t.calcDistance(e))??Number.MAX_SAFE_INTEGER}get bounds(){var e;return(null==(e=this.currentLine)?void 0:e.bounds)??new S.Ae}update(){var e;this.syncContributions();let t=this.data.version;this.updatePosition();let i=this.data.version;t!==i&&(this.data.version=i,null==(e=this.currentLine)||e.update({fromPos:this.data.position.from,toPos:this.data.position.to}))}get lineType(){return this.entity.renderType??this.entity.linesManager.lineType}get center(){var e;return(null==(e=this.currentLine)?void 0:e.center)||{x:0,y:0,labelX:0,labelY:0}}updatePosition(){if(this.data.position.from=this.entity.from.getData(V).getOutputPoint(this.entity.info.fromPort),this.entity.info.drawingTo)this.data.position.to=this.entity.info.drawingTo;else{var e,t;this.data.position.to=(null==(t=this.entity.to)||null==(e=t.getData(V))?void 0:e.getInputPoint(this.entity.info.toPort))??{x:this.data.position.from.x,y:this.data.position.from.y,location:"right"===this.data.position.from.location?"left":"top"}}this.data.version=[this.lineType,this.data.position.from.x,this.data.position.from.y,this.data.position.from.location,this.data.position.to.x,this.data.position.to.y,this.data.position.to.location].join("-")}get currentLine(){return this.data.contributions.get(this.lineType)}syncContributions(){this.entity.linesManager.contributionFactories.length!==this.data.contributions.size&&this.entity.linesManager.contributionFactories.forEach(e=>{this.registerContribution(e)})}registerContribution(e){if(this.data.contributions.has(e.type))return;let t=new e(this.entity);this.data.contributions.set(e.type,t)}constructor(e){super(e),this.syncContributions()}};Y.type="WorkflowLineRenderData";var U=10,$=class e extends E.JH{static portInfoToLineId(e){let{from:t,to:i,fromPort:r,toPort:n}=e;return`${t}_${r||""}-${i||""}_${n||""}`}get uiState(){return this._uiState}updateUIState(e){let t=!1;Object.keys(e).forEach(i=>{let r=e[i];this._uiState[i]!==r&&(this._uiState[i]=r,t=!0)}),t&&this.fireChange()}get lineData(){return this._lineData}set lineData(e){let t=this._lineData;(0,w.Z)(t,e)||(this._lineData=e,this._onLineDataChangeEmitter.fire({oldValue:t,newValue:e}),this.fireChange())}get from(){return this._from}get to(){return this._to}get isHidden(){return this.highlightColor===this.linesManager.lineColor.hidden}get inContainer(){let e=e=>!!(null==e?void 0:e.parent)&&"root"!==e.parent.flowNodeType;return e(this.from)||e(this.to)}get processing(){return this._uiState.flowing}set processing(e){this.flowing=e}get hasError(){return this.uiState.hasError}set hasError(e){this.updateUIState({hasError:e}),this._node&&(this._node.dataset.hasError=this.hasError?"true":"false")}setToPort(e){if(!this.isDrawing)throw Error("[setToPort] only support drawing line.");if(this.toPort===e)return;let t=this.toPort;if(e&&"input"===e.portType&&this.linesManager.canAddLine(this.fromPort,e,!0)){let{node:t,portID:i}=e;this._to=t,this.info.drawingTo=void 0,this.info.to=t.id,this.info.toPort=i}else this._to=void 0,this.info.to=void 0,this.info.toPort="";t&&t.validate(),this.fireChange()}set drawingTo(e){let t=this.info.drawingTo;if(!e){this.info.drawingTo=void 0,this.fireChange();return}t&&e.x===t.x&&e.y===t.y||(this.info.to=void 0,this.info.drawingTo=e,this.fireChange())}get drawingTo(){return this.info.drawingTo}get highlightColor(){return this.uiState.highlightColor||""}set highlightColor(e){this.updateUIState({highlightColor:e})}get lockedColor(){return this.uiState.lockedColor}set lockedColor(e){this.updateUIState({lockedColor:e})}get bounds(){return this.getData(Y).bounds}get center(){return this.getData(Y).center}getHoverDist(e){return this.getData(Y).calcDistance(e)}get fromPort(){return this.from.getData(V).getPortEntityByKey("output",this.info.fromPort)}get toPort(){if(this.to)return this.to.getData(V).getPortEntityByKey("input",this.info.toPort)}get position(){return this.getData(Y).position}get reverse(){return this.linesManager.isReverseLine(this,this.uiState.reverse)}get hideArrow(){return this.linesManager.isHideArrowLine(this,this.uiState.hideArrow)}get flowing(){return this.linesManager.isFlowingLine(this,this.uiState.flowing)}set flowing(e){this._uiState.flowing!==e&&(this._uiState.flowing=e,this.fireChange())}get disabled(){return this.linesManager.isDisabledLine(this,this.uiState.disabled)}get vertical(){var e;let t=this.fromPort.location,i=null==(e=this.toPort)?void 0:e.location;return i?"top"===i:"bottom"===t}get renderType(){return this.linesManager.setLineRenderType(this)}get className(){return[this.linesManager.setLineClassName(this),this._uiState.className].filter(e=>!!e).join(" ")}get color(){return this.linesManager.getLineColor(this)}initInfo(e){(0,w.Z)(e,this.info)||(this.info=e,this._from=this.document.getNode(e.from),this._to=e.to?this.document.getNode(e.to):void 0,this._lineData=e.data,this.fireChange())}validate(){this.validateSelf()}validateSelf(){let{fromPort:e,toPort:t}=this;e&&(this.hasError=this.linesManager.isErrorLine(e,t,this.uiState.hasError))}is(t){return t instanceof e?this===t:e.portInfoToLineId(t)===this.id}canRemove(e){return this.linesManager.canRemove(this,e)}get node(){var e,t,i;return this._node||(this._node=S.xF.createDivWithClass("gedit-flow-activity-line"),this._node.dataset.testid="sdk.workflow.canvas.line",this._node.dataset.lineId=this.id,this._node.dataset.fromNodeId=this.from.id,this._node.dataset.fromPortId=(null==(e=this.fromPort)?void 0:e.id)??"",this._node.dataset.toNodeId=(null==(t=this.to)?void 0:t.id)??"",this._node.dataset.toPortId=(null==(i=this.toPort)?void 0:i.id)??"",this._node.dataset.hasError=this.hasError?"true":"false"),this._node}toJSON(){let e={sourceNodeID:this.info.from,targetNodeID:this.info.to,sourcePortID:this.info.fromPort,targetPortID:this.info.toPort};return void 0!==this._lineData&&(e.data=this._lineData),e.sourcePortID||delete e.sourcePortID,e.targetPortID||delete e.targetPortID,e}fireRender(){this.fireChange()}constructor(e){super(e),this._onLineDataChangeEmitter=new S.Q5,this.onLineDataChange=this._onLineDataChangeEmitter.event,this._uiState={hasError:!1,flowing:!1,disabled:!1,hideArrow:!1,reverse:!1,shrink:10,curvature:.25,highlightColor:"",lockedColor:""},this.stackIndex=0,this.info={from:""},this.document=e.document,this.linesManager=e.linesManager,this.initInfo({from:e.from,to:e.to,drawingTo:e.drawingTo,fromPort:e.fromPort,toPort:e.toPort,data:e.data}),e.drawingTo&&(this.isDrawing=!0),this.onEntityChange(()=>{var e,t;null==(e=this.fromPort)||e.validate(),null==(t=this.toPort)||t.validate()}),this.onDispose(()=>{var e,t;null==(e=this.fromPort)||e.validate(),null==(t=this.toPort)||t.validate()}),this.toDispose.push(this._onLineDataChangeEmitter)}};$.type=P;var G=$,Q=class{get onSelectionChanged(){return this.selectionService.onSelectionChanged}get selection(){return this.selectionService.selection}set selection(e){this.selectionService.selection=e}get activatedNode(){let{selectedNodes:e}=this;if(1===e.length)return e[0]}isSelected(e){return this.selectionService.selection.some(t=>t.id===e)}isActivated(e){var t;return(null==(t=this.activatedNode)?void 0:t.id)===e}get selectedNodes(){return this.selectionService.selection.filter(e=>e instanceof j)}selectNode(e){this.selectionService.selection=[e]}toggleSelect(e){this.selectionService.selection.includes(e)?this.selectionService.selection=this.selectionService.selection.filter(t=>t!==e):this.selectionService.selection=this.selectionService.selection.concat(e)}select(e){this.selectionService.selection=[e]}clear(){this.selectionService.selection=[]}async selectNodeAndScrollToView(e,t){this.selectNodeAndFocus(e),await (0,S.gw)(30);let i={entities:[e]};if(t){let t=S.Ae.enlarge([e.getData(E.VO).bounds]).pad(30,30),r=this.playground.config.getViewport(!1);i.zoom=S.rM.fixSize(t,r),i.scrollToCenter=!0,i.easing=!0}return this.playground.config.scrollToView(i)}selectNodeAndFocus(e){this.select(e),this.playground.node.focus()}};m([(0,M.f3)(E.z2)],Q.prototype,"selectionService",2),m([(0,M.f3)(E.XQ)],Q.prototype,"playground",2),Q=m([(0,M.b2)()],Q);var W=class{updateHoveredKey(e){this.hoveredKey!==e&&(this.hoveredKey=e,this.onHoveredChangeEmitter.fire(e))}updateHoverPosition(e,t){this.hoveredPos=e,this.onUpdateHoverPositionEmitter.fire({position:e,target:t})}clearHovered(){this.updateHoveredKey("")}isHovered(e){return e===this.hoveredKey}isSomeHovered(){return!!this.hoveredKey}get hoveredNode(){return this.entityManager.getEntityById(this.hoveredKey)}constructor(){this.onHoveredChangeEmitter=new S.Q5,this.onUpdateHoverPositionEmitter=new S.Q5,this.onHoveredChange=this.onHoveredChangeEmitter.event,this.onUpdateHoverPosition=this.onUpdateHoverPositionEmitter.event,this.hoveredPos={x:0,y:0},this.hoveredKey=""}};m([(0,M.f3)(E.v2)],W.prototype,"entityManager",2),W=m([(0,M.b2)()],W);var H=Symbol("WorkflowDocumentOptions"),X={cursors:{grab:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjEiIHZpZXdCb3g9IjAgMCAyMCAyMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMC40ODczIDIuNjIzNzhDOS45MDczMSAyLjYyMzc4IDkuNDM3MTMgMy4wOTM5NiA5LjQzNzEzIDMuNjczOTZWNS4xNDM3NkM5LjM5NDI4IDQuNDAyNzQgOC43Nzk3OCAzLjgxNTA0IDguMDI4MDIgMy44MTUwNEM3LjI0ODQ4IDMuODE1MDQgNi42MTY1MyA0LjQ0Njk5IDYuNjE2NTMgNS4yMjY1M1YxMS44Mjg5TDUuNjc0MTggMTEuMDA0OUM1LjE1NDg3IDEwLjU1MDkgNC40MDk1IDEwLjQ2MzYgMy43OTkzOCAxMC43ODU1TDMuNjk2OTQgMTAuODM5NkMzLjA2MjE3IDExLjE3NDUgMi45MjI2IDEyLjAyMjggMy40MTY2MiAxMi41NDM0TDcuMzM5NTkgMTYuNjc3NVYxNy4zMjU5QzcuMzM5NTkgMTcuNzg2MiA3LjcxMjY5IDE4LjE1OTMgOC4xNzI5MiAxOC4xNTkzSDEzLjgwODRDMTQuMjY4NyAxOC4xNTkzIDE0LjY0MTcgMTcuNzg2MiAxNC42NDE3IDE3LjMyNTlWMTYuNzkzNUMxNS44MDk0IDE1LjY0ODUgMTYuNDY3MyAxNC4wODE5IDE2LjQ2NzMgMTIuNDQ2NVYxMS40OTY3TDE2LjQ2NzEgNi42MzY4NUMxNi40NjcxIDUuOTU2MyAxNS45MTU0IDUuNDA0NjEgMTUuMjM0OCA1LjQwNDYxQzE0LjU1NDMgNS40MDQ2MSAxNC4wMDI2IDUuOTU2MyAxNC4wMDI2IDYuNjM2ODVMMTQuMDAyMSA1LjA0NzI4QzE0LjAwMjEgNC4zNjY3MyAxMy40NTA0IDMuODE1MDQgMTIuNzY5OCAzLjgxNTA0QzEyLjA4OTMgMy44MTUwNCAxMS41Mzc2IDQuMzY2NzMgMTEuNTM3NiA1LjA0NzI4TDExLjUzNzUgMy42NzM5NUMxMS41Mzc1IDMuMDkzOTYgMTEuMDY3MyAyLjYyMzc4IDEwLjQ4NzMgMi42MjM3OFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTAuNDg3NCAxLjM3NDAyQzExLjM2MTIgMS4zNzQwMiAxMi4xMjExIDEuODYxMTggMTIuNTEwNSAyLjU3ODY4QzEyLjU5NTggMi41Njk4MyAxMi42ODIzIDIuNTY1MjggMTIuNzcgMi41NjUyOEMxMy44Mjc4IDIuNTY1MjggMTQuNzMxMSAzLjIyNzAxIDE1LjA4ODUgNC4xNTkxMUMxNS4xMzcgNC4xNTYyOSAxNS4xODU4IDQuMTU0ODYgMTUuMjM1IDQuMTU0ODZDMTYuNjA1OSA0LjE1NDg2IDE3LjcxNzIgNS4yNjYxOSAxNy43MTcyIDYuNjM3MDlMMTcuNzE3NCAxMi40NDY3QzE3LjcxNzQgMTQuMjM1NSAxNy4wNjQ0IDE1Ljk1NTkgMTUuODkxOSAxNy4yOTA0VjE3LjMyNjJDMTUuODkxOSAxOC40NzY4IDE0Ljk1OTEgMTkuNDA5NSAxMy44MDg1IDE5LjQwOTVIOC4xNzMwNkM3LjAyMjQ3IDE5LjQwOTUgNi4wODk3MyAxOC40NzY4IDYuMDg5NzMgMTcuMzI2MlYxNy4xNzY0TDIuNTEwMDMgMTMuNDA0MUMxLjQ0NTk5IDEyLjI4MjggMS43NDY2IDEwLjQ1NTUgMy4xMTM3OSA5LjczNDI0TDMuMjE2MjQgOS42ODAxOUMzLjg5MTY4IDkuMzIzODMgNC42NjE4NSA5LjI1NDAxIDUuMzY2NjYgOS40NTE5OFY1LjIyNjc4QzUuMzY2NjYgMy43NTY4NyA2LjU1ODI2IDIuNTY1MjggOC4wMjgxNiAyLjU2NTI4QzguMTcyOTMgMi41NjUyOCA4LjMxNDk5IDIuNTc2ODQgOC40NTM0NyAyLjU5OTA3QzguODM5NDMgMS44NzA0MiA5LjYwNTQ2IDEuMzc0MDIgMTAuNDg3NCAxLjM3NDAyWk0xMi40NDc2IDMuODU3ODdWOS40NzY0NkMxMi40NDc2IDkuNzI4NTIgMTIuMjQzMyA5LjkzMjg1IDExLjk5MTMgOS45MzI4NUMxMS43MzkyIDkuOTMyODUgMTEuNTM0OSA5LjcyODUyIDExLjUzNDkgOS40NzY0NlYzLjc5NjU1QzExLjUzNDkgMy43Nzk1NiAxMS41MzU4IDMuNzYyNzcgMTEuNTM3NiAzLjc0NjI2VjMuNjc0MkMxMS41Mzc2IDMuNDMyODIgMTEuNDU2MiAzLjIxMDQ2IDExLjMxOTMgMy4wMzMwOUMxMS4xMjcyIDIuNzg0MjggMTAuODI2MSAyLjYyNDAyIDEwLjQ4NzQgMi42MjQwMkMxMC4xMjM4IDIuNjI0MDIgOS44MDMzMiAyLjgwODg2IDkuNjE0ODMgMy4wODk3QzkuNTAyNjkgMy4yNTY3OSA5LjQzNzI2IDMuNDU3ODUgOS40MzcyNiAzLjY3NDJWMy43ODU3M0M5LjQzNzM1IDMuNzg5MzMgOS40MzczOSAzLjc5Mjk0IDkuNDM3MzkgMy43OTY1NVY5LjkwMTdDOS40MzczOSAxMC4xNTM3IDkuMjMzMDYgMTAuMzU4MSA4Ljk4MTAxIDEwLjM1ODFDOC43Mjg5NSAxMC4zNTgxIDguNTI0NjIgMTAuMTUzNyA4LjUyNDYyIDkuOTAxN1YzLjkwNTA3QzguNDE3NzMgMy44NjQ5IDguMzA0NjggMy44MzczMiA4LjE4NzI2IDMuODI0MTVDOC4xMzUwNCAzLjgxODI5IDguMDgxOTUgMy44MTUyOCA4LjAyODE2IDMuODE1MjhDNy4yNDg2MSAzLjgxNTI4IDYuNjE2NjYgNC40NDcyMyA2LjYxNjY2IDUuMjI2NzhWMTEuODI5Mkw1LjY3NDMxIDExLjAwNTJDNS41Nzg2OCAxMC45MjE2IDUuNDc1MzcgMTAuODUwNCA1LjM2NjY2IDEwLjc5MTlDNC44ODUwNiAxMC41MzI5IDQuMjk3MjggMTAuNTIzMSAzLjc5OTUyIDEwLjc4NThMMy42OTcwNyAxMC44Mzk4QzMuMDYyMzEgMTEuMTc0NyAyLjkyMjczIDEyLjAyMzEgMy40MTY3NSAxMi41NDM3TDcuMzM5NzMgMTYuNjc3N1YxNy4zMjYyQzcuMzM5NzMgMTcuNzg2NCA3LjcxMjgyIDE4LjE1OTUgOC4xNzMwNiAxOC4xNTk1SDEzLjgwODVDMTQuMjY4OCAxOC4xNTk1IDE0LjY0MTkgMTcuNzg2NCAxNC42NDE5IDE3LjMyNjJWMTYuNzkzOEMxNS43Mzc5IDE1LjcxOSAxNi4zODQ3IDE0LjI3MjggMTYuNDYgMTIuNzQ3QzE2LjQ2NDEgMTIuNjY0MSAxNi40NjY1IDEyLjU4MDkgMTYuNDY3MiAxMi40OTc1TDE2LjQ2NzQgMTIuNDQ2N0wxNi40NjcyIDYuNjM3MDlDMTYuNDY3MiA1Ljk2MjMgMTUuOTI0OCA1LjQxNDE5IDE1LjI1MjIgNS40MDQ5N0wxNS4yMzUgNS40MDQ4NkMxNS4xMjQ2IDUuNDA0ODYgMTUuMDE3NyA1LjQxOTM2IDE0LjkxNTkgNS40NDY1NlY5LjYwMjI2QzE0LjkxNTkgOS44NTQzMSAxNC43MTE2IDEwLjA1ODYgMTQuNDU5NSAxMC4wNTg2QzE0LjIwNzUgMTAuMDU4NiAxNC4wMDMxIDkuODU0MzEgMTQuMDAzMSA5LjYwMjI2VjYuNjA1MTRDMTQuMDAyOSA2LjYxNTc2IDE0LjAwMjcgNi42MjY0MSAxNC4wMDI3IDYuNjM3MDlWOS4yNzcwNUwxNC4wMDIyIDUuMDQ3NTJDMTQuMDAyMiA0Ljg2OTEzIDEzLjk2NDMgNC42OTk2IDEzLjg5NjEgNC41NDY1M0MxMy43MDY0IDQuMTIwNzIgMTMuMjgyMiAzLjgyMjM1IDEyLjc4NzYgMy44MTU0MUwxMi43NyAzLjgxNTI4QzEyLjY1ODQgMy44MTUyOCAxMi41NTA0IDMuODMwMSAxMi40NDc2IDMuODU3ODdaIiBmaWxsPSIjMUQxQzIzIi8+Cjwvc3ZnPg=="), auto',grabbing:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjEiIHZpZXdCb3g9IjAgMCAyMCAyMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik02LjYxODE3IDUuNTk4NzVDNi42MTgxNyA0LjgxOTIgNy4yNTAxMiA0LjE4NzI2IDguMDI5NjcgNC4xODcyNkM4Ljc3ODczIDQuMTg3MjYgOS4zOTE1MiA0Ljc3MDc1IDkuNDM4MjkgNS41MDgwMUM5LjQ1OTkyIDQuOTQ3MSA5LjkyMTQ3IDQuNDk5MDIgMTAuNDg3NyA0LjQ5OTAyQzExLjA2NzcgNC40OTkwMiAxMS41Mzc4IDQuOTY5MiAxMS41Mzc4IDUuNTQ5MTlWOC43NjI0NkwxMS41Mzc5IDYuNzExNUMxMS41Mzc5IDYuMDMwOTUgMTIuMDg5NiA1LjQ3OTI2IDEyLjc3MDIgNS40NzkyNkMxMy40NTA3IDUuNDc5MjYgMTQuMDAyNCA2LjAzMDk1IDE0LjAwMjQgNi43MTE1TDE0LjAwMjQgOC43NjI0NkwxNC4wMDI5IDguMDE5ODNDMTQuMDAyOSA3LjMzOTI5IDE0LjU1NDYgNi43ODc1OSAxNS4yMzUyIDYuNzg3NTlDMTUuOTE1NyA2Ljc4NzU5IDE2LjQ2NzQgNy4zMzkyOCAxNi40Njc0IDguMDE5ODNWMTEuNDk3TDE2LjQ2NzUgMTIuNDQ2N0MxNi40Njc1IDE0LjA4MjEgMTUuODA5NiAxNS42NDg3IDE0LjY0MiAxNi43OTM4VjE3LjMyNjJDMTQuNjQyIDE3Ljc4NjQgMTQuMjY4OSAxOC4xNTk1IDEzLjgwODcgMTguMTU5NUg4LjE3MzE3QzcuNzEyOTMgMTguMTU5NSA3LjMzOTg0IDE3Ljc4NjQgNy4zMzk4NCAxNy4zMjYyVjE1Ljk0MjRMNS4zNDU2MiAxNC43NTM0QzQuNTg5MjQgMTQuMzAyNCA0LjEyNTkxIDEzLjQ4NjcgNC4xMjU4OSAxMi42MDYxTDQuMTI1ODMgOS4yODM4M0M0LjEyNTgyIDguOTU0MjcgNC4zMjAwMyA4LjY1NTY2IDQuNjIxMjkgOC41MjIwNUw2LjYxODE3IDcuNjM2MzRWNS41OTg3NVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTAuNDg3OCAzLjI0OTAyQzExLjI3OTYgMy4yNDkwMiAxMS45Nzc4IDMuNjQ5MDIgMTIuMzkxNyA0LjI1Nzk2QzEyLjUxNTEgNC4yMzkwNiAxMi42NDE2IDQuMjI5MjYgMTIuNzcwMyA0LjIyOTI2QzEzLjcyMjQgNC4yMjkyNiAxNC41NDkzIDQuNzY1MzEgMTQuOTY1NyA1LjU1MjA3QzE1LjA1NDMgNS41NDI1IDE1LjE0NDIgNS41Mzc1OSAxNS4yMzUzIDUuNTM3NTlDMTYuNjA2MiA1LjUzNzU5IDE3LjcxNzYgNi42NDg5MyAxNy43MTc2IDguMDE5ODNMMTcuNzE3NyAxMi40NDY3QzE3LjcxNzcgMTQuMjM1NSAxNy4wNjQ3IDE1Ljk1NTkgMTUuODkyMSAxNy4yOTA0VjE3LjMyNjJDMTUuODkyMSAxOC40NzY4IDE0Ljk1OTQgMTkuNDA5NSAxMy44MDg4IDE5LjQwOTVIOC4xNzMzMkM3LjAyMjczIDE5LjQwOTUgNi4wODk5OCAxOC40NzY4IDYuMDg5OTggMTcuMzI2MlYxNi42NTI0TDQuNzA1NjMgMTUuODI3QzMuNTcxMDYgMTUuMTUwNSAyLjg3NjA3IDEzLjkyNzEgMi44NzYwNCAxMi42MDYxTDIuODc1OTggOS4yODM4NUMyLjg3NTk2IDguNDU5OTYgMy4zNjE0OSA3LjcxMzQ1IDQuMTE0NjIgNy4zNzk0TDUuMzY4MzIgNi44MjMzM1Y1LjU5ODc1QzUuMzY4MzIgNC4xMjg4NSA2LjU1OTkxIDIuOTM3MjYgOC4wMjk4MiAyLjkzNzI2QzguNjA4MzEgMi45MzcyNiA5LjE0MzU1IDMuMTIxNyA5LjU4MDA1IDMuNDM1MDVDOS44NTg1MyAzLjMxNTMyIDEwLjE2NTQgMy4yNDkwMiAxMC40ODc4IDMuMjQ5MDJaTTEyLjQ0NzkgNS41MjE4NlY5LjQ3NTU3QzEyLjQ0NzkgOS43Mjc2MiAxMi4yNDM2IDkuOTMxOTUgMTEuOTkxNiA5LjkzMTk1QzExLjc1NjggOS45MzE5NSAxMS41NjM0IDkuNzU0NjUgMTEuNTM4IDkuNTI2NjNDMTEuNTM2MSA5LjUwOTg3IDExLjUzNTIgOS40OTI4MyAxMS41MzUyIDkuNDc1NTdWNS40NzE1OEMxMS41MTU0IDUuMjAwODMgMTEuMzkzIDQuOTU4NTggMTEuMjA2NiA0Ljc4MzU4QzExLjAxODggNC42MDcxMSAxMC43NjU5IDQuNDk5MDIgMTAuNDg3OCA0LjQ5OTAyQzEwLjQ3NjYgNC40OTkwMiAxMC40NjU0IDQuNDk5MTkgMTAuNDU0MiA0LjQ5OTU0QzkuOTAzNDcgNC41MTY4NCA5LjQ1OTY0IDQuOTU4MjQgOS40Mzg0NCA1LjUwODAxQzkuNDM4MiA1LjUwNDMgOS40Mzc5NSA1LjUwMDU4IDkuNDM3NjkgNS40OTY4OFY5LjkwMjQzQzkuNDM3NjkgMTAuMTU0NSA5LjIzMzM2IDEwLjM1ODggOC45ODEzMSAxMC4zNTg4QzguNzI5MjUgMTAuMzU4OCA4LjUyNDkyIDEwLjE1NDUgOC41MjQ5MiA5LjkwMjQzVjQuMjc2NTNDOC4zNzA4NiA0LjIxODgyIDguMjA0MDIgNC4xODcyNiA4LjAyOTgyIDQuMTg3MjZDNy4yNTAyNyA0LjE4NzI2IDYuNjE4MzIgNC44MTkyIDYuNjE4MzIgNS41OTg3NUw2LjYxODI3IDkuOTc1OTlDNi42MTgyNyAxMC4yMjggNi40MTM5NCAxMC40MzI0IDYuMTYxODkgMTAuNDMyNEM1LjkwOTgzIDEwLjQzMjQgNS43MDU1IDEwLjIyOCA1LjcwNTUgOS45NzU5OVY4LjA0MTIyTDQuNjIxNDQgOC41MjIwNUM0LjMyMDE4IDguNjU1NjYgNC4xMjU5NyA4Ljk1NDI3IDQuMTI1OTggOS4yODM4M0w0LjEyNjA0IDEyLjYwNjFDNC4xMjYwNiAxMy40ODY3IDQuNTg5MzkgMTQuMzAyNCA1LjM0NTc2IDE0Ljc1MzRMNy4zMzk5OCAxNS45NDI0VjE3LjMyNjJDNy4zMzk5OCAxNy43ODY0IDcuNzEzMDggMTguMTU5NSA4LjE3MzMyIDE4LjE1OTVIMTMuODA4OEMxNC4yNjkgMTguMTU5NSAxNC42NDIxIDE3Ljc4NjQgMTQuNjQyMSAxNy4zMjYyVjE2Ljc5MzhDMTUuNzM4MSAxNS43MTkgMTYuMzg1IDE0LjI3MjggMTYuNDYwMyAxMi43NDdDMTYuNDY0NiAxMi42NiAxNi40NjcgMTIuNTcyOCAxNi40Njc2IDEyLjQ4NTRMMTYuNDY3NyAxMi40NDY3TDE2LjQ2NzYgOC4wMTk4M0MxNi40Njc2IDcuMzQ1MDQgMTUuOTI1MiA2Ljc5NjkzIDE1LjI1MjUgNi43ODc3MUwxNS4yMzUzIDYuNzg3NTlDMTUuMTI1IDYuNzg3NTkgMTUuMDE4IDYuODAyMSAxNC45MTYyIDYuODI5MzFWOS42MDEzNkMxNC45MTYyIDkuODUzNDIgMTQuNzExOSAxMC4wNTc3IDE0LjQ1OTggMTAuMDU3N0MxNC4yMDc4IDEwLjA1NzcgMTQuMDAzNCA5Ljg1MzQxIDE0LjAwMzQgOS42MDEzNlY3Ljk4OTg1QzE0LjAwMzIgNy45OTk4MiAxNC4wMDMxIDguMDA5ODEgMTQuMDAzMSA4LjAxOTgzTDE0LjAwMzQgOS42MDEzNkwxNC4wMDI1IDYuNzExNUMxNC4wMDI1IDYuNDQ5NzQgMTMuOTIwOSA2LjIwNzA1IDEzLjc4MTggNi4wMDc0OEMxMy41NjIgNS42OTI0MiAxMy4xOTg5IDUuNDg0ODMgMTIuNzg3IDUuNDc5MzdMMTIuNzcwMyA1LjQ3OTI2QzEyLjY1ODggNS40NzkyNiAxMi41NTA3IDUuNDk0MDggMTIuNDQ3OSA1LjUyMTg2WiIgZmlsbD0iIzFEMUMyMyIvPgo8L3N2Zz4="), auto'},fromNodeJSON(e,t,i){let r=e.getData(I.Ps),{formMeta:n}=e.getNodeRegistry();r&&n&&(i?(r.createForm(n,t.data),r.onDataChange(()=>{e.document.fireContentChange({type:"NODE_DATA_CHANGE",toJSON:()=>r.toJSON(),entity:e})})):r.updateFormValues(t.data))},toNodeJSON(e){var t,i;let r=null==(t=e.getData(I.fu))?void 0:t.getError();if(r)throw r;let n=e.getData(E.VO),o=function(e){let t=e.getData(I.Ps);if(t&&e.getNodeRegistry().formMeta)return t.toJSON()}(e),s={},a=e.getNodeMeta(),l=null==(i=a.subCanvas)?void 0:i.call(a,e);if((null==l?void 0:l.isCanvas)===!1){let{x:e,y:t}=l.canvasNode.getData(C.eG).transform.position;s.canvasPosition={x:e,y:t}}return{id:e.id,type:e.flowNodeType,meta:{position:{x:n.position.x,y:n.position.y},...s},data:o}}},J=class{init(e){this.document=e}forceUpdate(){this.onForceUpdateEmitter.fire()}get lineType(){return this._lineType}get lineColor(){let e={default:"var(--g-workflow-line-color-default,#4d53e8)",error:"var(--g-workflow-line-color-error,red)",hidden:"var(--g-workflow-line-color-hidden,transparent)",drawing:"var(--g-workflow-line-color-drawing, #5DD6E3)",hovered:"var(--g-workflow-line-color-hover,#37d0ff)",selected:"var(--g-workflow-line-color-selected,#37d0ff)",flowing:"var(--g-workflow-line-color-flowing,#4d53e8)"};return this.options.lineColor&&Object.assign(e,this.options.lineColor),e}switchLineType(e){return void 0===e&&(e=+(0===this._lineType)),e!==this._lineType&&(this._lineType=e,this.getAllLines().forEach(e=>{e.getData(Y).update()}),window.requestAnimationFrame(()=>{this.entityManager.fireEntityChanged(G.type)})),this._lineType}getAllLines(){return this.entityManager.getEntities(G)}hasLine(e){return!!this.entityManager.getEntityById(G.portInfoToLineId(e))}getLine(e){return this.entityManager.getEntityById(G.portInfoToLineId(e))}getLineById(e){return this.entityManager.getEntityById(e)}replaceLine(e,t){let i=this.getLine(e);return i&&i.dispose(),this.createLine(t)}createLine(e){var t;let{from:i,to:r,drawingTo:n,fromPort:o,toPort:s,data:a}=e,l=!!(i&&r),h=e.key||G.portInfoToLineId(e),d=this.entityManager.getEntityById(h);if(d)return d.highlightColor="",d.validate(),d;let u=null==(t=this.entityManager.getEntityById(i))?void 0:t.getData(F),c=r?this.entityManager.getEntityById(r).getData(F):void 0;if(u)return this.isDrawing=!!n,d=this.entityManager.createEntity(G,{id:h,document:this.document,linesManager:this,from:i,fromPort:o,toPort:s,to:r,drawingTo:n,data:a}),this.registerData(d),u.addLine(d),null==c||c.addLine(d),d.onDispose(()=>{n&&(this.isDrawing=!1),u.removeLine(d),null==c||c.removeLine(d)}),d.onDispose(()=>{l&&this.onAvailableLinesChangeEmitter.fire({type:"DELETE_LINE",toJSON:()=>d.toJSON(),entity:d})}),d.onLineDataChange(e=>{let{oldValue:t}=e;this.onAvailableLinesChangeEmitter.fire({type:"LINE_DATA_CHANGE",toJSON:()=>d.toJSON(),oldValue:t,entity:d})}),l&&this.onAvailableLinesChangeEmitter.fire({type:"ADD_LINE",toJSON:()=>d.toJSON(),entity:d}),d.validate(),d}getCloseInLineFromMousePos(e){let t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return this.getAllLines().forEach(n=>{let o=n.getHoverDist(e);o<=r&&(!i||i>=o)&&(i=o,t=n)}),t}dispose(){this.toDispose.dispose()}get disposed(){return this.toDispose.disposed}isErrorLine(e,t,i){return this.options.isErrorLine?this.options.isErrorLine(e,t,this):!!i}isReverseLine(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.options.isReverseLine?this.options.isReverseLine(e):t}isHideArrowLine(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.options.isHideArrowLine?this.options.isHideArrowLine(e):t}isFlowingLine(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.options.isFlowingLine?this.options.isFlowingLine(e):t}isDisabledLine(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.options.isDisabledLine?this.options.isDisabledLine(e):t}setLineRenderType(e){if(this.options.setLineRenderType)return this.options.setLineRenderType(e)}setLineClassName(e){if(this.options.setLineClassName)return this.options.setLineClassName(e)}getLineColor(e){return e.isHidden?this.lineColor.hidden:e.lockedColor?e.lockedColor:e.hasError?this.lineColor.error:e.highlightColor?e.highlightColor:e.drawingTo?this.lineColor.drawing:this.hoverService.isHovered(e.id)?this.lineColor.hovered:this.selectService.isSelected(e.id)?this.lineColor.selected:this.isFlowingLine(e)?this.lineColor.flowing:this.lineColor.default}canAddLine(e,t,i){if(e===t||e.node===t.node||"output"!==e.portType||"input"!==t.portType||t.disabled)return!1;let r=e.node.getNodeRegistry().canAddLine,n=t.node.getNodeRegistry().canAddLine;return(!r||!!r(e,t,this,i))&&(!n||!!n(e,t,this,i))&&(this.options.canAddLine?this.options.canAddLine(e,t,this,i):e.node!==t.node)}toJSON(){return this.getAllLines().filter(e=>!e.isDrawing).map(e=>e.toJSON())}getPortById(e){return this.entityManager.getEntityById(e)}canRemove(e,t,i){return!this.options||!this.options.canDeleteLine||!!this.options.canDeleteLine(e,t,i)}canReset(e,t,i){return!this.options||!this.options.canResetLine||!!this.options.canResetLine(e,t,i,this)}getPortFromMousePos(e){let t=this.getSortedNodes().reverse().map(e=>e.getData(V).allPorts).flat().find(t=>t.isHovered(e.x,e.y));if(t){let i=this.getContainNodesFromMousePos(e),r=(0,_.Z)(i);if(r&&r!==t.node)return}return t}getNodeFromMousePos(e){let{selection:t}=this.selectService,i=this.getContainNodesFromMousePos(e);if(null==t?void 0:t.length){let e=i.filter(e=>t.some(t=>e.id===t.id));if(null==e?void 0:e.length)return(0,_.Z)(e)}return(0,_.Z)(i)}registerContribution(e){return this.contributionFactories.push(e),this}registerData(e){e.addData(Y)}getSortedNodes(){return this.document.getAllNodes().sort((e,t)=>this.getNodeIndex(e)-this.getNodeIndex(t))}getContainNodesFromMousePos(e){var t,i;let r=this.getSortedNodes(),n=(null==(i=this.entityManager.getEntity(E.ER))||null==(t=i.config)?void 0:t.zoom)||1;return r.map(t=>{let{bounds:i}=t.getData(C.eG);if(i.clone().pad(4/n).contains(e.x,e.y))return t}).filter(Boolean)}getNodeIndex(e){return e.getData(C.Lz).stackIndex}constructor(){this.toDispose=new S.K4,this._lineType=0,this.onAvailableLinesChangeEmitter=new S.Q5,this.onForceUpdateEmitter=new S.Q5,this.onAvailableLinesChange=this.onAvailableLinesChangeEmitter.event,this.onForceUpdate=this.onForceUpdateEmitter.event,this.contributionFactories=[],this.isDrawing=!1}};m([(0,M.f3)(W)],J.prototype,"hoverService",2),m([(0,M.f3)(Q)],J.prototype,"selectService",2),m([(0,M.f3)(E.v2)],J.prototype,"entityManager",2),m([(0,M.f3)(H)],J.prototype,"options",2),J=m([(0,M.b2)()],J);var Z="free-layout",K=class{get document(){return this.documentProvider()}update(){var e;(null==(e=this.document.root.getData(C.eG))?void 0:e.localDirty)&&this.document.root.clearMemoGlobal()}syncTransform(e){let t=e.getData(C.eG);if(t.localDirty)e.clearMemoGlobal(),e.clearMemoLocal(),t.transform.update({size:t.data.size}),e.parent&&(e.parent.clearMemoGlobal(),e.parent.clearMemoLocal(),e.parent.getData(C.eG).transform.fireChange())}updateAffectedTransform(e){if(!e.transform.localDirty)return;let t=this.getAllParents(e);[...this.getAllBlocks(e).reverse(),...t].forEach(e=>{this.fireChange(e)})}getPadding(e){let{padding:t}=e.getNodeMeta(),i=e.getData(C.eG);return t?"function"==typeof t?t(i):t:S.sI.empty()}getInitScroll(e){let t=S.Ae.enlarge(this.document.getAllNodes().map(e=>e.getData(E.VO).bounds)).pad(30,30),i=this.playgroundConfig.getViewport(!1),r=S.rM.fixSize(t,i);return{scrollX:(t.x+t.width/2)*r-this.playgroundConfig.config.width/2,scrollY:(t.y+t.height/2)*r-this.playgroundConfig.config.height/2}}getDefaultInputPoint(e){return e.getData(E.VO).bounds.leftCenter}getDefaultOutputPoint(e){return e.getData(E.VO).bounds.rightCenter}getDefaultNodeOrigin(){return{x:.5,y:0}}getAllParents(e){let t=[],i=e.parent;for(;i;)t.push(i),i=i.parent;return t}getAllBlocks(e){return e.blocks.reduce((e,t)=>[...e,...this.getAllBlocks(t)],[e])}fireChange(e){let t=null==e?void 0:e.transform;e&&(null==t?void 0:t.localDirty)&&(e.clearMemoGlobal(),e.clearMemoLocal(),t.transform.fireChange())}constructor(){this.name=Z}};m([(0,M.f3)(E.ER)],K.prototype,"playgroundConfig",2),m([(0,M.f3)(C.JU)],K.prototype,"documentProvider",2),K=m([(0,M.b2)()],K);var q=(0,x.kP)("1234567890",5),ee=Symbol("WorkflowDocumentProvider"),et=class extends C.pQ{get loading(){return this._loading}async fitView(e){return O(this,this.playgroundConfig,e).then(()=>{this.linesManager.forceUpdate()})}init(){super.init(),this.currentLayoutKey=this.options.defaultLayout||Z,this.linesManager.init(this),this.playgroundConfig.getCursors=()=>this.options.cursors,this.linesManager.onAvailableLinesChange(e=>this.fireContentChange(e)),this.playgroundConfig.onReadonlyOrDisabledChange(e=>{let{readonly:t}=e;this.nodeEngineContext&&(this.nodeEngineContext.readonly=t)})}async load(){this.disposed||(this._loading=!0,await super.load(),this._loading=!1,this.onLoadedEmitter.fire())}async reload(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.disposed||(this._loading=!0,this.clear(),this.fromJSON(e),await (0,S.gw)(t),this._loading=!1,this._onReloadEmitter.fire(this))}fromJSON(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this.disposed)return;let i={nodes:e.nodes??[],edges:e.edges??[]};this.entityManager.changeEntityLocked=!0,this.renderJSON(i),this.entityManager.changeEntityLocked=!1,this.transformer.loading=!1,t&&this.fireRender()}clear(){this.getAllNodes().map(e=>e.dispose()),this.linesManager.getAllLines().map(e=>e.dispose()),this.getAllPorts().map(e=>e.dispose()),this.selectServices.clear()}createWorkflowNode(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=this.getNode(e.id),n=this.getNode(i??this.root.id)??this.root,o=this.addNode({...e,parent:n},void 0,!0),{formMeta:s}=o.getNodeRegistry(),a=o.getNodeMeta(),l=o.getData(I.Ps),h=o.getData(C.eG),d=this.layout;r||h.onDataChange(()=>{d.syncTransform(o)});let{position:u}=a;u||(u=this.getNodeDefaultPosition(e.type)),o.getData(E.VO).update({position:u}),s&&l&&!l.formModel.initialized&&(l.createForm(s,e.data),l.onDataChange(()=>{this.fireContentChange({type:"NODE_DATA_CHANGE",toJSON:()=>l.toJSON(),entity:o})}));let c=o.getData(E.WV);r||c.onDataChange(()=>{this.fireContentChange({type:"MOVE_NODE",toJSON:()=>c.toJSON(),entity:o})});let g=this.getNodeSubCanvas(o);if(!r&&!(null==g?void 0:g.isCanvas)){let e;this.fireContentChange({type:"ADD_NODE",entity:o,toJSON:()=>this.toNodeJSON(o)}),o.onDispose(()=>{o.parent&&o.parent.flowNodeType!==C.Sy.ROOT&&o.parent.getData(C.eG).fireChange()}),o.preDispose.onDispose(()=>{e=this.toNodeJSON(o)}),o.onDispose(()=>{this.fireContentChange({type:"DELETE_NODE",entity:o,toJSON:()=>e})})}if(e.blocks&&this.renderJSON({nodes:e.blocks,edges:e.edges??[]},{parent:o,isClone:t}),g){var p;g.canvasNode.getData(E.VO).update({position:null==(p=g.parentNode.getNodeMeta())?void 0:p.canvasPosition}),r||(g.parentNode.onDispose(()=>{g.canvasNode.dispose()}),g.canvasNode.onDispose(()=>{g.parentNode.dispose()}))}return r?this.onNodeUpdateEmitter.fire({node:o,data:e,json:e}):this.onNodeCreateEmitter.fire({node:o,data:e,json:e}),o}addNode(e,t,i){var r,n,o,s;let{id:a,type:l="block",originParent:h,parent:d,meta:u,hidden:c,index:g}=e,p=this.getNode(a),f=!1,y=this.getNodeRegistry(l,e.originParent);if(p&&p.flowNodeType!==e.type&&(p.dispose(),p=void 0),p)null==(o=(s=this.options).fromNodeJSON)||o.call(s,p,e,!1);else{let{dataRegistries:t}=y;p=this.entityManager.createEntity(j,{id:a,document:this,flowNodeType:l,originParent:h,meta:u});let i=t?this.nodeDataRegistries.concat(...t):this.nodeDataRegistries;p.addInitializeData(i),p.onDispose(()=>this.onNodeDisposeEmitter.fire({node:p})),null==(r=(n=this.options).fromNodeJSON)||r.call(n,p,e,!0),f=!0}if(p.initData({originParent:h,parent:d,meta:u,hidden:c,index:g}),null==t||t.push(p),y.onCreate){let i=y.onCreate(p,e);i&&t&&t.push(...i)}return i||(f?this.onNodeCreateEmitter.fire({node:p,data:e,json:e}):this.onNodeUpdateEmitter.fire({node:p,data:e,json:e})),p}get layout(){let e=this.layouts.find(e=>e.name==this.currentLayoutKey);if(!e)throw Error(`Unknown flow layout: ${this.currentLayoutKey}`);return e}getNodeDefaultPosition(e){let{size:t}=this.getNodeRegistry(e).meta||{},i=this.playgroundConfig.getViewport(!0).center;return t&&(i={x:i.x,y:i.y-t.height/2}),k(this,i)}createWorkflowNodeByType(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,n=i.id;if(void 0===n)do n=`1${q()}`;while(this.entityManager.getEntityById(n));else if(this.entityManager.getEntityById(n))throw Error(`[WorkflowDocument.createWorkflowNodeByType] Node Id "${n}" duplicated.`);return this.createWorkflowNode({...i,id:n,type:e,meta:{position:t,...null==i?void 0:i.meta},data:null==i?void 0:i.data,blocks:null==i?void 0:i.blocks,edges:null==i?void 0:i.edges},!1,r)}getAllNodes(){return this.entityManager.getEntities(j).filter(e=>e.id!==C.Sy.ROOT)}getAllPorts(){return this.entityManager.getEntities(z).filter(e=>e.node.id!==C.Sy.ROOT)}getAssociatedNodes(){var e,t;let i=this.getAllNodes(),r=this.linesManager.getAllLines().filter(e=>e.from&&e.to).map(e=>({from:e.from.id,to:e.to.id})),n=null==(e=i.find(e=>e.isStart))?void 0:e.id,o=null==(t=i.find(e=>e.isNodeEnd))?void 0:t.id,s=new Set(i.filter(e=>{var t;return null==(t=e.parent)?void 0:t.getNodeMeta().isContainer}).map(e=>e.id));o&&s.add(o);let a=e=>{s.has(e)||(s.add(e),r.reduce((t,i)=>{let{from:r,to:n}=i;return r!==e||s.has(n)||t.push(n),t},[]).forEach(a))};return n&&a(n),i.filter(e=>s.has(e.id))}fireRender(){this.entityManager.fireEntityChanged(j.type),this.entityManager.fireEntityChanged(G.type),this.entityManager.fireEntityChanged(z.type)}fireContentChange(e){this._loading||this.disposed||this.entityManager.changeEntityLocked||this._onContentChangeEmitter.fire(e)}toNodeJSON(e){let t=this.getNodeSubCanvas(e);if((null==t?void 0:t.isCanvas)===!0)return this.toNodeJSON(t.parentNode);let i=this.toNodeJSONFromOptions(e),r=this.getNodeChildren(e),n=r.map(e=>this.toNodeJSON(e)),o=new Map;r.forEach(e=>{let t=e.getData(F);[...t.inputLines,...t.outputLines].filter(Boolean).forEach(e=>{let t=this.toLineJSON(e);!t||o.has(e.id)||o.set(e.id,t)})});let s=Array.from(o.values());return n.length>0&&(i.blocks=n),s.length>0&&(i.edges=s),i}toNodeJSONFromOptions(e){return this.options.toNodeJSON?this.options.toNodeJSON(e):X.toNodeJSON(e)}copyNode(e,t,i,r){var n;let o=this.toNodeJSON(e);return i&&(o=i(o)),r=r||{x:o.meta.position.x+30,y:o.meta.position.y+30},this.createWorkflowNode({id:t||`1${q()}`,type:e.flowNodeType,meta:{...o.meta,position:r},data:o.data,blocks:o.blocks,edges:o.edges},!0,null==(n=e.parent)?void 0:n.id)}copyNodeFromJSON(e,t,i,r,n){return r=r||{x:t.meta.position.x+30,y:t.meta.position.y+30},this.createWorkflowNode({id:i||`1${q()}`,type:e,meta:{...t.meta,position:r},data:t.data,blocks:t.blocks,edges:t.edges},!0,n)}canRemove(e,t){return!e.getNodeMeta().deleteDisable&&(!this.options.canDeleteNode||!!this.options.canDeleteNode(e,t))}isErrorPort(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"function"==typeof this.options.isErrorPort?this.options.isErrorPort(e):t}toJSON(){if(this.disposed)throw Error("The WorkflowDocument has been disposed and it is no longer possible to call toJSON.");let e=this.toNodeJSON(this.root);return{nodes:e.blocks??[],edges:e.edges??[]}}dispose(){super.dispose(),this._onReloadEmitter.dispose()}renderJSON(e,t){return this.batchAddFromJSON(e,t)}batchAddFromJSON(e,t){var i;let{parent:r=this.root,isClone:n=!1}=t??{},o=(null==(i=this.getNodeSubCanvas(r))?void 0:i.canvasNode.id)??r.id,s=(e=>{let{nodes:t,edges:i}=e,r=t.filter(e=>e.type===C.Sy.GROUP),n=new Map(t.map(e=>[e.id,e])),o=r.map(e=>{let t=(e.data.blockIDs??[]).map(e=>n.get(e)).filter(Boolean),r=null==i?void 0:i.filter(e=>t.some(t=>t.id===e.sourceNodeID||t.id===e.targetNodeID));return{...e,blocks:t,edges:r}}),s=new Set(r.map(e=>e.data.blockIDs).flat());return{nodes:t.filter(e=>!s.has(e.id)).concat(o),edges:i}})(e);return{nodes:s.nodes.map(e=>this.createWorkflowNode(e,n,o)),edges:s.edges.map(e=>this.createWorkflowLine(e,o)).filter(Boolean)}}getNodeSubCanvas(e){var t;if(!e)return;let i=e.getNodeMeta();return null==(t=i.subCanvas)?void 0:t.call(i,e)}getNodeChildren(e){if(!e||e.flowNodeType===C.Sy.GROUP)return[];let t=this.getNodeSubCanvas(e);return(t?t.canvasNode.blocks:e.blocks).filter(t=>{var i,r;let n=t.getNodeMeta();return!(null==(r=n.subCanvas)||null==(i=r.call(n,e))?void 0:i.isCanvas)}).filter(Boolean).map(e=>e.flowNodeType===C.Sy.GROUP?[e,...e.blocks]:e).flat()}toLineJSON(e){let t=e.toJSON();if(!e.from||!e.info.from||!e.fromPort||!e.to||!e.info.to||!e.toPort)return;let i=this.getNodeSubCanvas(e.from),r=this.getNodeSubCanvas(e.to);if(!i||i.isCanvas||!r||!r.isCanvas)return e.from===e.to.parent&&i?{...t,sourceNodeID:i.parentNode.id}:e.to===e.from.parent&&r?{...t,targetNodeID:r.parentNode.id}:t}createWorkflowLine(e,t){let i=this.getNode(e.sourceNodeID),r=this.getNode(e.targetNodeID);if(!i||!r)return;let n={from:e.sourceNodeID,fromPort:e.sourcePortID,to:e.targetNodeID,toPort:e.targetPortID,data:e.data};if(!t)return this.linesManager.createLine(n);let o=this.getNode(t);if(!o)return this.linesManager.createLine(n);let s=this.getNodeSubCanvas(o);return s?n.from===s.parentNode.id?this.linesManager.createLine({...n,from:s.canvasNode.id}):n.to===s.parentNode.id?this.linesManager.createLine({...n,to:s.canvasNode.id}):this.linesManager.createLine(n):this.linesManager.createLine(n)}constructor(){super(...arguments),this._onContentChangeEmitter=new S.Q5,this.onLoadedEmitter=new S.Q5,this.onContentChange=this._onContentChangeEmitter.event,this._onReloadEmitter=new S.Q5,this.onReload=this._onReloadEmitter.event,this.onLoaded=this.onLoadedEmitter.event,this._loading=!1,this.options={}}};function ei(e,t,i){return!!(!i||e>100||Math.abs(t.endPos.x-t.startPos.x)>=5||Math.abs(t.endPos.y-t.startPos.y)>=5)}m([(0,M.f3)(J)],et.prototype,"linesManager",2),m([(0,M.f3)(E.ER)],et.prototype,"playgroundConfig",2),m([(0,E.el)()],et.prototype,"playgroundContext",2),m([(0,M.f3)(H)],et.prototype,"options",2),m([(0,M.f3)(I.j0),(0,M.jt)()],et.prototype,"nodeEngineContext",2),m([(0,M.f3)(Q)],et.prototype,"selectServices",2),m([(0,M.zY)()],et.prototype,"init",1),et=m([(0,M.b2)()],et);var er=class{init(){this._toDispose.pushAll([this._onDragLineEventEmitter,this._nodesDragEmitter]),this.options.onDragLineEnd&&this._toDispose.push(this.onDragLineEnd(this.options.onDragLineEnd))}dispose(){this._toDispose.dispose()}async startDragSelectedNodes(e){var t;let{selectedNodes:i}=this.selectService;if(0===i.length||this.playgroundConfig.readonly||this.playgroundConfig.disabled||this.isDragging)return Promise.resolve(!1);this.isDragging=!0;let r=this.childrenOfContainer(i);r&&r.flowNodeType!==C.Sy.ROOT&&(i=[r]);let n=this.getNodesPosition(i),o=i.map(e=>{let t=e.getData(E.VO);return{x:t.position.x,y:t.position.y}}),s=!1,a=Date.now(),l=new E.s5({onDragStart:t=>{this._nodesDragEmitter.fire({type:"onDragStart",nodes:i,startPositions:o,dragEvent:t,triggerEvent:e,dragger:l})},onDrag:t=>{!s&&ei(Date.now()-a,t)&&(s=!0);let r=this.getDragPosOffset({event:t,selectedNodes:i,startPosition:n}),h=[];i.forEach((e,t)=>{let i=e.getData(E.VO),n=o[t],s={x:n.x+r.x,y:n.y+r.y};i.update({position:s}),this.document.layout.updateAffectedTransform(e),h.push(s)}),this._nodesDragEmitter.fire({type:"onDragging",nodes:i,startPositions:o,positions:h,dragEvent:t,triggerEvent:e,dragger:l})},onDragEnd:t=>{this.isDragging=!1,this._nodesDragEmitter.fire({type:"onDragEnd",nodes:i,startPositions:o,dragEvent:t,triggerEvent:e,dragger:l})}}),{clientX:h,clientY:d}=E.UJ.getEventCoord(e);return null==(t=l.start(h,d,this.playgroundConfig))?void 0:t.then(()=>s)}async dropCard(e,t,i,r){let n=this.playgroundConfig.getPosFromMouseEvent(t);if(!this.playgroundConfig.getViewport().contains(n.x,n.y))return;let o=this.adjustSubNodePosition(e,r,n);return await this.document.createWorkflowNodeByType(e,o,i,null==r?void 0:r.id)}async startDragCard(e,t,i,r){let n,o={x:0,y:0},s=new S.cO,a=new E.s5({onDragStart:e=>{let i=t.currentTarget;n=r?r(e):i.cloneNode(!0);let s=i.getBoundingClientRect();o={x:s.left,y:s.top},S.xF.setStyle(n,{zIndex:1e3,position:"absolute",left:o.x,top:o.y,boxShadow:"0 6px 8px 0 rgba(28, 31, 35, .2)"}),document.body.appendChild(n),this.updateDroppableTransforms()},onDrag:e=>{let t=e.endPos.x-e.startPos.x,i=e.endPos.y-e.startPos.y,r=o.x+t,s=o.y+i;n.style.left=`${r}px`,n.style.top=`${s}px`;let{x:a,y:l}=this.playgroundConfig.getPosFromMouseEvent(e),h=new S.Ae(a,l,170,90),d=this._droppableTransforms.find(e=>{let{bounds:t,entity:i}=e,r=this.document.layout.getPadding(i),n=new S.Ae(t.x+r.left+r.right,t.y,t.width,t.height);return S.Ae.intersects(h,n)});this.updateDropNode(null==d?void 0:d.entity)},onDragEnd:async t=>{let r=this._dropNode,{allowDrop:a}=this.canDropToNode({dragNodeType:e,dropNodeType:null==r?void 0:r.flowNodeType,dropNode:r}),l=a?await this.dropCard(e,t,i,r):void 0;(this.clearDrop(),l)?(n.remove(),s.resolve(l)):(n.style.transition="all ease .2s",n.style.left=`${o.x}px`,n.style.top=`${o.y}px`,await (0,S.gw)(200),n.remove(),s.resolve())}});return await a.start(t.clientX,t.clientY),s.promise}adjustSubNodePosition(e,t,i){if(!i)return{x:0,y:0};if(!e||!t||t.flowNodeType===C.Sy.ROOT)return i;let r=!t.children||0===t.children.length,n=this.document.layout.getPadding(t),o=t.transform.transform.worldTransform;return r?{x:0,y:n.top}:{x:i.x-o.tx,y:i.y-o.ty}}registerPosAdjuster(e){return this.posAdjusters.add(e),{dispose:()=>this.posAdjusters.delete(e)}}canDropToNode(e){let{canDropToNode:t}=this.document.options,{dragNodeType:i,dropNode:r}=e;return t?t(e)?{allowDrop:!0,dropNode:r}:{allowDrop:!1}:i?{allowDrop:!0,dropNode:r}:{allowDrop:!1,message:"Please select a node to drop"}}getDragPosOffset(e){let{event:t,selectedNodes:i,startPosition:r}=e,{finalScale:n}=this.playgroundConfig,o={x:(t.endPos.x-t.startPos.x)/n,y:(t.endPos.y-t.startPos.y)/n},s={x:r.x+o.x,y:r.y+o.y};return Array.from(this.posAdjusters.values()).map(e=>e({selectedNodes:i,position:s})).reduce((e,t)=>({x:e.x+t.x,y:e.y+t.y}),o)}updateDroppableTransforms(){this._droppableTransforms=this.document.getRenderDatas(C.eG,!1).filter(e=>{let{entity:t}=e;return t.originParent?this.nodeSelectable(t)&&this.nodeSelectable(t.originParent):this.nodeSelectable(t)}).filter(e=>this.isContainer(e.entity))}isContainer(e){return(null==e?void 0:e.getNodeMeta().isContainer)??!1}getNodesPosition(e){let t=S.Ae.enlarge(e.map(e=>e.getData(C.eG).bounds));return{x:t.x,y:t.y}}nodeSelectable(e){let t=e.getNodeMeta().selectable;return"function"==typeof t?t(e):t}updateDropNode(e){if(this._dropNode){if(this._dropNode.id===(null==e?void 0:e.id))return;this.selectService.clear()}e&&this.selectService.selectNode(e),this._dropNode=e}clearDrop(){this._dropNode&&this.selectService.clear(),this._dropNode=void 0,this._droppableTransforms=[]}setLineColor(e,t){e.highlightColor=t,this.hoverService.clearHovered()}handleDragOnNode(e,t,i,r,n){return r&&((null==n?void 0:n.toPort)===r||"input"===r.portType&&this.linesManager.canAddLine(t,r,!0))?(this.hoverService.updateHoveredKey(r.id),i.setToPort(r),this._onDragLineEventEmitter.fire({type:"onDrag",onDragNodeId:e.id}),{hasError:!1}):this.isContainer(e)?{hasError:!1}:(this.setLineColor(i,this.linesManager.lineColor.error),{hasError:!0})}childrenOfContainer(e){var t;if(0===e.length)return;let i=null==(t=e[0])?void 0:t.parent;if(i&&i.collapsedChildren.length===e.length&&e.every(e=>(null==e?void 0:e.parent)===i))return i}async startDrawingLine(e,t,i){let r=!i&&e.isErrorPort()&&e.disabled;if((null==i?void 0:i.disabled)||r||this.playgroundConfig.readonly||this.playgroundConfig.disabled)return{dragSuccess:!1,newLine:void 0};this.selectService.clear();let n=this.playgroundConfig,o=new S.cO,s=n.cursor,a,l,h,d=!1,u=Date.now(),c=!1,g=new E.s5({onDrag:r=>{if(!a&&ei(Date.now()-u,r,i)){i&&(i.highlightColor=this.linesManager.lineColor.hidden),c=!0;let r=n.getPosFromMouseEvent(t);if(!(a=this.linesManager.createLine({from:e.node.id,fromPort:e.portID,data:null==i?void 0:i.lineData,drawingTo:{x:r.x,y:r.y,location:"right"===e.location?"left":"top"}})))return;n.updateCursor("grab"),a.highlightColor=(null==i?void 0:i.lockedColor)||this.linesManager.lineColor.drawing,this.hoverService.updateHoveredKey("")}if(!a)return;d=!1;let o=n.getPosFromMouseEvent(r);if(h=this.linesManager.getNodeFromMousePos(o),(l=this.linesManager.getPortFromMousePos(o))?this.linesManager.canAddLine(e,l,!0)?a.setToPort(l):(a.highlightColor=this.linesManager.lineColor.error,d=!0,a.setToPort(void 0)):a.setToPort(void 0),this._onDragLineEventEmitter.fire({type:"onDrag"}),this.setLineColor(a,(null==i?void 0:i.lockedColor)||this.linesManager.lineColor.drawing),h&&this.canBuildContainerLine(h,o)){l=this.getNearestPort(h,o);let{hasError:t}=this.handleDragOnNode(h,e,a,l,i);d=t}a.toPort?a.drawingTo={x:a.toPort.point.x,y:a.toPort.point.y,location:a.toPort.location}:a.drawingTo={x:o.x,y:o.y,location:"right"===a.fromPort.location?"left":"top"},null==i||i.validate(),a.validate()},onDragEnd:async t=>{let r=n.getPosFromMouseEvent(t),h=Array.from(this._onDragLineEndCallbacks.values());n.updateCursor(s),await Promise.all(h.map(n=>n({fromPort:e,toPort:l,mousePos:r,line:a,originLine:i,event:t}))),null==a||a.dispose(),this._onDragLineEventEmitter.fire({type:"onDragEnd"}),i&&(i.highlightColor="");let u=()=>{null==i||i.validate(),o.resolve({dragSuccess:c})};if(c){if(i&&i.toPort===l||l&&"input"!==l.portType)return u();let t=l?{from:e.node.id,fromPort:e.portID,to:l.node.id,toPort:l.portID,data:null==i?void 0:i.lineData}:void 0;if(i&&l&&!this.linesManager.canReset(i.fromPort,i.toPort,l)||i&&(!this.linesManager.canRemove(i,t,!1)||d))return u();if(null==i||i.dispose(),!l||!this.linesManager.canAddLine(e,l,!1))return u();let r=this.linesManager.createLine(t);r||u(),o.resolve({dragSuccess:c,newLine:r})}else u()}}),{clientX:p,clientY:f}=E.UJ.getEventCoord(t);return await g.start(p,f,n),o.promise}async resetLine(e,t){let{fromPort:i}=e,{dragSuccess:r}=await this.startDrawingLine(i,t,e);r||this.selectService.select(e)}onDragLineEnd(e){let t=(0,x.x0)();return this._onDragLineEndCallbacks.set(t,e),{dispose:()=>{this._onDragLineEndCallbacks.delete(t)}}}canBuildContainerLine(e,t){if(!this.isContainer(e))return!0;let{padding:i,bounds:r}=e.transform;return new S.Ae(r.x,r.y,2*i.left/3,r.height).contains(t.x,t.y)}getNearestPort(e,t){return e.getData(V).inputPorts.sort((e,i)=>Math.abs(t.y-e.point.y)-Math.abs(t.y-i.point.y))[0]}constructor(){this._onDragLineEventEmitter=new S.Q5,this.onDragLineEventChange=this._onDragLineEventEmitter.event,this.isDragging=!1,this._nodesDragEmitter=new S.Q5,this.onNodesDrag=this._nodesDragEmitter.event,this._toDispose=new S.K4,this._droppableTransforms=[],this.posAdjusters=new Set,this._onDragLineEndCallbacks=new Map}};m([(0,M.f3)(E.ER)],er.prototype,"playgroundConfig",2),m([(0,M.f3)(W)],er.prototype,"hoverService",2),m([(0,M.f3)(et)],er.prototype,"document",2),m([(0,M.f3)(J)],er.prototype,"linesManager",2),m([(0,M.f3)(E.VD)],er.prototype,"commandService",2),m([(0,M.f3)(Q)],er.prototype,"selectService",2),m([(0,M.f3)(C.VO)],er.prototype,"operationService",2),m([(0,M.f3)(H)],er.prototype,"options",2),m([(0,M.zY)()],er.prototype,"init",1),er=m([(0,M.b2)()],er);var en=async(e,t)=>{let i={};return e.forEach(e=>{let t=e.getData(E.VO),r=e.getData(C.eG);i[e.id]={x:t.position.x,y:t.position.y+r.bounds.height/2}}),new Promise(r=>{(0,E.p4)({from:{d:0},to:{d:100},duration:300,onUpdate:i=>{e.forEach(e=>{let r=e.getData(E.VO),n=(t[e.id].x-r.position.x)*i.d/100,o=(t[e.id].y-r.bounds.height/2-r.position.y)*i.d/100;r.update({position:{x:r.position.x+n,y:r.position.y+o}}),e.document.layout.updateAffectedTransform(e)})},onComplete:()=>{r(i)}})})},eo=class{init(){this._toDispose.push(this._resetLayoutEmitter)}fireResetLayout(e,t,i){this._resetLayoutEmitter.fire({nodeIds:e,positionMap:t,oldPositionMap:i})}async layoutToPositions(e,t){let i=e.map(e=>this._entityManager.getEntityById(e)).filter(Boolean),r=await en(i,t);return O(this._document,this._config,!0),r}dispose(){this._toDispose.dispose()}constructor(){this._resetLayoutEmitter=new S.Q5,this.onResetLayout=this._resetLayoutEmitter.event,this._toDispose=new S.K4}};m([(0,M.f3)(E.ER)],eo.prototype,"_config",2),m([(0,M.f3)(et)],eo.prototype,"_document",2),m([(0,M.f3)(E.v2)],eo.prototype,"_entityManager",2),m([(0,M.zY)()],eo.prototype,"init",1),eo=m([(0,M.b2)()],eo);var es=class extends C.D9{updateNodePosition(e,t){let i=this.toNodeEntity(e);if(!i)return;let r=i.getData(E.VO),n={x:r.position.x,y:r.position.y};r.update({position:t}),this.onNodePostionUpdateEmitter.fire({node:i,oldPosition:n,newPosition:t})}constructor(){super(...arguments),this.onNodePostionUpdateEmitter=new S.Q5,this.onNodePostionUpdate=this.onNodePostionUpdateEmitter.event}};function ea(e){let t=(0,E.Dc)(),i=(0,E.JA)();return(0,b.useEffect)(()=>{let r;return e&&(r=t.config.onReadonlyOrDisabledChange(()=>i())),()=>null==r?void 0:r.dispose()},[e]),t.config.readonly}function el(e){return e&&"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&!e.closest(".flow-canvas-not-draggable")}m([(0,M.f3)(et)],es.prototype,"document",2);var eh=null==(d=navigator)||null==(h=d.userAgent)||null==(l=h.includes)?void 0:l.call(h,"Firefox");function ed(e){let t=e||(0,b.useContext)(E.rQ),i=t.getData(C.Lz),r=t.getData(V),n=ea(),o=(0,E.G2)(er),s=(0,E.G2)(Q),a=(0,b.useRef)(!1),[l,h]=(0,b.useState)(0),d=(0,b.useRef)(!1);d.current=!1;let u=(0,b.useRef)(null),[c,g]=(0,b.useState)("");(0,b.useEffect)(()=>{let e=o.onDragLineEventChange(e=>{let{type:t,onDragNodeId:i}=e;"onDrag"===t?g(i||""):g("")});return()=>{e.dispose()}},[]);let p=(0,b.useCallback)(e=>{var i;E.UJ.preventDefault(e),s.isSelected(t.id)||f(e),(E.UJ.isTouchEvent(e)||el(e.target)&&el(document.activeElement))&&(a.current=!0,null==(i=o.startDragSelectedNodes(e))||i.finally(()=>setTimeout(()=>{a.current=!1})))},[o,t]),f=(0,b.useCallback)(e=>{!a.current&&(e.shiftKey?s.toggleSelect(t):s.selectNode(t),e.target&&e.target.focus())},[t]),y=(0,b.useCallback)(()=>t.dispose(),[t]);(0,E.H$)(r.onDataChange);let m=(0,b.useCallback)(()=>{if(eh){var e;null==(e=u.current)||e.setAttribute("draggable","false")}},[]),M=(0,b.useCallback)(()=>{if(eh){var e;null==(e=u.current)||e.setAttribute("draggable","true")}},[]),S=(0,b.useCallback)(()=>t.getExtInfo(),[t]),x=(0,b.useCallback)(e=>{t.updateExtInfo(e)},[t]),w=(0,b.useMemo)(()=>(0,N.CM)(t),[t]),_=(0,D.Re)(null==w?void 0:w.state),I=(0,b.useCallback)(()=>{i.toggleExpand()},[i]),L=s.isSelected(t.id),T=s.isActivated(t.id),A=i.expanded;return(0,b.useEffect)(()=>{let e=null==w?void 0:w.onFormValuesChange(()=>{d.current&&h(e=>e+1)});return()=>null==e?void 0:e.dispose()},[w]),(0,b.useMemo)(()=>({id:t.id,type:t.flowNodeType,get data(){if(w)return d.current=!0,w.values;return S()},updateData(e){w?w.updateFormValues(e):x(e)},node:t,selected:L,activated:T,expanded:A,startDrag:p,get ports(){return r.allPorts},deleteNode:y,selectNode:f,readonly:n,linkingNodeId:c,nodeRef:u,onFocus:m,onBlur:M,getExtInfo:S,updateExtInfo:x,toggleExpand:I,get form(){if(!w)return;return{...w,get values(){return d.current=!0,w.values},get state(){return _}}}}),[t,L,T,A,p,y,f,n,c,u,m,M,S,x,I,l])}function eu(){return(0,E.km)()}var ec=((s=ec||{}).GRAB="GRAB",s.SELECT="SELECT",s),eg=((a=eg||{}).MOUSE="MOUSE",a.PAD="PAD",a),ep=class{registerDocument(e){e.registerNodeDatas(C.eG,C.Lz,V,F),e.registerLayout(this.freeLayout)}};m([(0,M.f3)(K)],ep.prototype,"freeLayout",2),ep=m([(0,M.b2)()],ep);var ef=new M.nZ((e,t,i,r)=>{e(et).toSelf().inSingletonScope(),e(J).toSelf().inSingletonScope(),e(K).toSelf().inSingletonScope(),e(er).toSelf().inSingletonScope(),e(Q).toSelf().inSingletonScope(),e(W).toSelf().inSingletonScope(),e(eo).toSelf().inSingletonScope(),e(p).to(es).inSingletonScope(),e(u).toDynamicValue(()=>location.search.replace(/^\?/,"").split("&").reduce((e,t)=>{let[i,r]=t.split("=");return e[i]=r,e},{})).inSingletonScope(),(0,S.KV)(e,ep,[C.Lw]),e(H).toConstantValue({...X}),r(C.pQ).toService(et),e(ee).toDynamicValue(e=>()=>e.container.get(et)).inSingletonScope()})},438024:function(e,t,i){i.d(t,{EU:()=>en,Em:()=>P,Eq:()=>Z,HW:()=>G,Kz:()=>eo,NQ:()=>_,OK:()=>T,Pi:()=>A,Rf:()=>R,V7:()=>L,XD:()=>N,aK:()=>es,kD:()=>O,lV:()=>er,oC:()=>k,qf:()=>eh,qq:()=>el});var r,n,o,s=i(579962),a=i(893740),l=i(832176),h=i(721855),d=i(461932),u=i(863875),c=i(89802),g=i(908600),p=i(27430),f=i(336808),y=i(661881),m=Object.defineProperty,E=Object.getOwnPropertyDescriptor,b=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?E(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&m(t,i,o),o},D="#BBBFC4";function N(){var e,t;let i=(0,a.G2)(s.h3);return{baseColor:(null==(e=i.constants)?void 0:e[s.cc.BASE_COLOR])||D,baseActivatedColor:(null==(t=i.constants)?void 0:t[s.cc.BASE_ACTIVATED_COLOR])||"#82A7FC"}}var C={stroke:D,fill:"transparent",strokeLinecap:"round",strokeLinejoin:"round"};function M(e){let{isVertical:t}=e.entity;if(t){var i,r,n;let t=(null==(i=e.entity.next)?void 0:i.firstChild)&&!e.entity.next.isInlineBlocks?e.entity.next.firstChild.getData(s.eG).size.width:null==(r=e.entity.next)?void 0:r.getData(s.eG).size.width;return Math.max((null==(n=e.entity.getData(s.eG))?void 0:n.size.width)??s.Lu[s.T4.HOVER_AREA_WIDTH],t||0)}return e.transform.next?e.transform.next.inputPoint.x-e.transform.outputPoint.x:32}function S(e){var t,i,r;let{isVertical:n}=e.entity;if(n)return e.transform.next?e.transform.next.inputPoint.y-e.transform.outputPoint.y:32;let o=(null==(t=e.entity.next)?void 0:t.firstChild)&&!e.entity.next.isInlineBlocks?e.entity.next.firstChild.getData(s.eG).size.height:null==(i=e.entity.next)?void 0:i.getData(s.eG).size.height;return Math.max((null==(r=e.entity.getData(s.eG))?void 0:r.size.height)||280,o||0)}var x=class extends a.cv{get hasScroll(){return!!(this._scrollXInterval||this._scrollYInterval)}isCollision(e,t,i){let r=this.playgroundConfigEntity.finalScale||0;return i?this.isBranchCollision(e,t,r):this.isNodeCollision(e,t,r)}isNodeCollision(e,t,i){let{labels:r}=e,{isVertical:n}=e.entity;return{hasCollision:r.some(r=>{if(!r||![s.nx.ADDER_LABEL,s.nx.COLLAPSE_ADDER_LABEL].includes(r.type))return!1;let o=n?e.transform.bounds.width:32,a=n?32:e.transform.bounds.height,h=new l.Ae((r.offset.x-o/2)*i,(r.offset.y-a/2)*i,o*i,a*i);return l.Ae.intersects(h,t)}),labelOffsetType:void 0}}isBranchCollision(e,t,i){let{labels:r}=e,{isVertical:n}=e.entity,o=s.VH.NORMAL_BRANCH;return{hasCollision:r.some(e=>{if(!e||e.type!==s.nx.BRANCH_DRAGGING_LABEL)return!1;let r=n?64:e.width||0,a=n?e.width||0:64,h=new l.Ae((e.offset.x-a/2)*i,(e.offset.y-r/2)*i,a*i,r*i),d=l.Ae.intersects(h,t);return d&&(o=e.props.side),d}),labelOffsetType:o}}_startScrollX(e,t){if(this._scrollXInterval)return;let i=window.setInterval(()=>{let e=this._scrollXInterval;if(!e)return;let i=e.origin=t?e.origin+4:e.origin-4;this.playgroundConfigEntity.updateConfig({scrollX:i});let r=this.playgroundConfigEntity.config;(null==r?void 0:r.scrollX)===i&&(t?this.containerX+=4:this.containerX-=4,this.setDomStyle())},20);this._scrollXInterval={interval:i,origin:e}}_stopScrollX(){this._scrollXInterval&&(clearInterval(this._scrollXInterval.interval),this._scrollXInterval=void 0)}_startScrollY(e,t){if(this._scrollYInterval)return;let i=window.setInterval(()=>{let e=this._scrollYInterval;if(!e)return;let i=e.origin=t?e.origin+4:e.origin-4;this.playgroundConfigEntity.updateConfig({scrollY:i});let r=this.playgroundConfigEntity.config;(null==r?void 0:r.scrollY)===i&&(t?this.containerY+=4:this.containerY-=4,this.setDomStyle())},20);this._scrollYInterval={interval:i,origin:e}}_stopScrollY(){this._scrollYInterval&&(clearInterval(this._scrollYInterval.interval),this._scrollYInterval=void 0)}stopAllScroll(){this._stopScrollX(),this._stopScrollY()}setDomStyle(){this.containerDom.style.left=`${this.containerX}px`,this.containerDom.style.top=`${this.containerY}px`}scrollDirection(e,t,i,r){let n=this.playgroundConfigEntity.config,o=n.scrollX,s=n.scrollY;return(this.containerDom=t,this.containerX=i,this.containerY=r,n.height+n.clientY-e.clientY<20)?(this._startScrollY(s,!0),1):e.clientY-n.clientY<20?(this._startScrollY(s,!1),0):(this._stopScrollY(),n.width+n.clientX-e.clientX<20)?(this._startScrollX(o,!0),3):e.clientX-n.clientX<80?(this._startScrollX(o,!1),2):void this._stopScrollX()}dispose(){this.toDispose.dispose()}constructor(e){super(e),this.containerX=0,this.containerY=0,this.playgroundConfigEntity=this.entityManager.getEntity(a.ER,!0)}};x.type="FlowDragEntity";var w=class extends a.cv{getDefaultConfig(){return{selectedNodes:[]}}get selectedNodes(){return this.config.selectedNodes}set selectedNodes(e){((e=function(e){if(0===e.length)return[];let t=e.map(e=>(function(e){let t=[e];for(e=e.parent;e;)t.push(e),e=e.parent;return t.reverse()})(e)),i=Math.min(...t.map(e=>e.length)),r=0,n=[];for(;r<i&&!((n=(0,h.Z)(t.map(e=>e[r]))).length>1);)r+=1;return(0,h.Z)(n.map(e=>(function(e){for(;e.originParent;)e=e.originParent;return e})(e)))}(e)).length!==this.config.selectedNodes.length||e.some(e=>!this.config.selectedNodes.includes(e)))&&(this.config.selectedNodes.forEach(t=>{e.includes(t)||(t.getData(s.Lz).activated=!1)}),e.forEach(e=>{e.getData(s.Lz).activated=!0}),l.XJ.isArrayShallowChanged(this.config.selectedNodes,e)&&this.updateConfig({selectedNodes:e}))}clearSelectedNodes(){0!==this.config.selectedNodes.length&&(this.config.selectedNodes.forEach(e=>{e.getData(s.Lz).activated=!1}),this.updateConfig({selectedNodes:[]}))}selectFromBounds(e,t){let i=[];t.forEach(t=>{l.Ae.intersects(e,t.bounds)&&(t.entity.originParent?i.push(t.entity.originParent):i.push(t.entity))}),this.selectedNodes=i}getSelectedBounds(){let e=this.selectedNodes;return 0===e.length?l.Ae.EMPTY:l.Ae.enlarge(e.map(e=>e.getData(s.eG).bounds)).pad(this.boundsPadding)}constructor(){super(...arguments),this.boundsPadding=10}};w.type="FlowSelectConfigEntity";var _=class extends a.cv{get dragInfo(){return this.config}setDragInfo(e){this.updateConfig(e)}get disabled(){return this.config&&!!this.config.disabled}set disabled(e){this.updateConfig({disabled:e})}get isStart(){return this.dragInfo.isStart}get isMoving(){return this.dragInfo.isMoving}get position(){let{dragInfo:e}=this;return{x:e.startPos.x<e.endPos.x?e.startPos.x:e.endPos.x,y:e.startPos.y<e.endPos.y?e.startPos.y:e.endPos.y}}get size(){let{dragInfo:e}=this;return{width:Math.abs(e.startPos.x-e.endPos.x),height:Math.abs(e.startPos.y-e.endPos.y)}}get collapsed(){let{size:e}=this;return 0===e.width&&0===e.height}collapse(){this.setDragInfo({...this.dragInfo,isMoving:!1,isStart:!1})}toRectangle(e){let{position:t,size:i}=this;return new l.Ae(t.x/e,t.y/e,i.width/e,i.height/e)}};_.type="SelectorBoxConfigEntity";var I=class{observe(e,t){let i=new ResizeObserver(e=>{window.requestAnimationFrame(()=>{if(!Array.isArray(e)||!e.length)return;let{contentRect:i,target:r}=e[0],n=!!i&&(0!==i.bottom||0!==i.height||0!==i.left||0!==i.right||0!==i.top||0!==i.width||0!==i.x||0!==i.y)&&!0,o=!r.parentNode,s=(e=>{if(!e||(0,u.Z)(null==e?void 0:e.offsetParent))return!0;let t=window.getComputedStyle(e);return(null==t?void 0:t.display)==="none"})(r.parentNode);!n||o||s||(t.size={width:Math.round(10*i.width)/10,height:Math.round(10*i.height)/10})})});return i.observe(e),l.JT.create(()=>{i.unobserve(e)})}};I=b([(0,d.b2)()],I);var L=class extends a.mh{get transformVisibles(){return this.document.getRenderDatas(s.eG,!1)}onZoom(e){this.node.style.transform=`scale(${e})`}dispose(){this.renderCache.dispose(),super.dispose()}isCoordEqual(e,t){return .05>Math.abs(e-t)}onReady(){this.node.style.zIndex="10"}get visibeBounds(){return this.transformVisibles.map(e=>e.bounds)}updateNodesBounds(){this.renderCache.getMoreByItems(this.transformVisibles).forEach(e=>e.updateBounds())}autorun(){this.documentTransformer.loading||(this.documentTransformer.refresh(),this.updateNodesBounds())}get renderElement(){if("function"==typeof this.options.renderElement){let e=this.options.renderElement();if(e)return e}else if(void 0!==this.options.renderElement)return this.options.renderElement;return this.node}constructor(){super(...arguments),this.node=l.xF.createDivWithClass("gedit-flow-nodes-layer"),this.renderCache=l.Ct.create(e=>{let t,{renderState:i}=e,{node:r}=i,{entity:n}=e;r.id=n.id;let o=()=>{t&&(r.parentElement&&this.renderElement.removeChild(r),t.dispose(),t=void 0)};return!t&&(this.renderElement.appendChild(r),n.getNodeMeta().autoResizeDisable||(t=this.resizeObserver.observe(r,e))),{dispose:o,updateBounds:()=>{let{bounds:t}=e,i=parseFloat(r.style.left),n=parseFloat(r.style.top);this.isCoordEqual(i,t.x)&&this.isCoordEqual(n,t.y)||(r.style.left=`${t.x}px`,r.style.top=`${t.y}px`)}}})}};b([(0,d.f3)(s.pQ)],L.prototype,"document",2),b([(0,d.f3)(I)],L.prototype,"resizeObserver",2),b([(0,a.O0)(s.Vl)],L.prototype,"documentTransformer",2),b([(0,a.aI)(s.GA,s.eG)],L.prototype,"_transforms",2),L=b([(0,d.b2)()],L);var T=Symbol("FlowRendererContribution"),A=((r=A||{})[r.REACT=0]="REACT",r[r.DOM=1]="DOM",r[r.TEXT=2]="TEXT",r),O=((n=O||{}).NODE_RENDER="node-render",n.ADDER="adder",n.COLLAPSE="collapse",n.BRANCH_ADDER="branch-adder",n.TRY_CATCH_COLLAPSE="try-catch-collapse",n.DRAG_NODE="drag-node",n.DRAGGABLE_ADDER="draggable-adder",n.DRAG_HIGHLIGHT_ADDER="drag-highlight-adder",n.DRAG_BRANCH_HIGHLIGHT_ADDER="drag-branch-highlight-adder",n.SELECTOR_BOX_POPOVER="selector-box-popover",n.CONTEXT_MENU_POPOVER="context-menu-popover",n.SUB_CANVAS="sub-canvas",n.SLOT_ADDER="slot-adder",n.SLOT_LABEL="slot-label",n.SLOT_COLLAPSE="slot-collapse",n.ARROW_RENDERER="arrow-renderer",n.MARKER_ARROW="marker-arrow",n.MARKER_ACTIVATE_ARROW="marker-active-arrow",n),k=((o=k||{}).LOOP_END_TEXT="loop-end-text",o.LOOP_TRAVERSE_TEXT="loop-traverse-text",o.LOOP_WHILE_TEXT="loop-while-text",o.TRY_START_TEXT="try-start-text",o.TRY_END_TEXT="try-end-text",o.CATCH_TEXT="catch-text",o),R=class{init(){this.contribs.forEach(e=>{var t;return null==(t=e.registerRenderer)?void 0:t.call(e,this)})}registerRendererComponents(e,t){this.componentsMap.set(e,t)}registerReactComponent(e,t){this.componentsMap.set(e,{type:0,renderer:t})}registerText(e){Object.entries(e).forEach(e=>{let[t,i]=e;this.textMap.set(t,i)})}getText(e){return p.o.t(e,{defaultValue:""})||this.textMap.get(e)}getRendererComponent(e){let t=this.componentsMap.get(e);if(!t)throw Error(`Unknown render key ${e}`);return t}tryToGetRendererComponent(e){return this.componentsMap.get(e)}registerLayers(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(e=>this.pipeline.registerLayer(e))}registerLayer(e,t){this.pipeline.registerLayer(e,t)}constructor(){this.componentsMap=new Map,this.textMap=new Map,this.contribs=[]}};b([(0,d.nx)(T),(0,d.jt)()],R.prototype,"contribs",2),b([(0,d.f3)(a.Rm)],R.prototype,"pipeline",2),R=b([(0,d.b2)()],R);var P=class extends a.mh{get renderStatesVisible(){return this.document.getRenderDatas(s.Lz,!1)}getPortalRenderer(e){let t=e.entity.getNodeMeta(),i=this.rendererRegistry.getRendererComponent(t.renderKey||"node-render").renderer,r=this.renderMemoCache.get(i);return r||(r=g.memo(i),this.renderMemoCache.set(i,r)),r}onZoom(e){this.node.style.transform=`scale(${e})`}dispose(){this.reactPortals.dispose(),super.dispose()}onReady(){this.node.style.zIndex="10"}onReadonlyOrDisabledChange(){this.render()}getPortals(){return this.reactPortals.getMoreByItems(this.renderStatesVisible)}render(){return this.documentTransformer.loading?g.createElement(g.Fragment,null):(this.documentTransformer.refresh(),g.createElement(g.Fragment,null,this.getPortals().map(e=>g.createElement(e.Portal,{key:e.id}))))}constructor(){super(...arguments),this.renderMemoCache=new WeakMap,this.node=l.xF.createDivWithClass("gedit-flow-nodes-layer"),this.reactPortals=l.Ct.create(e=>{let{node:t,entity:i}=e,{config:r}=this,n=this.getPortalRenderer(e);return{id:t.id||i.id,dispose:()=>{},Portal:function(){return g.useEffect(()=>{if(!i.getNodeMeta().autoResizeDisable&&t.clientWidth&&t.clientHeight){let e=i.getData(s.eG);e&&(e.size={width:t.clientWidth,height:t.clientHeight})}},[i,t]),c.createPortal(g.createElement(a.rQ.Provider,{value:i},g.createElement(n,{node:i,version:null==e?void 0:e.version,activated:null==e?void 0:e.activated,readonly:r.readonly,disabled:r.disabled})),t)}}})}};b([(0,d.f3)(s.pQ)],P.prototype,"document",2),b([(0,d.f3)(R)],P.prototype,"rendererRegistry",2),b([(0,a.O0)(s.Vl)],P.prototype,"documentTransformer",2),b([(0,a.aI)(s.GA,s.Lz)],P.prototype,"_renderStates",2),P=b([(0,d.b2)()],P);var j=function(e){let{from:t,to:i,activated:r,style:n}=e,{baseColor:o,baseActivatedColor:s}=N();return g.createElement("path",{"data-line-id":e.lineId,d:`M ${t.x} ${t.y} L ${i.x} ${i.y}`,...C,stroke:r?s:o,style:n})},z="$marker_arrow$",V=function(e){let{baseColor:t}=N();return g.createElement("marker",{"data-line-id":e.id,id:e.id||z,markerWidth:"11",markerHeight:"14",refX:"10",refY:"7",orient:"auto"},g.createElement("path",{d:"M9.6 5.2C10.8 6.1 10.8 7.9 9.6 8.8L3.6 13.3C2.11672 14.4125 0 13.3541 0 11.5L0 2.5C0 0.645898 2.11672 -0.412461 3.6 0.7L9.6 5.2Z",fill:t}))},B="$marker_arrow_activated$",F=function(e){let{baseActivatedColor:t}=N();return g.createElement("marker",{"data-line-id":e.id,id:e.id||B,markerWidth:"11",markerHeight:"14",refX:"10",refY:"7",orient:"auto"},g.createElement("path",{d:"M9.6 5.2C10.8 6.1 10.8 7.9 9.6 8.8L3.6 13.3C2.11672 14.4125 0 13.3541 0 11.5L0 2.5C0 0.645898 2.11672 -0.412461 3.6 0.7L9.6 5.2Z",fill:t}))};function Y(e){let t=(0,a.G2)(R),i=null==t?void 0:t.tryToGetRendererComponent(e.activated?"marker-active-arrow":"marker-arrow");return i?g.createElement(i.renderer,{...e}):e.activated?g.createElement("defs",null,g.createElement(F,{id:e.id})):g.createElement("defs",null,g.createElement(V,{id:e.id}))}var U=function(e){let{vertices:t,radius:i=16,hide:r,xRadius:n,yRadius:o,...a}=e,{from:h,to:d,arrow:c,activated:p,style:f}=a||{},{baseActivatedColor:y,baseColor:m}=N(),E=t||(e.isHorizontal?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{from:r,to:n,type:o}=e||{},a=Math.abs(n.y-r.y),l=Math.abs(n.x-r.x),h=l/t,d=a/i,u=[];if(h<1)return[];switch(o){case s.IG.DIVERGE_LINE:case s.IG.DRAGGING_LINE:if(h<=1)return[{x:n.x,y:r.y,radiusX:l}];if(u=[{x:r.x+i,y:r.y},{x:r.x+i,y:n.y}],h<2){let e=l-i;u=[{x:r.x+e,y:r.y,radiusX:e},{x:r.x+e,y:n.y}]}return d<2&&(u[0].moveY=a/2,u[1].moveY=a/2),u;case s.IG.MERGE_LINE:if(h<2)return[{x:n.x,y:r.y}];return u=[{x:n.x-i,y:r.y},{x:n.x-i,y:n.y}],d<2&&(u[0].moveY=a/2,u[1].moveY=a/2),u}return[]}(a,n,o):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{from:r,to:n,type:o}=e||{},a=Math.abs(n.y-r.y),l=Math.abs(n.x-r.x),h=a/i,d=l/t,u=[];if(h<1)return[];switch(o){case s.IG.DIVERGE_LINE:case s.IG.DRAGGING_LINE:if(h<=1)return[{x:n.x,y:r.y,radiusY:a}];if(u=[{x:r.x,y:r.y+i},{x:n.x,y:r.y+i}],h<2){let e=a-i;u=[{x:r.x,y:r.y+e,radiusY:e},{x:n.x,y:r.y+e}]}return d<2&&(u[0].moveX=l/2,u[1].moveX=l/2),u;case s.IG.MERGE_LINE:if(h<2)return[{x:r.x,y:n.y}];return u=[{x:r.x,y:n.y-i},{x:n.x,y:n.y-i}],d<2&&(u[0].moveX=l/2,u[1].moveX=l/2),u}return[]}(a,n,o)),b=(0,g.useMemo)(()=>E.map((e,t)=>{let r=E[t-1]||h,n=E[t+1]||d,o={x:Math.abs(r.x-e.x),y:Math.abs(r.y-e.y)},s={x:Math.abs(n.x-e.x),y:Math.abs(n.y-e.y)},a=0===o.x&&0===s.y,c=0===o.y&&0===s.x;a||c||console.error(`vertex ${e.x},${e.y} is not right angle`);let g=new l.E9().copyFrom(e),p=new l.E9().copyFrom(e),f=(0,u.Z)(e.radiusX)?i:e.radiusX,y=(0,u.Z)(e.radiusY)?i:e.radiusY,m=f,b=y;if(a){b=Math.min(o.y,y);let t=(0,u.Z)(e.moveY)?b:e.moveY;g.y+=h.y<e.y?-t:+t,m=Math.min(s.x,f);let i=(0,u.Z)(e.moveX)?m:e.moveX;p.x+=d.x<e.x?-i:+i}if(c){m=Math.min(o.x,f);let t=(0,u.Z)(e.moveX)?m:e.moveX;g.x+=h.x<e.x?-t:+t,b=Math.min(s.y,y);let i=(0,u.Z)(e.moveY)?b:e.moveY;p.y+=d.y<e.y?-i:+i}"truncate"===e.radiusOverflow&&(m=f,b=y);let D=(e.x-g.x)*(p.y-g.y)-(e.y-g.y)*(p.x-g.x);return`L ${g.x} ${g.y} A ${m} ${b} 0 0 ${+(D>0)} ${p.x} ${p.y}`}).join(" "),[E]);if(r)return null;let D=`M ${h.x} ${h.y} ${b} L ${d.x} ${d.y}`,M=p?`${B}${e.lineId}`:`${z}${e.lineId}`;return g.createElement(g.Fragment,null,c?g.createElement(Y,{id:M,activated:p}):null,g.createElement("path",{"data-line-id":e.lineId,d:D,...C,stroke:p?y:m,...c?{markerEnd:`url(#${M})`}:{},style:f}))},$=function(e){let{renderKey:t,rendererRegistry:i,...r}=e;if(!t)return g.createElement(g.Fragment,null);let n=i.getRendererComponent(t);if(!n)return g.createElement(g.Fragment,null);let o=n.renderer;return g.createElement(o,{lineId:e.lineId,...r})},G=class extends a.mh{get transitions(){return this.document.getRenderDatas(s.Xr)}onZoom(){var e;let t=this.node.querySelector("svg.flow-lines-container");null==t||null==(e=t.setAttribute)||e.call(t,"viewBox",this.viewBox)}onReady(){this.node.style.zIndex="1"}get viewBox(){let e=1e3/this.config.finalScale;return`0 0 ${e} ${e}`}render(){let e=[],t=this.config.isViewportVisible.bind(this.config);if(this.documentTransformer.loading)return g.createElement(g.Fragment,null);this.documentTransformer.refresh(),this.transitions.forEach(i=>{!function(e){let{data:t,rendererRegistry:i,linesSave:r,dragService:n}=e,{lines:o,entity:a}=t||{},h=(0,s.yI)(a,s.T4.ROUNDED_LINE_X_RADIUS),d=(0,s.yI)(a,s.T4.ROUNDED_LINE_Y_RADIUS);o.forEach((o,a)=>{let u=l.Ae.createRectangleWithTwoPoints(o.from,o.to).pad(10);if(e.isViewportVisible(u)){let e=((e,r)=>{var o;let{renderData:a}=t,{isVertical:l}=t.entity,{lineActivated:u}=a||{},c=(e.type===s.IG.DRAGGING_LINE||e.isDraggingLine)&&!n.isDroppableBranch(t.entity,e.side),p=(e.type===s.IG.DRAGGING_LINE||e.isDraggingLine)&&(null==(o=t.entity)?void 0:o.id)===n.dropNodeId&&e.side===n.labelSide;switch(e.type){case s.IG.STRAIGHT_LINE:return g.createElement(j,{key:`${t.entity.id}_${r}`,lineId:t.entity.id,activated:u,...e});case s.IG.DIVERGE_LINE:case s.IG.DRAGGING_LINE:case s.IG.MERGE_LINE:case s.IG.ROUNDED_LINE:return g.createElement(U,{key:`${t.entity.id}_${r}`,lineId:t.entity.id,isHorizontal:!l,activated:u||p,...e,xRadius:h,yRadius:d,hide:c});case s.IG.CUSTOM_LINE:return g.createElement($,{key:`${t.entity.id}_${r}`,lineId:t.entity.id,...e,rendererRegistry:i})}})(o,a);e&&r.push(e)}})}({data:i,rendererRegistry:this.rendererRegistry,isViewportVisible:t,linesSave:e,dragService:this.dragService})});let{activateLines:i=[],normalLines:r=[]}=(0,f.Z)(e,e=>e.props.activated?"activateLines":"normalLines"),n=[...r,...i];return g.createElement("svg",{className:"flow-lines-container",width:"1000",height:"1000",overflow:"visible",viewBox:this.viewBox,xmlns:"http://www.w3.org/2000/svg"},n)}constructor(){super(...arguments),this.node=l.xF.createDivWithClass("gedit-flow-lines-layer"),this.onViewportChange=(0,y.Z)(()=>{this.render()},100)}};function Q(e){let{data:t,rendererRegistry:i,forceVisible:r,hoverHeight:n=S(t),hoverWidth:o=M(t),wrapperStyle:a,...l}=e,{activateNode:h}=l,[d,u]=(0,g.useState)(!1),c=null==h?void 0:h.getData(s.Lz),p=(0,g.useCallback)(()=>{u(!0),null==c||c.toggleMouseEnter()},[]),f=(0,g.useCallback)(()=>{u(!1),null==c||c.toggleMouseLeave()},[]),y=i.getRendererComponent("collapse"),m=t.entity,E=g.createElement(y.renderer,{node:m,collapseNode:m,...l,hoverActivated:d}),b=t.collapsed||(null==c?void 0:c.hovered)||d||r;return g.createElement("div",{className:"flow-canvas-collapse",onMouseEnter:p,onMouseLeave:f,style:{width:o,height:n,display:"flex",justifyContent:"center",alignItems:"center",...a}},b?E:null)}function W(e){let{data:t,rendererRegistry:i,hoverHeight:r=S(t),hoverWidth:n=M(t),...o}=e,[l,h]=(0,g.useState)(!1),d=(0,g.useCallback)(()=>h(!0),[]),u=(0,g.useCallback)(()=>h(!1),[]),c=t.entity,p=((e,t)=>{let{dragService:i}=t;return i&&i.dragging&&i.isDroppableNode(e)?i.dropNodeId===e.id?"drag-highlight-adder":"draggable-adder":"adder"})(c,{dragService:(0,a.G2)(s.eE)}),f=i.getRendererComponent(p),y=t.entity.document.renderTree.getOriginInfo(c).next,m=c.next,E=g.createElement(f.renderer,{node:c,from:c,to:y,renderTo:m,hoverActivated:l,setHoverActivated:h,hoverWidth:n,hoverHeight:r,...o});return g.createElement("div",{className:"flow-canvas-adder","data-testid":"sdk.flowcanvas.line.adder","data-from":c.id,"data-to":(null==y?void 0:y.id)??"",onMouseEnter:d,onMouseLeave:u,style:{width:n,height:r,display:"flex",justifyContent:"center",alignItems:"center"}},E)}function H(e){let{data:t,rendererRegistry:i,...r}=e,{activateNode:n}=r,[o,a]=(0,g.useState)(!1),l=null==n?void 0:n.getData(s.Lz),h=(0,g.useCallback)(()=>{a(!0)},[]),d=(0,g.useCallback)(()=>{a(!1)},[]),u=null==n?void 0:n.isVertical,c=(null==l?void 0:l.hovered)||o;return u?g.createElement("div",{className:"flow-canvas-collapse-adder",onMouseEnter:h,onMouseLeave:d},(c||t.collapsed)&&g.createElement(Q,{forceVisible:!0,...e,wrapperStyle:{alignItems:"flex-end"},hoverHeight:20}),!t.collapsed&&g.createElement(W,{...e,hoverHeight:c?20:40,hoverActivated:c})):g.createElement("div",{className:"flow-canvas-collapse-adder",onMouseEnter:h,onMouseLeave:d,style:{display:t.collapsed?"block":"flex"}},(c||t.collapsed)&&g.createElement(Q,{forceVisible:!0,...e,wrapperStyle:{justifyContent:"flex-end"},hoverWidth:20}),!t.collapsed&&g.createElement(W,{...e,hoverWidth:c?20:40,hoverActivated:c}))}function X(e){let{data:t,rendererRegistry:i,side:r,...n}=e,o=t.entity,l=((e,t)=>{let{dragService:i,side:r}=t;return i.isDragBranch&&r&&i.labelSide===r&&i.isDroppableBranch(e,r)?i.dropNodeId===e.id?"drag-branch-highlight-adder":"draggable-adder":""})(o,{side:r,dragService:(0,a.G2)(s.eE)});if(!l)return null;let h=i.getRendererComponent(l),d=t.entity.document.renderTree.getOriginInfo(o).next,u=o.next,c=g.createElement(h.renderer,{node:o,from:o,to:d,renderTo:u,...n});return g.createElement("div",{className:"flow-canvas-branch-draggable-adder"},c)}b([(0,d.f3)(s.pQ)],G.prototype,"document",2),b([(0,d.f3)(s.eE)],G.prototype,"dragService",2),b([(0,d.f3)(R)],G.prototype,"rendererRegistry",2),b([(0,a.O0)(s.Vl)],G.prototype,"documentTransformer",2),b([(0,a.O0)(s.y3)],G.prototype,"flowRenderState",2),b([(0,a.aI)(s.GA,s.Xr)],G.prototype,"_transitions",2),G=b([(0,d.b2)()],G);var J={fontSize:12,color:"#8F959E",textAlign:"center",whiteSpace:"nowrap",backgroundColor:"var(--g-editor-background)",lineHeight:"20px"},Z=class extends a.mh{get transitions(){return this.document.getRenderDatas(s.Xr)}onZoom(e){this.node.style.transform=`scale(${e})`}onReady(){this.node.style.zIndex="9"}onReadonlyOrDisabledChange(){this.render()}render(){var e,t,i;let r=[];if(null==(e=this.documentTransformer)?void 0:e.loading)return g.createElement(g.Fragment,null);null==(i=this.documentTransformer)||null==(t=i.refresh)||t.call(i);let{baseActivatedColor:n,baseColor:o}=N(),a=this.config.isViewportVisible.bind(this.config);return this.transitions.forEach(e=>{!function(e){let{data:t,rendererRegistry:i,labelsSave:r,getLabelColor:n}=e,{labels:o,renderData:a}=t||{},{activated:h}=a||{};o.forEach((o,a)=>{var d;e.isViewportVisible((d=o.offset,new l.Ae(d.x-75,d.y-30,150,60)))&&r.push(((r,o)=>{let{offset:a,renderKey:l,props:d,rotate:u,origin:c,type:p}=r||{},f=a.x,y=a.y,m=null;switch(p){case s.nx.BRANCH_DRAGGING_LABEL:m=g.createElement(X,{labelId:r.labelId||e.data.entity.id,rendererRegistry:i,data:t,...d});break;case s.nx.ADDER_LABEL:m=g.createElement(W,{labelId:r.labelId||e.data.entity.id,rendererRegistry:i,data:t,...d});break;case s.nx.COLLAPSE_LABEL:m=g.createElement(Q,{labelId:r.labelId||e.data.entity.id,rendererRegistry:i,data:t,...d});break;case s.nx.COLLAPSE_ADDER_LABEL:m=g.createElement(H,{labelId:r.labelId||e.data.entity.id,rendererRegistry:i,data:t,...d});break;case s.nx.TEXT_LABEL:if(!l)return null;let E=i.getText(l)||l;m=g.createElement("div",{"data-label-id":r.labelId||e.data.entity.id,style:{...J,...null==d?void 0:d.style,color:n(h),transform:u?`rotate(${u})`:void 0}},E);break;case s.nx.CUSTOM_LABEL:if(!l)return null;try{let n=i.getRendererComponent(l);m=g.createElement(n.renderer,{node:t.entity,labelId:r.labelId||e.data.entity.id,...d})}catch(e){console.error(e),m=l}}let b="number"==typeof(null==c?void 0:c[0])?null==c?void 0:c[0]:.5,D="number"==typeof(null==c?void 0:c[1])?null==c?void 0:c[1]:.5;return g.createElement("div",{key:`${t.entity.id}${o}`,"data-label-id":r.labelId||e.data.entity.id,style:{position:"absolute",left:f,top:y,transform:`translate(-${100*b}%, -${100*D}%)`}},m)})(o,a))})}({data:e,rendererRegistry:this.rendererRegistry,isViewportVisible:a,labelsSave:r,getLabelColor:e=>e?n:o})}),g.createElement(g.Fragment,null,r)}constructor(){super(...arguments),this.node=l.xF.createDivWithClass("gedit-flow-labels-layer"),this.onViewportChange=(0,y.Z)(()=>{this.render()},100)}};function K(e,t){let i=t.finalScale;return new l.Ae(e.scrollX/i,e.scrollY/i,t.config.width/i,t.config.height/i).pad(-120/i,-120/i)}b([(0,d.f3)(s.pQ)],Z.prototype,"document",2),b([(0,d.f3)(R)],Z.prototype,"rendererRegistry",2),b([(0,a.O0)(s.Vl)],Z.prototype,"documentTransformer",2),b([(0,a.O0)(s.y3)],Z.prototype,"flowRenderState",2),b([(0,a.aI)(s.GA,s.Xr)],Z.prototype,"_transitions",2),Z=b([(0,d.b2)()],Z);var q=Symbol("ScrollBarEvents"),ee=0;function et(e){let t=Math.min(e/10*255,255),i=(ee+=1)%3,r=()=>Math.floor(Math.random()*t);return`rgb(${0===i?r():0}, ${1===i?r():0}, ${2===i?r():0})`}var ei=class extends a.mh{get transforms(){return this.document.getRenderDatas(s.eG)}onReady(){this.node.style.zIndex="20",l.xF.setStyle(this.originLine,{position:"absolute",width:1,height:"100%",left:this.pipelineNode.style.left,top:0,borderLeft:"1px dashed rgba(255, 0, 0, 0.5)"}),this.pipelineNode.parentElement.appendChild(this.originLine),this.node.appendChild(this.viewport),this.node.appendChild(this.versionNodes),this.node.appendChild(this.boundsNodes),this.node.appendChild(this.pointsNodes),this.renderScrollViewportBounds()}onScroll(){this.originLine.style.left=this.pipelineNode.style.left,this.renderScrollViewportBounds()}onResize(){this.renderScrollViewportBounds()}onZoom(e){this.node.style.transform=`scale(${e})`,this.renderScrollViewportBounds()}createBounds(e,t,i){if(this.filterKey&&-1===e.key.indexOf(this.filterKey))return;let r=this.domCache.get(e),{bounds:n,inputPoint:o,outputPoint:s}=e;if(!r){let i=l.xF.createDivWithClass(""),n=l.xF.createDivWithClass(""),o=l.xF.createDivWithClass(""),s=l.xF.createDivWithClass("");i.title=e.key,n.title=e.key+"(input)",o.title=e.key+"(output)",s.title=e.key,this.boundsNodes.appendChild(i),this.pointsNodes.appendChild(n),this.pointsNodes.appendChild(o),this.versionNodes.appendChild(s),e.onDispose(()=>{i.remove(),n.remove(),o.remove()}),r={bbox:i,input:n,output:o,version:s,color:t},this.domCache.set(e,r)}l.xF.setStyle(r.version,{position:"absolute",marginLeft:"-9px",marginTop:"-10px",borderRadius:12,background:"#f54a45",padding:4,color:"navajowhite",display:e.renderState.hidden?"none":"block",zIndex:i+1e3,left:n.center.x,top:n.center.y}),r.version.innerHTML=e.version.toString(),l.xF.setStyle(r.input,{position:"absolute",width:10,height:10,marginLeft:-5,marginTop:-5,borderRadius:5,left:o.x,top:o.y,opacity:.4,zIndex:i,backgroundColor:r.color,whiteSpace:"nowrap",overflow:"visible"}),r.input.innerHTML=`${o.x},${o.y}`,l.xF.setStyle(r.output,{position:"absolute",width:10,height:10,marginLeft:-5,marginTop:-5,borderRadius:5,left:s.x,top:s.y,opacity:.4,zIndex:i,backgroundColor:r.color,whiteSpace:"nowrap",overflow:"visible"}),r.output.innerHTML=`${s.x},${s.y}`,l.xF.setStyle(r.bbox,{position:"absolute",width:n.width,height:n.height,left:n.left,top:n.top,opacity:`${i/30}`,backgroundColor:r.color})}renderScrollViewportBounds(){let e=K({scrollX:this.config.config.scrollX,scrollY:this.config.config.scrollY},this.config);l.xF.setStyle(this.viewport,{position:"absolute",width:e.width-2,height:e.height-2,left:e.left+1,top:e.top+1,border:"1px solid rgba(200, 200, 255, 0.5)"})}autorun(){if(this.documentTransformer.loading)return;this.documentTransformer.refresh();let e=et(0);this.document.traverse((t,i)=>{let r=t.getData(s.eG);e=et(i),this.createBounds(r,e,i)}),this.renderScrollViewportBounds()}constructor(){var e;super(...arguments),this.node=document.createElement("div"),this.viewport=l.xF.createDivWithClass("gedit-flow-debug-bounds"),this.boundsNodes=l.xF.createDivWithClass("gedit-flow-debug-bounds"),this.pointsNodes=l.xF.createDivWithClass("gedit-flow-debug-points"),this.versionNodes=l.xF.createDivWithClass("gedit-flow-debug-versions gedit-hidden"),this.filterKey=(null==(e=window.location.search.match(/debug=([^&]+)/))?void 0:e[1])||"",this.originLine=document.createElement("div"),this.domCache=new WeakMap}};b([(0,d.f3)(s.pQ)],ei.prototype,"document",2),b([(0,a.O0)(s.Vl)],ei.prototype,"documentTransformer",2),b([(0,a.aI)(s.GA,s.eG)],ei.prototype,"_transforms",2),ei=b([(0,d.b2)()],ei);var er=class extends a.mh{get clientViewportWidth(){return this.viewportWidth*this.scale-11}get clientViewportHeight(){return this.viewportHeight*this.scale-11}get viewportFullWidth(){return this.mostLeft-this.mostRight}get viewportFullHeight(){return this.mostTop-this.mostBottom}get viewportMoveWidth(){return this.mostLeft-this.mostRight+this.width}get viewportMoveHeight(){return this.mostTop-this.mostBottom+this.height}getToLeft(e){return(e-this.mostRight)/this.viewportMoveWidth*this.clientViewportWidth}getToTop(e){return(e-this.mostBottom)/this.viewportMoveHeight*this.clientViewportHeight}clickRightScrollBar(e){e.preventDefault(),e.stopPropagation();let t=1-((null==e?void 0:e.y)||0)/this.clientViewportHeight,i=(this.mostTop-this.viewportFullHeight*t)*this.scale;this.playgroundConfigEntity.scroll({scrollY:i},!1)}clickBottomScrollBar(e){e.preventDefault(),e.stopPropagation();let t=1-((null==e?void 0:e.x)||0)/this.clientViewportWidth,i=(this.mostLeft-this.viewportFullWidth*t)*this.scale;this.playgroundConfigEntity.scroll({scrollX:i},!1)}onBoardingToast(){var e;null==(e=this.events)||e.dragStart()}changeScrollBarVisibility(e,t){l.xF.addClass(e,"show"===t?"gedit-playground-scroll-show":"gedit-playground-scroll-hidden"),l.xF.delClass(e,"show"===t?"gedit-playground-scroll-hidden":"gedit-playground-scroll-show")}onReady(){this.options.getBounds||(this.options={getBounds:()=>{let e=this.flowDocument;return e?(e.transformer.refresh(),e.root.getData(s.eG).bounds):l.Ae.EMPTY},showScrollBars:"whenScrolling"}),this.pipelineNode.parentNode.appendChild(this.rightScrollBar),this.pipelineNode.parentNode.appendChild(this.rightScrollBarBlock),this.pipelineNode.parentNode.appendChild(this.bottomScrollBar),this.pipelineNode.parentNode.appendChild(this.bottomScrollBarBlock),this.rightScrollBar.onclick=this.clickRightScrollBar.bind(this),this.bottomScrollBar.onclick=this.clickBottomScrollBar.bind(this),"whenScrolling"===this.options.showScrollBars&&(this.rightScrollBar.addEventListener("mouseenter",e=>{this.changeScrollBarVisibility(this.rightScrollBarBlock,"show")}),this.rightScrollBar.addEventListener("mouseleave",e=>{this.changeScrollBarVisibility(this.rightScrollBarBlock,"hidden")}),this.bottomScrollBar.addEventListener("mouseenter",e=>{this.changeScrollBarVisibility(this.bottomScrollBarBlock,"show")}),this.bottomScrollBar.addEventListener("mouseleave",e=>{this.changeScrollBarVisibility(this.bottomScrollBarBlock,"hidden")})),this.bottomScrollBarBlock.addEventListener("mousedown",e=>{this.bottomGrabDragger.start(e.clientX,e.clientY),e.stopPropagation()}),this.rightScrollBarBlock.addEventListener("mousedown",e=>{this.rightGrabDragger.start(e.clientX,e.clientY),e.stopPropagation()})}autorun(){this.hideTimeout&&clearTimeout(this.hideTimeout);let e=K({scrollX:this.config.config.scrollX,scrollY:this.config.config.scrollY},this.config),t=this.config.getViewport();this.viewportWidth=t.width,this.viewportHeight=t.height;let i=this.options.getBounds();this.width=(null==i?void 0:i.width)||0,this.height=(null==i?void 0:i.height)||0;let r=(this.viewportWidth-e.width)/2-2,n=(this.viewportHeight-e.height)/2-2,o=this.width+e.width,s=this.height+e.height,a=i.x,h=i.y;this.mostLeft=this.width+a-r,this.mostRight=this.mostLeft-o,this.mostTop=this.height+h-n,this.mostBottom=this.mostTop-s,this.scale=this.config.finalScale;let d=this.clientViewportWidth,u=this.clientViewportHeight;this.scrollBottomWidth=d-d*(this.mostLeft-this.mostRight)/this.viewportMoveWidth,this.scrollRightHeight=u-u*(this.mostTop-this.mostBottom)/this.viewportMoveHeight;let c=this.getToLeft(t.x),g=this.getToTop(t.y);l.xF.setStyle(this.rightScrollBarBlock,{right:2,top:g,background:"#1F2329",zIndex:10,height:this.scrollRightHeight,width:"7px"}),l.xF.setStyle(this.bottomScrollBarBlock,{left:c,bottom:2,background:"#1F2329",zIndex:10,height:"7px",width:this.scrollBottomWidth}),this.changeScrollBarVisibility(this.rightScrollBarBlock,"show"),this.changeScrollBarVisibility(this.bottomScrollBarBlock,"show"),"whenScrolling"===this.options.showScrollBars&&(this.hideTimeout=window.setTimeout(()=>{this.changeScrollBarVisibility(this.rightScrollBarBlock,"hidden"),this.changeScrollBarVisibility(this.bottomScrollBarBlock,"hidden"),this.hideTimeout=void 0},1e3))}constructor(){super(...arguments),this.rightScrollBar=l.xF.createDivWithClass("gedit-playground-scroll-right"),this.rightScrollBarBlock=l.xF.createDivWithClass("gedit-playground-scroll-right-block"),this.bottomScrollBar=l.xF.createDivWithClass("gedit-playground-scroll-bottom"),this.bottomScrollBarBlock=l.xF.createDivWithClass("gedit-playground-scroll-bottom-block"),this.sum=0,this.initialScrollX=0,this.initialScrollY=0,this.bottomGrabDragger=new a.s5({onDragStart:e=>{this.config.updateCursor("grabbing"),this.sum=0,this.initialScrollX=this.config.getViewport().x,this.onBoardingToast()},onDrag:e=>{this.sum+=e.movingDelta.x,this.playgroundConfigEntity.scroll({scrollX:(this.initialScrollX+this.sum*this.viewportFullWidth/(this.clientViewportWidth-this.scrollBottomWidth))*this.scale},!1)},onDragEnd:e=>{this.config.updateCursor("default")}}),this.rightGrabDragger=new a.s5({onDragStart:e=>{this.config.updateCursor("grabbing"),this.sum=0,this.initialScrollY=this.config.getViewport().y,this.onBoardingToast()},onDrag:e=>{this.sum+=e.movingDelta.y,this.playgroundConfigEntity.scroll({scrollY:(this.initialScrollY+this.sum*this.viewportFullHeight/(this.clientViewportHeight-this.scrollRightHeight))*this.scale},!1)},onDragEnd:e=>{this.config.updateCursor("default")}})}};b([(0,d.jt)(),(0,d.f3)(q)],er.prototype,"events",2),b([(0,d.f3)(s.pQ),(0,d.jt)()],er.prototype,"flowDocument",2),b([(0,a.O0)(a.ER)],er.prototype,"playgroundConfigEntity",2),er=b([(0,d.b2)()],er);var en=class extends a.mh{get transitions(){let e=[];return this.document.traverse(t=>{e.push(t.getData(s.Xr))}),e}get dragStartEntity(){return this.flowRenderStateEntity.getDragStartEntity()}set dragStartEntity(e){this.flowRenderStateEntity.setDragStartEntity(e)}get dragEntities(){return this.flowRenderStateEntity.getDragEntities()}set dragEntities(e){this.flowRenderStateEntity.setDragEntities(e)}isGrab(){return this.editorStateConfig.getCurrentState()===a.yy.STATE_GRAB}setDraggingStatus(e){this.service.nodeDragIdsWithChildren.length&&this.service.nodeDragIdsWithChildren.forEach(t=>{let i=this.entityManager.getEntityById(t);(null==i?void 0:i.getData(s.Lz)).dragging=e})}dragEnable(e){return Math.abs(e.clientX-this.initialPosition.x)>10||Math.abs(e.clientY-this.initialPosition.y)>10}handleMouseMove(e){if(this.dragStartEntity&&this.dragEnable(e)){this.setDraggingStatus(!0);let i=this.playgroundConfigEntity.finalScale;if(this.containerRef.current){var t;let r,n=null==(t=this.containerRef.current.children)?void 0:t[0],o=e.clientX-(this.pipelineNode.offsetLeft||0)-this.playgroundConfigEntity.config.clientX-(n.clientWidth-this.dragOffset.x)*i,s=e.clientY-(this.pipelineNode.offsetTop||0)-this.playgroundConfigEntity.config.clientY-(n.clientHeight-this.dragOffset.y)*i,a=this.service.isDragBranch,h=new l.Ae(o,s,n.clientWidth*i,n.clientHeight*i),d=this.transitions.find(e=>{var t,i;if(null==e||null==(i=e.entity)||null==(t=i.parent)?void 0:t.collapsed)return!1;let{hasCollision:n,labelOffsetType:o}=this.flowDragConfigEntity.isCollision(e,h,a);return r=o,n});d&&(a?this.service.isDroppableBranch(d.entity,r):this.service.isDroppableNode(d.entity))&&(!this.options.canDrop||this.options.canDrop({dragNodes:this.dragEntities,dropNode:d.entity,isBranch:a}))?this.flowRenderStateEntity.setNodeDroppingId(d.entity.id):this.flowRenderStateEntity.setNodeDroppingId(""),this.flowRenderStateEntity.setDragLabelSide(r),this.containerRef.current.style.visibility="visible",this.pipelineNode.parentElement.appendChild(this.draggingNodeMask),this.containerRef.current.style.left=`${o}px`,this.containerRef.current.style.top=`${s}px`,this.containerRef.current.style.transformOrigin="top left",this.containerRef.current.style.transform=`scale(${i})`,this.flowDragConfigEntity.scrollDirection(e,this.containerRef.current,o,s)}}}handleMouseUp(){this.setDraggingStatus(!1),this.dragStartEntity&&(this.service.dropNodeId&&(this.service.isDragBranch?this.service.dropBranch():(this.service.dropNode(),this.selectConfigEntity.clearSelectedNodes())),this.flowRenderStateEntity.setNodeDroppingId(""),this.flowRenderStateEntity.setDragLabelSide(),this.dragStartEntity=void 0,this.dragEntities=[],this.flowDragConfigEntity.stopAllScroll()),this.containerRef.current&&(this.containerRef.current.style.visibility="hidden",this.pipelineNode.parentElement.contains(this.draggingNodeMask)&&this.pipelineNode.parentElement.removeChild(this.draggingNodeMask))}async startDrag(e,t,i){let{dragStartEntity:r,dragEntities:n}=t;if(this.isGrab()||this.config.disabled||this.config.readonly)return;this.dragOffset.x=(null==i?void 0:i.dragOffsetX)||8,this.dragOffset.y=(null==i?void 0:i.dragOffsetY)||8;let o=r.flowNodeType===s.Sy.BLOCK_ICON,a=r.flowNodeType===s.Sy.BLOCK_ORDER_ICON,l=o||a?r.parent:r;if(l.getData(s.Lz).draggable)return this.initialPosition={x:e.clientX,y:e.clientY},this.dragStartEntity=l,this.dragEntities=n||[this.dragStartEntity],this._dragger.start(e.clientX,e.clientY)}onReady(){this.draggingNodeMask.style.width="100%",this.draggingNodeMask.style.height="100%",this.draggingNodeMask.style.position="absolute",this.draggingNodeMask.classList.add("dragging-node"),this.draggingNodeMask.style.zIndex="99",this.draggingNodeMask.style.cursor="pointer",this.dragNodeComp=this.rendererRegistry.getRendererComponent("drag-node"),this.options.onDrop&&this.toDispose.push(this.service.onDrop(this.options.onDrop))}render(){let e=this.dragNodeComp.renderer;return g.createElement("div",{ref:this.containerRef,style:{position:"absolute",zIndex:99999,visibility:"hidden"},onMouseEnter:e=>e.stopPropagation()},g.createElement(e,{dragStart:this.dragStartEntity,dragNodes:this.dragEntities}))}constructor(){super(...arguments),this.dragOffset={x:8,y:8},this.containerRef=g.createRef(),this.draggingNodeMask=document.createElement("div"),this._dragger=new a.s5({onDrag:e=>{this.handleMouseMove(e)},onDragEnd:()=>{this.handleMouseUp()},stopGlobalEventNames:["contextmenu"]})}};b([(0,d.f3)(s.pQ)],en.prototype,"document",2),b([(0,d.f3)(s.eE)],en.prototype,"service",2),b([(0,a.aI)(s.GA,s.eG)],en.prototype,"transforms",2),b([(0,a.O0)(a.Zs)],en.prototype,"editorStateConfig",2),b([(0,a.O0)(a.ER)],en.prototype,"playgroundConfigEntity",2),b([(0,a.O0)(x)],en.prototype,"flowDragConfigEntity",2),b([(0,a.O0)(s.y3)],en.prototype,"flowRenderStateEntity",2),b([(0,a.O0)(w)],en.prototype,"selectConfigEntity",2),b([(0,d.f3)(R)],en.prototype,"rendererRegistry",2),en=b([(0,d.b2)()],en);var eo=class extends a.mh{onReady(){this.options.canSelect||(this.options.canSelect=e=>{let t=e.target;return t===this.pipelineNode||t===this.playgroundNode}),this.toDispose.pushAll([this.selectConfigEntity.onConfigChanged(()=>{this.selectionService.selection=this.selectConfigEntity.selectedNodes}),this.selectionService.onSelectionChanged(()=>{let e=this.selectionService.selection.filter(e=>e instanceof s.GA);this.selectConfigEntity.selectedNodes=e})]),this.listenPlaygroundEvent("mousedown",e=>{if(this.isEnabled()&&(!this.options.canSelect||this.options.canSelect(e,this.selectorBoxConfigEntity)))return this.editorStateConfig.getCurrentState()===a.yy.STATE_MOUSE_FRIENDLY_SELECT&&this.selectConfigEntity.clearSelectedNodes(),this.selectboxDragger.start(e.clientX,e.clientY,this.config),!0},a.nn.BASE_LAYER)}isEnabled(){let e=this.editorStateConfig.getCurrentState(),t=e===a.yy.STATE_MOUSE_FRIENDLY_SELECT;return!this.config.disabled&&!this.config.readonly&&(t&&this.editorStateConfig.isPressingShift||e===a.yy.STATE_SELECT)&&!this.selectorBoxConfigEntity.disabled}dispose(){this.selectorBox.dispose(),this.selectorBoxBlock.dispose(),super.dispose()}updateSelectorBox(e){let t=this.selectorBox.get(),i=this.selectorBoxBlock.get();!this.isEnabled()&&e.isMoving&&this.selectorBoxConfigEntity.collapse(),this.isEnabled()&&e.isMoving?(t.setStyle({display:"block",left:e.position.x,top:e.position.y,width:e.size.width,height:e.size.height}),i.setStyle({display:"block",left:e.position.x-10,top:e.position.y-10,width:e.size.width+20,height:e.size.height+20})):(t.setStyle({display:"none"}),i.setStyle({display:"none"}))}nodeSelectable(e,t){let i=e.getNodeMeta().selectable;return"function"==typeof i?i(e,t):i}constructor(){super(...arguments),this.node=l.xF.createDivWithClass("gedit-selector-box-layer"),this.selectorBox=this.createDOMCache("gedit-selector-box"),this.selectorBoxBlock=this.createDOMCache("gedit-selector-box-block"),this.selectboxDragger=new a.s5({onDragStart:e=>{this.selectConfigEntity.clearSelectedNodes();let t=this.playgroundConfigEntity.getPosFromMouseEvent(e);this.transformVisibles=this.flowDocument.getRenderDatas(s.eG,!1).filter(e=>{let{entity:i}=e;return i.originParent?this.nodeSelectable(i,t)&&this.nodeSelectable(i.originParent,t):this.nodeSelectable(i,t)}),this.selectorBoxConfigEntity.setDragInfo(e),this.updateSelectorBox(this.selectorBoxConfigEntity)},onDrag:e=>{this.selectorBoxConfigEntity.setDragInfo(e),this.selectConfigEntity.selectFromBounds(this.selectorBoxConfigEntity.toRectangle(this.playgroundConfigEntity.finalScale),this.transformVisibles),this.updateSelectorBox(this.selectorBoxConfigEntity)},onDragEnd:e=>{this.selectorBoxConfigEntity.setDragInfo(e),this.transformVisibles.length=0,this.updateSelectorBox(this.selectorBoxConfigEntity)}})}};b([(0,d.f3)(s.pQ)],eo.prototype,"flowDocument",2),b([(0,d.f3)(a.Lk)],eo.prototype,"contextMenuService",2),b([(0,a.O0)(a.ER)],eo.prototype,"playgroundConfigEntity",2),b([(0,d.f3)(a.z2)],eo.prototype,"selectionService",2),b([(0,a.O0)(_)],eo.prototype,"selectorBoxConfigEntity",2),b([(0,a.O0)(w)],eo.prototype,"selectConfigEntity",2),b([(0,a.O0)(a.Zs)],eo.prototype,"editorStateConfig",2),eo=b([(0,d.b2)()],eo);var es=class extends a.mh{onReady(){this.node.style.zIndex="20";let{firstChild:e}=this.pipelineNode;void 0!==this.options.boundsPadding&&(this.flowSelectConfigEntity.boundsPadding=this.options.boundsPadding),this.options.backgroundClassName&&this.selectBoundsBackground.classList.add(this.options.backgroundClassName);let t=l.xF.createDivWithClass("gedit-playground-layer");t.appendChild(this.selectBoundsBackground),this.pipelineNode.insertBefore(t,e)}onZoom(e){this.node.style.transform=`scale(${e})`,this.selectBoundsBackground.parentElement.style.transform=`scale(${e})`}onViewportChange(){this.render()}isEnabled(){return this.editorStateConfig.getCurrentState()===a.yy.STATE_SELECT}render(){var e;let{ignoreOneSelect:t,ignoreChildrenLength:i,SelectorBoxPopover:r,disableBackground:n,CustomBoundsRenderer:o}=this.options,s=this.flowSelectConfigEntity.getSelectedBounds(),a=this.flowSelectConfigEntity.selectedNodes,h=this.selectBoundsBackground,d=!this.selectorBoxConfigEntity.isStart;if(0===s.width||0===s.height||t&&1===a.length&&(i||a[0].childrenLength<=1))return l.xF.setStyle(h,{display:"none"}),g.createElement(g.Fragment,null);if(o)return g.createElement(o,{bounds:s,config:this.config,flowSelectConfig:this.flowSelectConfigEntity,commandRegistry:this.commandRegistry});let u={display:"block",left:s.left,top:s.top,width:s.width,height:s.height};n||l.xF.setStyle(h,u);let c="gedit-selector-bounds-foreground";this.options.foregroundClassName&&(c+=" "+this.options.foregroundClassName);let p=r||(null==(e=this.rendererRegistry.tryToGetRendererComponent("selector-box-popover"))?void 0:e.renderer);return d&&p?g.createElement(p,{bounds:s,config:this.config,flowSelectConfig:this.flowSelectConfigEntity,commandRegistry:this.commandRegistry},g.createElement("div",{className:c,style:u})):g.createElement("div",{className:c,style:u})}constructor(){super(...arguments),this.node=l.xF.createDivWithClass("gedit-selector-bounds-layer"),this.selectBoundsBackground=l.xF.createDivWithClass("gedit-selector-bounds-background")}};b([(0,d.f3)(R)],es.prototype,"rendererRegistry",2),b([(0,d.f3)(a.Ho)],es.prototype,"commandRegistry",2),b([(0,a.O0)(w)],es.prototype,"flowSelectConfigEntity",2),b([(0,a.O0)(a.Zs)],es.prototype,"editorStateConfig",2),b([(0,a.O0)(_)],es.prototype,"selectorBoxConfigEntity",2),b([(0,a.aI)(s.GA,s.Lz)],es.prototype,"renderStates",2),b([(0,a.aI)(s.GA,s.eG)],es.prototype,"_transforms",2),es=b([(0,d.b2)()],es);var ea=class extends a.mh{isEnabled(){let e=this.editorStateConfig.getCurrentState();return!this.config.disabled&&!this.config.readonly&&e===a.yy.STATE_SELECT&&!this.selectorBoxConfigEntity.disabled}onReady(){this.node.style.zIndex="30",this.node.style.display="block",this.toDispose.pushAll([this.listenPlaygroundEvent("contextmenu",e=>{var t;if(!this.isEnabled())return;this.contextMenuService.rightPanelVisible=!0;let i=this.flowSelectConfigEntity.getSelectedBounds();if(0===i.width||0===i.height)return;e.stopPropagation(),e.preventDefault(),null==(t=this.nodeRef.current)||t.setVisible(!0);let r=e.clientX-(this.pipelineNode.offsetLeft||0)-this.playgroundConfigEntity.config.clientX,n=e.clientY-(this.pipelineNode.offsetTop||0)-this.playgroundConfigEntity.config.clientY;this.node.style.left=`${r}px`,this.node.style.top=`${n}px`},a.nn.BASE_LAYER),this.listenPlaygroundEvent("mousedown",()=>{var e;null==(e=this.nodeRef.current)||e.setVisible(!1),this.contextMenuService.rightPanelVisible=!1})])}onScroll(){var e;null==(e=this.nodeRef.current)||e.setVisible(!1)}onZoom(){var e;null==(e=this.nodeRef.current)||e.setVisible(!1)}dispose(){super.dispose()}renderCommandMenus(){return this.commandRegistry.commands.filter(e=>"SELECTOR_BOX"===e.category).map(e=>{var t;let i=null==(t=this.rendererRegistry.getRendererComponent(e.icon||e.id))?void 0:t.renderer;return g.createElement(i,{key:e.id,command:e,isContextMenu:!0,disabled:!this.commandRegistry.isEnabled(e.id),onClick:t=>this.commandRegistry.executeCommand(e.id,t)})}).filter(e=>e)}render(){let e=this.rendererRegistry.getRendererComponent("context-menu-popover").renderer;return g.createElement(e,{ref:this.nodeRef,content:this.renderCommandMenus()})}constructor(){super(...arguments),this.node=l.xF.createDivWithClass("gedit-context-menu-layer"),this.nodeRef=g.createRef()}};b([(0,d.f3)(a.Ho)],ea.prototype,"commandRegistry",2),b([(0,d.f3)(R)],ea.prototype,"rendererRegistry",2),b([(0,d.f3)(a.Lk)],ea.prototype,"contextMenuService",2),b([(0,a.O0)(w)],ea.prototype,"flowSelectConfigEntity",2),b([(0,d.f3)(a.z2)],ea.prototype,"selectionService",2),b([(0,a.O0)(a.ER)],ea.prototype,"playgroundConfigEntity",2),b([(0,a.O0)(a.Zs)],ea.prototype,"editorStateConfig",2),b([(0,a.O0)(_)],ea.prototype,"selectorBoxConfigEntity",2),ea=b([(0,d.b2)()],ea);var el=class extends a.mh{getInitScroll(){return this.document.layout.getInitScroll(this.pipelineNode.getBoundingClientRect())}onReady(){let e=()=>this.getInitScroll();this.config.updateConfig(e()),this.config.addScrollLimit(t=>(function(e,t,i,r){e={...e};let n=i.config,o={scrollX:n.scrollX,scrollY:n.scrollY};if(0===t.length||0===n.width||0===n.height)return e;let s=K(e,i);if(!t.find(e=>l.Ae.isViewportVisible(e,s))){let e=K(o,i);return t.find(t=>l.Ae.isViewportVisible(t,e))?o:r()}return e})(t,[this.document.root.getData(s.eG).bounds],this.config,e))}};b([(0,d.f3)(s.pQ)],el.prototype,"document",2),el=b([(0,d.b2)()],el);var eh=new d.nZ(e=>{e(R).toSelf().inSingletonScope(),e(I).toSelf().inSingletonScope()})},950454:function(e,t,i){i.d(t,{JTr:()=>a.JT,f3M:()=>u.f3,qRT:()=>c.qR,QUv:()=>h.QU,_J4:()=>b,PiV:()=>d.Pi,D9C:()=>h.D9,fin:()=>M,qmw:()=>c.qm,Emw:()=>d.Em,xFV:()=>a.xF,GAy:()=>h.GA,kmj:()=>l.km,d3V:()=>l.d3,Fu1:()=>ey,zEJ:()=>s.zE,Rf1:()=>d.Rf,C8:()=>h.C8,VOn:()=>l.VO,i2z:()=>c.i2,OTb:()=>h.OT,XsM:()=>h.Xs,z2R:()=>l.z2,SyX:()=>h.Sy,yyW:()=>l.yy,HoL:()=>l.Ho,ERL:()=>l.ER,Odm:()=>R.Od,nYJ:()=>n,esp:()=>en.es,LzJ:()=>h.Lz,cL:()=>L.cL,_cB:()=>W,XQj:()=>l.XQ,AeJ:()=>a.Ae,F26:()=>R.F2,cc3:()=>h.cc,mYg:()=>l.mY,v2K:()=>l.v2,gw0:()=>a.gw,u$R:()=>_,b2C:()=>u.b2,Dcz:()=>l.Dc,k6H:()=>w,Zn3:()=>l.Zn,FwO:()=>l.Fw,YvH:()=>l.Yv,R6T:()=>l.iX,kDE:()=>d.kD,pQ4:()=>h.pQ,EU3:()=>d.EU,VDr:()=>l.VD,h3M:()=>h.h3,Aub:()=>C,eGM:()=>h.eG,XDS:()=>d.XD,gNt:()=>R.gN,V7e:()=>d.V7,loc:()=>E,rQR:()=>l.rQ,C$T:()=>R.C$,THq:()=>s.TH,$eD:()=>c.$e,KUq:()=>l.KU,rVg:()=>c.rV,Psq:()=>T.Ps,oci:()=>O.o,W2M:()=>H,G2Z:()=>l.G2,CR5:()=>s.CR,Q5$:()=>a.Q5,lVg:()=>d.lV,M1y:()=>l.M1,qoQ:()=>R.qo,UJL:()=>l.UJ,LF0:()=>c.LF,CMu:()=>s.CM,JAk:()=>a.JA,l09:()=>R.l0,W6u:()=>l.W6,XPE:()=>h.XP,K46:()=>a.K4,GwP:()=>c.Gw,qq0:()=>d.qq,oC4:()=>d.oC,mh4:()=>l.mh,Ys9:()=>I}),i(543789);var r,n,o,s=i(928079),a=i(832176),l=i(893740),h=i(579962),d=i(438024),u=i(461932),c=i(319428),g=i(288216),p=Object.defineProperty,f=Object.getOwnPropertyDescriptor,y=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?f(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&p(t,i,o),o},m=(e,t)=>(i,r)=>t(i,r,e),E=((r=E||{}).public="public",r.private="private",r),b=class extends l.RD{get private(){return this._private}get public(){return this._public}setVar(e,t){if("string"==typeof e&&void 0!==t)return this.public.ast.set(e,t);if("object"==typeof e&&void 0===t)return this.public.ast.set("outputs",e);throw Error("Invalid arguments")}getVar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"outputs";return this.public.ast.get(e)}clearVar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"outputs";return this.public.ast.remove(e)}setPrivateVar(e,t){if("string"==typeof e&&void 0!==t)return this.initPrivate().ast.set(e,t);if("object"==typeof e&&void 0===t)return this.initPrivate().ast.set("outputs",e);throw Error("Invalid arguments")}getPrivateVar(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"outputs";return null==(e=this.private)?void 0:e.ast.get(t)}clearPrivateVar(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"outputs";return null==(e=this.private)?void 0:e.ast.remove(t)}get allScopes(){let e=[];return this._public&&e.push(this._public),this._private&&e.push(this._private),e}getDefaultData(){return{}}initPrivate(){return this._private||(this._private=this.variableEngine.createScope(`${this.entity.id}_private`,{node:this.entity,type:"private"}),this.variableEngine.chain.refreshAllChange(),this.toDispose.push(this._private)),this._private}getByKeyPath(e){return this.public.available.getByKeyPath(e)}getByKeyPathInPrivate(e){var t;return null==(t=this.private)?void 0:t.available.getByKeyPath(e)}constructor(e,t){super(e),this.opts=t;let{variableEngine:i}=t||{};this.variableEngine=i,this._public=this.variableEngine.createScope(this.entity.id,{node:this.entity,type:"public"}),this.toDispose.push(this._public)}};b.type="FlowNodeVariableData";var D=Symbol("VariableChainConfig"),N=(e,t)=>e,C=class{hasTransformer(e){return this.transformerMap.has(e)}registerTransformer(e,t){this.transformerMap.set(e,t)}transformDeps(e,t){let{scope:i}=t;return Array.from(this.transformerMap.values()).reduce((e,t)=>t.transformDeps?e=t.transformDeps(e,{scope:i,document:this.document,variableEngine:this.variableEngine}):e,e)}transformCovers(e,t){let{scope:i}=t;return Array.from(this.transformerMap.values()).reduce((e,t)=>t.transformCovers?e=t.transformCovers(e,{scope:i,document:this.document,variableEngine:this.variableEngine}):e,e)}constructor(e){var t,i;this.configs=e,this.transformerMap=new Map,((null==(t=this.configs)?void 0:t.transformDeps)||(null==(i=this.configs)?void 0:i.transformCovers))&&this.transformerMap.set("VARIABLE_LAYOUT_CONFIG",{transformDeps:this.configs.transformDeps||N,transformCovers:this.configs.transformCovers||N})}};y([(0,l.yT)(h.pQ)],C.prototype,"document",2),y([(0,l.yT)(c.i2)],C.prototype,"variableEngine",2),C=y([(0,u.b2)(),m(0,(0,u.jt)()),m(0,(0,u.f3)(D))],C);var M=class extends c.sX{static is(e){return e.id===M.ID}};M.ID=Symbol("GlobalScope"),M=y([(0,u.b2)()],M);var S=class extends c.$s{get tree(){return this.flowDocument.originTree}onInit(){this.toDispose.pushAll([this.entityManager.onEntityDataChange(e=>{let{entityDataType:t}=e;t===g.Z1.type&&this.refreshAllChange()}),this.tree.onTreeChange(()=>{this.refreshAllChange()})])}getAllInputLayerNodes(e){let t=this.getNodeParent(e),i=new Set,r=[e];for(;r.length;){var n;((null==(n=r.shift().getData(g.Z1))?void 0:n.inputNodes)||[]).forEach(e=>{this.getNodeParent(e)===t&&(i.has(e)||(r.push(e),i.add(e)))})}return Array.from(i).reverse()}getAllOutputLayerNodes(e){var t;let i=this.getNodeParent(e);return((null==(t=e.getData(g.Z1))?void 0:t.allOutputNodes)||[]).filter(e=>this.getNodeParent(e)===i)}getDeps(e){let{node:t}=e.meta||{};if(!t)return this.transformService.transformDeps([],{scope:e});let i=[],r=t;for(;r;){let t=r.getData(b);(null==t?void 0:t.private)&&e!==t.private&&i.unshift(t.private);let n=this.getAllInputLayerNodes(r);i.unshift(...n.map(e=>[e.getData(b).public,...this.getAllPublicChildScopes(e)]).flat().filter(Boolean)),r=this.getNodeParent(r)}let n=this.variableEngine.getScopeById(M.ID);n&&i.unshift(n);let o=Array.from(new Set(i));return this.transformService.transformDeps(o,{scope:e})}getCovers(e){if(M.is(e)){let t=this.variableEngine.getAllScopes({sort:!0}).filter(e=>!M.is(e));return this.transformService.transformCovers(t,{scope:e})}let{node:t}=e.meta||{};if(!t)return this.transformService.transformCovers([],{scope:e});let i="private"===e.meta.type,r=[];if(i)r.push(...this.getNodeChildren(t));else{r.push(...this.getAllOutputLayerNodes(t)||[]);let e=this.getNodeParent(t);for(;e&&!this.isNodeChildrenPrivate(e);)r.push(...this.getAllOutputLayerNodes(e)),e=this.getNodeParent(e)}let n=[];for(;r.length;){let e=r.shift(),t=e.getData(b);n.push(...t.allScopes);let i=e&&this.getNodeChildren(e);(null==i?void 0:i.length)&&r.push(...i)}let o=t.getData(b);i&&o.public&&n.push(o.public);let s=Array.from(new Set(n));return this.transformService.transformCovers(s,{scope:e})}getNodeChildren(e){var t,i,r,n;if(null==(t=this.configs)?void 0:t.getNodeChildren)return null==(r=(n=this.configs).getNodeChildren)?void 0:r.call(n,e);let o=e.getNodeMeta(),s=null==(i=o.subCanvas)?void 0:i.call(o,e);if(s)if(s.isCanvas)return[];else return s.canvasNode.collapsedChildren;return this.tree.getChildren(e)}getAllPublicChildScopes(e){return this.isNodeChildrenPrivate(e)?[]:this.getNodeChildren(e).map(e=>[e.getData(b).public,...this.getAllPublicChildScopes(e)]).flat()}getNodeParent(e){var t,i;if(null==(t=this.configs)?void 0:t.getNodeParent)return this.configs.getNodeParent(e);let r=e.document.originTree.getParent(e);for(;(null==r?void 0:r.flowNodeType)===h.Sy.GROUP;)r=r.parent;if(!r)return r;let n=r.getNodeMeta(),o=null==(i=n.subCanvas)?void 0:i.call(n,r);return(null==o?void 0:o.isCanvas)?o.parentNode:r}isNodeChildrenPrivate(e){var t,i;return(null==(t=this.configs)?void 0:t.isNodeChildrenPrivate)?!!e&&(null==(i=this.configs)?void 0:i.isNodeChildrenPrivate(e)):!(null==e?void 0:e.id.startsWith("$"))&&(null==e?void 0:e.flowNodeType)!==h.Sy.GROUP}sortAll(){return console.warn("FreeLayoutScopeChain.sortAll is not implemented"),[]}};y([(0,u.f3)(l.v2)],S.prototype,"entityManager",2),y([(0,u.f3)(h.pQ)],S.prototype,"flowDocument",2),y([(0,u.jt)(),(0,u.f3)(D)],S.prototype,"configs",2),y([(0,u.f3)(C)],S.prototype,"transformService",2),y([(0,u.zY)()],S.prototype,"onInit",1);var x=class extends c.$s{bindTree(e){this.tree=e}getDeps(e){if(!this.tree)return this.transformService.transformDeps([],{scope:e});let t=e.meta.node;if(!t)return this.transformService.transformDeps([],{scope:e});let i=[],r=t;for(;r;){let{parent:n,pre:o}=this.tree.getInfo(r),s=this.getVariableData(r);if(r===t?"public"===e.meta.type&&(null==s?void 0:s.private)&&i.unshift(s.private):this.hasChildren(r)&&!this.isNodeChildrenPrivate(r)&&i.unshift(...this.getAllSortedChildScope(r,{ignoreNodeChildrenPrivate:!0})),s&&r!==t&&i.unshift(s.public),o){r=o;continue}if(n){let e=n,t=this.tree.getPre(e);for(;e;){let r=this.getVariableData(e);if(r&&i.unshift(...r.allScopes),t)break;t=(e=this.tree.getParent(e))?this.tree.getPre(e):void 0}r=t;continue}r=void 0}let n=this.variableEngine.getScopeById(M.ID);return n&&i.unshift(n),this.transformService.transformDeps(i,{scope:e})}getCovers(e){if(!this.tree)return this.transformService.transformCovers([],{scope:e});if(M.is(e)){let t=this.variableEngine.getAllScopes({sort:!0}).filter(e=>!M.is(e));return this.transformService.transformCovers(t,{scope:e})}let t=e.meta.node;if(!t)return this.transformService.transformCovers([],{scope:e});let i=[];if("private"===e.meta.type)return i.push(...this.getAllSortedChildScope(t,{addNodePrivateScope:!0}).filter(t=>t!==e)),this.transformService.transformCovers(i,{scope:e});let r=t;for(;r;){let{next:n,parent:o}=this.tree.getInfo(r),s=this.getVariableData(r);if(r!==t&&(this.hasChildren(r)?i.push(...this.getAllSortedChildScope(r,{addNodePrivateScope:!0})):s&&i.push(...s.allScopes)),n){r=n;continue}if(o){let t=o,n=this.tree.getNext(t);for(;t;){if(this.isNodeChildrenPrivate(t))return this.transformService.transformCovers(i,{scope:e});if(n)break;n=(t=this.tree.getParent(t))?this.tree.getNext(t):void 0}if(!n&&t)break;r=n;continue}r=void 0}return this.transformService.transformCovers(i,{scope:e})}sortAll(){let e=this.flowDocument.getAllNodes().find(e=>e.isStart);if(!e)return[];let t=e.getData(b).public,i=this.getDeps(t),r=this.getCovers(t).filter(e=>!i.includes(e)&&e!==t);return[...i,t,...r]}getVariableData(e){if("virtualNode"!==e.flowNodeType&&!e.id.startsWith("$"))return e.getData(b)}isNodeChildrenPrivate(e){var t,i;return(null==(t=this.configs)?void 0:t.isNodeChildrenPrivate)?!!e&&(null==(i=this.configs)?void 0:i.isNodeChildrenPrivate(e)):!(null==e?void 0:e.id.startsWith("$"))&&this.hasChildren(e)}hasChildren(e){return!!(this.tree&&e&&this.tree.getChildren(e).length>0)}getAllSortedChildScope(e){var t;let{ignoreNodeChildrenPrivate:i,addNodePrivateScope:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],o=this.getVariableData(e);return o&&n.push(o.public),i&&this.isNodeChildrenPrivate(e)||(r&&(null==o?void 0:o.private)&&n.push(o.private),n.push(...((null==(t=this.tree)?void 0:t.getChildren(e))||[]).map(e=>this.getAllSortedChildScope(e,{ignoreNodeChildrenPrivate:i,addNodePrivateScope:r})).flat())),n}constructor(e,t){super(),this.flowDocument=e,this.configs=t,this.bindTree(e.originTree),this.toDispose.push(e.originTree.onTreeChange(()=>{this.refreshAllChange()}))}};function w(e){return e.getData(b).public}function _(e){return e.getData(b).initPrivate()}y([(0,u.f3)(C)],x.prototype,"transformService",2),x=y([m(0,(0,u.f3)(h.pQ)),m(1,(0,u.jt)()),m(1,(0,u.f3)(D))],x);var I=(0,l.M1)({onBind(e,t){let{bind:i}=e,{layout:r,layoutConfig:n,chainConfig:o}=t;i(C).toSelf().inSingletonScope(),"free"===r&&i(c.$s).to(S).inSingletonScope(),"fixed"===r&&i(c.$s).to(x).inSingletonScope(),o?i(D).toConstantValue(o||{}):n&&(console.warn("Layout Config deprecated, use chainConfig instead"),i(D).toConstantValue(n||{})),i(M).toDynamicValue(e=>{let t=e.container.get(c.i2),i=t.getScopeById(M.ID);return i||(i=t.createScope(M.ID,{},{ScopeConstructor:M}),t.chain.refreshAllChange()),i})},onInit(e,t){let{extendASTNodes:i}=t||{},r=e.get(c.i2),n=e.get(c.OI),o=e.get(l.v2),s=e.get(h.pQ);(i||[]).forEach(t=>{if(Array.isArray(t)){let[i,r]=t;n.registerAST(i,r?()=>r(e):void 0);return}n.registerAST(t)}),o.registerEntityData(b,()=>({variableEngine:r})),s.registerNodeDatas(b)},containerModules:[c.gJ]}),L=i(148168),T=i(57064),A=(0,l.M1)({onInit(e,t){e.get(h.pQ).registerNodeDatas(...(0,T.Co)());let i=e=>new s.wL(e);if(e.get(l.v2).registerEntityData(T.Ps,()=>({formModelFactory:i})),!t.materials)return;let r=e.get(T.Bl),n=e.get(T.yf);if(!r||!n)throw Error("NodeCorePlugin Error: nodeManager or formManager not found");!function(e){let{nodeManager:t,formManager:i,material:r}=e,{setters:n=[],decorators:o=[],effects:s=[],validators:a=[],nodeErrorRender:l,nodePlaceholderRender:h}=r;l&&(0,T.kq)(t,l),h&&(0,T.FC)(t,h),n.forEach(e=>{i.registerAbilityExtension(T.Bw.type,e)}),o.forEach(e=>{i.registerAbilityExtension(T.GH.type,e)}),s.forEach(e=>{i.registerAbilityExtension(T.ps.type,e)}),a.forEach(e=>{i.registerAbilityExtension(T.Us.type,e)})}({nodeManager:r,formManager:n,material:t.materials})},onDispose(e){var t;null==(t=e.get(T.yf))||t.dispose()},containerModules:(0,T.pm)()}),O=i(27430),k=(0,l.M1)({onInit:(e,t)=>{t.onLanguageChange&&e.playground.toDispose.push(O.o.onLanguageChange(t.onLanguageChange)),t.languages&&(Array.isArray(t.languages)?O.o.addLanguages(t.languages):O.o.addLanguages(Object.keys(t.languages).map(e=>({languageId:e,contents:t.languages[e]})))),(t.locale||t.localLanguage)&&(O.o.locale=t.locale||t.localLanguage)}}),R=i(755395),P=Object.defineProperty,j=Object.getOwnPropertyDescriptor,z=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?j(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&P(t,i,o),o},V=class{init(){this.devTools&&(this.devTools.init(this.getState()),this.devTools.subscribe(e=>{var t;(null==e||null==(t=e.payload)?void 0:t.type)==="COMMIT"&&this.devTools.init(this.getState())}),this.onInit())}send(e,t){this.devTools&&this.devTools.send(e,t||this.getState())}constructor(){var e;this.devTools=null==(e=window.__REDUX_DEVTOOLS_EXTENSION__)?void 0:e.connect({name:this.getName()})}};z([(0,u.zY)()],V.prototype,"init",1),V=z([(0,u.b2)()],V);var B=class extends V{getName(){return"@flowgram.ai/EntityManager"}getState(){return this.entityManager.storeState({configOnly:!1})}onInit(){this.entityManager.onEntityLifeCycleChange(e=>{this.send(`${e.type}/${e.entity.type}/${e.entity.id}`)})}};z([(0,u.f3)(l.v2)],B.prototype,"entityManager",2),B=z([(0,u.b2)()],B);var F=class extends V{getName(){return"@flowgram.ai/VariableEngine"}getState(){return{scopes:this.scopes,variables:this.variableEngine.globalVariableTable.variables}}getScopeState(e){return{ast:null==e?void 0:e.ast.toJSON(),output:e.output.variables,available:e.available.variables}}onInit(){this.variableEngine.onScopeChange(e=>{let{scope:t,type:i}=e;"delete"===i?delete this.scopes[String(t.id)]:this.scopes={...this.scopes,[t.id]:this.getScopeState(t)},this.send(`${i}/${String(t.id)}`)})}constructor(){super(...arguments),this.scopes={}}};z([(0,u.f3)(c.i2)],F.prototype,"variableEngine",2),F=z([(0,u.b2)()],F);var Y=(0,l.M1)({onBind(e,t){let{bind:i}=e,{enable:r}=t;r&&(i(B).toSelf().inSingletonScope(),i(F).toSelf().inSingletonScope())},onInit(e,t){let{enable:i,ecs:r=!0,variable:n=!1}=t;i&&(r&&e.get(B),n&&e.get(F))}}),U=i(908600),$=e=>{let{children:t}=e,i=(0,l.km)(),r=(0,U.useMemo)(()=>i.getData(b).public,[i]);return U.createElement(c.$Y,{value:{scope:r}},t)},G=e=>t=>U.createElement($,null,U.createElement(e,{...t})),Q=(0,l.M1)({onInit(e){e.get(T.Bl).registerNodeRenderHoc(G)}}),W=e=>{let{children:t}=e,i=(0,l.km)(),r=(0,U.useMemo)(()=>{let e=i.getData(b);return e.private||e.initPrivate(),e.private},[i]);return U.createElement(c.$Y,{value:{scope:r}},t)};function H(e){let t=t=>{let i=t.getData(b);return e.private||"private"===e.scope?i.initPrivate():i.public},i=i=>{let{value:r,context:n}=i;if(!n)return;let{node:o}=n,s=t(o);s.ast.set(e.namespace||"",{kind:c.Hx.VariableDeclarationList,declarations:e.parse(r,{node:o,scope:s,options:e})})};return[{event:s.zE.onValueInit,effect:r=>{var n;let{context:o}=r,s=t(o.node),a=null==(n=e.onInit)?void 0:n.call(e,{node:o.node,scope:s,options:e});a&&s.toDispose.push(a),i(r)}},{event:s.zE.onValueChange,effect:e=>{i(e)}}]}(0,s.CR)({name:"VariableProviderPlugin",onInit:(e,t)=>{},onSetupFormMeta(e){let{mergeEffect:t}=e;t({arr:[{event:s.zE.onValueInitOrChange,effect:()=>{}}]})},onDispose:(e,t)=>{}});var X=(0,l.M1)({onInit(e,t){let i=e.get(d.Rf);i.registerReactComponent(d.kD.NODE_RENDER,t.renderDefaultNode||(()=>null)),t.renderTexts&&i.registerText(t.renderTexts),t.components&&Object.keys(t.components).forEach(e=>i.registerReactComponent(e,t.components[e])),t.renderNodes&&Object.keys(t.renderNodes).forEach(e=>i.registerReactComponent(e,t.renderNodes[e]))}}),J=i(66298),Z=i(969134),K=Object.defineProperty,q=Object.getOwnPropertyDescriptor;function ee(e){var t;if(!e)return;let i=null==e||null==(t=e.getData(T.Ps))?void 0:t.getFormModel();if(i&&(0,s.TH)(i))return i}var et=[{type:"changeFormValues",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:(e,t)=>{let{value:{value:i,path:r,id:n}}=e,o=ee(t.get(h.pQ).getNode(n));o&&(r?o.setValueIn(r,i):o.updateFormValues(i))},shouldMerge:function(e,t,i){if(!t)return!1;if(Date.now()-i.getTimestamp()<500){var r,n,o,s,a,l;return e.type!==t.type||(null==(r=e.value)?void 0:r.id)!==(null==(n=t.value)?void 0:n.id)||(null==(o=e.value)?void 0:o.path)!==(null==(s=t.value)?void 0:s.path)||{type:e.type,value:{...e.value,value:null==(a=e.value)?void 0:a.value,oldValue:null==(l=t.value)?void 0:l.oldValue}}}return!1}}],ei=class{registerOperationMeta(e){et.forEach(t=>{e.registerOperationMeta(t)})}};ei=((e,t,i,r)=>{for(var n,o=r>1?void 0:r?q(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&K(t,i,o),o})([(0,u.b2)()],ei);var er=(0,l.M1)({onBind:e=>{let{bind:t}=e;(0,l.KV)(t,ei,[J.FU])},onInit:(e,t)=>{let i=e.get(h.pQ),r=e.get(J.qp);i.onNodeCreate(e=>{let{node:t}=e,i=ee(t);i&&i.onFormValuesChange(e=>{r.pushOperation({type:"changeFormValues",value:{id:t.id,path:e.name,value:e.name?(0,Z.Z)(e.values,e.name):e.values,oldValue:e.name?(0,Z.Z)(e.prevValues,e.name):e.prevValues}},{noApply:!0})})})},containerModules:[J.Xn]}),en=i(309844),eo=Object.defineProperty,es=Object.getOwnPropertyDescriptor,ea=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?es(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&eo(t,i,o),o};(n||(n={})).DEFAULT={background:{}};var el="flowide-highlight",eh=`
@keyframes flowide-fade {
  from {
   opacity: 1.0;
  }
  to {
    opacity: 0;
  }
}
@-webkit-keyframes flowide-fade {
  from {
   opacity: 1.0;
  }
  to {
    opacity: 0;
  }
}
.${el} {
  background-color: rgba(238, 245, 40, 0.5);
  animation: flowide-fade 2s 1 forwards;
  -webkit-animation: flowide-fade 2s 1 forwards;
}
`,ed=class{highlightNodeFormItem(e,t){this.previousOverlay=function(e,t){let i=e.formModel.flowNodeEntity.getData(h.Lz).node,r=e.domRef.current;if(!r)return;let n=document.createElement("div"),{padding:o=0,overlayClassName:s}=t||{};n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="9999",i.appendChild(n);let a=i.getBoundingClientRect(),l=r.getBoundingClientRect();return n.style.top=l.top-a.top-o+"px",n.style.left=l.left-a.left-o+"px",n.style.width=l.width+2*o+"px",n.style.height=l.height+2*o+"px",n.className=s||el,setTimeout(()=>{n.remove()},2e3),n}(e,t)}focusNodeFormItem(e,t){let i=e.formModel.flowNodeEntity,{canvas:r={},highlight:n}=t||{};this.previousOverlay&&(this.previousOverlay.remove(),this.previousOverlay=void 0);let o=this.playground.scrollToView({entities:[i],scrollToCenter:!0,...r}).then(()=>{e&&n&&this.currentPromise===o&&this.highlightNodeFormItem(e,"boolean"==typeof n?{}:n)});return this.currentPromise=o,this.currentPromise}};ea([(0,u.f3)(l.XQ)],ed.prototype,"playground",2),ed=ea([(0,u.b2)()],ed);var eu=class{};ea([(0,u.f3)(ed)],eu.prototype,"nodeFocusService",2),eu=ea([(0,u.b2)()],eu);var ec=(0,l.M1)({onInit(){o||((o=document.createElement("style")).innerHTML=eh,document.head.appendChild(o))},onDispose(){null==o||o.remove(),o=void 0}}),eg=(0,l.M1)({onBind(e){let{bind:t}=e;t(ed).toSelf().inSingletonScope(),t(eu).toSelf().inSingletonScope()}}),ep=class{focusNodeFormItem(e,t){this.nodeClient.nodeFocusService.focusNodeFormItem(e,t)}focusNode(e,t){this.playground.scrollToView({entities:[e],...t})}};ea([(0,u.f3)(eu)],ep.prototype,"nodeClient",2),ea([(0,u.f3)(l.XQ)],ep.prototype,"playground",2),ep=ea([(0,u.b2)()],ep);var ef=(0,l.M1)({onBind(e){let{bind:t}=e;t(ep).toSelf().inSingletonScope()}});function ey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return i=>{var r,o,s;(e={...n.DEFAULT,...e}).i18n&&t.push(k(e.i18n)),t.push(ec({}),eg({}),ef({})),(null==(r=e.reduxDevTool)?void 0:r.enable)&&t.push(Y(e.reduxDevTool));let a=[h.d1,d.qf];return t.push(X(e.materials||{})),e.nodeEngine&&!1!==e.nodeEngine.enable&&(t.push(A({materials:e.nodeEngine.materials})),(null==(o=e.variableEngine)?void 0:o.enable)&&t.push(Q({})),(null==(s=e.history)?void 0:s.enable)&&t.push(er({}))),t.push((0,l.d3)({onInit:t=>{e.nodeRegistries&&t.document.registerFlowNodes(...e.nodeRegistries),e.constants&&(t.document.options.constants=e.constants),e.getNodeDefaultRegistry&&(t.document.options.getNodeDefaultRegistry=e.getNodeDefaultRegistry),t.get(d.Rf).init()},onReady(t){e.initialData&&t.document.fromJSON(e.initialData),e.readonly&&(t.playground.config.readonly=e.readonly),t.document.load().then(()=>{e.onLoad&&e.onLoad(t)})},onDispose(e){e.document.dispose()},containerModules:a})),t}}},640898:function(e,t,i){i.d(t,{f3M:()=>o.f3M,qRT:()=>o.qRT,fin:()=>o.fin,xFV:()=>o.xFV,bQo:()=>tl,Jbc:()=>eK.Jb,kmj:()=>o.kmj,QW0:()=>s.QW,zEJ:()=>o.zEJ,Z14:()=>s.Z1,e2M:()=>s.e2,VOn:()=>o.VOn,IxS:()=>tu,SPu:()=>s.SP,qpv:()=>l.qp,SyX:()=>o.SyX,HoL:()=>o.HoL,Nj8:()=>l.Nj,ERL:()=>o.ERL,z2R:()=>o.z2R,n2P:()=>s.n2,x0q:()=>s.x0,sX$:()=>tp,b2C:()=>o.b2C,XQj:()=>o.XQj,AeJ:()=>o.AeJ,F26:()=>o.F26,v2K:()=>o.v2K,XHk:()=>s.XH,erw:()=>tf,Dcz:()=>o.Dcz,gw0:()=>o.gw0,dmf:()=>s.dm,iwM:()=>s.iw,R6T:()=>o.R6T,VDr:()=>o.VDr,PFB:()=>s.PF,eGM:()=>o.eGM,L4w:()=>s.L4,gNt:()=>o.gNt,C$T:()=>o.C$T,rQR:()=>o.rQR,Psq:()=>o.Psq,oci:()=>o.oci,G2Z:()=>o.G2Z,Q5$:()=>o.Q5$,PVB:()=>s.PV,M1y:()=>o.M1y,EhS:()=>td,qoQ:()=>o.qoQ,UJL:()=>o.UJL,CTO:()=>s.CT,oJU:()=>s.oJ,JAk:()=>o.JAk,CMu:()=>o.CMu,l09:()=>o.l09,mh4:()=>o.mh4}),i(543789);var r,n,o=i(950454),s=i(288216),a=i(908600),l=i(201063),h=i(461932),d=i(66298),u=i(308387),c=i(893740),g=i(579962),p=Object.defineProperty,f=Object.getOwnPropertyDescriptor,y=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?f(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&p(t,i,o),o},m=class{dequeue(){let e=this._sentinel,t=e._prev;if(t!==e)return E(t),t}enqueue(e){let t=this._sentinel;e._prev&&e._next&&E(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t}toString(){let e=[],t=this._sentinel,i=t._prev;for(;i!==t;)e.push(JSON.stringify(i,b)),i=i._prev;return"["+e.join(", ")+"]"}constructor(){let e={};e._next=e._prev=e,this._sentinel=e}};function E(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function b(e,t){if("_next"!==e&&"_prev"!==e)return t}var D=()=>1;function N(e,t,i,r,n){let o=n?[]:void 0;return e.inEdges(r.v).forEach(r=>{let s=e.edge(r),a=e.node(r.v);n&&o.push({v:r.v,w:r.w}),a.out-=s,C(t,i,a)}),e.outEdges(r.v).forEach(r=>{let n=e.edge(r),o=r.w,s=e.node(o);s.in-=n,C(t,i,s)}),e.removeNode(r.v),o}function C(e,t,i){i.out?i.in?e[i.out-i.in+t].enqueue(i):e[e.length-1].enqueue(i):e[0].enqueue(i)}var M={addBorderNode:function(e,t,i,r){let n={width:0,height:0};return arguments.length>=4&&(n.rank=i,n.order=r),S(e,"border",n,t)},addDummyNode:S,applyWithChunking:I,asNonCompoundGraph:function(e){let t=new u.Graph({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(i=>{e.children(i).length||t.setNode(i,e.node(i))}),e.edges().forEach(i=>{t.setEdge(i,e.edge(i))}),t},buildLayerMatrix:function(e){let t=O(L(e)+1).map(()=>[]);return e.nodes().forEach(i=>{let r=e.node(i),n=r.rank;void 0!==n&&(t[n][r.order]=i)}),t},intersectRect:function(e,t){let i,r,n=e.x,o=e.y,s=t.x-n,a=t.y-o,l=e.width/2,h=e.height/2;if(!s&&!a)throw Error("Not possible to find intersection inside of the rectangle");return Math.abs(a)*l>Math.abs(s)*h?(a<0&&(h=-h),i=h*s/a,r=h):(s<0&&(l=-l),i=l,r=l*a/s),{x:n+i,y:o+r}},mapValues:function(e,t){let i=t;return"string"==typeof t&&(i=e=>e[t]),Object.entries(e).reduce((e,t)=>{let[r,n]=t;return e[r]=i(n,r),e},{})},maxRank:L,normalizeRanks:w,notime:function(e,t){return t()},partition:function(e,t){let i={lhs:[],rhs:[]};return e.forEach(e=>{t(e)?i.lhs.push(e):i.rhs.push(e)}),i},pick:function(e,t){let i={};for(let r of t)void 0!==e[r]&&(i[r]=e[r]);return i},predecessorWeights:function(e){let t=e.nodes().map(t=>{let i={};return e.inEdges(t).forEach(t=>{i[t.v]=(i[t.v]||0)+e.edge(t).weight}),i});return k(e.nodes(),t)},range:O,removeEmptyRanks:_,simplify:x,successorWeights:function(e){let t=e.nodes().map(t=>{let i={};return e.outEdges(t).forEach(t=>{i[t.w]=(i[t.w]||0)+e.edge(t).weight}),i});return k(e.nodes(),t)},time:function(e,t){let i=Date.now();try{return t()}finally{console.log(e+" time: "+(Date.now()-i)+"ms")}},uniqueId:A,zipObject:k};function S(e,t,i,r){let n;do n=A(r);while(e.hasNode(n));return i.dummy=t,e.setNode(n,i),n}function x(e){let t=new u.Graph().setGraph(e.graph());return e.nodes().forEach(i=>t.setNode(i,e.node(i))),e.edges().forEach(i=>{let r=t.edge(i.v,i.w)||{weight:0,minlen:1},n=e.edge(i);t.setEdge(i.v,i.w,{weight:r.weight+n.weight,minlen:Math.max(r.minlen,n.minlen)})}),t}function w(e){let t=I(Math.min,e.nodes().map(t=>{let i=e.node(t).rank;return void 0===i?Number.MAX_VALUE:i}));e.nodes().forEach(i=>{let r=e.node(i);Object.hasOwn(r,"rank")&&(r.rank-=t)})}function _(e){let t=I(Math.min,e.nodes().map(t=>e.node(t).rank)),i=[];e.nodes().forEach(r=>{let n=e.node(r).rank-t;i[n]||(i[n]=[]),i[n].push(r)});let r=0,n=e.graph().nodeRankFactor;Array.from(i).forEach((t,i)=>{void 0===t&&i%n!=0?--r:void 0!==t&&r&&t.forEach(t=>e.node(t).rank+=r)})}function I(e,t){if(!(t.length>65535))return e.apply(null,t);{let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:65535,i=[];for(let r=0;r<e.length;r+=t){let n=e.slice(r,r+t);i.push(n)}return i}(t);return e.apply(null,i.map(t=>e.apply(null,t)))}}function L(e){return I(Math.max,e.nodes().map(t=>{let i=e.node(t).rank;return void 0===i?5e-324:i}))}var T=0;function A(e){var t=++T;return toString(e)+t}function O(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;null==t&&(t=e,e=0);let r=e=>e<t;i<0&&(r=e=>t<e);let n=[];for(let t=e;r(t);t+=i)n.push(t);return n}function k(e,t){return e.reduce((e,i,r)=>(e[i]=t[r],e),{})}function R(e){var t={};e.sources().forEach(function i(r){var n=e.node(r);if(Object.hasOwn(t,r))return n.rank;t[r]=!0;var o=I(Math.min,e.outEdges(r).map(t=>null==t?1/0:i(t.w)-e.edge(t).minlen));return o===1/0&&(o=0),n.rank=o})}function P(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}function j(e){var t,i,r,n,o=new u.Graph({directed:!1}),s=e.nodes()[0],a=e.nodeCount();for(o.setNode(s,{});t=o,i=e,t.nodes().forEach(function e(r){i.nodeEdges(r).forEach(n=>{var o=n.v,s=r===o?n.w:o;t.hasNode(s)||P(i,n)||(t.setNode(s,{}),t.setEdge(r,s,{}),e(s))})}),t.nodeCount()<a;)r=function(e,t){return t.edges().reduce((i,r)=>{let n=1/0;return(e.hasNode(r.v)!==e.hasNode(r.w)&&(n=P(t,r)),n<i[0])?[n,r]:i},[1/0,null])[1]}(o,e),n=o.hasNode(r.v)?P(e,r):-P(e,r),function(e,t,i){e.nodes().forEach(e=>t.node(e).rank+=i)}(o,e,n);return o}var{preorder:z,postorder:V}=u.alg;function B(e){R(e=x(e));var t,i,r=j(e);for(U(r),F(r,e);t=$(r);)i=G(r,e,t),Q(r,e,t,i)}function F(e,t){var i=V(e,e.nodes());(i=i.slice(0,i.length-1)).forEach(i=>{var r,n,o,s;return r=e,n=t,o=i,s=r.node(o).parent,void(r.edge(o,s).cutvalue=Y(r,n,o))})}function Y(e,t,i){var r=e.node(i).parent,n=!0,o=t.edge(i,r),s=0;return o||(n=!1,o=t.edge(r,i)),s=o.weight,t.nodeEdges(i).forEach(o=>{var a=o.v===i,l=a?o.w:o.v;if(l!==r){var h,d,u,c=a===n,g=t.edge(o).weight;if(s+=c?g:-g,h=e,d=i,u=l,h.hasEdge(d,u)){var p=e.edge(i,l).cutvalue;s+=c?-p:p}}}),s}function U(e,t){arguments.length<2&&(t=e.nodes()[0]),function e(t,i,r,n,o){var s=r,a=t.node(n);return i[n]=!0,t.neighbors(n).forEach(o=>{Object.hasOwn(i,o)||(r=e(t,i,r,o,n))}),a.low=s,a.lim=r++,o?a.parent=o:delete a.parent,r}(e,{},1,t)}function $(e){return e.edges().find(t=>e.edge(t).cutvalue<0)}function G(e,t,i){var r=i.v,n=i.w;t.hasEdge(r,n)||(r=i.w,n=i.v);var o=e.node(r),s=e.node(n),a=o,l=!1;return o.lim>s.lim&&(a=s,l=!0),t.edges().filter(t=>l===W(e,e.node(t.v),a)&&l!==W(e,e.node(t.w),a)).reduce((e,i)=>P(t,i)<P(t,e)?i:e)}function Q(e,t,i,r){var n,o,s,a,l=i.v,h=i.w;e.removeEdge(l,h),e.setEdge(r.v,r.w,{}),U(e),F(e,t),n=e,o=t,s=n.nodes().find(e=>!o.node(e).parent),(a=(a=z(n,s)).slice(1)).forEach(e=>{var t=n.node(e).parent,i=o.edge(e,t),r=!1;i||(i=o.edge(t,e),r=!0),o.node(e).rank=o.node(t).rank+(r?i.minlen:-i.minlen)})}function W(e,t,i){return i.low<=t.lim&&t.lim<=i.lim}B.initLowLimValues=U,B.initCutValues=F,B.calcCutValue=Y,B.leaveEdge=$,B.enterEdge=G,B.exchangeEdges=Q;var H=R;function X(e,t,i,r,n,o){let s=n[t][o-1],a=M.addDummyNode(e,"border",{width:0,height:0,rank:o,borderType:t},i);n[t][o]=a,e.setParent(a,r),s&&e.setEdge(s,a,{weight:1})}function J(e){e.nodes().forEach(t=>Z(e.node(t))),e.edges().forEach(t=>Z(e.edge(t)))}function Z(e){let t=e.width;e.width=e.height,e.height=t}function K(e){e.y=-e.y}function q(e){let t=e.x;e.x=e.y,e.y=t}var ee=function(e,t){let i=0;for(let r=1;r<t.length;++r)i+=function(e,t,i){let r=k(i,i.map((e,t)=>t)),n=t.flatMap(t=>e.outEdges(t).map(t=>({pos:r[t.w],weight:e.edge(t).weight})).sort((e,t)=>e.pos-t.pos)),o=1;for(;o<i.length;)o<<=1;let s=2*o-1;o-=1;let a=Array(s).fill(0),l=0;return n.forEach(e=>{let t=e.pos+o;a[t]+=e.weight;let i=0;for(;t>0;)t%2&&(i+=a[t+1]),t=t-1>>1,a[t]+=e.weight;l+=e.weight*i}),l}(e,t[r-1],t[r]);return i};function et(e,t,i){let r;for(;t.length&&(r=t[t.length-1]).i<=i;)t.pop(),e.push(r.vs),i++;return i}function ei(e,t,i){return t.map(function(t){var r,n,o;let s,a;return r=e,n=t,o=i,s=function(e){for(var t;e.hasNode(t=M.uniqueId("_root")););return t}(r),a=new u.Graph({compound:!0}).setGraph({root:s}).setDefaultNodeLabel(e=>r.node(e)),r.nodes().forEach(e=>{let t=r.node(e),i=r.parent(e);(t.rank===n||t.minRank<=n&&n<=t.maxRank)&&(a.setNode(e),a.setParent(e,i||s),r[o](e).forEach(t=>{let i=t.v===e?t.w:t.v,n=a.edge(i,e),o=void 0!==n?n.weight:0;a.setEdge(i,e,{weight:r.edge(t).weight+o})}),Object.hasOwn(t,"minRank")&&a.setNode(e,{borderLeft:t.borderLeft[n],borderRight:t.borderRight[n]}))}),a})}function er(e,t){Object.values(t).forEach(t=>t.forEach((t,i)=>e.node(t).order=i))}function en(e,t,i){if(t>i){let e=t;t=i,i=e}let r=e[t];r||(e[t]=r={}),r[i]=!0}var eo=["nodesep","edgesep","ranksep","marginx","marginy"],es={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},ea=["acyclicer","ranker","rankdir","align"],el=["width","height"],eh={width:0,height:0},ed=["minlen","weight","width","height","labeloffset"],eu={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},ec=["labelpos"];function eg(e,t){return M.mapValues(M.pick(e,t),Number)}function ep(e){var t={};return e&&Object.entries(e).forEach(e=>{let[i,r]=e;"string"==typeof i&&(i=i.toLowerCase()),t[i]=r}),t}var ef=function(e){let t=new u.Graph({multigraph:!0,compound:!0}),i=ep(e.graph());return t.setGraph(Object.assign({},es,eg(i,eo),M.pick(i,ea))),e.nodes().forEach(i=>{let r=eg(ep(e.node(i)),el);Object.keys(eh).forEach(e=>{void 0===r[e]&&(r[e]=eh[e])}),t.setNode(i,r),t.setParent(i,e.parent(i))}),e.edges().forEach(i=>{let r=ep(e.edge(i));t.setEdge(i,Object.assign({},eu,eg(r,ed),M.pick(r,ec)))}),t},ey=function(e,t){e.nodes().forEach(i=>{let r=e.node(i),n=t.node(i);r&&(r.x=n.x,r.y=n.y,r.rank=n.rank,t.children(i).length&&(r.width=n.width,r.height=n.height))}),e.edges().forEach(i=>{let r=e.edge(i),n=t.edge(i);r.points=n.points,Object.hasOwn(n,"x")&&(r.x=n.x,r.y=n.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},em=function(e){let t=e.graph();t.ranksep/=2,e.edges().forEach(i=>{let r=e.edge(i);r.minlen*=2,"c"!==r.labelpos.toLowerCase()&&("TB"===t.rankdir||"BT"===t.rankdir?r.width+=r.labeloffset:r.height+=r.labeloffset)})},ev=function(e){e.edges().forEach(t=>{if(t.v===t.w){var i=e.node(t.v);i.selfEdges||(i.selfEdges=[]),i.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})},eE=function(e){var t,i;let r,n,o;("greedy"===e.graph().acyclicer?function(e,t){var i,r;let n,o,s,a,l;if(1>=e.nodeCount())return[];let h=(i=e,r=t||D,n=new u.Graph,o=0,s=0,i.nodes().forEach(e=>{n.setNode(e,{v:e,in:0,out:0})}),i.edges().forEach(e=>{let t=n.edge(e.v,e.w)||0,i=r(e);n.setEdge(e.v,e.w,t+i),s=Math.max(s,n.node(e.v).out+=i),o=Math.max(o,n.node(e.w).in+=i)}),a=(function(e){let t=[];for(let i=0;i<e;i++)t.push(i);return t})(s+o+3).map(()=>new m),l=o+1,n.nodes().forEach(e=>{C(a,l,n.node(e))}),{graph:n,buckets:a,zeroIdx:l});return(function(e,t,i){let r,n=[],o=t[t.length-1],s=t[0];for(;e.nodeCount();){for(;r=s.dequeue();)N(e,t,i,r);for(;r=o.dequeue();)N(e,t,i,r);if(e.nodeCount()){for(let o=t.length-2;o>0;--o)if(r=t[o].dequeue()){n=n.concat(N(e,t,i,r,!0));break}}}return n})(h.graph,h.buckets,h.zeroIdx).flatMap(t=>e.outEdges(t.v,t.w))}(e,(t=e,e=>t.edge(e).weight)):(r=[],n={},o={},(i=e).nodes().forEach(function e(t){Object.hasOwn(o,t)||(o[t]=!0,n[t]=!0,i.outEdges(t).forEach(t=>{Object.hasOwn(n,t.w)?r.push(t):e(t.w)}),delete n[t])}),r)).forEach(t=>{let i=e.edge(t);e.removeEdge(t),i.forwardName=t.name,i.reversed=!0,e.setEdge(t.w,t.v,i,A("rev"))})},eb=function(e){e.edges().forEach(t=>{let i=e.edge(t);if(i.reversed){e.removeEdge(t);let r=i.forwardName;delete i.reversed,delete i.forwardName,e.setEdge(t.w,t.v,i,r)}})},eD=function(e){var t,i,r;let n=M.addDummyNode(e,"root",{},"_root"),o=(i={},(t=e).children().forEach(e=>(function e(r,n){var o=t.children(r);o&&o.length&&o.forEach(t=>e(t,n+1)),i[r]=n})(e,1)),i),s=Object.values(o),a=M.applyWithChunking(Math.max,s)-1,l=2*a+1;e.graph().nestingRoot=n,e.edges().forEach(t=>e.edge(t).minlen*=l);let h=(r=e).edges().reduce((e,t)=>e+r.edge(t).weight,0)+1;e.children().forEach(t=>(function e(t,i,r,n,o,s,a){let l=t.children(a);if(!l.length){a!==i&&t.setEdge(i,a,{weight:0,minlen:r});return}let h=M.addBorderNode(t,"_bt"),d=M.addBorderNode(t,"_bb"),u=t.node(a);t.setParent(h,a),u.borderTop=h,t.setParent(d,a),u.borderBottom=d,l.forEach(l=>{e(t,i,r,n,o,s,l);let u=t.node(l),c=u.borderTop?u.borderTop:l,g=u.borderBottom?u.borderBottom:l,p=u.borderTop?n:2*n,f=c!==g?1:o-s[a]+1;t.setEdge(h,c,{weight:p,minlen:f,nestingEdge:!0}),t.setEdge(g,d,{weight:p,minlen:f,nestingEdge:!0})}),t.parent(a)||t.setEdge(i,h,{weight:0,minlen:o+s[a]})})(e,n,l,h,a,o,t)),e.graph().nodeRankFactor=l},eN=function(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(t=>{e.edge(t).nestingEdge&&e.removeEdge(t)})},eC=function(e){switch(e.graph().ranker){case"network-simplex":default:B(e);break;case"tight-tree":var t;R(t=e),j(t);break;case"longest-path":H(e)}},eM=function(e){e.edges().forEach(t=>{let i=e.edge(t);if(i.width&&i.height){let i=e.node(t.v),r={rank:(e.node(t.w).rank-i.rank)/2+i.rank,e:t};M.addDummyNode(e,"edge-proxy",r,"_ep")}})},eS=function(e){let t=0;e.nodes().forEach(i=>{let r=e.node(i);r.borderTop&&(r.minRank=e.node(r.borderTop).rank,r.maxRank=e.node(r.borderBottom).rank,t=Math.max(t,r.maxRank))}),e.graph().maxRank=t},ex=function(e){e.nodes().forEach(t=>{let i=e.node(t);"edge-proxy"===i.dummy&&(e.edge(i.e).labelRank=i.rank,e.removeNode(t))})},ew=function(e){e.graph().dummyChains=[],e.edges().forEach(t=>(function(e,t){let i,r,n,o=t.v,s=e.node(o).rank,a=t.w,l=e.node(a).rank,h=t.name,d=e.edge(t),u=d.labelRank;if(l!==s+1){for(e.removeEdge(t),n=0,++s;s<l;++n,++s)d.points=[],r={width:0,height:0,edgeLabel:d,edgeObj:t,rank:s},i=M.addDummyNode(e,"edge",r,"_d"),s===u&&(r.width=d.width,r.height=d.height,r.dummy="edge-label",r.labelpos=d.labelpos),e.setEdge(o,i,{weight:d.weight},h),0===n&&e.graph().dummyChains.push(i),o=i;e.setEdge(o,a,{weight:d.weight},h)}})(e,t))},e_=function(e){e.graph().dummyChains.forEach(t=>{let i,r=e.node(t),n=r.edgeLabel;for(e.setEdge(r.edgeObj,n);r.dummy;)i=e.successors(t)[0],e.removeNode(t),n.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height),t=i,r=e.node(t)})},eI=function(e){var t;let i,r,n=(i={},r=0,(t=e).children().forEach(function e(n){let o=r;t.children(n).forEach(e),i[n]={low:o,lim:r++}}),i);e.graph().dummyChains.forEach(t=>{let i=e.node(t),r=i.edgeObj,o=function(e,t,i,r){let n,o,s=[],a=[],l=Math.min(t[i].low,t[r].low),h=Math.max(t[i].lim,t[r].lim);n=i;do s.push(n=e.parent(n));while(n&&(t[n].low>l||h>t[n].lim));for(o=n,n=r;(n=e.parent(n))!==o;)a.push(n);return{path:s.concat(a.reverse()),lca:o}}(e,n,r.v,r.w),s=o.path,a=o.lca,l=0,h=s[0],d=!0;for(;t!==r.w;){if(i=e.node(t),d){for(;(h=s[l])!==a&&e.node(h).maxRank<i.rank;)l++;h===a&&(d=!1)}if(!d){for(;l<s.length-1&&e.node(h=s[l+1]).minRank<=i.rank;)l++;h=s[l]}e.setParent(t,h),t=e.successors(t)[0]}})},eL=function(e){e.children().forEach(function t(i){let r=e.children(i),n=e.node(i);if(r.length&&r.forEach(t),Object.hasOwn(n,"minRank")){n.borderLeft=[],n.borderRight=[];for(let t=n.minRank,r=n.maxRank+1;t<r;++t)X(e,"borderLeft","_bl",i,n,t),X(e,"borderRight","_br",i,n,t)}})},eT=function e(t,i){var r;let n,o,s,a,l;if(i&&"function"==typeof i.customOrder)return void i.customOrder(t,e);let h=M.maxRank(t),d=ei(t,M.range(1,h+1),"inEdges"),c=ei(t,M.range(h-1,-1,-1),"outEdges"),g=(n={},s=(o=(r=t).nodes().filter(e=>!r.children(e).length)).map(e=>r.node(e).rank),a=M.applyWithChunking(Math.max,s),l=M.range(a+1).map(()=>[]),o.sort((e,t)=>r.node(e).rank-r.node(t).rank).forEach(function e(t){n[t]||(n[t]=!0,l[r.node(t).rank].push(t),r.successors(t).forEach(e))}),l);if(er(t,g),i&&i.disableOptimalOrderHeuristic)return;let p=1/0,f;for(let e=0,i=0;i<4;++e,++i){(function(e,t){let i=new u.Graph;e.forEach(function(e){let r=e.graph().root,n=function e(t,i,r,n){let o=t.children(i),s=t.node(i),a=s?s.borderLeft:void 0,l=s?s.borderRight:void 0,h={};a&&(o=o.filter(e=>e!==a&&e!==l));let d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map(t=>{let i=e.inEdges(t);if(!i.length)return{v:t};{let r=i.reduce((t,i)=>{let r=e.edge(i),n=e.node(i.v);return{sum:t.sum+r.weight*n.order,weight:t.weight+r.weight}},{sum:0,weight:0});return{v:t,barycenter:r.sum/r.weight,weight:r.weight}}})}(t,o);d.forEach(i=>{if(t.children(i.v).length){var o,s;let a=e(t,i.v,r,n);h[i.v]=a,Object.hasOwn(a,"barycenter")&&(o=i,s=a,void 0!==o.barycenter?(o.barycenter=(o.barycenter*o.weight+s.barycenter*s.weight)/(o.weight+s.weight),o.weight+=s.weight):(o.barycenter=s.barycenter,o.weight=s.weight))}});let u=function(e,t){let i={};return e.forEach((e,t)=>{let r=i[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};void 0!==e.barycenter&&(r.barycenter=e.barycenter,r.weight=e.weight)}),t.edges().forEach(e=>{let t=i[e.v],r=i[e.w];void 0!==t&&void 0!==r&&(r.indegree++,t.out.push(i[e.w]))}),function(e){let t=[];for(;e.length;){let i=e.pop();t.push(i),i.in.reverse().forEach(function(e){return t=>{!t.merged&&(void 0===t.barycenter||void 0===e.barycenter||t.barycenter>=e.barycenter)&&function(e,t){let i=0,r=0;e.weight&&(i+=e.barycenter*e.weight,r+=e.weight),t.weight&&(i+=t.barycenter*t.weight,r+=t.weight),e.vs=t.vs.concat(e.vs),e.barycenter=i/r,e.weight=r,e.i=Math.min(t.i,e.i),t.merged=!0}(e,t)}}(i)),i.out.forEach(function(t){return i=>{i.in.push(t),0==--i.indegree&&e.push(i)}}(i))}return t.filter(e=>!e.merged).map(e=>M.pick(e,["vs","i","barycenter","weight"]))}(Object.values(i).filter(e=>!e.indegree))}(d,r);!function(e,t){e.forEach(e=>{e.vs=e.vs.flatMap(e=>t[e]?t[e].vs:e)})}(u,h);let c=function(e,t){let i=M.partition(e,e=>Object.hasOwn(e,"barycenter")),r=i.lhs,n=i.rhs.sort((e,t)=>t.i-e.i),o=[],s=0,a=0,l=0;r.sort(function(e){return(t,i)=>t.barycenter<i.barycenter?-1:t.barycenter>i.barycenter?1:e?i.i-t.i:t.i-i.i}(!!t)),l=et(o,n,l),r.forEach(e=>{l+=e.vs.length,o.push(e.vs),s+=e.barycenter*e.weight,a+=e.weight,l=et(o,n,l)});let h={vs:o.flat(!0)};return a&&(h.barycenter=s/a,h.weight=a),h}(u,n);if(a&&(c.vs=[a,c.vs,l].flat(!0),t.predecessors(a).length)){let e=t.node(t.predecessors(a)[0]),i=t.node(t.predecessors(l)[0]);Object.hasOwn(c,"barycenter")||(c.barycenter=0,c.weight=0),c.barycenter=(c.barycenter*c.weight+e.order+i.order)/(c.weight+2),c.weight+=2}return c}(e,r,i,t);n.vs.forEach((t,i)=>e.node(t).order=i),function(e,t,i){let r={},n;i.forEach(i=>{let o=e.parent(i),s,a;for(;o;){if((s=e.parent(o))?(a=r[s],r[s]=o):(a=n,n=o),a&&a!==o)return void t.setEdge(a,o);o=s}})}(e,i,n.vs)})})(e%2?d:c,e%4>=2),g=M.buildLayerMatrix(t);let r=ee(t,g);r<p&&(i=0,f=Object.assign({},g),p=r)}er(t,f)},eA=function(e){M.buildLayerMatrix(e).forEach(t=>{var i=0;t.forEach((t,r)=>{var n=e.node(t);n.order=r+i,(n.selfEdges||[]).forEach(t=>{M.addDummyNode(e,"selfedge",{width:t.label.width,height:t.label.height,rank:n.rank,order:r+ ++i,e:t.e,label:t.label},"_se")}),delete n.selfEdges})})},eO=function(e){let t=e.graph().rankdir.toLowerCase();("lr"===t||"rl"===t)&&J(e)},ek=function(e){var t,i;let r=e.graph().rankdir.toLowerCase();("bt"===r||"rl"===r)&&((t=e).nodes().forEach(e=>K(t.node(e))),t.edges().forEach(e=>{let i=t.edge(e);i.points.forEach(K),Object.hasOwn(i,"y")&&K(i)})),("lr"===r||"rl"===r)&&((i=e).nodes().forEach(e=>q(i.node(e))),i.edges().forEach(e=>{let t=i.edge(e);t.points.forEach(q),Object.hasOwn(t,"x")&&q(t)}),J(e))},eR=function(e){var t,i,r;let n,o,s,a,l,h,d,c,g,p,f,y;r=e=M.asNonCompoundGraph(e),p=M.buildLayerMatrix(r),f=r.graph().ranksep,y=0,p.forEach(e=>{let t=e.reduce((e,t)=>{let i=r.node(t).height;return e>i?e:i},0);e.forEach(e=>r.node(e).y=y+t/2),y+=t+f}),Object.entries((t=e,o=M.buildLayerMatrix(t),a=Object.assign((s={},o.length&&o.reduce(function(e,i){let r=0,n=0,o=e.length,a=i[i.length-1];return i.forEach((e,l)=>{let h=function(e,t){if(e.node(t).dummy)return e.predecessors(t).find(t=>e.node(t).dummy)}(t,e),d=h?t.node(h).order:o;(h||e===a)&&(i.slice(n,l+1).forEach(e=>{t.predecessors(e).forEach(i=>{let n=t.node(i),o=n.order;(o<r||d<o)&&!(n.dummy&&t.node(e).dummy)&&en(s,i,e)})}),n=l+1,r=d)}),i}),s),function(e,t){let i={};function r(t,r,n,o,s){let a;M.range(r,n).forEach(r=>{a=t[r],e.node(a).dummy&&e.predecessors(a).forEach(t=>{let r=e.node(t);r.dummy&&(r.order<o||r.order>s)&&en(i,t,a)})})}return t.length&&t.reduce(function(t,i){let n=-1,o,s=0;return i.forEach((a,l)=>{if("border"===e.node(a).dummy){let t=e.predecessors(a);t.length&&(o=e.node(t[0]).order,r(i,s,l,n,o),s=l,n=o)}r(i,s,i.length,o,t.length)}),i}),i}(t,o)),l={},["u","d"].forEach(e=>{n="u"===e?o:Object.values(o).reverse(),["l","r"].forEach(i=>{var r;let o,s,h;"r"===i&&(n=n.map(e=>Object.values(e).reverse()));let d=("u"===e?t.predecessors:t.successors).bind(t),c=(o={},s={},h={},(r=n).forEach(e=>{e.forEach((e,t)=>{o[e]=e,s[e]=e,h[e]=t})}),r.forEach(e=>{let t=-1;e.forEach(e=>{let i=d(e);if(i.length){let r=((i=i.sort((e,t)=>h[e]-h[t])).length-1)/2;for(let n=Math.floor(r),l=Math.ceil(r);n<=l;++n){let r=i[n];s[e]===e&&t<h[r]&&!function(e,t,i){if(t>i){let e=t;t=i,i=e}return!!e[t]&&Object.hasOwn(e[t],i)}(a,e,r)&&(s[r]=e,s[e]=o[e]=o[r],t=h[r])}}})}),{root:o,align:s}),g=function(e,t,i,r,n){var o,s,a,l,h,d,c;let g,p,f,y={},m=(o=e,s=t,a=i,l=n,g=new u.Graph,f=(h=(p=o.graph()).nodesep,d=p.edgesep,c=l,(e,t,i)=>{let r,n,o=e.node(t),s=e.node(i);if(r=0+o.width/2,Object.hasOwn(o,"labelpos"))switch(o.labelpos.toLowerCase()){case"l":n=-o.width/2;break;case"r":n=o.width/2}if(n&&(r+=c?n:-n),n=0,r+=(o.dummy?d:h)/2,r+=(s.dummy?d:h)/2,r+=s.width/2,Object.hasOwn(s,"labelpos"))switch(s.labelpos.toLowerCase()){case"l":n=s.width/2;break;case"r":n=-s.width/2}return n&&(r+=c?n:-n),n=0,r}),s.forEach(e=>{let t;e.forEach(e=>{let i=a[e];if(g.setNode(i),t){var r=a[t],n=g.edge(r,i);g.setEdge(r,i,Math.max(f(o,e,t),n||0))}t=e})}),g),E=n?"borderLeft":"borderRight";function b(e,t){let i=m.nodes(),r=i.pop(),n={};for(;r;)n[r]?e(r):(n[r]=!0,i.push(r),i=i.concat(t(r))),r=i.pop()}return b(function(e){y[e]=m.inEdges(e).reduce((e,t)=>Math.max(e,y[t.v]+m.edge(t)),0)},m.predecessors.bind(m)),b(function(t){let i=m.outEdges(t).reduce((e,t)=>Math.min(e,y[t.w]-m.edge(t)),1/0),r=e.node(t);i!==1/0&&r.borderType!==E&&(y[t]=Math.max(y[t],i))},m.successors.bind(m)),Object.keys(r).forEach(e=>y[e]=y[i[e]]),y}(t,n,c.root,c.align,"r"===i);"r"===i&&(g=M.mapValues(g,e=>-e)),l[e+i]=g})}),h=Object.values(l).reduce((e,i)=>{let r=-1/0,n=1/0;Object.entries(i).forEach(e=>{var i,o;let[s,a]=e,l=(i=t,o=s,i.node(o).width/2);r=Math.max(a+l,r),n=Math.min(a-l,n)});let o=r-n;return o<e[0]&&(e=[o,i]),e},[1/0,null])[1],d=Object.values(h),c=M.applyWithChunking(Math.min,d),g=M.applyWithChunking(Math.max,d),["u","d"].forEach(e=>{["l","r"].forEach(t=>{let i=e+t,r=l[i];if(r===h)return;let n=Object.values(r),o=c-M.applyWithChunking(Math.min,n);"l"!==t&&(o=g-M.applyWithChunking(Math.max,n)),o&&(l[i]=M.mapValues(r,e=>e+o))})}),i=t.graph().align,M.mapValues(l.ul,(e,t)=>{if(i)return l[i.toLowerCase()][t];{let e=Object.values(l).map(e=>e[t]).sort((e,t)=>e-t);return(e[1]+e[2])/2}}))).forEach(t=>{let[i,r]=t;return e.node(i).x=r})},eP=function(e){e.nodes().forEach(t=>{var i=e.node(t);if("selfedge"===i.dummy){var r=e.node(i.e.v),n=r.x+r.width/2,o=r.y,s=i.x-n,a=r.height/2;e.setEdge(i.e,i.label),e.removeNode(t),i.label.points=[{x:n+2*s/3,y:o-a},{x:n+5*s/6,y:o-a},{x:n+s,y:o},{x:n+5*s/6,y:o+a},{x:n+2*s/3,y:o+a}],i.label.x=i.x,i.label.y=i.y}})},ej=function(e){e.nodes().forEach(t=>{if(e.children(t).length){let i=e.node(t),r=e.node(i.borderTop),n=e.node(i.borderBottom),o=e.node(i.borderLeft[i.borderLeft.length-1]),s=e.node(i.borderRight[i.borderRight.length-1]);i.width=Math.abs(s.x-o.x),i.height=Math.abs(n.y-r.y),i.x=o.x+i.width/2,i.y=r.y+i.height/2}}),e.nodes().forEach(t=>{"border"===e.node(t).dummy&&e.removeNode(t)})},ez=function(e){e.edges().forEach(t=>{let i=e.edge(t);if(Object.hasOwn(i,"x"))switch(("l"===i.labelpos||"r"===i.labelpos)&&(i.width-=i.labeloffset),i.labelpos){case"l":i.x-=i.width/2+i.labeloffset;break;case"r":i.x+=i.width/2+i.labeloffset}})},eV=function(e){let t=1/0,i=0,r=1/0,n=0,o=e.graph(),s=o.marginx||0,a=o.marginy||0;function l(e){let o=e.x,s=e.y,a=e.width,l=e.height;t=Math.min(t,o-a/2),i=Math.max(i,o+a/2),r=Math.min(r,s-l/2),n=Math.max(n,s+l/2)}e.nodes().forEach(t=>l(e.node(t))),e.edges().forEach(t=>{let i=e.edge(t);Object.hasOwn(i,"x")&&l(i)}),t-=s,r-=a,e.nodes().forEach(i=>{let n=e.node(i);n.x-=t,n.y-=r}),e.edges().forEach(i=>{let n=e.edge(i);n.points.forEach(e=>{e.x-=t,e.y-=r}),Object.hasOwn(n,"x")&&(n.x-=t),Object.hasOwn(n,"y")&&(n.y-=r)}),o.width=i-t+s,o.height=n-r+a},eB=function(e){e.edges().forEach(t=>{let i,r,n=e.edge(t),o=e.node(t.v),s=e.node(t.w);n.points?(i=n.points[0],r=n.points[n.points.length-1]):(n.points=[],i=s,r=o),n.points.unshift(M.intersectRect(o,i)),n.points.push(M.intersectRect(s,r))})},eF=function(e){e.edges().forEach(t=>{let i=e.edge(t);i.reversed&&i.points.reverse()})},eY={rankdir:"LR",align:void 0,nodesep:100,edgesep:10,ranksep:100,marginx:0,marginy:0,acyclicer:void 0,ranker:"network-simplex"},eU={getFollowNode:void 0,enableAnimation:!1},e$=class{get initialized(){return this.init}getNode(e){if(e)return this.store.nodes.get(e)}getNodeByIndex(e){let t=this.indexMap.get(e);return t?this.getNode(t):void 0}getEdge(e){return this.store.edges.get(e)}get nodes(){return Array.from(this.store.nodes.values())}get edges(){return Array.from(this.store.edges.values())}create(e,t){this.store=this.createStore(e),this.indexMap=this.createIndexMap(),this.setOptions(t),this.init=!0}createStore(e){let{nodes:t,edges:i,container:r}=e;this.container=r;let n=this.createLayoutNodes(t),o=this.createEdgesStore(i),s=this.createVirtualEdges(e),a={nodes:new Map,edges:new Map};return n.forEach(e=>a.nodes.set(e.id,e)),o.concat(s).forEach(e=>a.edges.set(e.id,e)),a}createLayoutNodes(e){return e.map((e,t)=>{var i;let{bounds:r}=e.getData(g.eG);return{id:e.id,entity:e,index:"",rank:-1,order:-1,position:{x:r.center.x,y:r.center.y},offset:{x:0,y:0},size:{width:r.width,height:r.height},hasChildren:(null==(i=e.collapsedChildren)?void 0:i.length)>0}})}createEdgesStore(e){return e.map(e=>{let{from:t,to:i}=e.info;if(t&&i&&!e.vertical)return{id:e.id,entity:e,from:t,to:i,fromIndex:"",toIndex:"",name:e.id}}).filter(Boolean)}createVirtualEdges(e){let{nodes:t,edges:i}=e;return t.filter(e=>e.flowNodeType===g.Sy.GROUP).map(e=>{let{id:t,blocks:r=[]}=e,n=new Set(r.map(e=>e.id));return[...i.filter(e=>{var t;return n.has((null==(t=e.to)?void 0:t.id)??"")}).map(e=>{let{from:i,to:r}=e.info;if(!i||!r||e.vertical)return;let n=`virtual_${t}_${r}`;return{id:n,entity:e,from:i,to:t,fromIndex:"",toIndex:"",name:n}}).filter(Boolean),...i.filter(e=>n.has(e.from.id??"")).map(e=>{let{from:i,to:r}=e.info;if(!i||!r||e.vertical)return;let n=`virtual_${t}_${i}`;return{id:n,entity:e,from:t,to:r,fromIndex:"",toIndex:"",name:n}}).filter(Boolean)]}).flat()}createIndexMap(){let e=this.sortNodes(),t=new Map;e.forEach((e,i)=>{let r=this.getNode(e);if(!r)return;let n=String(1e5+i);t.set(r.id,n),r.index=n}),this.edges.forEach(e=>{let i=t.get(e.from),r=t.get(e.to);if(!i||!r)return void this.store.edges.delete(e.id);e.fromIndex=i,e.toIndex=r});let i=new Map;return t.forEach((e,t)=>{i.set(e,t)}),i}sortNodes(){let e=[];this.nodes.forEach(t=>{e.push(t.id)}),this.edges.forEach(t=>{e.push(t.to)});let t=new Set,i=r=>{if(t.has(r.id))return;t.add(r.id),e.push(r.id),r.blocks.forEach(e=>{i(e)});let{outputLines:n}=r.getData(s.Z1);n.sort((e,t)=>{var i,r;let n=this.getNode(null==(i=e.to)?void 0:i.id),o=this.getNode(null==(r=t.to)?void 0:r.id),s=e.fromPort,a=t.fromPort;return s===a&&n&&o?n.position.y-o.position.y:s&&a?s.point.y-a.point.y:0}).forEach(e=>{let{to:t}=e;t&&i(t)})};return i(this.container),e.reduceRight((e,t)=>(e.includes(t)||e.unshift(t),e),[])}setOptions(e){this.options=e,this.setFollowNode(e.getFollowNode)}setFollowNode(e){if(!e)return;let t={store:this};this.nodes.forEach(i=>{var r;let n=null==(r=e(i,t))?void 0:r.followTo;if(!n)return;let o=this.getNode(n);o&&(o.followedBy||(o.followedBy=[]),o.followedBy.push(i.id),i.followTo=n)})}constructor(e){this.config=e,this.init=!1}},eG=class{async position(){return this.store.options.enableAnimation?this.positionWithAnimation():this.positionDirectly()}positionDirectly(){this.store.nodes.forEach(e=>{this.updateNodePosition({layoutNode:e,step:100})})}async positionWithAnimation(){return new Promise(e=>{(0,c.p4)({from:{d:0},to:{d:100},duration:300,onUpdate:e=>{this.store.nodes.forEach(t=>{this.updateNodePosition({layoutNode:t,step:e.d})})},onComplete:()=>{e()}})})}updateNodePosition(e){let{layoutNode:t,step:i}=e,r=t.entity.getData(c.VO),n={x:t.position.x+t.offset.x,y:t.position.y+t.offset.y},o=(n.x-r.position.x)*i/100,s=(n.y-r.bounds.height/2-r.position.y)*i/100;r.update({position:{x:r.position.x+o,y:r.position.y+s}}),t.entity.document.layout.updateAffectedTransform(t.entity)}constructor(e){this.store=e}},eQ=class{layout(){this.graphSetData(),this.dagreLayout(),this.layoutSetPosition()}dagreLayout(){let e=ef(this.graph);this.runLayout(e),ey(this.graph,e)}runLayout(e){em(e),ev(e),eE(e),eD(e),eC(M.asNonCompoundGraph(e)),eM(e),_(e),eN(e),w(e),eS(e),ex(e),ew(e),eI(e),eL(e),eT(e),this.setOrderAndRank(e),eA(e),eO(e),eR(e),eP(e),ej(e),e_(e),ez(e),ek(e),eV(e),eB(e),eF(e),eb(e)}createGraph(){let e=new u.Graph({multigraph:!0});return e.setDefaultEdgeLabel(()=>({})),e.setGraph(this.store.config),e}graphSetData(){let e=Array.from(this.store.nodes.values()),t=Array.from(this.store.edges.values()).sort((e,t)=>e.fromIndex===t.fromIndex?e.toIndex<t.toIndex?-1:1:e.fromIndex<t.fromIndex?-1:1);e.forEach(e=>{this.graph.setNode(e.index,{originID:e.id,width:e.size.width,height:e.size.height})}),t.forEach(e=>{this.graph.setEdge({v:e.fromIndex,w:e.toIndex,name:e.name})})}layoutSetPosition(){this.store.nodes.forEach(e=>{let t=this.getOffsetX(e),i=this.graph.node(e.index);if(!i){e.rank=-1,e.position={x:e.position.x+t,y:e.position.y};return}e.rank=i.rank??-1,e.position={x:this.normalizeNumber(i.x)+t,y:this.normalizeNumber(i.y)}})}normalizeNumber(e){return Number.isNaN(e)?0:e}getOffsetX(e){if(!e.hasChildren)return 0;let{bounds:t,padding:i}=e.entity.getData(g.eG);return-t.width/2+i.left}setOrderAndRank(e){return this.followAdjust(e),this.normalizeOrder(e),e}followAdjust(e){let t=this.rankGroup(e);e.nodes().forEach(i=>{let r=e.node(i),n=this.store.getNodeByIndex(i);if(!r||!(null==n?void 0:n.followedBy))return;let{followedBy:o}=n,{rank:s,order:a}=r,l=o.map(e=>{var t;return null==(t=this.store.getNode(e))?void 0:t.index}).filter(Boolean),h=new Set(l),d=t.get(s);d&&(Array.from(d).filter(t=>!h.has(t)&&e.node(t).order>a).forEach(t=>{let i=e.node(t);i.order=i.order+o.length}),l.forEach((i,r)=>{var n,o;let l=e.node(i);l.order=a+r+1;let h=l.rank;l.rank=s,null==(n=t.get(h))||n.delete(i),null==(o=t.get(s))||o.add(i)}))})}normalizeOrder(e){this.rankGroup(e).forEach((t,i)=>{let r=Array.from(t).map(t=>e.node(t));r.sort((e,t)=>e.order-t.order),r.forEach((e,t)=>{e.order=t})})}rankGroup(e){let t=new Map;return e.nodes().forEach(i=>{var r;let n=e.node(i).rank;t.has(n)||t.set(n,new Set),null==(r=t.get(n))||r.add(i)}),t}constructor(e){this.store=e,this.graph=this.createGraph()}},eW=class{init(e,t){this._store.create(e,t)}layout(){this._store.initialized&&this._layout.layout()}async position(){if(this._store.initialized)return await this._position.position()}constructor(e){this._store=new e$(e),this._layout=new eQ(this._store),this._position=new eG(this._store)}},eH=class{init(e){this.layoutConfig={...this.layoutConfig,...e.layoutConfig}}async layout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await this.layoutNode(this.document.root,{...eU,...e})}async layoutNode(e,t){let i=e.blocks;if(!i||!Array.isArray(i)||!i.length)return;let r=this.getNodesAllLines(i);await Promise.all(i.map(async e=>this.layoutNode(e,t)));let n=new eW(this.layoutConfig);n.init({nodes:i,edges:r,container:e},t),n.layout(),await n.position()}getNodesAllLines(e){return e.map(e=>{let t=e.getData(s.Z1);return[...t.outputLines.filter(Boolean),...t.inputLines.filter(Boolean)]}).flat()}constructor(){this.layoutConfig=eY}};y([(0,h.f3)(s.L4)],eH.prototype,"document",2),eH=y([(0,h.b2)()],eH);var eX=(0,c.M1)({onBind:e=>{let{bind:t}=e;t(eH).toSelf().inSingletonScope()},onInit:(e,t)=>{e.get(eH).init(t)},singleton:!0}),eJ=i(324067),eZ=i(854343),eK=i(697495),eq=i(438024),e0=i(832176),e1=Object.defineProperty,e2=Object.getOwnPropertyDescriptor,e4=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?e2(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&e1(t,i,o),o};(r||(r={})).DEFAULT={canHovered:()=>!0};var e3=class extends c.mh{autorun(){let{activatedNode:e}=this.selectionService;this.nodeTransformsWithSort=this.nodeTransforms.filter(e=>"root"!==e.entity.id&&e.entity.flowNodeType!==g.Sy.GROUP).reverse().sort(t=>t.entity===e?-1:0)}get isDrawing(){return this.linesManager.isDrawing}onReady(){this.options={...r.DEFAULT,...this.options},this.toDispose.pushAll([this.hoverService.onUpdateHoverPosition(e=>{let{position:t,target:i}=e,r=this.config.getPosFromMouseEvent({clientX:t.x,clientY:t.y});this.updateHoveredState(r,i)}),this.listenPlaygroundEvent("mousemove",e=>{if(this.hoverService.hoveredPos=this.config.getPosFromMouseEvent(e),!this.isEnabled()||!this.options.canHovered(e,this.hoverService))return;let t=this.config.getPosFromMouseEvent(e);this.updateHoveredState(t,null==e?void 0:e.target)}),this.selectionService.onSelectionChanged(()=>this.autorun()),this.listenPlaygroundEvent("touchstart",e=>{if(this.isEnabled()&&!this.isDrawing)return this.handleDragLine(e)}),this.listenPlaygroundEvent("mousedown",e=>{if(!this.isEnabled()||this.isDrawing)return;let{hoveredNode:t}=this.hoverService;if(this.handleDragLine(e))return!0;let i=this.config.getPosFromMouseEvent(e),r=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=e.filter(e=>e instanceof s.CT);return i.length>+!!t?e0.Ae.enlarge(i.map(e=>e.getData(g.eG).bounds)).pad(2):e0.Ae.EMPTY}(this.selectionService.selection,!0);if(r.width>0&&r.contains(i.x,i.y)){var n;return null==(n=this.dragService.startDragSelectedNodes(e))||n.then(i=>{i||(t&&t instanceof s.CT?e.shiftKey?this.selectionService.toggleSelect(t):this.selectionService.selectNode(t):this.selectionService.clear())}),!0}t||this.selectionService.clear()})])}updateHoveredState(e,t){var i,r,n;let{hoverService:o}=this,s=this.nodeTransformsWithSort,a=this.linesManager.getPortFromMousePos(e),l=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-line")].some(e=>e.contains(t));if(a){if("output"===a.portType)o.updateHoveredKey(a.id);else if(l||(null==t||null==(n=t.className)||null==(r=n.includes)?void 0:r.call(n,"workflow-port-bg"))){let t=this.linesManager.getCloseInLineFromMousePos(e);t&&this.updateHoveredKey(t.id)}return}if(this.isDrawing)return;let h=null==(i=s.find(t=>t.bounds.contains(e.x,e.y)))?void 0:i.entity,d=[...this.playgroundNode.querySelectorAll(".gedit-flow-activity-node")].some(e=>e.contains(t));(h||d)&&(null==h?void 0:h.id)&&this.updateHoveredKey(h.id);let u=l?this.linesManager.getCloseInLineFromMousePos(e):void 0;return h&&u?h.renderData.stackIndex>u.stackIndex?this.updateHoveredKey(h.id):this.updateHoveredKey(u.id):h?this.updateHoveredKey(h.id):u?this.updateHoveredKey(u.id):void(o.clearHovered(),this.editorStateConfig.getCurrentState()===c.yy.STATE_MOUSE_FRIENDLY_SELECT&&!this.editorStateConfig.isPressingShift&&this.configEntity.updateCursor("grab"))}updateHoveredKey(e){this.configEntity.updateCursor("default"),this.hoverService.updateHoveredKey(e)}isEnabled(){let e=this.editorStateConfig.getCurrentState();return(e===c.yy.STATE_SELECT||e===c.yy.STATE_MOUSE_FRIENDLY_SELECT)&&!this.selectorBoxConfigEntity.isStart&&!this.dragService.isDragging}handleDragLine(e){let{hoveredNode:t}=this.hoverService;return t&&t instanceof s.e2?(this.dragService.resetLine(t,e),!0):t&&t instanceof s.FD&&"input"!==t.portType&&!t.disabled&&1!==e.button?(e.stopPropagation(),e.preventDefault(),this.dragService.startDrawingLine(t,e),!0):void 0}constructor(){super(...arguments),this.nodeTransformsWithSort=[]}};e3.type="HoverLayer",e4([(0,h.f3)(s.L4)],e3.prototype,"document",2),e4([(0,h.f3)(s.oJ)],e3.prototype,"selectionService",2),e4([(0,h.f3)(s.iw)],e3.prototype,"dragService",2),e4([(0,h.f3)(s.XH)],e3.prototype,"hoverService",2),e4([(0,h.f3)(s.dm)],e3.prototype,"linesManager",2),e4([(0,c.O0)(c.Zs)],e3.prototype,"editorStateConfig",2),e4([(0,c.O0)(eq.NQ)],e3.prototype,"selectorBoxConfigEntity",2),e4([(0,h.f3)(c.ER)],e3.prototype,"configEntity",2),e4([(0,c.aI)(s.CT,g.eG)],e3.prototype,"nodeTransforms",2),e4([(0,c.RX)(s.e2)],e3.prototype,"lines",2),e3=e4([(0,h.b2)()],e3);var e5=(0,c.M1)({onInit(e){e.playground.registerLayer(e3)}}),e9=i(65881),e6=Object.defineProperty,e8=Object.getOwnPropertyDescriptor,e7=Object.getOwnPropertyNames,te=Object.prototype.hasOwnProperty,tt=(e,t)=>{for(var i in t)e6(e,i,{get:t[i],enumerable:!0})},ti=(e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of e7(t))te.call(e,n)||n===i||e6(e,n,{get:()=>t[n],enumerable:!(r=e8(t,n))||r.enumerable});return e},tr=(e,t,i)=>(ti(e,t,"default"),i&&ti(i,t,"default")),tn=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?e8(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&e6(t,i,o),o},to={};tt(to,{FreeLayoutEditor:()=>tc,FreeLayoutEditorProvider:()=>td,FreeLayoutPluginContext:()=>tl,FreeLayoutProps:()=>n,WorkflowAutoLayoutTool:()=>ta,WorkflowNodeRenderer:()=>tu,WorkflowPortRender:()=>eK.Jb,createFreeLayoutPreset:()=>th,useAutoLayout:()=>tg,useClientContext:()=>tp,usePlaygroundTools:()=>tf});var ts={};tt(ts,{FreeLayoutEditor:()=>tc,FreeLayoutEditorProvider:()=>td,WorkflowNodeRenderer:()=>tu,WorkflowPortRender:()=>eK.Jb});var ta=class{async handle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{disableFitView:t=!1,...i}=e;if(this.playground.config.readonly)return()=>{};this.fitView(t);let r=await this.autoLayout(i);return this.fitView(t),r}async autoLayout(e){let t=this.document.getAllNodes(),i=t.map(this.getNodePosition);await this.autoLayoutService.layout(e);let r=t.map(this.getNodePosition);return this.updateHistory({nodes:t,startPositions:i,endPositions:r}),this.createResetFn({nodes:t,startPositions:i})}fitView(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(0,s.Qu)(this.document,this.playground.config)}getNodePosition(e){let t=e.getData(o.VOn);return{x:t.position.x,y:t.position.y}}createResetFn(e){let{nodes:t,startPositions:i}=e;return()=>{t.forEach((e,t)=>{let r=e.getData(o.VOn),n=i[t];r.update({position:n})})}}updateHistory(e){var t;let{nodes:i,startPositions:r,endPositions:n}=e,o=i.map(e=>e.id);null==(t=this.historyService)||t.pushOperation({type:l.Nj.dragNodes,value:{ids:o,value:n,oldValue:r}},{noApply:!0})}};tn([(0,h.f3)(s.L4)],ta.prototype,"document",2),tn([(0,h.f3)(o.XQj)],ta.prototype,"playground",2),tn([(0,h.f3)(eH)],ta.prototype,"autoLayoutService",2),tn([(0,h.f3)(d.qp),(0,h.jt)()],ta.prototype,"historyService",2),ta=tn([(0,h.b2)()],ta);var tl=o.Zn3;(n||(n={})).DEFAULT={...o.nYJ.DEFAULT};function th(e){return t=>{var i,r;e={...n.DEFAULT,...e,playground:{...e.playground,get hoverService(){return t.get(s.XH)}}};let a=[];return a.push((0,o.cL)({registerShortcuts(i){var r;let n=t.get(o.z2R);if(i.addHandlers({commandId:s.uB.DELETE_NODES,shortcuts:["backspace","delete"],isEnabled:()=>n.selection.length>0&&!t.playground.config.readonlyOrDisabled,execute:()=>{n.selection.forEach(e=>{if(e instanceof s.CT){var i;if(!t.document.canRemove(e))return;let r=e.getNodeMeta(),n=null==(i=r.subCanvas)?void 0:i.call(r,e);if(null==n?void 0:n.isCanvas)return void n.parentNode.dispose();e.dispose()}else if(e instanceof s.e2){if(!t.document.linesManager.canRemove(e))return;e.dispose()}}),n.selection=n.selection.filter(e=>!e.disposed)}}),null==e||null==(r=e.history)?void 0:r.enable){let r=t.get(l.qp);e.history.disableShortcuts||(i.addHandlers({commandId:o.mYg.Default.UNDO,shortcuts:["meta z","ctrl z"],isEnabled:()=>!0,execute:()=>{r.undo()}}),i.addHandlers({commandId:o.mYg.Default.REDO,shortcuts:["meta shift z","ctrl shift z"],isEnabled:()=>!0,execute:()=>{r.redo()}}))}}})),a=(0,o.Fu1)(e,a)(t),(null==(i=e.variableEngine)?void 0:i.enable)&&a.push((0,o.Ys9)({...e.variableEngine,layout:"free"})),(null==(r=e.history)?void 0:r.enable)&&a.push((0,l.ou)(e.history)),a.push((0,o.d3V)({onBind:i=>{var r,n,a,l,h,d,u,c,g,p,f,y,m,E,b;i.bind(ta).toSelf().inSingletonScope(),i.rebind(s.fY).toConstantValue({canAddLine:null==(r=e.canAddLine)?void 0:r.bind(null,t),canDeleteLine:null==(n=e.canDeleteLine)?void 0:n.bind(null,t),isErrorLine:null==(a=e.isErrorLine)?void 0:a.bind(null,t),isErrorPort:null==(l=e.isErrorPort)?void 0:l.bind(null,t),isDisabledPort:null==(h=e.isDisabledPort)?void 0:h.bind(null,t),isReverseLine:null==(d=e.isReverseLine)?void 0:d.bind(null,t),isHideArrowLine:null==(u=e.isHideArrowLine)?void 0:u.bind(null,t),isFlowingLine:null==(c=e.isFlowingLine)?void 0:c.bind(null,t),isDisabledLine:null==(g=e.isDisabledLine)?void 0:g.bind(null,t),onDragLineEnd:null==(p=e.onDragLineEnd)?void 0:p.bind(null,t),setLineRenderType:null==(f=e.setLineRenderType)?void 0:f.bind(null,t),setLineClassName:null==(y=e.setLineClassName)?void 0:y.bind(null,t),canDeleteNode:null==(m=e.canDeleteNode)?void 0:m.bind(null,t),canResetLine:null==(E=e.canResetLine)?void 0:E.bind(null,t),canDropToNode:null==(b=e.canDropToNode)?void 0:b.bind(null,t),cursors:e.cursors??s.jg.cursors,lineColor:e.lineColor??s.jg.lineColor,allNodesDefaultExpanded:e.allNodesDefaultExpanded,toNodeJSON:t=>(function(e,t){let i,r=t.getData(o.Psq),n=t.transform.position;if(i=r?s.jg.toNodeJSON(t):{id:t.id,type:t.flowNodeType,meta:{position:{x:n.x,y:n.y}},data:t.getExtInfo()},t.flowNodeType===o.SyX.GROUP){var a;let e=(null==(a=t.parent)?void 0:a.id)??o.SyX.ROOT,r=t.blocks.map(e=>e.id)??[];i.data={...i.data,parentID:e,blockIDs:r}}return e.toNodeJSON?e.toNodeJSON(t,i):i})(e,t),fromNodeJSON:(t,i,r)=>(function(e,t,i,r){if(i=e.fromNodeJSON?e.fromNodeJSON(t,i,r):i,!t.getData(o.Psq)){i.data&&t.updateExtInfo(i.data),r&&t.onExtInfoChange(()=>{t.document.fireContentChange({type:s.fT.NODE_DATA_CHANGE,toJSON:()=>t.getExtInfo(),entity:t})});return}return s.jg.fromNodeJSON(t,i,r)})(e,t,i,r)})},onInit:t=>{var i,r,n;t.playground.registerLayer(o.Emw),t.playground.registerLayer(o.V7e,{renderElement:()=>(e=>{let t=e.get(eZ.StackingContextManager);if(t.node)return t.node})(t)}),(null==(i=e.scroll)?void 0:i.enableScrollLimit)&&t.playground.registerLayer(o.qq0),(null==(r=e.scroll)?void 0:r.disableScrollBar)||t.playground.registerLayer(o.lVg),(null==(n=e.scroll)?void 0:n.disableScroll)&&(t.playground.config.scrollDisable=!0),e.onContentChange&&t.document.onContentChange(i=>e.onContentChange(t,i))},containerModules:[s._s]}),(0,eZ.createFreeStackPlugin)({}),(0,eK.J2)({}),e5({}),eX({}),(0,eJ.Y)({canSelect:e=>{if(0!==e.button)return!1;let i=e.target;if(i){if(i.classList.contains("gedit-flow-background-layer")||i.closest('[data-flow-editor-selectable="true"]'))return!0;if(i.closest('[data-flow-editor-selectable="false"]'))return!1}return!t.get(s.XH).isSomeHovered()},ignoreOneSelect:!0,ignoreChildrenLength:!0,...e.selectBox||{}})),(0,o.esp)(e,a)(t)}}var td=(0,a.forwardRef)(function(e,t){let{children:i,...r}=e,n=(0,a.useMemo)(()=>th(r),[]),h=(0,a.useCallback)(e=>({...(0,o.FwO)(e),get document(){return e.get(s.L4)},get clipboard(){return e.get(o.YvH)},get selection(){return e.get(o.z2R)},get history(){return e.get(l.qp)},get tools(){let t=e.get(ta);return{autoLayout:t.handle.bind(t),fitView:t=>(0,s.Qu)(e.get(s.L4),e.get(o.XQj).config,t)}}}),[]);return a.createElement(o.W6u,{ref:t,plugins:n,customPluginContext:h},i)}),tu=e=>{let{selected:t,activated:i,startDrag:r,ports:n,selectNode:o,nodeRef:l,onFocus:h,onBlur:d}=(0,s.PV)(),u=(0,e9.Z)(e.className||"",{activated:i,selected:t});return a.createElement(a.Fragment,null,a.createElement("div",{className:u,style:e.style,ref:l,draggable:!0,onDragStart:r,onClick:o,onFocus:h,onBlur:d,"data-node-selected":String(t)},e.children),n.map(t=>a.createElement(eK.Jb,{key:t.id,entity:t,onClick:e.onPortClick?i=>e.onPortClick(t,i):void 0,className:e.portClassName,style:e.portStyle,primaryColor:e.portPrimaryColor,secondaryColor:e.portSecondaryColor,errorColor:e.portErrorColor,backgroundColor:e.portBackgroundColor})))},tc=(0,a.forwardRef)(function(e,t){let{children:i,...r}=e;return a.createElement(td,{ref:t,...r},a.createElement(o.R6T,null,i))});tr(ts,eZ),tr(to,ts);var tg=()=>{let e=(0,s.G2)(ta);return e.handle.bind(e)};function tp(){return(0,o.G2Z)(o.Zn3)}function tf(e){let{maxZoom:t,minZoom:i}=e||{},r=(0,s.Dc)(),n=(0,s.G2)(s.L4),[l,h]=(0,a.useState)(1),[d,u]=(0,a.useState)(n.linesManager.lineType),[c,g]=(0,a.useState)(s.YC.SELECT),[p,f]=(0,a.useState)(s.v6.PAD),y=(0,a.useCallback)(e=>{null==r||r.config.zoomout(e)},[l,r]),m=(0,a.useCallback)(e=>{null==r||r.config.zoomin(e)},[l,r]),E=(0,a.useCallback)(e=>{let t=n.linesManager.switchLineType(e);return u(t),t},[n]),b=(0,a.useCallback)(e=>{(0,s.Qu)(n,r.config,e)},[n,r]),D=tg();return(0,a.useEffect)(()=>{let e=null;return r&&(e=r.onZoom(e=>h(e))),()=>{e&&e.dispose()}},[r]),(0,a.useEffect)(()=>{let e=r.editorState.onStateChange(e=>{g(e.state===o.yyW.STATE_GRAB||e.state===o.yyW.STATE_MOUSE_FRIENDLY_SELECT?s.YC.GRAB:s.YC.SELECT),f(e.state===o.yyW.STATE_MOUSE_FRIENDLY_SELECT?s.v6.MOUSE:s.v6.PAD)});return()=>{e.dispose()}},[r]),(0,a.useEffect)(()=>{let e=r.config.config;r.config.updateConfig({maxZoom:void 0!==t?t:e.maxZoom,minZoom:void 0!==i?i:e.minZoom})},[r,t,i]),{zoomin:m,zoomout:y,fitView:b,autoLayout:D,switchLineType:E,zoom:l,lineType:d,cursorState:c,setCursorState:function(e){let t;void 0!==(t="function"==typeof e?e({isPressingSpaceBar:r.editorState.isPressingSpaceBar,cursorState:c}):e)&&(t===s.YC.GRAB?(r.editorState.changeState(o.yyW.STATE_GRAB.id),g(t)):(t=s.YC.SELECT)&&(r.editorState.changeState(o.yyW.STATE_SELECT.id),g(t)))},interactiveType:p,setInteractiveType:function(e){e===s.v6.MOUSE?(r.editorState.changeState(o.yyW.STATE_MOUSE_FRIENDLY_SELECT.id),g(s.YC.GRAB)):e===s.v6.PAD&&(r.editorState.changeState(o.yyW.STATE_SELECT.id),g(s.YC.SELECT)),f(e)},setMouseScrollDelta:function(e){r.config.updateConfig({mouseScrollDelta:e})}}}},309844:function(e,t,i){i.d(t,{Dc:()=>n.Dc,RE:()=>p,Wi:()=>n.Wi,er:()=>u,es:()=>c,mY:()=>n.mY,pk:()=>f}),i(543789);var r=i(832176),n=i(893740),o=i(908600),s=i(148168),a=i(569517),l=i(461932),h=Object.defineProperty,d=Object.getOwnPropertyDescriptor;function u(e){let{maxZoom:t,minZoom:i}=e||{},s=(0,n.Dc)(),a=(0,n.bP)(n.Zs,!0),[l,h]=(0,o.useState)(1),d=(0,o.useCallback)(e=>{s.config.zoomout(e)},[s]),u=(0,o.useCallback)(e=>{s.config.zoomin(e)},[s]),c=(0,o.useCallback)((e,t,i)=>{s.config.updateZoom(e,t,i)},[s]),g=(0,o.useCallback)(()=>{a.isMouseFriendlyMode()?a.changeState(n.yy.STATE_SELECT.id):a.changeState(n.yy.STATE_MOUSE_FRIENDLY_SELECT.id)},[a]);return(0,o.useEffect)(()=>{let e=new r.K4;return e.push(s.onZoom(e=>h(e))),()=>e.dispose()},[s]),(0,o.useEffect)(()=>{let e=s.config.config;s.config.updateConfig({maxZoom:void 0!==t?t:e.maxZoom,minZoom:void 0!==i?i:e.minZoom})},[s,t,i]),{zoomin:u,zoomout:d,updateZoom:c,zoom:l,interactiveType:a.isMouseFriendlyMode()?"MOUSE":"PAD",toggleIneractiveType:g}}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return i=>{if(t=t.slice(),e.background||void 0===e.background){let i="object"==typeof e.background?e.background:{};t.push((0,a.bz)(i))}return e.shortcuts&&t.push((0,s.cL)({registerShortcuts:t=>e.shortcuts(t,i)})),e.plugins&&t.push(...e.plugins(i)),t.push((0,n.d3)({onBind:t=>{var i;null==(i=e.onBind)||i.call(e,t)},onInit:t=>{let i=t.get(n.W4);e.playground&&(void 0!==e.playground.autoFocus&&(i.autoFocus=e.playground.autoFocus),void 0!==e.playground.autoResize&&(i.autoResize=e.playground.autoResize)),i.autoFocus=!1,t.playground.registerLayer(n.wY,e.playground),e.layers&&t.playground.registerLayers(...e.layers),e.onInit&&e.onInit(t)},onReady(t){e.onReady&&e.onReady(t)},onAllLayersRendered(){e.onAllLayersRendered&&e.onAllLayersRendered(i)},onDispose(){e.onDispose&&e.onDispose(i)},containerModules:e.containerModules||[]})),t}}var g=class extends n.mh{onZoom(e){this.node.style.transform=`scale(${e})`}onReady(){this.node.style.left="0px",this.node.style.top="0px"}updateOptions(e){this.options=e,this.render()}render(){return o.createElement("div",{className:this.options.className,style:{position:"absolute",...this.options.style}},this.options.children)}constructor(){super(...arguments),this.node=r.xF.createDivWithClass("gedit-playground-layer gedit-playground-content-layer")}};g.type="PlaygroundContentLayer",g=((e,t,i,r)=>{for(var n,o=r>1?void 0:r?d(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&h(t,i,o),o})([(0,l.b2)()],g);var p=(0,o.forwardRef)(function(e,t){let{parentContainer:i,children:r,...s}=e,a=(0,o.useMemo)(()=>(0,n.d3)({onInit(e){e.playground.registerLayer(g)}}),[]),l=(0,o.useMemo)(()=>c(s,[a]),[]);return o.createElement(n.W6,{ref:t,plugins:l,parentContainer:i},o.createElement(n.iX,null,r))}),f=e=>{let t=(0,n.Dc)();return(0,o.useMemo)(()=>{t.getLayer(g).updateOptions(e)},[e]),o.createElement(o.Fragment,null)}},66298:function(e,t,i){i.d(t,{CD:()=>g,FU:()=>c,Xn:()=>C,f9:()=>y,qp:()=>N});var r=i(461932),n=i(832176),o=i(433210),s=i(976826),a=i(952893),l=i(893740),h=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?d(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&h(t,i,o),o},c=Symbol("OperationContribution"),g=class{init(){for(let t of this.contributions){var e;null==(e=t.registerOperationMeta)||e.call(t,this)}}registerOperationMeta(e){return this._operationMetas.has(e.type)?(console.warn(`A operation meta ${e.type} is already registered.`),n.JT.NULL):new n.K4(this._doRegisterOperationMetaMeta(e))}getOperationMeta(e){return this._operationMetas.get(e)}_doRegisterOperationMetaMeta(e){return this._operationMetas.set(e.type,e),{dispose:()=>{this._operationMetas.delete(e.type)}}}constructor(){this._operationMetas=new Map,this.contributions=[]}};u([(0,r.nx)(c),(0,r.jt)()],g.prototype,"contributions",2),u([(0,r.zY)()],g.prototype,"init",1),g=u([(0,r.b2)()],g);var p=class{};p=u([(0,r.b2)()],p);var f=class{constructor(){this.generateId=()=>(0,o.x0)(),this.getSnapshot=()=>""}};f=u([(0,r.b2)()],f);var y=class{init(){this._toDispose.push(this.applyEmitter)}applyOperation(e,t){let i,r=this.operationRegistry.getOperationMeta(e.type);if(!r)throw Error(`Operation meta ${e.type} has not registered.`);return(null==t?void 0:t.noApply)||(i=r.apply(e,this.context.source)),this.applyEmitter.fire(e),i}getOperationLabel(e){let t=this.operationRegistry.getOperationMeta(e.type);if(t&&t.getLabel)return t.getLabel(e,this.context.source)}getOperationDescription(e){let t=this.operationRegistry.getOperationMeta(e.type);if(t&&t.getDescription)return t.getDescription(e,this.context.source)}inverseOperations(e){return e.map(e=>this.inverseOperation(e)).reverse()}inverseOperation(e){let t=this.operationRegistry.getOperationMeta(e.type);if(!t)throw Error(`Operation meta ${e.type} has not registered.`);return t.inverse(e)}dispose(){this._toDispose.dispose()}constructor(){this.applyEmitter=new n.Q5,this.onApply=this.applyEmitter.event,this._toDispose=new n.K4}};u([(0,r.f3)(g)],y.prototype,"operationRegistry",2),u([(0,r.f3)(p)],y.prototype,"context",2),u([(0,r.f3)(f)],y.prototype,"config",2),u([(0,r.zY)()],y.prototype,"init",1),y=u([(0,r.b2)()],y);var m=class{setLimit(e){this._limit=e}pushElement(e){this._redoStack=[],this._stackPush(this._undoStack,e),this._toDispose.push(e),this._emitChange("push",e)}getUndoStack(){return this._undoStack}getRedoStack(){return this._redoStack}getLastElement(){return this._undoStack[this._undoStack.length-1]}async undo(){if(!this.canUndo()||this._undoing)return;this._undoing=!0;let e=this._undoStack.pop();try{await e.undo()}finally{this._stackPush(this._redoStack,e),this._emitChange("undo",e),this._undoing=!1}}async redo(){if(!this.canRedo()||this._redoing)return;this._redoing=!0;let e=this._redoStack.pop();try{await e.redo()}finally{this._stackPush(this._undoStack,e),this._emitChange("redo",e),this._redoing=!1}}canUndo(){return this._undoStack.length>0}canRedo(){return this._redoStack.length>0}canPush(){return!this._redoing&&!this._undoing}clear(){this.clearRedoStack(),this.clearUndoStack(),this._emitChange("clear")}clearRedoStack(){this._redoStack.forEach(e=>{e.dispose()}),this._redoStack=[]}clearUndoStack(){this._undoStack.forEach(e=>{e.dispose()}),this._undoStack=[]}dispose(){this.clear(),this._toDispose.dispose()}_stackPush(e,t){e.push(t),e.length>this._limit&&e.shift()}_emitChange(e,t){t?this.onChangeEmitter.fire({type:e,element:t}):this.onChangeEmitter.fire({type:e})}constructor(){this._undoing=!1,this._redoing=!1,this._limit=100,this.onChangeEmitter=new n.Q5,this.onChange=this.onChangeEmitter.event,this._toDispose=new n.K4,this._undoStack=[],this._redoStack=[],this._toDispose.push(this.onChangeEmitter)}};m=u([(0,r.b2)()],m);var E=class{get id(){return this._id}getTimestamp(){return this._timestamp}pushOperation(e){let t=this._operation(e);return this._operations.push(t),t}getOperations(){return this._operations}getChangeOperations(e){return"undo"===e?this._operationService.inverseOperations(this._operations):this._operations}getFirstOperation(){return this._operations[0]}getLastOperation(){return this._operations[this._operations.length-1]}async undo(){for(let e of this._operationService.inverseOperations(this._operations))await this._apply(e)}async redo(){for(let e of this._operations)await this._apply(e)}revert(e){let t=this._operations;for(let i of("undo"!==e&&(t=this._operations.map(e=>this._inverse(e)).reverse()),t))this._apply(i)}_inverse(e){return this._operationService.inverseOperation(e)}async _apply(e){await this._operationService.applyOperation(e)}_operation(e){return{...e,value:(0,a.Z)(e.value),id:this._operationService.config.generateId()}}dispose(){this._toDispose.dispose()}constructor(e,t=[]){this._toDispose=new n.K4,this._timestamp=Date.now(),this._operationService=e,this._operations=t.map(e=>this._operation(e)),this._id=e.config.generateId()}},b=class{get items(){return this._items}add(e,t){let i=this._getHistoryItem(e,t);return this._items.unshift(i),this._items.length>this.limit&&this._items.pop(),this.onChangeEmitter.fire({type:"add",value:i,service:e}),i}findById(e){return this._items.find(t=>t.id===e)}changeByIndex(e,t,i){let r=this._getHistoryItem(t,i);this._items[e]=r,this.onChangeEmitter.fire({type:"update",value:r,service:t})}addOperation(e,t,i){let r=this._items.find(e=>e.id===t);if(!r)return void console.warn("no history item found");let n=this._getHistoryOperation(e,i);r.operations.push(n),this.onChangeEmitter.fire({type:"add_operation",value:{historyItem:r,operation:n},service:e})}updateOperation(e,t,i){let r=this._items.find(e=>e.id===t);if(!r)return void console.warn("no history item found");let n=r.operations.findIndex(e=>e.id==e.id);if(n<0)return void console.warn("no operation found");let o=this._getHistoryOperation(e,i);r.operations.splice(n,1,o),this.onChangeEmitter.fire({type:"update_operation",value:{historyItem:r,operation:o},service:e})}clear(){this._items=[]}dispose(){this._items=[],this._toDispose.dispose()}_getHistoryItem(e,t){return{...t,uri:e.context.uri,time:b.dateFormat(t.timestamp),operations:t.operations.map(i=>this._getHistoryOperation(e,i,"push"!==t.type))}}_getHistoryOperation(e,t){let i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)i=this.historyConfig.generateId();else{let e=t.id;if(!e)throw Error("no operation id found");i=e}return{...(0,a.Z)(t),id:i,label:e.operationService.getOperationLabel(t),description:e.operationService.getOperationDescription(t),timestamp:Date.now()}}static dateFormat(e){return new Date(e).toLocaleString()}constructor(){this._items=[],this.onChangeEmitter=new n.Q5,this.onChange=this.onChangeEmitter.event,this._toDispose=new n.K4,this.limit=100,this._toDispose.push(this.onChangeEmitter)}};u([(0,r.f3)(f)],b.prototype,"historyConfig",2),b=u([(0,r.b2)()],b);var D=class{registerHistoryService(e){let t=new n.K4;t.pushAll([e.undoRedoService.onChange(t=>{if("clear"===t.type)return;let{type:i,element:r}=t,n=r.getChangeOperations(i),o={id:"push"===i?r.id:this.historyConfig.generateId(),type:i,uri:e.context.uri,operations:n,timestamp:Date.now()};this.historyStack.add(e,o)}),e.onMerge(t=>{this._handleMerge(e,t)})]),this._historyServices.set(e,t),this._toDispose.push(e.onWillDispose(()=>{this.unregisterHistoryService(e)}))}unregisterHistoryService(e){let t=this._historyServices.get(e);t&&(t.dispose(),this._historyServices.delete(e))}getHistoryServiceByURI(e){for(let t of this._historyServices.keys())if(t.context.uri===e)return t}getFirstHistoryService(){for(let e of this._historyServices.keys())return e}dispose(){this._toDispose.dispose(),this.historyStack.dispose(),this._historyServices.forEach(e=>e.dispose()),this._historyServices.clear()}_handleMerge(e,t){let{element:i,operation:r}=t.value;if(this.historyStack.findById(i.id)){if(!r.id)return void console.warn("no operation id found");"UPDATE"===t.type&&this.historyStack.updateOperation(e,i.id,r),"ADD"===t.type&&this.historyStack.addOperation(e,i.id,r)}}constructor(){this._historyServices=new Map,this._toDispose=new n.K4}};u([(0,r.f3)(b)],D.prototype,"historyStack",2),u([(0,r.f3)(f)],D.prototype,"historyConfig",2),D=u([(0,r.b2)()],D);var N=class{get onApply(){return this.operationService.onApply}init(){this._toDispose.push(this._willDisposeEmitter),this._toDispose.push(this._mergeEmitter)}start(){this._locked=!1}stop(){this._locked=!0}limit(e){this.undoRedoService.setLimit(e)}startTransaction(){if(this._transacting)return;this._transacting=!0;let e=new E(this.operationService,[]);this._transactOperation=e}endTransaction(){let e=this._transactOperation;e&&(0!==e.getOperations().length&&this._pushStackOperation(e),this._transactOperation=null,this._transacting=!1)}transact(e){this._transacting||(this.startTransaction(),e(),this.endTransaction())}pushOperation(e,t){if(!this._canPush())return;let i=this._transactOperation||this.undoRedoService.getLastElement(),r=this.operationRegistry.getOperationMeta(e.type);if(!r)throw Error(`Operation meta ${e.type} has not registered.`);if(r.shouldSave&&!r.shouldSave(e))return r.apply(e,this.context.source);let n=this.operationService.applyOperation(e,{noApply:null==t?void 0:t.noApply});r.getURI&&!e.uri&&(e.uri=r.getURI(e,this.context.source));let o=this._shouldMerge(e,i,r);if(o)if("object"==typeof o){let e=i.getLastOperation();e.value=o.value,this._mergeEmitter.fire({type:"UPDATE",value:{element:i,operation:e,value:o.value}})}else{let t=i.pushOperation(e);this._mergeEmitter.fire({type:"ADD",value:{element:i,operation:t}})}else{let t=new E(this.operationService,[e]);this._pushStackOperation(t)}return n}getHistoryOperations(){return this.historyManager.historyStack.items.reverse().map(e=>e.operations.map(e=>({...(0,s.Z)(e,["type","value"]),label:e.label||e.type}))).flat()}async undo(){await this.undoRedoService.undo()}async redo(){await this.undoRedoService.redo()}canUndo(){return this.undoRedoService.canUndo()}canRedo(){return this.undoRedoService.canRedo()}getSnapshot(){return this.config.getSnapshot()}getRecords(){throw Error("Method not implemented.")}restore(e){throw Error("Method not implemented.")}clear(){this.undoRedoService.clear()}dispose(){this._willDisposeEmitter.fire(this),this._toDispose.dispose()}_canPush(){return!this._locked&&this.undoRedoService.canPush()}_pushStackOperation(e){this.undoRedoService.pushElement(e),this.undoRedoService.clearRedoStack()}_shouldMerge(e,t,i){return!!t&&(!!this._transacting||i.shouldMerge&&i.shouldMerge(e,t.getLastOperation(),t))}constructor(){this._toDispose=new n.K4,this._transacting=!1,this._transactOperation=null,this._locked=!1,this._willDisposeEmitter=new n.Q5,this._mergeEmitter=new n.Q5,this.onWillDispose=this._willDisposeEmitter.event,this.onMerge=this._mergeEmitter.event}};u([(0,r.f3)(m)],N.prototype,"undoRedoService",2),u([(0,r.f3)(g)],N.prototype,"operationRegistry",2),u([(0,r.f3)(y)],N.prototype,"operationService",2),u([(0,r.f3)(p)],N.prototype,"context",2),u([(0,r.f3)(f)],N.prototype,"config",2),u([(0,r.f3)(D)],N.prototype,"historyManager",2),u([(0,r.zY)()],N.prototype,"init",1),N=u([(0,r.b2)()],N);var C=new r.nZ((e,t,i,r,n,o,s)=>{e(g).toSelf().inSingletonScope(),e(y).toSelf().inSingletonScope(),e(m).toSelf().inSingletonScope(),e(N).toSelf().inSingletonScope(),e(p).toSelf().inSingletonScope(),e(D).toSelf().inSingletonScope(),e(b).toSelf().inSingletonScope(),e(f).toSelf().inSingletonScope(),o(N,(e,t)=>{var i,r,n,o;let s;return(s=(null==(r=e.container)||null==(i=r.parent)?void 0:i.isBound(D))?null==(o=e.container)||null==(n=o.parent)?void 0:n.get(D):e.container.get(D))&&(t.historyManager=s,s.registerHistoryService(t)),t})});(0,l.M1)({onInit:(e,t)=>{t.onApply&&e.get(y).onApply(t.onApply.bind(null,e))},containerModules:[C]})},27430:function(e,t,i){i.d(t,{o:()=>o});var r=i(291241),n=i(832176),o=new class{t(e,t){return this.i18n.t(e,{defaultValue:this.missingStrictMode?void 0:e,...t})}get locale(){return this.i18n.locale}set locale(e){this.i18n.locale=e}addLanguages(e){this.i18n.store(e.reduce((e,t)=>Object.assign(e,{[t.languageId]:{languageName:t.languageName,localizedLanguageName:t.localizedLanguageName,...t.contents}}),{}))}addLanguage(e){this.addLanguages([e])}constructor(e){this.i18n=new r.oc,this._onLanguageChangeEmitter=new n.Q5,this.onLanguageChange=this._onLanguageChangeEmitter.event,this.missingStrictMode=!1,this.addLanguages(e),this.locale=function(){if("object"!=typeof navigator)return"en-US";let e=navigator.language;return"en"===e||"en-US"===e?"en-US":"zh"===e||"zh-CN"===e?"zh-CN":e}(),this.i18n.onChange(()=>{this._onLanguageChangeEmitter.fire(this.i18n.locale)})}}([{languageId:"en-US",languageName:"English",localizedLanguageName:"English",contents:{Yes:"Yes",No:"No"}},{languageId:"zh-CN",languageName:"Chinese",localizedLanguageName:"()",contents:{Yes:"",No:""}}])},875787:function(e,t,i){i.d(t,{BP:()=>h,Re:()=>d,nt:()=>u});var r,n=i(908600),o=i(832176);(e=>{let t,i=[],r=[],n=!1,o=!1,s=!1,a=!1;function l(e,t){if(a)throw t;console.error(`[Tracker error] ${e}`,t)}function h(e){if(o)throw Error("Can't call Tracker.flush while flushing");if(s)throw Error("Can't flush inside Tracker.autorun");o=!0,n=!0,a=!!(e=e||{}).throwFirstError;var t=0,u=!1;try{for(;i.length||r.length;){for(;i.length;){var c=i.shift();if(c._recompute(),c._needsRecompute()&&i.unshift(c),!e.finishSynchronously&&++t>100){u=!0;return}}if(r.length){var g=r.shift();try{g()}catch(e){l("afterFlush",e)}}}u=!0}finally{if(u||(o=!1,h({finishSynchronously:e.finishSynchronously,throwFirstError:!1})),n=!1,o=!1,i.length||r.length){if(e.finishSynchronously)throw Error("still have more to do?");setTimeout(d,10)}}}function d(){n||(setTimeout(h,0),n=!0)}function u(e){let i=t;t=void 0;try{return e(void 0)}finally{t=i}}function c(){return!!t}e.withComputation=function(e,i){let r=t;t=e;try{return i.call(null,e)}finally{t=r}},e.withoutComputation=u,e.isActive=c,e.getCurrentComputation=function(){return t},e.autorun=function(i,r){var n=new g(i,t,null==r?void 0:r.onError);return c()&&e.onInvalidate(function(){n.stop()}),n};e.onInvalidate=function(e){if(!t)throw Error("Tracker.onInvalidate requires a currentComputation");t.onInvalidate(e)},e.inFlush=function(){return o},e.flush=function(e){h({finishSynchronously:!0,throwFirstError:e&&e.throwFirstError})},e.afterFlush=function(e){r.push(e),d()};class g{onInvalidate(e){this.invalidated?u(e.bind(null,this)):this._onInvalidateCallbacks.push(e)}invalidate(){if(!this.invalidated){this._recomputing||this.stopped||(d(),i.push(this)),this.invalidated=!0;for(var e,t=0;e=this._onInvalidateCallbacks[t];t++)u(e.bind(null,this));this._onInvalidateCallbacks=[]}}stop(){if(!this.stopped){this.stopped=!0,this.invalidate();for(let e=0,t;t=this._onStopCallbacks[e];e++)u(t.bind(null,this));this._onStopCallbacks=[]}}onStop(e){this.stopped?u(e.bind(null,this)):this._onStopCallbacks.push(e)}_compute(){this.invalidated=!1;var t=s;s=!0;try{this._result=e.withComputation(this,this._fn)}finally{s=t}}_needsRecompute(){return this.invalidated&&!this.stopped}_recompute(){this._recomputing=!0;try{if(this._needsRecompute())try{this._compute()}catch(e){this._onError?this._onError(e):l("recompute",e)}}finally{this._recomputing=!1}}flush(){this._recomputing||this._recompute()}run(){this.invalidate(),this.flush()}get result(){return this._result}constructor(e,t,i){this._fn=e,this.parent=t,this._onError=i,this._onInvalidateCallbacks=[],this._onStopCallbacks=[],this._recomputing=!1,this.stopped=!1,this.invalidated=!1,this.firstRun=!0;let r=!0;try{this._compute(),r=!1}finally{this.firstRun=!1,r&&this.stop()}}}e.Computation=g,e.Dependency=class{depend(e){if(!e){if(!c())return!1;e=t}return!this._dependents.has(e)&&(this._dependents.add(e),e.onInvalidate(()=>{this._dependents.delete(e)}),!0)}changed(){for(let e of this._dependents)e.invalidate()}hasDependents(){return 0!==this._dependents.size}constructor(){this._dependents=new Set}}})(r||(r={}));var s=class{_addDepend(e){r.isActive()&&e.depend()}hasDependents(){return this._dep.hasDependents()}get value(){return this._addDepend(this._dep),this._value}set value(e){this._isEqual(this._value,e)||(this._value=e,this._dep.changed())}constructor(e,t){this._dep=new r.Dependency,this._isEqual=(e,t)=>e==t,this._value=e,(null==t?void 0:t.isEqual)&&(this._isEqual=t.isEqual)}};function a(e,t){if("Proxy"in window)return new Proxy(e,t);let i={};for(let r in e)Object.defineProperty(i,r,{enumerable:!0,get:t.get?()=>t.get(e,r):void 0,set:t.set?i=>t.set(e,r,i):void 0});return i}var l=r.Dependency,h=class extends s{set(e,t){this._ensureKey(e);let i=this._value[e];return!this._isEqual(i,t)&&(this._value[e]=t,this._keyDeps.get(e).changed(),!0)}get(e){return this._ensureKey(e),this._addDepend(this._keyDeps.get(e)),this._value[e]}_ensureKey(e){this._keyDeps.has(e)||this._keyDeps.set(e,new l)}hasDependents(){if(this._dep.hasDependents())return!0;for(let e of this._keyDeps.values())if(e.hasDependents())return!0;return!1}keys(){return Object.keys(this._value)}set value(e){this._isEqual(this._value,e)||(this._value=e,this._keyDeps.clear(),this._dep.changed())}get value(){return this._addDepend(this._dep),this._proxyValue||(this._proxyValue=a(this._value,{get:(e,t)=>this.get(t),set:(e,t,i)=>(this.set(t,i),!0)})),this._proxyValue}get readonlyValue(){return this._addDepend(this._dep),this._proxyReadonlyValue||(this._proxyReadonlyValue=a(this._value,{get:(e,t)=>this.get(t),set:(e,t)=>{throw Error(`[ReactiveState] Cannnot set readonly field "${t}"`)}})),this._proxyReadonlyValue}constructor(){super(...arguments),this._keyDeps=new Map}};function d(e){let t=(0,o.JA)(),i=(0,n.useMemo)(()=>new Map,[]),s=(0,n.useCallback)(()=>{i.forEach(e=>e.stop()),i.clear()},[]);return(0,n.useEffect)(()=>s,[]),s(),(0,n.useMemo)(()=>void 0===e?{}:a(e,{get(n,o){let s=i.get(o);return s||(s=new r.Computation(i=>i.firstRun?e[o]:void t()),i.set(o,s)),e[o]}}),[e])}function u(e){return d(e.readonlyValue)}var{Dependency:c,Computation:g}=r},832176:function(e,t,i){i.d(t,{Ae:()=>A,Cd:()=>P,Ct:()=>p,E9:()=>I,JA:()=>eE,JT:()=>d,K4:()=>X,KV:()=>ef,Of:()=>es,Pq:()=>H,Q5:()=>W,Qc:()=>ey,RZ:()=>h,S9:()=>ea,V_:()=>y,XJ:()=>g,Zp:()=>en,_b:()=>x,cO:()=>K,dG:()=>U,gE:()=>ei,gw:()=>q,hY:()=>el,i1:()=>er,jl:()=>w,oN:()=>ep,pL:()=>m,r9:()=>eh,rM:()=>E,sI:()=>b,xF:()=>N,y3:()=>j,yb:()=>ev,z:()=>eo});var r,n,o,s,a,l,h,d,u,c,g,p,f,y,m,E,b,D,N,C=i(65881),M=i(908600),{PI:S}=Math,x=2*S,w=180/S,_=class e{sub(t){return new e(this.x-t.x,this.y-t.y)}dot(e){return this.x*e.x+this.y*e.y}constructor(e=0,t=0){this.x=e,this.y=t}},I=class e{clone(){return new e(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.x=this.x,e.y=this.y,e}equals(e){return e.x===this.x&&e.y===this.y}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.x=e,this.y=t,this}constructor(e=0,t=0){this.x=e,this.y=t}},L=I||(I={});function T(e,t,i){return{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)}}L.EMPTY={x:0,y:0},L.getDistance=function(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)},L.getMiddlePoint=function(e,t){return T(e,t,.5)},L.getRatioPoint=T,L.fixZero=function(e){return 0===e.x&&(e.x=0),0===e.y&&(e.y=0),e},L.move=function(e,t){return{x:e.x+(t.x||0),y:e.y+(t.y||0)}},L.moveDistanceToDirection=function(e,t,i){let r=t.x-e.x,n=t.y-e.y,o=0===r?0:Math.sqrt(i**2/(1+n**2/r**2)),s=0===r?i:Math.abs(o*n/r);return{x:e.x+(r>0?o:-o),y:e.y+(n>0?s:-s)}};var A=class e{static get EMPTY(){return new e(0,0,0,0)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}clone(){return new e(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0)&&!(this.height<=0)&&!!(e>=this.x)&&!!(e<=this.right)&&!!(t>=this.y)&&!!(t<=this.bottom)}isEqual(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}containsRectangle(e){return e.left>=this.left&&e.right<=this.right&&e.top>=this.top&&e.bottom<=this.bottom}pad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){let t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),r=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001,i=Math.ceil((this.x+this.width-t)*e)/e,r=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=r-this.y,this}enlarge(e){let t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),r=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=r,this.height=n-r,this}get center(){return{x:this.x+this.width/2,y:this.y+this.height/2}}get rightBottom(){return{x:this.right,y:this.bottom}}get leftBottom(){return{x:this.left,y:this.bottom}}get rightTop(){return{x:this.right,y:this.top}}get leftTop(){return{x:this.left,y:this.top}}get bottomCenter(){return{x:this.x+this.width/2,y:this.bottom}}get topCenter(){return{x:this.x+this.width/2,y:this.top}}get rightCenter(){return{x:this.right,y:this.y+this.height/2}}get leftCenter(){return{x:this.left,y:this.y+this.height/2}}update(e){return e(this)}get crossDistance(){return I.getDistance(this.leftTop,this.rightBottom)}toStyleStr(){return`left: ${this.x}px; top: ${this.y}px; width: ${this.width}px; height: ${this.height}px;`}withPadding(e){return this.x-=e.left,this.y-=e.top,this.width+=e.left+e.right,this.height+=e.top+e.bottom,this}withoutPadding(e){return this.x+=e.left,this.y+=e.top,this.width=this.width-e.left-e.right,this.height=this.height-e.top-e.bottom,this}withHeight(e){return this.height=e,this}clearSpace(){return this.width=0,this.height=0,this}constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.width=i,this.height=r,this.type=1}},O=A||(A={});function k(e){let t=O.EMPTY.clone();if(!e.length)return t;let i=[],r=[],n=[],o=[];e.forEach(e=>{i.push(e.left),n.push(e.right),o.push(e.bottom),r.push(e.top)});let s=Math.min.apply(Math,i),a=Math.max.apply(Math,n),l=Math.min.apply(Math,r),h=Math.max.apply(Math,o);return t.x=s,t.width=a-s,t.y=l,t.height=h-l,t}O.align=function(e,t){if(e.length<=1)return e;switch(t){case"align-bottom":let i=Math.max(...e.map(e=>e.bottom));e.forEach(e=>{e.y=i-e.height});break;case"align-center":let r=k(e).center.x;e.forEach(e=>{e.x=r-e.width/2});break;case"align-left":let n=Math.min(...e.map(e=>e.left));e.forEach(e=>{e.x=n});break;case"align-middle":let o=k(e).center.y;e.forEach(e=>{e.y=o-e.height/2});break;case"align-right":let s=Math.max(...e.map(e=>e.right));e.forEach(e=>{e.x=s-e.width});break;case"align-top":let a=Math.min(...e.map(e=>e.top));e.forEach(e=>{e.y=a});break;case"distribute-horizontal":if(e.length<=2)break;let l=e.slice().sort((e,t)=>e.left-t.left),h=k(e),d=e.reduce((e,t)=>e-t.width,h.width)/(e.length-1);l.reduce((e,t)=>(t.x=e,e+t.width+d),h.x);break;case"distribute-vertical":if(e.length<=2)break;let u=e.slice().sort((e,t)=>e.top-t.top),c=k(e),g=e.reduce((e,t)=>e-t.height,c.height)/(e.length-1);u.reduce((e,t)=>(t.y=e,e+t.height+g),c.y)}return e},O.enlarge=k,O.intersects=function(e,t,i){let r=e.left,n=e.top,o=e.right,s=e.bottom,a=t.left,l=t.top,h=t.right,d=t.bottom;return"horizontal"===i?o>a&&r<h:"vertical"===i?s>l&&n<d:!!(o>a)&&!!(r<h)&&!!(s>l)&&!!(n<d)},O.intersectsWithRotation=function(e,t,i,r){let n=new R(e.center,e.width,e.height,t),o=new R(i.center,i.width,i.height,r),s=n.centerPoint.sub(o.centerPoint),a=n.axesX;if(n.getProjectionRadius(a)+o.getProjectionRadius(a)<=Math.abs(s.dot(a)))return!1;let l=n.axesY;if(n.getProjectionRadius(l)+o.getProjectionRadius(l)<=Math.abs(s.dot(l)))return!1;let h=o.axesX;if(n.getProjectionRadius(h)+o.getProjectionRadius(h)<=Math.abs(s.dot(h)))return!1;let d=o.axesY;return!(n.getProjectionRadius(d)+o.getProjectionRadius(d)<=Math.abs(s.dot(d)))},O.isViewportVisible=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r?t.containsRectangle(e):0===i?O.intersects(e,t):O.intersectsWithRotation(e,i,t,0)},O.setViewportVisible=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{left:r,right:n,top:o,bottom:s,width:a,height:l}=e,{left:h,right:d,top:u,bottom:c}=t;return r<=h?e.x=h+i:n>=d&&(e.x=d-i-a),o<=u?e.y=u+i:s>=c&&(e.y=c-i-l),e},O.createRectangleWithTwoPoints=function(e,t){let i=e.x<t.x?e.x:t.x,r=e.y<t.y?e.y:t.y;return new O(i,r,Math.abs(e.x-t.x),Math.abs(e.y-t.y))};var R=class{getProjectionRadius(e){return this.width/2*Math.abs(e.dot(this.axesX))+this.height/2*Math.abs(e.dot(this.axesY))}constructor(e,t,i,r){this.width=t,this.height=i,this.centerPoint=new _(e.x,e.y),this.axesX=new _(Math.cos(r),Math.sin(r)),this.axesY=new _(-1*this.axesX.y,this.axesX.x)}},P=class e{clone(){return new e(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;let i=this.radius*this.radius,r=this.x-e,n=this.y-t;return r*=r,n*=n,r+n<=i}getBounds(){return new A(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.radius=i,this.type=2}},j=class e{static get IDENTITY(){return new e}static get TEMP_MATRIX(){return new e}fromArray(e){return e.length<6||(this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]),this}set(e,t,i,r,n,o){return this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o,this}toArray(e,t){this.array||(this.array=new Float32Array(9));let i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0),i[8]=1,i}apply(e,t){let{x:i,y:r}=e;return(t=t||{x:0,y:0}).x=this.a*i+this.c*r+this.tx,t.y=this.b*i+this.d*r+this.ty,t}applyInverse(e,t){t=t||{x:0,y:0};let i=1/(this.a*this.d+-(this.c*this.b)),{x:r}=e,{y:n}=e;return t.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){let t=Math.cos(e),i=Math.sin(e),r=this.a,n=this.c,o=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=n*t-this.d*i,this.d=n*i+this.d*t,this.tx=o*t-this.ty*i,this.ty=o*i+this.ty*t,this}append(e){let t=this.a,i=this.b,r=this.c,n=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*i+e.b*n,this.c=e.c*t+e.d*r,this.d=e.c*i+e.d*n,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*i+e.ty*n+this.ty,this}setTransform(e,t,i,r,n,o,s,a,l){return this.a=Math.cos(s+l)*n,this.b=Math.sin(s+l)*n,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=e-(i*this.a+r*this.c),this.ty=t-(i*this.b+r*this.d),this}prepend(e){let t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){let t=this.a,i=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){let{a:t}=this,{b:i}=this,{c:r}=this,{d:n}=this,o=-Math.atan2(-r,n),s=Math.atan2(i,t),a=Math.abs(o+s);return a<1e-5||1e-5>Math.abs(x-a)?(e.rotation=s,e.skew.x=0,e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=s),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(r*r+n*n),e.position.x=this.tx,e.position.y=this.ty,e}invert(){let e=this.a,t=this.b,i=this.c,r=this.d,n=this.tx,o=e*r-t*i;return this.a=r/o,this.b=-t/o,this.c=-i/o,this.d=e/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(e*this.ty-t*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}isSimple(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d}clone(){let t=new e;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}constructor(e=1,t=0,i=0,r=1,n=0,o=0){this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o,this.array=null}},z=class e{get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}clone(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.cb,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scope;return new e(t,i,this._x,this._y)}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.x=this._x,e.y=this._y,e}equals(e){return e.x===this._x&&e.y===this._y}constructor(e,t,i=0,r=0){this._x=i,this._y=r,this.cb=e,this.scope=t}},V=class{onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){let e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){let t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){let i=e.worldTransform,r=this.worldTransform;r.a=t.a*i.a+t.b*i.c,r.b=t.a*i.b+t.b*i.d,r.c=t.c*i.a+t.d*i.c,r.d=t.c*i.b+t.d*i.d,r.tx=t.tx*i.a+t.ty*i.c+i.tx,r.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}constructor(){this.worldTransform=new j,this.localTransform=new j,this.position=new z(this.onChange,this,0,0),this.scale=new z(this.onChange,this,1,1),this.pivot=new z(this.onChange,this,0,0),this.skew=new z(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}};function B(e,t,i){let r=i-t;return t+((e-t)%r+r)%r}V.IDENTITY=new V,(r=h||(h={})).wrap=function(e){return B(e,-Math.PI,Math.PI)},r.wrapDegrees=function(e){return B(e,-180,180)},r.betweenPoints=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0},r={x:e.x-i.x,y:e.y-i.y},n={x:t.x-i.x,y:t.y-i.y};return Math.atan2(r.x*n.y-r.y*n.x,r.x*n.x+r.y*n.y)};var{keys:F}=Object;Object.prototype.hasOwnProperty;var Y=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return F(e).reduce((i,r)=>t(i,e[r],r),i)},U=()=>{};Object.prototype.toString;var $=d||(d={});function G(e){return{dispose:e}}$.is=function(e){return"object"==typeof e&&null!==e&&"function"==typeof e.dispose},$.create=G,$.NULL=Object.freeze(G(()=>{})),(u||(u={})).None=()=>d.NULL;var Q=class e{get event(){return this._event||(this._event=(t,i)=>{if(this._disposed)return d.NULL;this._listeners||(this._listeners=[]);let r=i?t.bind(i):t;this._listeners.length>=e.LEAK_WARNING_THRESHHOLD&&console.warn(`[Emitter] Listeners length >= ${e.LEAK_WARNING_THRESHHOLD}`),this._listeners.push(r);let n={dispose:()=>{if(n.dispose=U,!this._disposed){let e=this._listeners.indexOf(r);-1!==e&&this._listeners.splice(e,1)}}};return n}),this._event}fire(e){this._listeners&&this._listeners.forEach(t=>t(e))}get disposed(){return this._disposed}dispose(){this._listeners&&(this._listeners=void 0),this._disposed=!0}constructor(){this._disposed=!1}};Q.LEAK_WARNING_THRESHHOLD=175;var W=Q,H=class{dispose(){this.toDispose.dispose()}get disposed(){return this.toDispose.disposed}get onDispose(){return this.toDispose.onDispose}constructor(){this.toDispose=new X}},X=class{get length(){return this.disposables.length}get onDispose(){return this.onDisposeEmitter.event}get disposed(){return this._disposed}dispose(){this.disposed||(this._disposed=!0,this.disposables.slice().reverse().forEach(e=>{try{e.dispose()}catch(e){console.error(e)}}),this.onDisposeEmitter.fire(void 0),this.onDisposeEmitter.dispose())}push(e){if(this.disposed||e===d.NULL)return d.NULL;let{disposables:t}=this;if(t.find(t=>t===e))return d.NULL;let i=e.dispose,r=d.create(()=>{let r=t.indexOf(e);-1!==r&&t.splice(r,1),e.dispose=i});return e.dispose=()=>{r.dispose(),e.dispose()},t.push(e),r}pushAll(e){return e.map(e=>this.push(e))}constructor(...e){this.disposables=[],this.onDisposeEmitter=new W,this._disposed=!1,e.forEach(e=>this.push(e))}},J=Object.freeze(function(e,t){let i=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(i)}}});(n=c||(c={})).isCancellationToken=function(e){return e===n.None||e===n.Cancelled||e instanceof Z||!!e&&"object"==typeof e&&"boolean"==typeof e.isCancellationRequested&&"function"==typeof e.onCancellationRequested},n.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:u.None}),n.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:J});var Z=class{cancel(){!this._isCancelled&&(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?J:(this._emitter||(this._emitter=new W),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}constructor(){this._isCancelled=!1}},K=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};function q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.None,i=new K,r=setTimeout(()=>i.resolve(),e);return t.onCancellationRequested(()=>{clearTimeout(r),i.reject(Error("Cancelled"))}),i.promise}var ee=g||(g={});function et(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(e===t)return!1;if(0===i||"object"!=typeof e||"object"!=typeof t)return e!==t;let n=Object.keys(t);if(!r){let t=Object.keys(e);if(n.length!==t.length)return!0}for(let o=0,s=n.length;o<s;o++){let s=n[o];if(et(e[s],t[s],i-1,r))return!0}return!1}ee.isChanged=et,ee.isDeepChanged=function(e,t,i){return et(e,t,1/0,i)},ee.isArrayShallowChanged=function(e,t){if(e.length!==t.length)return!0;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!0;return!1},(o=p||(p={})).create=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[];return{getFromCache:()=>i,getMore(r){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(r===i.length);else if(r>i.length){let t=r-i.length;for(;t>0;)i.push(e()),t--}else if(n){let e=t.deleteLimit??0;i.length-r>e&&i.splice(r).forEach(e=>e.dispose&&e.dispose())}return i.slice(0,r)},getMoreByItemKeys(t){let r=[],n=new Map;return i.forEach(e=>{if(t.find(t=>t.key===e.key))n.set(e.key,e);else{var i;null==(i=e.dispose)||i.call(e)}}),t.forEach(t=>{if(!t.key)throw Error("getMoreByItemKeys need a key");let i=n.get(t.key);i?r.push(i):r.push(e(t))}),i=r},getMoreByItems(t){let r=[],n=new Map;return i.forEach(e=>{if(t.find(t=>t===e.key))n.set(e.key,e);else{var i;null==(i=e.dispose)||i.call(e)}}),t.forEach(t=>{let i=n.get(t);i?r.push(i):r.push({...e(t),key:t})}),i=r},get:()=>(i.length>0||i.push(e()),i[0]),getFromCacheByKey:e=>i.find(t=>t.key===e),dispose(){i.forEach(e=>e.dispose&&e.dispose()),i.length=0},clear(){this.dispose()}}},o.assign=function(e,t){return Object.assign(e,t)},o.createShortCache=function(){let e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;function r(){t&&clearTimeout(t),t=setTimeout(()=>{t=void 0,e=void 0},i)}return{get:t=>(e||(e=t()),r(),e)}},o.createWeakCache=function(){let e=new WeakMap;return{get:t=>e.get(t),save:(t,i)=>e.set(t,i),isChanged:(t,i)=>g.isChanged(e.get(t),i)}},(f||(f={})).create=function(e,t,i){return{type:"object",properties:{...null==t?void 0:t.properties,...e},mixinDefaults:{...null==t?void 0:t.mixinDefaults,...i}}},(s=y||(y={})).createDefault=function e(t,i,r){i={...t.mixinDefaults,...i};let n=r?`${r}.`:"";if(t.properties){let r,o;return r=t.properties,o=(t,r)=>{let o=n+r;return i&&void 0!==i[o]?i[o]:e(t,i,o)},Y(r,(e,t,i)=>Object.assign(e,{[i]:o(t,i)}))}return"function"==typeof t.default?t.default():t.default},s.isBaseType=function(e){return"string"===e.type||"float"===e.type||"integer"===e.type||"boolean"===e.type||"enum"===e.type||"color"===e.type||"range"===e.type};var ei={label:"",properties:{width:{label:"",default:0,type:"float"},height:{label:"",default:0,type:"float"},locked:{label:"",default:!1,type:"boolean"}},type:"object"},er={label:"",description:"",properties:{x:{label:"x",default:.5,type:"float"},y:{label:"y",default:.5,type:"float"}},type:"object"},en={label:"",properties:{x:{label:"x",default:0,type:"float"},y:{label:"y",default:0,type:"float"}},type:"object"},eo={label:"",type:"float",default:0},es={label:"",properties:{x:{label:"x",default:1,type:"float"},y:{label:"y",default:1,type:"float"}},type:"object"},ea={label:"",properties:{x:{label:"x",default:0,type:"float"},y:{label:"y",default:0,type:"float"}},type:"object"},el={properties:{position:en,size:ei,origin:er,scale:es,skew:ea,rotation:eo},type:"object"};(a=m||(m={})).createDefault=function(){return y.createDefault(el)},a.toJSON=function(e){return{position:{x:e.position.x,y:e.position.y},size:{width:e.size.width,height:e.size.height,locked:e.size.locked},origin:{x:e.origin.x,y:e.origin.y},scale:{x:e.scale.x,y:e.scale.y},skew:{x:e.skew.x,y:e.skew.y},rotation:e.rotation}},a.getDelta=function(e,t){return{position:{x:t.position.x-e.position.x,y:t.position.y-e.position.y},size:{width:t.size.width-e.size.width,height:t.size.height-e.size.height},origin:{x:t.origin.x-e.origin.x,y:t.origin.y-e.origin.y},scale:{x:t.scale.x-e.scale.x,y:t.scale.y-e.scale.y},skew:{x:t.skew.x-e.skew.x,y:t.skew.y-e.skew.y},rotation:t.rotation-e.rotation}},a.mergeDelta=function(e,t,i){let r=void 0!==i?e=>Math.round(100*e)/100:e=>e;return{position:{x:r(t.position.x+e.position.x),y:r(t.position.y+e.position.y)},size:{width:r(t.size.width+e.size.width),height:r(t.size.height+e.size.height),locked:e.size.locked},origin:{x:r(t.origin.x+e.origin.x),y:r(t.origin.y+e.origin.y)},scale:{x:r(t.scale.x+e.scale.x),y:r(t.scale.y+e.scale.y)},skew:{x:r(t.skew.x+e.skew.x),y:r(t.skew.y+e.skew.y)},rotation:t.rotation+e.rotation}},a.is=function(e){return e&&e.position&&e.size&&"number"==typeof e.position.x&&"number"==typeof e.size.width},(l=E||(E={})).fixSize=function(e,t){if(e.width<=t.width&&e.height<=t.height)return 1;let i=e.width/t.width,r=e.height/t.height;return 1/(i>r?i:r)},l.coverSize=function(e,t){let i=e.width/t.width,r=e.height/t.height;return 1/(i<r?i:r)},l.empty=function(){return{width:0,height:0}},(b||(b={})).empty=()=>({left:0,right:0,top:0,bottom:0}),(D||(D={})).isEmpty=function(e){return!e||void 0===e.topLeft&&void 0===e.topRight&&void 0===e.bottomLeft&&void 0===e.bottomRight};var eh={label:"",type:"float",min:0,max:1,default:1},ed=N||(N={});function eu(e){return`${e}px`}function ec(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let n=document.createElement(e);return i.length>0&&(n.className=(0,C.Z)(i)),n}ed.toPixel=eu,ed.fromPercent=function(e){return parseFloat(e.substring(0,e.length-1))},ed.toPercent=function(e){return`${e}%`},ed.enableEvent=function(e){e.style.pointerEvents="all"},ed.disableEvent=function(e){e.style.pointerEvents="none"},ed.createElement=ec,ed.createDivWithClass=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return ec("div",...t)},ed.addClass=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];e.className=(0,C.Z)(i.concat(e.className.split(" ")))},ed.delClass=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];i.forEach(t=>{e.classList.remove(t)}),e.className=e.classList.toString()},ed.coverClass=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];e.className=(0,C.Z)(i)},ed.clearChildren=function(e){e.innerHTML=""},ed.translatePercent=function(e,t,i){e.style.transform=`translate(${t}%, ${i}%)`},ed.translateXPercent=function(e,t){e.style.transform=`translateX(${t}%)`},ed.translateYPercent=function(e,t){e.style.transform=`translateY(${t}%)`},ed.setStyle=function(e,t){let i=[];F(t).forEach(e=>((e,t)=>{void 0!==e&&("number"==typeof e&&"opacity"!==t&&"zIndex"!==t&&"scale"!==t&&(e=eu(e)),i.push(`${t.replace(/([A-Z])/,e=>`-${e.toLowerCase()}`)}:${e}`))})(t[e],e));let r=e.getAttribute("style"),n=i.join(";");r!==n&&e.setAttribute("style",n)},ed.classNameWithPrefix=function(e){return(t,i)=>(0,C.Z)(t.split(/\s+/).map(t=>`${e}-${t}`).join(" "),i)},ed.addStandardDisposableListener=function(e,t,i,r){return e.addEventListener(t,i,r),d.create(()=>{e.removeEventListener(t,i)})},ed.createDOMCache=function(e,t,i){return p.create(()=>{let r="string"==typeof t?ed.createDivWithClass(t):t();return i&&(r.innerHTML=i),e.appendChild(r),Object.assign(r,{dispose:()=>{let{parentNode:e}=r;e&&e.removeChild(r)},setStyle:e=>{ed.setStyle(r,e)}})})};var eg=0;function ep(){return eg===Number.MAX_SAFE_INTEGER&&(eg=0),eg++}function ef(e,t,i){e(t).toSelf().inSingletonScope(),i.forEach(i=>e(i).toService(t))}var ey=Symbol("ContributionProvider"),em=class{forEach(e){this.getContributions().forEach(e)}getContributions(){if(!this.services){let e=[],{container:t}=this;if(t.isBound(this.identifier))try{e.push(...t.getAll(this.identifier))}catch(e){console.error(e)}this.services=e}return this.services}constructor(e,t){this.container=e,this.identifier=t}};function ev(e,t){e(ey).toDynamicValue(e=>new em(e.container,t)).inSingletonScope().whenTargetNamed(t)}function eE(e){let[,t]=(0,M.useState)(e);return(0,M.useCallback)(e=>t(void 0!==e?e:{}),[])}new class{isDevEnv(){return!1}info(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(this.isDevEnv())return console.info(t)}log(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(this.isDevEnv())return console.log(...t)}error(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.error(...t)}warn(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.warn(...t)}}},57064:function(e,t,i){i.d(t,{Bl:()=>g,Bw:()=>k,Co:()=>K,FC:()=>Z,GH:()=>P,Ps:()=>Y,Us:()=>B,au:()=>L,b5:()=>I,fu:()=>N,j0:()=>p,kq:()=>J,o:()=>X,pm:()=>W,ps:()=>z,yf:()=>F});var r=i(461932),n=i(430550),o=i(832176),s=i(893740),a=i(908600),l=i(444596),h=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?d(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&h(t,i,o),o},c=Symbol("NodeContribution"),g=class{registerMaterialRender(e,t){this.materialRenderRegistry.set(e,t)}getMaterialRender(e){return this.materialRenderRegistry.get(e)}registerPluginRender(e,t){this.pluginRenderRegistry.set(e,t)}getPluginRender(e){return this.pluginRenderRegistry.get(e)}registerNodeErrorRender(e){this.registerMaterialRender("Material_CustomNodeError",e)}get nodeRenderHoc(){return(0,n.Z)(this.nodeRenderHocs)}registerNodeRenderHoc(e){this.nodeRenderHocs.push(e)}get nodeErrorRender(){return this.materialRenderRegistry.get("Material_CustomNodeError")}init(){this.nodeContributions.forEach(e=>{var t;return null==(t=e.onRegister)?void 0:t.call(e,this)})}constructor(){this.materialRenderRegistry=new Map,this.pluginRenderRegistry=new Map,this.nodeRenderHocs=[],this.nodeContributions=[]}};u([(0,r.nx)(c),(0,r.jt)()],g.prototype,"nodeContributions",2),u([(0,r.zY)()],g.prototype,"init",1),g=u([(0,r.b2)()],g);var p=class{get json(){return this._json}get readonly(){return this._readonly}set readonly(e){this._readonly=e,this.fireChange()}fireChange(){this.updateJSON(),this.onChangeEmitter.fire(this)}updateJSON(){this._json={readonly:this._readonly}}constructor(){this.onChangeEmitter=new o.Q5,this.onChange=this.onChangeEmitter.event,this._readonly=p.DEFAULT_READONLY,this._json=p.DEFAULT_JSON}};p.DEFAULT_READONLY=!1,p.DEFAULT_JSON={readonly:p.DEFAULT_READONLY},p=u([(0,r.b2)()],p);var f=class{};u([(0,r.f3)(g)],f.prototype,"nodeManager",2),u([(0,r.f3)(p)],f.prototype,"context",2),f=u([(0,r.b2)()],f);var y=new r.nZ((e,t,i,r)=>{e(f).toSelf().inSingletonScope(),e(g).toSelf().inSingletonScope(),e(p).toSelf().inSingletonScope()}),m="Plugin_Form",E="Plugin_Error",b="node_error_render",D="node_placeholder_render",N=class extends s.RD{getDefaultData(){return{error:null}}setError(e){this.update({error:e})}getError(){return this.data.error}};N.type="FlowNodeErrorData";var C={color:"#f54a45"},M=e=>{let{node:t,playgroundContext:i,clientContext:r}=e,n=(0,s.JA)(),o=t.getData(N),l=o.getError(),h=(0,s.G2)(g).getMaterialRender(b),d=(0,a.useCallback)(()=>h?h({error:l,context:{node:t,playgroundContext:i,clientContext:r}}):(e=>{let{error:t}=e;return a.createElement("div",{style:C},t.message)})({error:l,context:{node:t,playgroundContext:i,clientContext:r}}),[l,t,i,r]);return(0,a.useEffect)(()=>{let e=o.onDataChange(()=>{n()});return()=>{e.dispose()}},[]),l?d():null},S=e=>a.createElement(M,{...e}),x=class{onRegister(e){e.registerPluginRender(E,S)}};x=u([(0,r.b2)()],x);var w=new r.nZ(e=>{(0,o.KV)(e,x,[c])}),_=class{makeFormItemMaterialContext(e,t){return{meta:e.meta,path:e.path,readonly:this.nodeEngineContext.readonly,getFormItemValueByPath:e.formModel.getFormItemValueByPath.bind(e.formModel),onFormValidate:e.formModel.onValidate.bind(e.formModel),form:e.formModel,node:e.formModel.flowNodeEntity,playgroundContext:this.playgroundContext,index:null==t?void 0:t.getIndex()}}};u([(0,r.f3)(p)],_.prototype,"nodeEngineContext",2),u([(0,s.el)()],_.prototype,"playgroundContext",2),_=u([(0,r.b2)()],_);var I=class{static normalize(e){return e===I.ROOT||e.endsWith(I.DIVIDER)&&(e=e.slice(0,-1)),e}static join(e){if(e[1].startsWith(I.ROOT))throw Error(`FormPathService Error: join failed, invalid paths[1], paths[1]= ${e[1]}`);return e[0].endsWith(I.DIVIDER)?`${e[0]}${e[1]}`:e.join(I.DIVIDER)}static toArrayPath(e){return I.join([e,I.ARRAY])}static parseArrayItemPath(e){let t=e.split("/"),i=0;for(;i<t.length;){let e=parseInt(t[i]);if(!isNaN(e)){let r=I.toArrayPath(t.slice(0,i).join(I.DIVIDER)),n=t.slice(i+1).join(I.DIVIDER),o=I.join([r,n]);return{itemIndex:e,arrayPath:r,itemMetaPath:o}}i+=1}return null}simplify(e){let t=e.split(I.DIVIDER),i=[];for(let e=0;e<t.length;e++){if(!t[e])throw Error("FormPathService: join failed");t[e]!==I.RELATIVE_CURRENT&&(t[e]===I.RELATIVE_PARENT&&i.pop(),i.push(t[e]))}return i.join(I.DIVIDER)}};I.ROOT="/",I.DIVIDER="/",I.RELATIVE_PARENT="..",I.RELATIVE_CURRENT=".",I.ARRAY="[]",I=u([(0,r.b2)()],I),Symbol("FormModelFactory"),Symbol("FormModelEntity");var L=class{constructor(){this.toDispose=new o.K4}};L=u([(0,r.b2)()],L);var T=class{register(e){this.registry.set(e.key,e)}get(e){return this.registry.get(e)}get objectMap(){return Object.fromEntries(this.registry)}get collection(){return Array.from(this.registry.values())}constructor(){this.registry=new Map}};T=u([(0,r.b2)()],T);var A=Symbol("FormContribution"),O=class e{get type(){return e.type}};O.type="setter";var k=O,R=class e{get type(){return e.type}};R.type="decorator";var P=R;var j=class e{get type(){return e.type}};j.type="effect";var z=j;var V=class e{get type(){return e.type}};V.type="validation";var B=V,F=class{get components(){var e;return(0,l.Z)((null==(e=this.extensionRegistryMap.get(k.type))?void 0:e.objectMap)||{},e=>e.component)}get decorators(){var e;return(0,l.Z)((null==(e=this.extensionRegistryMap.get(P.type))?void 0:e.objectMap)||{},e=>e.component)}registerAbilityExtension(e,t){this.extensionRegistryMap.get(e)||this.extensionRegistryMap.set(e,new T);let i=this.extensionRegistryMap.get(e);i&&i.register(t)}getAbilityExtension(e,t){var i;return null==(i=this.extensionRegistryMap.get(e))?void 0:i.get(t)}registerAbility(e){let t=new e;this.abilityRegistry.set(t.type,t)}registerAbilities(e){e.forEach(this.registerAbility.bind(this))}getAbility(e){return this.abilityRegistry.get(e)}registerSetterHoc(e){this.setterHocs.push(e)}fireFormModelWillInit(e,t){this.onFormModelWillInitEmitter.fire({model:e,data:t})}dispose(){this.onFormModelWillInitEmitter.dispose()}init(){this.formContributions.forEach(e=>{var t;return null==(t=e.onRegister)?void 0:t.call(e,this)})}constructor(){this.abilityRegistry=new Map,this.setterHocs=[],this.extensionRegistryMap=new Map,this.formContributions=[],this.onFormModelWillInitEmitter=new o.Q5,this.onFormModelWillInit=this.onFormModelWillInitEmitter.event}};u([(0,r.f3)(I)],F.prototype,"pathManager",2),u([(0,r.f3)(_)],F.prototype,"formContextMaker",2),u([(0,s.el)()],F.prototype,"playgroundContext",2),u([(0,r.nx)(A),(0,r.jt)()],F.prototype,"formContributions",2),u([(0,r.zY)()],F.prototype,"init",1),F=u([(0,r.b2)()],F);var Y=class extends s.RD{getFormModel(){return this.formModel}getDefaultData(){return{}}createForm(e,t){let i=this.flowNodeEntity.getData(N);i.setError(null);try{this.formModel.init(e,t)}catch(e){i.setError(e)}}updateFormValues(e){this.formModel.updateFormValues(e)}recreateForm(e,t){this.createForm(e,t)}toJSON(){return this.formModel.toJSON()}dispose(){super.dispose()}fireDetaiChange(e){this.onDetailChangeEmitter.fire(e)}constructor(e,t){super(e),this.onDetailChangeEmitter=new o.Q5,this.onDetailChange=this.onDetailChangeEmitter.event,this.flowNodeEntity=e,this.formModel=t.formModelFactory(e),this.toDispose.push(this.onDetailChangeEmitter),this.toDispose.push(o.JT.create(()=>{this.formModel.dispose()}))}};function U(e){var t;let{node:i}=e,r=(0,o.JA)(),n=null==(t=i.getData(Y))?void 0:t.getFormModel();return(0,a.useEffect)(()=>{let e=null==n?void 0:n.onInitialized(()=>{r()});return()=>{e.dispose()}},[n]),(null==n?void 0:n.initialized)?n.render():null}Y.type="FlowNodeEntityFormData";var $=e=>a.createElement(U,{...e}),G=class{onRegister(e){e.registerPluginRender(m,$)}};G=u([(0,r.b2)()],G);var Q=new r.nZ(e=>{e(F).toSelf().inSingletonScope(),e(I).toSelf().inSingletonScope(),e(_).toSelf().inSingletonScope(),(0,o.KV)(e,G,[c])});function W(){return[y,Q,w]}var H=a.createContext(p.DEFAULT_JSON),X=(0,a.memo)(e=>{let{node:t}=e,i=(0,s.JA)(),r=t.getData(N),n=t.getData(Y).formModel,o=!!t.getData(N).getError(),l=t.getData(Y).getFormModel().initialized,h=(0,s.G2)(s.xm),d=(0,s.G2)(s.Zn),u=(0,s.G2)(g),c=u.getPluginRender(m),f=u.getPluginRender(E),y=u.getMaterialRender(D),b=function(){let e=(0,s.JA)(),t=(0,s.G2)(p);return(0,a.useEffect)(()=>{let i=t.onChange(()=>{e()});return()=>{i.dispose()}},[]),t}();(0,a.useEffect)(()=>{let e=r.onDataChange(()=>{i()}),t=n.onInitialized(()=>{i()});return()=>{e.dispose(),t.dispose()}},[]);let C=(0,a.useCallback)(()=>o?f({node:t,playgroundContext:h,clientContext:d}):n.formMeta?l?c({node:t,playgroundContext:h,clientContext:d}):(null==y?void 0:y({node:t,playgroundContext:h}))||null:null,[o,l,f,c,y,t,h]);return a.createElement(H.Provider,{value:b.json},u.nodeRenderHoc(C)())});function J(e,t){e.registerMaterialRender(b,t)}function Z(e,t){e.registerMaterialRender(D,t)}function K(){return[Y,N]}},755395:function(e,t,i){i.d(t,{C$:()=>O,F2:()=>eo,Np:()=>et,Od:()=>A,eP:()=>B,gN:()=>G,l0:()=>er,lE:()=>q,qo:()=>en,rR:()=>s});var r,n,o,s,a,l=i(908600),h=i(314112),d=i(832176),u=i(875787),c=i(349090),g=i(626866),p=i(661195),f=i(969134),y=i(13721),m=i(325486),E=i(938573),b=i(437104),D=i(268479),N=i(952893),C=i(433210),M=i(959250),S=i(336808),x=e=>null!==e&&"object"==typeof e,w=e=>String(Math.floor(Number(e)))===e;function _(e,t){let i=new Set(t),r={};return Object.keys(e).forEach(t=>{i.has(t)&&(r[t]=e[t])}),r}var I=s||(s={});function L(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let n=i.shift();if(void 0===n)return e.toString();let o="";return(o=""===e&&""===n?"":""!==e&&""===n?e.toString():""===e&&""!==n?n.toString():`${e}${I.DIVIDER}${n}`,i.length>0)?L(o,...i):o}function T(e,t,i){if(!e||!t)return[];let r=t.split(I.DIVIDER),n=r.shift(),o=[],s=e;for(;n;){if("object"!=typeof s||null===s)return[];if(n===I.ALL){let e=o.join(I.DIVIDER);return(0,p.Z)(Object.keys(s).map(t=>0===r.length?L(e,t):T(s[t],`${r.join(I.DIVIDER)}`,i).map(i=>L(e,t,i))))}if(!(n in s)&&!i)return[];s=s[n],o.push(n),n=r.shift()}return[t]}I.DIVIDER=".",I.ALL="*",I.isMatch=function(e,t){let i=e.split(I.DIVIDER),r=t.split(I.DIVIDER);return i.length===r.length&&i.every((e,t)=>e===I.ALL||e===r[t])},I.isMatchOrParent=function(e,t){if(""===e)return!0;let i=e.split(I.DIVIDER),r=t.split(I.DIVIDER);if(i.length>r.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!==I.ALL&&i[e]!==r[e])return!1;return!0},I.getParentPathByPattern=function(e,t){let i=e.split(I.DIVIDER);return t.split(I.DIVIDER).slice(0,i.length).join(I.DIVIDER)},I.getSubPaths=function(e,t){return t&&"object"==typeof t?(0,p.Z)(e.map(e=>{let i=""===e?t:(0,f.Z)(t,e);return(0,y.Z)(i)?i.map((t,i)=>L(e,i)):(0,m.Z)(i)?Object.keys(i).map(t=>L(e,t)):[]})):[]},I.splitPattern=function(e){let t=e.split(I.DIVIDER),i=[],r=0,n=[];for(;r<t.length;)t[r]===I.ALL?(n.length&&i.push(n.join(I.DIVIDER)),i.push(I.ALL),n=[]):n.push(t[r]),r+=1;return n.length&&i.push(n.join(I.DIVIDER)),i},I.findMatchPaths=T,I.findMatchPathsWithEmptyValue=function(e,t){return t.includes("*")?T(e,t,!0):[t]};var A=((r=A||{}).Error="error",r.Warning="warning",r),O=((n=O||{}).onChange="onChange",n.onBlur="onBlur",n),k=class e{get parent(){if(!(this._path.length<2))return new e(this._path.slice(0,-1))}toString(){return this._path.join(".")}get value(){return this._path}isChild(t){let i=new e(t).value,r=this.value;if(i.length-r.length!=1)return!1;for(let e=0;e<r.length;e++)if(i[e]!==r[e])return!1;return!0}static compareArrayPath(e,t){let i=0;for(;e.value[i]&&t.value[i];){let r=parseInt(e.value[i]),n=parseInt(t.value[i]);if(!isNaN(r)&&!isNaN(n))return r-n;if(e.value[i]!==t.value[i])throw Error(`[Form] Path.compareArrayPath invalid input Error: two path should refers to the same array, but got path1: ${e.toString()}, path2: ${t.toString()}`);i++}throw Error(`[Form] Path.compareArrayPath invalid input Error: got path1: ${e.toString()}, path2: ${t.toString()}`)}isChildOrGrandChild(t){let i=new e(t).value,r=this.value;if(i.length-r.length<1)return!1;for(let e=0;e<r.length;e++)if(i[e]!==r[e])return!1;return!0}getArrayIndex(e){return parseInt(this._path[e.value.length])}concat(t){if("string"==typeof t||"number"==typeof t)return new e(this._path.concat(new e(t.toString())._path));throw Error(`[Form] Error in Path.concat: invalid param type, require number or string, but got ${typeof t}`)}replaceParent(t,i){if(t.value.length>this.value.length)throw Error(`[Form] Error in Path.replaceParent: invalid parent param: ${t}, parent length should not greater than current length.`);let r=[];for(let e=0;e<this.value.length;e++){if(e<t.value.length&&t.value[e]!==this.value[e])throw Error(`[Form] Error in Path.replaceParent: invalid parent param: '${t}' is not a parent of '${this.toString()}'`);e>=t.value.length&&r.push(this.value[e])}return new e(i.value.concat(r))}constructor(e){this._path=[],this._path=(0,c.Z)(e)}};function R(e,t){return(e||[]).map(e=>({...e,name:t}))}function P(e,t){return t?e?Object.keys(t).some(i=>!(0,E.Z)(e[i],t[i]))?{...e,...t}:e:{...t}:e}function j(e,t){return t&&e in t&&delete t[e],t}function z(e){let t={get name(){return e.name},get value(){return e.value},onChange:t=>{"object"==typeof t&&null!==t&&"target"in t&&"object"==typeof t.target?e.value="object"==typeof t&&null!==t&&"target"in t&&"object"==typeof t.target&&"checkbox"===t.target.type?t.target.checked:t.target.value:e.value=t},onBlur(){"onBlur"===e.form.validationTrigger&&e.validate()},onFocus(){e.state.isTouched=!0}};return Object.defineProperty(t,"key",{enumerable:!1,get:()=>e.id}),Object.defineProperty(t,"_fieldModel",{enumerable:!1,get:()=>e}),t}function V(e){return{get isTouched(){return e.isTouched},get invalid(){return e.invalid},get isDirty(){return e.isDirty},get isValidating(){return e.isValidating},get errors(){if(e.errors)return Object.values(e.errors).reduce((e,t)=>e.concat(t),[]);return},get warnings(){if(e.warnings)return Object.values(e.warnings).reduce((e,t)=>e.concat(t),[]);return}}}function B(e){let t={initialValues:e.initialValues,get values(){return e.values},set values(v){e.values=v},state:F(e.state),getValueIn:t=>e.getValueIn(t),setValueIn:(t,i)=>e.setValueIn(t,i),validate:e.validate.bind(e)};return Object.defineProperty(t,"_formModel",{enumerable:!1,get:()=>e}),t}function F(e){return{get isTouched(){return e.isTouched},get invalid(){return e.invalid},get isDirty(){return e.isDirty},get isValidating(){return e.isValidating},get errors(){return e.errors},get warnings(){return e.warnings}}}(o=a||(a={})).shouldTriggerFieldChangeEvent=function(e,t){let{name:i,options:r}=e;if(s.isMatchOrParent(t,i))return!0;if(new k(i).isChildOrGrandChild(t)){var n;return(null==r?void 0:r.action)==="array-append"?!new k(i).isChildOrGrandChild(t):(null==r?void 0:r.action)!=="array-splice"||null==r||null==(n=r.indexes)||!n.length||k.compareArrayPath(new k(t),new k(i).concat(r.indexes[0]))>=0}return!1},o.shouldTriggerFieldValidateWhenChange=function(e,t){let{name:i,options:r}=e;return(null==r?void 0:r.action)==="array-splice"||(null==r?void 0:r.action)==="array-swap"?t===i:o.shouldTriggerFieldChangeEvent(e,t)};var Y=l.createContext({}),U=l.createContext({});function $(){return(0,l.useContext)(Y)}function G(e){let{name:t,defaultValue:i,render:r,children:n,deps:o}=e,s=$(),a=s.getField(t)||s.createField(t),c=l.useMemo(()=>z(a),[a]),g=(0,u.nt)(a.reactiveState),p=(0,u.nt)(s.reactiveState),f=l.useMemo(()=>V(g),[g]),y=F(p),m=(0,d.JA)();return(l.useEffect(()=>{if(a.disposed)return m(),()=>{};a.renderCount=a.renderCount+1,s.getValueIn(t),void 0!==i&&(s.setInitValueIn(t,i),m());let e=new d.K4;return e.push(a.onValueChange(()=>{m()})),o&&o.forEach(t=>{var i;let r=null==(i=s.getField(t))?void 0:i.onValueChange(()=>{m()});r&&e.push(r)}),()=>{e.dispose(),a.renderCount>1?a.renderCount=a.renderCount-1:s.getField(a.name)===a&&a.dispose()}},[a]),a.disposed)?l.createElement(l.Fragment,null):l.createElement(U.Provider,{value:a},r?r({field:c,fieldState:f,formState:y}):(0,h.Z)(n)?n({field:c,fieldState:f,formState:y}):l.cloneElement(n,{...c}))}function Q(e){let t={get key(){return e.id},get name(){return e.path.toString()},get value(){return e.value},onChange:t=>{e.value=t},map:t=>e.map((e,i)=>t(z(e),i)),append:t=>z(e.append(t)),delete:t=>e.delete(t),remove:t=>e.delete(t),swap:(t,i)=>e.swap(t,i),move:(t,i)=>e.move(t,i)};return Object.defineProperty(t,"_fieldModel",{enumerable:!1,get:()=>e}),t}function W(e,t){return"string"==typeof e?{name:t,message:e,level:"error"}:(null==e?void 0:e.message)?{...e,name:t}:void 0}function H(e,t){return{[e]:t?[t]:[]}}var X={invalid:!1,isDirty:!1,isTouched:!1,isValidating:!1},J={invalid:!1,isDirty:!1,isTouched:!1,isValidating:!1},Z=class{get values(){return(0,g.Z)(this._values)}set values(e){this._values=(0,N.Z)(e)}setIn(e,t){this._values=function(e,t,i){let r=(0,g.Z)(e),n=r,o=0,s=(0,c.Z)(t);for(;o<s.length-1;o++){let t=s[o],i=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=(0,c.Z)(t);for(;e&&r<n.length;)e=e[n[r++]];return r===n.length||e?void 0===e?i:e:i}(e,s.slice(0,o+1));if(i&&(x(i)||Array.isArray(i)))n=n[t]=(0,g.Z)(i);else{let e=s[o+1];n=n[t]=w(e)&&Number(e)>=0?[]:{}}}return(0===o?e:n)[s[o]]===i&&s[o]in e?e:(n[s[o]]=i,r)}(this._values||{},e.toString(),t)}getIn(e){return(0,f.Z)(this.values,e.value)}dispose(){}},K=class{get renderCount(){return this._renderCount}set renderCount(e){this._renderCount=e}initState(){let e=(0,f.Z)(this.form.state.errors,this.name),t=(0,f.Z)(this.form.state.warnings,this.name);e&&(this.state.errors={[this.name]:e}),t&&(this.state.warnings={[this.name]:t})}get path(){return this._path}get name(){return this._path.toString()}set name(e){this._path=new k(e)}get ref(){return this._ref}set ref(e){this._ref=e}get state(){return this._state.value}get reactiveState(){return this._state}get value(){return this.form.getValueIn(this.name)}set value(e){this.form.setValueIn(this.name,e),this.state.isTouched||(this.state.isTouched=!0,this.bubbleState())}updateNameForLeafState(e){var t,i;let{errors:r,warnings:n}=this.state,o=r?null==(t=Object.keys(r))?void 0:t[0]:void 0;o&&(null==r?void 0:r[o])&&o!==e&&(this.state.errors={[e]:(null==r?void 0:r[o])?R(null==r?void 0:r[o],e):null==r?void 0:r[o]});let s=n?null==(i=Object.keys(n))?void 0:i[0]:void 0;s&&(null==n?void 0:n[s])&&s!==e&&(this.state.warnings={[e]:(null==n?void 0:n[s])?R(null==n?void 0:n[s],e):null==n?void 0:n[s]})}updateValidate(e,t){"ui"===t&&this.originalValidate||(this.originalValidate=e)}bubbleState(){let{errors:e,warnings:t}=this.state;if(this.parent){this.parent.state.isTouched=(0,M.Z)(this.parent.children.map(e=>e.state.isTouched),Boolean),this.parent.state.invalid=(0,M.Z)(this.parent.children.map(e=>e.state.invalid),Boolean),this.parent.state.isDirty=(0,M.Z)(this.parent.children.map(e=>e.state.isDirty),Boolean),this.parent.state.isValidating=(0,M.Z)(this.parent.children.map(e=>e.state.isValidating),Boolean),this.parent.state.errors=e?P(this.parent.state.errors,e):j(this.name,this.parent.state.errors),this.parent.state.warnings=t?P(this.parent.state.warnings,t):j(this.name,this.parent.state.warnings),this.parent.bubbleState();return}this.form.state.isTouched=(0,M.Z)(this.form.fields.map(e=>e.state.isTouched),Boolean),this.form.state.invalid=(0,M.Z)(this.form.fields.map(e=>e.state.invalid),Boolean),this.form.state.isDirty=(0,M.Z)(this.form.fields.map(e=>e.state.isDirty),Boolean),this.form.state.isValidating=(0,M.Z)(this.form.fields.map(e=>e.state.isValidating),Boolean),this.form.state.errors=e?P(this.form.state.errors,e):j(this.name,this.form.state.errors),this.form.state.warnings=t?P(this.form.state.warnings,t):j(this.name,this.form.state.warnings)}clearState(){this.state.errors=X.errors,this.state.warnings=X.warnings,this.state.isTouched=X.isTouched,this.state.isDirty=X.isDirty,this.bubbleState()}get children(){let e=[];return this.form.fieldMap.forEach((t,i)=>{this.path.isChild(i)&&e.push(t)}),e}get parent(){let e=this.path.parent;if(e)return this.form.fieldMap.get(e.toString())}clear(){this.value&&(this.value=void 0)}async validate(){await this.validateSelf()}async validateSelf(){this.state.isValidating=!0,this.bubbleState();let{errors:e,warnings:t}=await this._runAsyncValidate();(null==e?void 0:e.length)?(this.state.errors=(0,S.Z)(e,"name"),this.state.invalid=!0):(this.state.errors={[this.name]:[]},this.state.invalid=!1),(null==t?void 0:t.length)?this.state.warnings=(0,S.Z)(t,"name"):this.state.warnings={[this.name]:[]},this.state.isValidating=!1,this.bubbleState(),this.form.onValidateEmitter.fire(this.form.state)}async _runAsyncValidate(){let e=[],t=[],i=await this.form.validateIn(this.name);if(!(null==i?void 0:i.length))return{};{let r=i.map(e=>W(e,this.name)).filter(Boolean);if(!(null==r?void 0:r.length))return{};let n=(0,S.Z)(r,"level");t=t.concat(n.warning||[]),e=e.concat(n.error||[])}return{errors:e,warnings:t}}updateState(e){}dispose(){this.children.map(e=>e.dispose()),this.toDispose.dispose(),this.form.fieldMap.delete(this.path.toString())}onDispose(e){this.toDispose.onDispose(e)}get disposed(){return this.toDispose.disposed}constructor(e,t){this.onValueChangeEmitter=new d.Q5,this.onValueChange=this.onValueChangeEmitter.event,this.toDispose=new d.K4,this._state=new u.BP({...X}),this._renderCount=0,this._mount=!1,this._path=e,this.form=t,this.id=(0,C.x0)();let i=this.form.onFormValuesChange(e=>{let{values:t,prevValues:i}=e;a.shouldTriggerFieldChangeEvent(e,this.name)&&(this.onValueChangeEmitter.fire({value:(0,f.Z)(t,this.name),prevValue:(0,f.Z)(i,this.name),formValues:t,prevFormValues:i}),"onChange"===this.form.validationTrigger&&a.shouldTriggerFieldValidateWhenChange(e,this.name)&&this.validate())});this.toDispose.push(i),this.toDispose.push(this.onValueChangeEmitter),this.initState()}},q=class extends K{get children(){let e=[];return this.form.fieldMap.forEach((t,i)=>{this.path.isChild(i)&&e.push(t)}),e.sort((e,t)=>{let i=e.path.value,r=t.path.value;return parseInt(i[i.length-1])-parseInt(r[r.length-1])})}map(e){return(this.value||[]).map((e,t)=>{let i=this.path.concat(t).toString(),r=this.form.getField(i);return r||(r=this.form.createField(i)),r}).map(e)}append(e){var t;let i=(null==(t=this.value)?void 0:t.length)||0,r=this.path.concat(i).toString(),n=this.form.createField(r),o=this.value?[...this.value,e]:[e],s=this.form.values;return this.form.store.setIn(new k(this.name),o),this.form.fireOnFormValuesChange({values:this.form.values,prevValues:s,name:this.name,options:{action:"array-append",indexes:[i]}}),this.form.fireOnFormValuesInit({values:this.form.values,prevValues:s,name:r}),this.onAppendEmitter.fire({value:e,arrayValue:this.value,index:this.value.length-1}),n}delete(e){this._splice(e,1),this.onDeleteEmitter.fire({arrayValue:this.value,index:e})}_splice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e<0||t<0)throw Error("[Form] Error in FieldArrayModel.splice: Invalid Params, start and deleteCount should > 0");if(!this.value||0===this.value.length||t>this.value.length){var i;throw Error(`[Form] Error in FieldArrayModel.splice: delete count exceeds array length, tried to delete ${t} elements, but array length is ${(null==(i=this.value)?void 0:i.length)||0}`)}let r=this.form.values,n=[...this.value];n.splice(e,t),this.form.store.setIn(new k(this.name),n),this.form.fireOnFormValuesChange({values:this.form.values,prevValues:r,name:this.name,options:{action:"array-splice",indexes:Array.from({length:t},(t,i)=>i+e)}});let o=this.children;if(e+t>=o.length)for(let t=e;t<o.length;t++)this.form.disposeField(o[t].name);let s=[],a=new Map(this.form.fieldMap),l=(i,r)=>{var n;if((null==(n=i.children)?void 0:n.length)&&i.children.forEach(e=>{l(e,r)}),r<e)a.set(i.name,i);else if(r<e+t)s.push(i);else{let e=i.name,n=i.path.replaceParent(this.path.concat(r),this.path.concat(r-t)).toString();a.set(n,i),i.children.length||(i.updateNameForLeafState(n),i.bubbleState()),i.name=n,r>o.length-t-1&&a.delete(e)}};o.map((e,t)=>{l(e,t)}),s.forEach(e=>{e.dispose()}),this.form.fieldMap=a,this.form.alignStateWithFieldMap()}swap(e,t){if(!this.value)return;if(e<0||t<0||e>this.value.length-1||t>this.value.length-1)throw Error(`[Form]: FieldArrayModel.swap Error: invalid params 'form' and 'to', form=${e} to=${t}. expect the value between 0 to ${length-1}`);let i=this.form.values,r=[...this.value],n=r[e],o=r[t];r[t]=n,r[e]=o,this.form.store.setIn(this.path,r),this.form.fireOnFormValuesChange({values:this.form.values,prevValues:i,name:this.name,options:{action:"array-swap",indexes:[e,t]}});let s=new Map(this.form.fieldMap),a=this.findAllFieldsAt(e),l=this.findAllFieldsAt(t),h=this.getPathAt(e),d=this.getPathAt(t),u=[];a.forEach(e=>{let t=e.path.replaceParent(h,d).toString();e.name=t,e.children.length||(e.updateNameForLeafState(t),u.push(e)),s.set(t,e)}),l.forEach(e=>{let t=e.path.replaceParent(d,h).toString();e.name=t,e.children.length||e.updateNameForLeafState(t),s.set(t,e),u.push(e)}),this.form.fieldMap=s,u.forEach(e=>e.bubbleState()),this.form.alignStateWithFieldMap()}move(e,t){if(!this.value)return;if(e<0||t<0||e>this.value.length-1||t>this.value.length-1)throw Error(`[Form]: FieldArrayModel.move Error: invalid params 'form' and 'to', form=${e} to=${t}. expect the value between 0 to ${length-1}`);let i=[...this.value],r=i[e];i.splice(e,1),i.splice(t,0,r),this.form.setValueIn(this.name,i)}insertAt(e,t){if(!this.value)return;if(e<0||e>this.value.length)throw Error("[Form]: FieldArrayModel.insertAt Error: index exceeds array boundary");let i=[...this.value];i.splice(e,0,t),this.form.setValueIn(this.name,i)}getPathAt(e){return this.path.concat(e)}findAllFieldsAt(e){let t=this.getPathAt(e),i=t.toString(),r=this.form.fieldMap.get(i)?[this.form.fieldMap.get(i)]:[];return this.form.fieldMap.forEach((e,i)=>{t.isChildOrGrandChild(i)&&r.push(e)}),r}constructor(){super(...arguments),this.onAppendEmitter=new d.Q5,this.onAppend=this.onAppendEmitter.event,this.onDeleteEmitter=new d.Q5,this.onDelete=this.onDeleteEmitter.event}},ee=class{set fieldMap(e){this._fieldMap=e}get fieldMap(){return this._fieldMap}get context(){return this._options.context}get initialValues(){return this._options.initialValues}get values(){return this.store.values}set values(e){let t=this.values;(0,D.deepEqual)(t,e)||(this.store.values=e,this.fireOnFormValuesChange({values:this.values,prevValues:t,name:""}))}get validationTrigger(){return this._options.validateTrigger}get state(){return this._state.value}get reactiveState(){return this._state}get fields(){return Array.from(this.fieldMap.values())}updateState(e){}get initialized(){return this._initialized}fireOnFormValuesChange(e){this.onFormValuesChangeEmitter.fire(e),this.onFormValuesUpdatedEmitter.fire(e)}fireOnFormValuesInit(e){this.onFormValuesInitEmitter.fire(e),this.onFormValuesUpdatedEmitter.fire(e)}init(e){if(this._options=e,e.initialValues){let t=this.store.values;this.store.values=e.initialValues,this.fireOnFormValuesInit({values:e.initialValues,prevValues:t,name:""})}this._initialized=!0}createField(e,t){let i=new k(e),r=i.toString();if(this.fieldMap.get(r))return this.fieldMap.get(r);let n=t?new q(i,this):new K(i,this);return this.fieldMap.set(r,n),n.onDispose(()=>{this.fieldMap.delete(r)}),this.onFieldModelCreateEmitter.fire(n),n}createFieldArray(e,t){return this.createField(e,!0)}disposeField(e){let t=this.fieldMap.get(e);t&&t.dispose()}deleteField(e){let t=this.fieldMap.get(e);t&&(t.clear(),t.dispose())}getField(e){return this.fieldMap.get(new k(e).toString())}getValueIn(e){return this.store.getIn(new k(e))}setValueIn(e,t){let i=this.values;this.store.setIn(new k(e),t),this.fireOnFormValuesChange({values:this.values,prevValues:i,name:e})}setInitValueIn(e,t){let i=new k(e);if(void 0===this.store.getIn(i)){let i=this.values;this.store.setIn(new k(e),t),this.fireOnFormValuesInit({values:this.values,prevValues:i,name:e})}}clearValueIn(e){this.setValueIn(e,void 0)}async validateIn(e){if(this.validateDisabled)return[];let t=this.getValidateOptions();if(t)return Promise.all(Object.keys(t).filter(t=>s.isMatch(t,e)).map(async i=>(0,t[i])({value:this.getValueIn(e),formValues:this.values,context:this.context,name:e})))}getValidateOptions(){let e=this._options.validate;return"function"==typeof e?e(this.values,this.context):e}async validate(){if(this.validateDisabled)return[];let e=this.getValidateOptions();if(!e)return[];let t=Object.keys(e).map(async t=>{let i=e[t],r=this.values;return Promise.all(s.findMatchPathsWithEmptyValue(r,t).map(async e=>{var t;let n=W(await i({value:(0,f.Z)(r,e),formValues:r,context:this.context,name:e}),e),o=this.getField(e),s=H(e,(null==n?void 0:n.level)==="error"?n:void 0),a=H(e,(null==n?void 0:n.level)==="warning"?n:void 0);o&&(o.state.errors=s,o.state.warnings=a,o.state.invalid=Object.keys(s).some(e=>{var t;return(null==(t=s[e])?void 0:t.length)>0}),o.bubbleState());return this.state.errors=P(this.state.errors,s),this.state.warnings=P(this.state.warnings,a),this.state.invalid=!(!(t=this.state.errors)||Object.keys(t).every(e=>(0,b.Z)(t[e]))),n}))});this.state.isValidating=!0;let i=await Promise.all(t);return this.state.isValidating=!1,this.onValidateEmitter.fire(this.state),(0,p.Z)(i).filter(Boolean)}alignStateWithFieldMap(){let e=Array.from(this.fieldMap.keys());this.state.errors&&(this.state.errors=_(this.state.errors,e)),this.state.warnings&&(this.state.warnings=_(this.state.warnings,e)),this.fieldMap.forEach(t=>{t.state.errors&&(t.state.errors=_(t.state.errors,e)),t.state.warnings&&(t.state.warnings=_(t.state.warnings,e))})}dispose(){this.fieldMap.forEach(e=>e.dispose()),this.store.dispose(),this._initialized=!1}constructor(){this._fieldMap=new Map,this.store=new Z,this._options={},this.onFieldModelCreateEmitter=new d.Q5,this.onFieldModelCreate=this.onFieldModelCreateEmitter.event,this.onFormValuesChangeEmitter=new d.Q5,this.onFormValuesChange=this.onFormValuesChangeEmitter.event,this.onFormValuesInitEmitter=new d.Q5,this.onFormValuesInit=this.onFormValuesInitEmitter.event,this.onFormValuesUpdatedEmitter=new d.Q5,this.onFormValuesUpdated=this.onFormValuesUpdatedEmitter.event,this.onValidateEmitter=new d.Q5,this.onValidate=this.onValidateEmitter.event,this._state=new u.BP({...J}),this._initialized=!1,this.validateDisabled=!1}};function et(e){let{disableAutoInit:t=!1,...i}=e||{},r=new ee;return t||r.init(i||{}),{form:B(r),control:{_formModel:r,getField:e=>{let t=r.getField(e);if(t)return t instanceof q?Q(t):z(t)},init:()=>r.init(i||{})}}}function ei(e){let{form:t,render:i}=e;return l.createElement(l.Fragment,null,i({form:t}))}function er(e){let{children:t,keepModelOnUnMount:i=!1,control:r,...n}=e,{_formModel:o}=(0,l.useMemo)(()=>r||et(n).control,[r]);(0,l.useEffect)(()=>()=>{i||o.dispose()},[]);let s=(0,l.useMemo)(()=>B(o),[o]);return l.createElement(Y.Provider,{value:o},t?(0,h.Z)(t)?l.createElement(ei,{form:s,render:t}):l.Children.only(t):null)}function en(e){let t=(0,d.JA)(),i=$();if(!i)throw Error("[Form] error in useWatch, formModel not found");let r=i.getValueIn(e);return(0,l.useEffect)(()=>{let r=i.onFormValuesUpdated(i=>{let{name:r}=i;r===e&&t()});return()=>r.dispose()},[e,i]),r}function eo(e){let{name:t,defaultValue:i,deps:r,render:n,children:o}=e,s=$(),a=s.getField(t)||s.createFieldArray(t),c=l.useMemo(()=>Q(a),[a]),g=(0,d.JA)(),p=(0,u.nt)(a.reactiveState),f=(0,u.nt)(s.reactiveState),y=V(p),m=l.useMemo(()=>F(f),[f]);return(l.useEffect(()=>{if(a.disposed)return g(),()=>{};a.renderCount=a.renderCount+1,s.getValueIn(t),void 0!==i&&(s.setInitValueIn(t,i),g());let e=new d.K4;return e.push(a.onValueChange(()=>{g()})),r&&r.forEach(t=>{var i;let r=null==(i=s.getField(t))?void 0:i.onValueChange(()=>{g()});r&&e.push(r)}),()=>{e.dispose(),a.renderCount>1?a.renderCount=a.renderCount-1:s.getField(a.name)===a&&a.dispose()}},[a]),a.disposed)?l.createElement(l.Fragment,null):l.createElement(U.Provider,{value:a},n&&(0,h.Z)(n)?n({field:c,fieldState:y,formState:m}):(0,h.Z)(o)?o({field:c,fieldState:y,formState:m}):l.createElement(l.Fragment,null,"Invalid Array render"))}},928079:function(e,t,i){i.d(t,{CM:()=>T,CR:()=>L,TH:()=>b,wL:()=>_,zE:()=>E});var r,n=i(721855),o=i(969134),s=i(863875),a=i(336808),l=i(325681),h=i(437104),d=i(832176),u=i(57064),c=i(755395),g=i(893740),p=i(938791),f=i(935391),y=i(908600),m=i(433210),E=((r=E||{}).onValueChange="onValueChange",r.onValueInit="onValueInit",r.onValueInitOrChange="onValueInitOrChange",r.onArrayAppend="onArrayAppend",r.onArrayDelete="onArrayDelete",r);function b(e){return"onFormValuesChange"in e}function D(e){return e.startsWith("/")?u.b5.normalize(e).slice(1).split("/").join("."):e}function N(e,t){return()=>{null==e||e(),null==t||t()}}function C(e,t,i){i.forEach(i=>{let r=e.get(i);(null==r?void 0:r[t])&&(r[t](),delete r[t])})}var M=e=>{let{formModel:t}=e;return(null==t?void 0:t.formControl)?y.createElement(y.Fragment,null,y.createElement(c.l0,{control:null==t?void 0:t.formControl,keepModelOnUnMount:!0},t.formMeta.render)):null},S=()=>({}),x=()=>new Map([["onValueInitOrChange",{}],["onValueChange",{}],["onValueInit",{}],["onArrayAppend",{}],["onArrayDelete",{}]]),w=()=>[],_=class extends u.au{get valid(){return this._valid}set valid(e){this._valid=e,this.onValidChangeEmitter.fire(e)}get flowNodeEntity(){return this.node}get formManager(){return this.node.getService(u.yf)}get formControl(){return this._formControl}get formMeta(){return this._formMeta||this.node.getNodeRegistry().formMeta}get values(){var e;return null==(e=this.nativeFormModel)?void 0:e.values}get feedbacks(){return this._feedbacks}updateFormValues(e){if(this.nativeFormModel){let t=this.formMeta.formatOnInit?this.formMeta.formatOnInit(e,this.nodeContext):e;this.nativeFormModel.values=t}}set feedbacks(e){this._feedbacks=e,this.onFeedbacksChangeEmitter.fire(e)}get formItemPathMap(){return new Map}get initialized(){return this._initialized}get nodeContext(){return{node:this.node,playgroundContext:this.node.getService(g.xm),clientContext:this.node.getService(g.Zn)}}get nativeFormModel(){var e;return null==(e=this._formControl)?void 0:e._formModel}render(){return y.createElement(M,{formModel:this})}initPlugins(e){e.length&&(this.plugins=e,e.forEach(e=>{e.init(this)}))}init(e,t){var i;let r=this.node.getData(u.Ps);this.onFormValuesChange(()=>{this._valid=null,r.fireChange()}),null==(i=e.plugins||[])||i.forEach(t=>{t.setupFormMeta&&(e=t.setupFormMeta(e,this.nodeContext))}),this._formMeta=e;let{validateTrigger:h,validate:d,effect:g}=e;g&&(this.effectMap=g);let f="function"==typeof e.defaultValues?e.defaultValues(this.nodeContext):e.defaultValues,y=e.formatOnInit?e.formatOnInit(t,this.nodeContext):t,{control:m}=(0,c.Np)({initialValues:y||f,validateTrigger:h,context:this.nodeContext,validate:d,disableAutoInit:!0});this._formControl=m;let E=m._formModel;this.toDispose.push(E),E.onFormValuesChange(e=>{this.onFormValuesChangeEmitter.fire(e)}),e.plugins&&this.initPlugins(e.plugins),E.onFormValuesChange(e=>{let{values:t,prevValues:i,name:r,options:a}=e;Object.keys(this.effectMap).forEach(e=>{let l=(0,n.Z)([...c.rR.findMatchPaths(t,e),...c.rR.findMatchPaths(i,e)]).filter(e=>(0,o.Z)(t,e)!==(0,o.Z)(i,e));if(c.rR.isMatchOrParent(e,r)){let t=c.rR.getParentPathByPattern(e,r);l.includes(t)||l.push(t)}let h=this.effectMap[e];l.forEach(e=>{let n=["onValueChange","onValueInitOrChange"];(0,s.Z)((0,o.Z)(i,e))&&(n=(null==a?void 0:a.action)==="array-append"&&c.rR.isMatch(`${r}.*`,e)?[]:["onValueInit","onValueInitOrChange"]),C(this.effectReturnMap,e,n),h.forEach(r=>{let{effect:s,event:a}=r;if(n.includes(a)){let r=s({name:e,value:(0,o.Z)(t,e),prevValue:(0,o.Z)(i,e),formValues:t,form:(0,c.eP)(this.nativeFormModel),context:this.nodeContext});if(r&&"function"==typeof r&&this.effectReturnMap.has(a)){let t=this.effectReturnMap.get(a);t[e]=N(t[e],r)}}})})})}),E.onFormValuesInit(e=>{let{values:t,name:i,prevValues:r}=e;Object.keys(this.effectMap).forEach(e=>{let n=c.rR.findMatchPaths(t,e),s=this.effectMap[e];n.forEach(e=>{(c.rR.isMatchOrParent(i,e)||i===e)&&(C(this.effectReturnMap,e,["onValueInit","onValueInitOrChange"]),s.forEach(i=>{let{event:n,effect:s}=i;if("onValueInit"===n||"onValueInitOrChange"===n){let i=s({name:e,value:(0,o.Z)(t,e),formValues:t,prevValue:(0,o.Z)(r,e),form:(0,c.eP)(this.nativeFormModel),context:this.nodeContext});if(i&&"function"==typeof i&&this.effectReturnMap.has(n)){let t=this.effectReturnMap.get(n);t[e]=N(t[e],i)}}}))})})}),E.onFieldModelCreate(e=>{let t=function(e,t){if(!t)return;if(t[e.name])return t[e.name];let i=(0,p.Z)(Object.keys(t),t=>!!t.startsWith("regex:")&&RegExp(t.split(":")[1]).test(e.name));if(i)return t[i]}(e,this.effectMap);if(null==t?void 0:t.length){let i=(0,a.Z)(t,"event");(0,l.Z)(i,(t,i)=>{let r=e=>{t.forEach(t=>{let{effect:i}=t;return i({...e,formValues:E.values,form:(0,c.eP)(this.nativeFormModel),context:this.nodeContext})})};switch(i){case"onArrayAppend":e instanceof c.lE&&e.onAppend(r);break;case"onArrayDelete":e instanceof c.lE&&e.onDelete(r)}})}}),this._formControl.init(),this._initialized=!0,this.onInitializedEmitter.fire(this),this.onDispose(()=>{this._initialized=!1,this.effectMap={},E.dispose()})}toJSON(){var e,t;return this.formMeta.formatOnSubmit?this.formMeta.formatOnSubmit(null==(t=this.nativeFormModel)?void 0:t.values,this.nodeContext):null==(e=this.nativeFormModel)?void 0:e.values}clearValid(){}async validate(){var e,t;return this.formFeedbacks=await (null==(e=this.nativeFormModel)?void 0:e.validate()),this.valid=(0,h.Z)(null==(t=this.formFeedbacks)?void 0:t.filter(e=>"error"===e.level)),this.onValidateEmitter.fire(this),this.valid}getValues(){var e;return null==(e=this._formControl)?void 0:e._formModel.values}getField(e){var t;let i=e.includes("/")?D(e):e;return null==(t=this.formControl)?void 0:t.getField(i)}getValueIn(e){var t;let i=e.includes("/")?D(e):e;return null==(t=this.nativeFormModel)?void 0:t.getValueIn(i)}setValueIn(e,t){var i;let r=e.includes("/")?D(e):e;null==(i=this.nativeFormModel)||i.setValueIn(r,t)}onFormValueChangeIn(e,t){if(!this._initialized)throw Error("[NodeEngine] FormModel Error: onFormValueChangeIn can not be called before initialized");return this.formControl._formModel.onFormValuesChange(i=>{let{name:r,values:n,prevValues:s}=i;r===e&&t({value:(0,o.Z)(n,e),prevValue:(0,o.Z)(s,e),formValues:n,prevFormValues:s})})}getFormItemValueByPath(e){if(!e)return;if("/"===e){var t;return null==(t=this._formControl)?void 0:t._formModel.values}let i=D(e);return this.getValueIn(i)}async validateWithFeedbacks(){return await this.validate(),this.formFeedbacks.map(e=>({feedbackStatus:e.level,feedbackText:e.message,path:e.name}))}getFormItemByPath(e){if(!this.nativeFormModel)return;let t=this;if("/"===e)return{get value(){return t.nativeFormModel.values},set value(v){t.nativeFormModel.values=v}};let i=D(e),r=t.getValueIn(i);return{get value(){return r},set value(v){t.setValueIn(i,v)}}}dispose(){this.onDisposeEmitter.fire(),this.effectReturnMap.forEach(e=>{Object.values(e).forEach(e=>{e()})}),this.effectMap=S(),this.effectReturnMap=x(),this.plugins.forEach(e=>{e.dispose()}),this.plugins=[],this.formFeedbacks=w(),this._valid=null,this._formControl=void 0,this._initialized=!1,this.toDispose.dispose()}constructor(e){super(),this.effectMap=S(),this.effectReturnMap=x(),this.plugins=[],this.formFeedbacks=w(),this.onInitializedEmitter=new d.Q5,this.onValidateEmitter=new d.Q5,this.onValidate=this.onValidateEmitter.event,this.onInitialized=this.onInitializedEmitter.event,this.onDisposeEmitter=new d.Q5,this.onDispose=this.onDisposeEmitter.event,this.toDispose=new d.K4,this.onFormValuesChangeEmitter=new d.Q5,this.onFormValuesChange=this.onFormValuesChangeEmitter.event,this.onValidChangeEmitter=new d.Q5,this.onValidChange=this.onValidChangeEmitter.event,this.onFeedbacksChangeEmitter=new d.Q5,this.onFeedbacksChange=this.onFeedbacksChangeEmitter.event,this._valid=null,this._feedbacks=[],this._initialized=!1,this.node=e,this.toDispose.pushAll([this.onInitializedEmitter,this.onValidateEmitter,this.onValidChangeEmitter,this.onFeedbacksChangeEmitter,this.onFormValuesChangeEmitter])}},I=class{get formModel(){return this._formModel}get ctx(){return{formModel:this.formModel,...this.formModel.nodeContext}}setupFormMeta(e,t){var i,r;let n={...e};return null==(i=(r=this.config).onSetupFormMeta)||i.call(r,{mergeEffect:e=>{var t;t=n.effect||{},n.effect=(0,f.Z)(t,e,function(e,t){return(e||[]).concat(t)})},mergeValidate:e=>{n.validate={...n.validate||{},...e}},addFormatOnInit:e=>{if(!n.formatOnInit){n.formatOnInit=e;return}let t=n.formatOnInit;n.formatOnInit=(i,r)=>null==e?void 0:e(t(i,r),r)},addFormatOnSubmit:e=>{if(!n.formatOnSubmit){n.formatOnSubmit=e;return}let t=n.formatOnSubmit;n.formatOnSubmit=(i,r)=>null==e?void 0:e(t(i,r),r)},...t},this.opts),n}init(e){var t,i;this._formModel=e,null==(i=this.config)||null==(t=i.onInit)||t.call(i,this.ctx,this.opts)}dispose(){var e,t;(null==(e=this.config)?void 0:e.onDispose)&&(null==(t=this.config)||t.onDispose(this.ctx,this.opts))}constructor(e,t){this.name=(null==e?void 0:e.name)||"",this.pluginId=`${this.name}__${(0,m.x0)()}`,this.config=e,this.opts=t}};function L(e){return function(t){return new I(e,t)}}function T(e){var t;let i=null==(t=e.getData(u.Ps))?void 0:t.getFormModel(),r=null==i?void 0:i.nativeFormModel;if(!i||!r)return;let n={initialValues:r.initialValues,get values(){return r.values},state:r.state,getValueIn:e=>r.getValueIn(e),setValueIn:(e,t)=>r.setValueIn(e,t),updateFormValues:e=>{i.updateFormValues(e)},render:()=>y.createElement(u.o,{node:e}),onFormValuesChange:i.onFormValuesChange.bind(i),onFormValueChangeIn:i.onFormValueChangeIn.bind(i),onValidate:i.nativeFormModel.onValidate,validate:i.validate.bind(i)};return Object.defineProperty(n,"_formModel",{enumerable:!1,get:()=>i}),n}},569517:function(e,t,i){i.d(t,{Xm:()=>l,bz:()=>d});var r=i(832176),n=i(893740),o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=0,l=Symbol("BackgroundConfig"),h=class extends n.mh{get gridSize(){return this.options.gridSize??20}get dotSize(){return this.options.dotSize??1}get dotColor(){return this.options.dotColor??"#eceeef"}get dotOpacity(){return this.options.dotOpacity??.5}get backgroundColor(){return this.options.backgroundColor??"transparent"}get dotFillColor(){return this.options.dotFillColor??this.dotColor}get logoConfig(){return this.options.logo}get zoom(){return this.config.finalScale}onReady(){let{firstChild:e}=this.pipelineNode;this.pipelineNode.insertBefore(this.node,e),this.playgroundConfigEntity.updateConfig({minZoom:.1,maxZoom:2}),this.grid.style.zIndex="-1",this.grid.style.position="relative",this.node.appendChild(this.grid),this.grid.className="gedit-grid-svg","transparent"!==this.backgroundColor&&(this.node.style.backgroundColor=this.backgroundColor)}getScaleUnit(){let{zoom:e}=this;return{realSize:this.gridSize,renderSize:Math.round(this.gridSize*e*100)/100,zoom:e}}autorun(){let e=this.playgroundConfigEntity.config,t=this.getScaleUnit(),i=10*t.renderSize,o=e.width+2*i,s=e.height+2*i,{scrollX:a}=e,{scrollY:l}=e,h=this.getScrollDelta(a,i),d=this.getScrollDelta(l,i);r.xF.setStyle(this.node,{left:a-n.JW,top:l-n.JW}),this.drawGrid(t,o,s),this.setSVGStyle(this.grid,{width:o,height:s,left:n.JW-h-i,top:n.JW-d-i})}calculateLogoPosition(e,t){if(!this.logoConfig)return{x:0,y:0};let{position:i="center",offset:r={x:0,y:0}}=this.logoConfig,n=this.playgroundConfigEntity.config,o=10*this.getScaleUnit().renderSize,{scrollX:s,scrollY:a}=n,l=this.getScrollDelta(s,o),h=this.getScrollDelta(a,o),d=o+l,u=o+h,c=d+n.width/2,g=u+n.height/2,p=0,f=0;switch(i){case"center":p=c,f=g;break;case"top-left":p=d+100,f=u+100;break;case"top-right":p=d+n.width-100,f=u+100;break;case"bottom-left":p=d+100,f=u+n.height-100;break;case"bottom-right":p=d+n.width-100,f=u+n.height-100}return{x:p+r.x,y:f+r.y}}getLogoSize(){if(!this.logoConfig)return 0;let{size:e="medium"}=this.logoConfig;if("number"==typeof e)return e;switch(e){case"small":return 24;case"medium":default:return 48;case"large":return 72}}hexToRgb(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}adjustBrightness(e,t){let i=this.hexToRgb(e);if(!i)return e;let r=e=>Math.max(0,Math.min(255,Math.round(e+(255-e)*t)));return`#${r(i.r).toString(16).padStart(2,"0")}${r(i.g).toString(16).padStart(2,"0")}${r(i.b).toString(16).padStart(2,"0")}`}generateNeumorphismFilter(e,t,i,r,n,o,s){let a=s?-r:r,l=s?r:-r;return`
      <defs>
        <filter id="${e}" x="-50%" y="-50%" width="200%" height="200%">
          <feDropShadow dx="${a}" dy="${a}" stdDeviation="${n}" flood-color="${t}" flood-opacity="${o}"/>
          <feDropShadow dx="${l}" dy="${l}" stdDeviation="${n}" flood-color="${i}" flood-opacity="${o}"/>
        </filter>
      </defs>`}generateLogoSVG(e,t){if(!this.logoConfig)return"";let{text:i,imageUrl:r,opacity:n=.1,color:o="#cccccc",fontSize:s,fontFamily:a="Arial, sans-serif",fontWeight:l="normal",neumorphism:h}=this.logoConfig,d=this.calculateLogoPosition(e,t),u=this.getLogoSize(),c="";if(r)c=`
        <image
          href="${r}"
          x="${d.x-u/2}"
          y="${d.y-u/2}"
          width="${u}"
          height="${u}"
          opacity="${n}"
        />`;else if(i){let e=s??Math.max(u/2,12);if(null==h?void 0:h.enabled){let{textColor:t,lightShadowColor:r,darkShadowColor:o,shadowOffset:s=6,shadowBlur:u=12,intensity:g=.3,raised:p=!0}=h,f="transparent"!==this.backgroundColor?this.backgroundColor:"#f0f0f0",y=t||f,m=r||this.adjustBrightness(f,.2),E=o||this.adjustBrightness(f,-.2),b=`neumorphism-${this._patternId}`;c+=this.generateNeumorphismFilter(b,m,E,s,u,g,p),c+=`
          <text
            x="${d.x}"
            y="${d.y}"
            font-family="${a}"
            font-size="${e}"
            font-weight="${l}"
            fill="${y}"
            opacity="${n}"
            text-anchor="middle"
            dominant-baseline="middle"
            filter="url(#${b})"
          >${i}</text>`}else c=`
          <text
            x="${d.x}"
            y="${d.y}"
            font-family="${a}"
            font-size="${e}"
            font-weight="${l}"
            fill="${o}"
            opacity="${n}"
            text-anchor="middle"
            dominant-baseline="middle"
          >${i}</text>`}return c}drawGrid(e,t,i){let r=e.renderSize;if(!this.grid)return;let n=this.dotSize*this.zoom,o='<svg width="100%" height="100%">';"transparent"!==this.backgroundColor&&(o+=`<rect width="100%" height="100%" fill="${this.backgroundColor}"/>`);let s=[`cx="${n}"`,`cy="${n}"`,`r="${n}"`,`stroke="${this.dotColor}"`,this.options.dotFillColor&&this.dotFillColor!==this.dotColor?`fill="${this.dotFillColor}"`:"",`fill-opacity="${this.dotOpacity}"`].filter(Boolean).join(" ");o+=`
      <pattern id="${this._patternId}" width="${r}" height="${r}" patternUnits="userSpaceOnUse">
        <circle ${s} />
      </pattern>
      <rect width="100%" height="100%" fill="url(#${this._patternId})"/>`;let a=this.generateLogoSVG(t,i);a&&(o+=a),o+="</svg>",this.grid.innerHTML=o}setSVGStyle(e,t){e&&(e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.left=`${t.left}px`,e.style.top=`${t.top}px`)}getScrollDelta(e,t){return e>=0?e%t:t-Math.abs(e)%t}constructor(){super(...arguments),this._patternId=`gedit-background-pattern-${a++}`,this.node=r.xF.createDivWithClass("gedit-flow-background-layer"),this.grid=document.createElement("div")}};h.type="WorkflowBackgroundLayer",((e,t,i,r)=>{for(var n,a=r>1?void 0:r?s(t,i):t,l=e.length-1;l>=0;l--)(n=e[l])&&(a=(r?n(t,i,a):n(a))||a);return r&&a&&o(t,i,a)})([(0,n.O0)(n.ER)],h.prototype,"playgroundConfigEntity",2);var d=(0,n.M1)({onBind:(e,t)=>{e.bind(l).toConstantValue(t)},onInit:(e,t)=>{e.playground.registerLayer(h,t)}})},201063:function(e,t,i){i.d(t,{Nj:()=>b,ou:()=>Y,qp:()=>o.qp});var r,n=i(893740),o=i(66298),s=i(952893),a=i(938573),l=i(461932),h=i(832176),d=i(969134),u=i(383909),c=i(288216),g=i(57064),p=i(579962);i(908600);var f=Object.defineProperty,y=Object.getOwnPropertyDescriptor,m=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?y(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&f(t,i,o),o},E=class{addEntityData(e){this._entityDataValues.set(e,(0,s.Z)(e.toJSON())),this._toDispose.push(e.onWillChange(t=>{let i=t.toJSON(),r=this._entityDataValues.get(e);(0,a.Z)(i,r)||this._entityDataValues.set(e,(0,s.Z)(i))}))}getValue(e){return this._entityDataValues.get(e)}setValue(e,t){return this._entityDataValues.set(e,t)}dispose(){this._entityDataValues.clear(),this._toDispose.dispose()}constructor(){this._entityDataValues=new Map,this._toDispose=new h.K4}};E=m([(0,l.b2)()],E);var b=((r=b||{}).addLine="addLine",r.deleteLine="deleteLine",r.changeLineData="changeLineData",r.moveNode="moveNode",r.addNode="addNode",r.deleteNode="deleteNode",r.changeNodeData="changeNodeData",r.resetLayout="resetLayout",r.dragNodes="dragNodes",r.moveChildNodes="moveChildNodes",r),D=class{handle(e){"onDragEnd"===e.type&&this._dragNode(e)}_dragNode(e){this._historyService.pushOperation({type:"dragNodes",value:{ids:e.nodes.map(e=>e.id),value:e.nodes.map(e=>{let{x:t,y:i}=e.getData(n.VO).position;return{x:t,y:i}}),oldValue:e.startPositions}},{noApply:!0})}};m([(0,l.f3)(o.qp)],D.prototype,"_historyService",2),D=m([(0,l.b2)()],D);var N=class{init(e,t){this.enable=!!(null==t?void 0:t.enable),t.nodeToJSON&&(this.nodeToJSON=t.nodeToJSON(e)),t.getNodeLabelById&&(this.getNodeLabelById=t.getNodeLabelById(e)),t.getNodeLabel&&(this.getNodeLabel=t.getNodeLabel(e)),t.getBlockLabel&&(this.getBlockLabel=t.getBlockLabel(e)),t.getNodeURI&&(this.getNodeURI=t.getNodeURI(e)),t.getLineURI&&(this.getLineURI=t.getLineURI(e)),void 0!==t.enableChangeNode&&(this.enableChangeNode=t.enableChangeNode),void 0!==t.enableChangeLineData&&(this.enableChangeLineData=t.enableChangeLineData)}constructor(){this.enableChangeNode=!0,this.enableChangeLineData=!0,this.enable=!1,this.nodeToJSON=e=>e.toJSON(),this.getNodeLabelById=e=>e,this.getNodeLabel=e=>e.id,this.getBlockLabel=e=>e.id,this.getNodeURI=e=>`node:${e}`,this.getLineURI=e=>`line:${e}`}};N=m([(0,l.b2)()],N);var C=class{handle(e){let{path:t,value:i,initialized:r,node:n}=e,o=n.getData(g.Ps),l=this._entityManager.getValue(o),h=t.split("/").filter(Boolean).join("."),c=h?(0,d.Z)(l,h):l;if(!(0,a.Z)(i,c)){if(r){let e=t,r=(0,s.Z)(i),o=c;if("/"!==t){let n=(0,s.Z)(l);(0,u.Z)(n,h,i),e=t.split("/").filter(Boolean)[0],r=(0,d.Z)(n,e),o=(0,d.Z)(l,e)}this._historyService.pushOperation({type:"changeNodeData",value:{id:n.id,path:e,value:r,oldValue:o},uri:this._config.getNodeURI(n.id)},{noApply:!0})}h?(0,u.Z)(l,h,(0,s.Z)(i)):this._entityManager.setValue(o,(0,s.Z)(i))}}};m([(0,l.f3)(o.qp)],C.prototype,"_historyService",2),m([(0,l.f3)(c.L4)],C.prototype,"document",2),m([(0,l.f3)(E)],C.prototype,"_entityManager",2),m([(0,l.f3)(N)],C.prototype,"_config",2),C=m([(0,l.b2)()],C);var M={type:c.fT.DELETE_NODE,toOperation:(e,t)=>{var i;let r=t.get(N),n=e.entity;return{type:"deleteNode",value:{node:e.toJSON(),parentID:null==(i=n.parent)?void 0:i.id},uri:r.getNodeURI(n.id)}}},S={type:c.fT.DELETE_LINE,toOperation:(e,t)=>{let i=t.get(N),r=e.entity;return{type:"deleteLine",value:{from:r.info.from,to:r.info.to||"",fromPort:r.info.fromPort||"",toPort:r.info.toPort||"",data:r.info.data,id:r.id},uri:i.getNodeURI(r.id)}}},x={type:c.fT.LINE_DATA_CHANGE,toOperation:(e,t)=>{let i=t.get(N),r=e.entity;return{type:"changeLineData",value:{id:r.id,oldValue:e.oldValue,newValue:r.lineData},uri:i.getLineURI(r.id)}}},w={type:c.fT.ADD_NODE,toOperation:(e,t)=>{var i;let r=t.get(N),n=t.get(c.L4),o=e.entity,s=null==(i=o.parent)?void 0:i.id;return{type:"addNode",value:{node:n.toNodeJSON(o),parentID:s},uri:r.getNodeURI(o.id)}}},_=[{type:c.fT.ADD_LINE,toOperation:(e,t)=>{let i=t.get(N),r=e.entity;return{type:"addLine",value:{from:r.info.from,to:r.info.to||"",fromPort:r.info.fromPort||"",toPort:r.info.toPort||"",data:r.info.data,id:r.id},uri:i.getLineURI(r.id)}}},S,w,M,x],I=class{handle(e,t){if(!this._historyService.undoRedoService.canPush()||!this._historyConfig.enableChangeLineData&&e.type===c.fT.LINE_DATA_CHANGE)return;let i=_.find(t=>t.type===e.type);if(!i)return;let r=i.toOperation(e,t);r&&this._historyService.pushOperation(r,{noApply:!0})}};m([(0,l.f3)(o.qp)],I.prototype,"_historyService",2),m([(0,l.f3)(N)],I.prototype,"_historyConfig",2),I=m([(0,l.b2)()],I);var L={shouldMerge:(e,t,i)=>!!t&&Date.now()-i.getTimestamp()<500},T={...L,type:"resetLayout",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:async(e,t)=>{let i=t.get(c.ZO);await i.layoutToPositions(e.value.ids,e.value.value)},shouldMerge:()=>!1},A={...L,type:p.C8.moveChildNodes,inverse:e=>({...e,value:{...e.value,fromIndex:e.value.toIndex,toIndex:e.value.fromIndex,fromParentId:e.value.toParentId,toParentId:e.value.fromParentId}}),apply:(e,t)=>{let i=t.get(c.L4);i.moveChildNodes(e.value);let r=i.getNode(e.value.fromParentId);requestAnimationFrame(()=>{r&&r.flowNodeType!==p.Sy.ROOT&&r.getData(n.VO).fireChange()})}},O={...L,type:"dragNodes",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:(e,t)=>{e.value.ids.forEach((i,r)=>{let o=t.get(c.L4),s=o.getNode(i);if(!s)return;let a=s.getData(n.VO),l=e.value.value[r];a.update({position:{x:l.x,y:l.y}}),o.layout.updateAffectedTransform(s)})}},k={...L,type:"deleteNode",inverse:e=>({...e,type:"addNode"}),apply:(e,t)=>{let i=t.get(c.L4).getNode(e.value.node.id);i&&i.dispose()},getLabel:(e,t)=>{let i=t.get(N);return`Delete Node ${i.getNodeLabel(e.value.node)}`},getDescription:(e,t)=>{var i;let r=t.get(N),n=`Delete Node ${r.getNodeLabel(e.value.node)}`;return(null==(i=e.value.node.meta)?void 0:i.position)&&(n+=` at ${e.value.node.meta.position.x},${e.value.node.meta.position.y}`),n}},R={...L,type:"deleteLine",inverse:e=>({...e,type:"addLine"}),apply:(e,t)=>{t.get(c.L4).removeNode(e.value.id)},getLabel:(e,t)=>"Delete Line",getDescription:(e,t)=>{let i=t.get(N),{value:r}=e;if(!r.from||!r.to)return"Delete Line";let n=i.getNodeLabelById(r.from),o=i.getNodeLabelById(r.to);return`Delete Line from ${n} to ${o}`}},P={...L,type:"changeNodeData",inverse:e=>({...e,value:{...e.value,value:e.value.oldValue,oldValue:e.value.value}}),apply:(e,t)=>{let i=t.get(c.L4).getNode(e.value.id);if(!i)return;let r=i.getData(g.Ps);if(!r)return;let{path:n}=e.value;n.endsWith("/")&&"/"!==n&&(n=n.slice(0,-1)),n.startsWith("/")||(n=`/${n}`);let o=r.formModel.getFormItemByPath(n);o&&(o.value=e.value.value)},shouldMerge:(e,t,i)=>{if(!t)return!1;if(Date.now()-i.getTimestamp()<500){var r,n;return e.type!==t.type||e.value.id!==t.value.id||(null==(r=e.value)?void 0:r.path)!==(null==(n=t.value)?void 0:n.path)||{type:e.type,value:{...e.value,value:e.value.value,oldValue:t.value.oldValue}}}return!1}},j={...L,type:"changeLineData",inverse:e=>({...e,value:{...e.value,newValue:e.value.oldValue,oldValue:e.value.newValue}}),apply:(e,t)=>{let i=t.get(c.dm).getLineById(e.value.id);i&&(i.lineData=e.value.newValue)},shouldMerge:(e,t,i)=>!!t&&!!(Date.now()-i.getTimestamp()<500)&&(e.type!==t.type||e.value.id!==t.value.id||{type:e.type,value:{...e.value,newValue:e.value.newValue,oldValue:t.value.oldValue}})},z={...L,type:"addNode",inverse:e=>({...e,type:"deleteNode"}),apply:async(e,t)=>{let i=t.get(c.L4);await i.createWorkflowNode((0,s.Z)(e.value.node),!1,e.value.parentID)},getLabel:(e,t)=>{let i=t.get(N);return`Create Node ${i.getNodeLabel(e.value.node)}`},getDescription:(e,t)=>{var i;let r=t.get(N),n=`Create Node ${r.getNodeLabel(e.value.node)}`;return(null==(i=e.value.node.meta)?void 0:i.position)&&(n+=` at ${e.value.node.meta.position.x},${e.value.node.meta.position.y}`),n}},V=[{...L,type:"addLine",inverse:e=>({...e,type:"deleteLine"}),apply:(e,t)=>{t.get(c.dm).createLine({...e.value,key:e.value.id})},getLabel:(e,t)=>"Create Line",getDescription:(e,t)=>{let i=t.get(N),{value:r}=e;if(!r.from||!r.to)return"Create Line";let n=i.getNodeLabelById(r.from),o=i.getNodeLabelById(r.to);return`Create Line from ${n} to ${o}`}},R,z,k,P,T,O,A,j],B=class{registerOperationMeta(e){V.forEach(t=>{e.registerOperationMeta(t)})}};B=m([(0,l.b2)()],B);var F=class{onInit(e,t){let i=e.get(c.L4),r=e.get(o.qp),a=e.get(c.iw),l=e.get(c.ZO);(null==t?void 0:t.limit)&&r.limit(t.limit),r.context.source=e,this._toDispose.pushAll([a.onNodesDrag(async e=>{"onDragEnd"===e.type&&this._dragNodesHandler.handle(e)}),i.onNodeCreate(e=>{let{node:t,data:i}=e,r=t.getData(n.WV);r&&this._entityManager.addEntityData(r)}),this._formManager?this._formManager.onFormModelWillInit(e=>{let{model:t,data:i}=e,r=t.flowNodeEntity,n=r.getData(g.Ps);n&&(this._entityManager.setValue(n,(0,s.Z)(i)),this._toDispose.push(n.onDetailChange(e=>{this._changeNodeDataHandler.handle({...e,node:r})})))}):h.JT.NULL,i.onContentChange(t=>{this._changeContentHandler.handle(t,e)}),i.onReload(e=>{r.clear()}),l.onResetLayout(e=>{r.pushOperation({type:"resetLayout",value:{ids:e.nodeIds,value:e.positionMap,oldValue:e.oldPositionMap}},{noApply:!0})}),this._operationService.onNodeMove(e=>{let{node:t,fromParent:i,fromIndex:n,toParent:o,toIndex:s}=e;r.pushOperation({type:p.C8.moveChildNodes,value:{fromParentId:i.id,fromIndex:n,nodeIds:[t.id],toParentId:o.id,toIndex:s}},{noApply:!0})}),this._operationService.onNodePostionUpdate(e=>{let t={ids:[e.node.id],value:[e.newPosition],oldValue:[e.oldPosition]};r.pushOperation({type:"dragNodes",value:t},{noApply:!0})})])}dispose(){this._entityManager.dispose(),this._toDispose.dispose()}constructor(){this._toDispose=new h.K4}};m([(0,l.f3)(D)],F.prototype,"_dragNodesHandler",2),m([(0,l.f3)(C)],F.prototype,"_changeNodeDataHandler",2),m([(0,l.f3)(I)],F.prototype,"_changeContentHandler",2),m([(0,l.f3)(E)],F.prototype,"_entityManager",2),m([(0,l.f3)(g.yf),(0,l.jt)()],F.prototype,"_formManager",2),m([(0,l.f3)(c.xV)],F.prototype,"_operationService",2),F=m([(0,l.b2)()],F);var Y=(0,n.M1)({onBind:e=>{let{bind:t}=e;(0,n.KV)(t,B,[o.FU]),t(N).toSelf().inSingletonScope(),t(F).toSelf().inSingletonScope(),t(E).toSelf().inSingletonScope(),t(D).toSelf().inSingletonScope(),t(C).toSelf().inSingletonScope(),t(I).toSelf().inSingletonScope()},onInit(e,t){e.get(N).init(e,t),t.enable&&e.get(F).onInit(e,t)},onDispose(e){e.get(E).dispose()},containerModules:[o.Xn]})},697495:function(e,t,i){i.d(t,{J2:()=>k,Jb:()=>D});var r,n=i(89802),o=i(908600),s=i(65881),a=i(288216),l=i(893740),h=i(261513),d=i(461932),u=i(832176),c=i(438024),g=i(854343),p=i(564085),f=Object.defineProperty,y=Object.getOwnPropertyDescriptor,m=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?y(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&f(t,i,o),o},E=h.ZP.div`
  width: 20px;
  height: 20px;
  border-radius: 50%;
  margin-top: -10px;
  margin-left: -10px;
  left: 50%;
  top: 50%;
  position: absolute;
  //  hover 
  border: none;

  & > .symbol {
    opacity: 0;
  }

  .bg-circle {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    background-color: var(--g-workflow-port-color-background, #fff);
    transform: scale(0.5);
    transition: all 0.2s linear 0s;
  }

  .bg {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: var(--g-workflow-port-color-secondary, #9197f1);
    transform: scale(0.4, 0.4);
    transition: all 0.2s linear 0s;

    &.hasError {
      background: var(--g-workflow-port-color-error, red);
    }

    .symbol {
      position: absolute;
      width: 14px;
      height: 14px;
      opacity: 0;
      pointer-events: none;
      color: var(--g-workflow-port-color-background, #fff);
      transition: opacity 0.2s linear 0s;

      & > svg {
        width: 14px;
        height: 14px;
      }
    }

    .focus-circle {
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 8px;
      height: 8px;
      opacity: 0;
      background: var(--g-workflow-port-color-secondary, #9197f1);
      border-radius: 50%;
      transition: opacity 0.2s linear 0s;
    }
  }

  &.linked .bg:not(.hasError) {
    background: var(--g-workflow-port-color-primary, #4d53e8);
  }

  &.hovered .bg:not(.hasError) {
    border: none;
    cursor: crosshair;
    transform: scale(1, 1);
    background: var(--g-workflow-port-color-primary, #4d53e8);

    & > .symbol {
      opacity: 1;
    }
  }

  .cross-hair {
    position: relative;
    left: 2px;
    top: 2px;

    &::after,
    &::before {
      content: '';
      background: var(--g-workflow-port-color-background, #fff);
      border-radius: 2px;
      position: absolute;
    }

    &::after {
      left: 4px;
      width: 2px;
      height: 6px;
      box-shadow: 0 4px var(--g-workflow-port-color-background, #fff);
    }

    &::before {
      top: 4px;
      width: 6px;
      height: 2px;
      box-shadow: 4px 0 var(--g-workflow-port-color-background, #fff);
    }
`;function b(){return o.createElement("div",{className:"symbol"},o.createElement("div",{className:"cross-hair"}))}var D=o.memo(e=>{var t;let i=(0,l.G2)(a.XH),r=(0,l.G2)(a.dm),{entity:h,onClick:d}=e,{portType:u,relativePosition:c,disabled:g}=h,[p,f]=(0,o.useState)(h.targetElement),[y,m]=(0,o.useState)(c.x),[D,N]=(0,o.useState)(c.y),[C,M]=(0,o.useState)(!1),[S,x]=(0,o.useState)(!!(null==h||null==(t=h.lines)?void 0:t.length)),[w,_]=(0,o.useState)(e.entity.hasError),I=(0,a.gO)();(0,o.useEffect)(()=>{h.validate(),_(h.hasError);let e=h.onEntityChange(()=>{if(h.targetElement){h.targetElement!==p&&f(h.targetElement);return}let e=h.relativePosition;m(Math.round(e.x)),N(Math.round(e.y))}),t=i.onHoveredChange(e=>{M(i.isHovered(h.id))}),n=h.onErrorChanged(()=>{_(h.hasError)}),o=r.onAvailableLinesChange(()=>{setTimeout(()=>{r.disposed||h.disposed||x(!!h.lines.length)},0)});return()=>{e.dispose(),t.dispose(),n.dispose(),o.dispose()}},[i,h,p]);let L=(0,s.Z)("workflow-port-render",e.className||"",{hovered:!I&&C&&!g&&"input"!==u,linked:S}),T={};e.primaryColor&&(T["--g-workflow-port-color-primary"]=e.primaryColor),e.secondaryColor&&(T["--g-workflow-port-color-secondary"]=e.secondaryColor),e.errorColor&&(T["--g-workflow-port-color-error"]=e.errorColor),e.backgroundColor&&(T["--g-workflow-port-color-background"]=e.backgroundColor);let A=p?{...e.style,...T}:{...e.style,...T,left:y,top:D},O=o.createElement(E,{className:L,style:A,onClick:e=>null==d?void 0:d(e,h),onTouchStart:e=>{d&&l.UJ.onTouched(e,e=>{d(e,h)})},"data-port-entity-id":h.id,"data-port-entity-type":h.portType,"data-testid":"sdk.workflow.canvas.node.port"},o.createElement("div",{className:(0,s.Z)("bg-circle","workflow-bg-circle")}),o.createElement("div",{className:(0,s.Z)({bg:!0,"workflow-port-bg":!0,"workflow-point-bg":!0,hasError:w})},o.createElement(b,null)),o.createElement("div",{className:"focus-circle"}));return p?n.createPortal(O,p):O}),N=h.ZP.div`
  position: absolute;

  @keyframes flowingDash {
    to {
      stroke-dashoffset: -13;
    }
  }

  .dashed-line {
    stroke-dasharray: 8, 5;
  }

  .flowing-line {
    animation: flowingDash 0.5s linear infinite;
  }
`;function C(e){let{id:t,pos:i,reverseArrow:r,strokeWidth:n,vertical:s,hide:a}=e;if(a)return null;let l=s?r?`M ${i.x-6},${i.y} L ${i.x},${i.y-6} L ${i.x+6},${i.y}`:`M ${i.x-6},${i.y-6} L ${i.x},${i.y} L ${i.x+6},${i.y-6}`:r?`M ${i.x},${i.y+6} L ${i.x-6},${i.y} L ${i.x},${i.y-6}`:`M ${i.x-6},${i.y-6} L ${i.x},${i.y} L ${i.x-6},${i.y+6}`;return o.createElement("path",{d:l,strokeLinecap:"round",stroke:`url(#${t})`,fill:"none",strokeWidth:n})}var M=(0,o.memo)(e=>{var t;let{line:i,color:r,selected:n,children:l,strokePrefix:h,rendererRegistry:d}=e,{position:u,reverse:c,hideArrow:g,vertical:p}=i,{bounds:f,path:y}=i.getData(a.ps),m=e=>({x:e.x-f.x+12,y:e.y-f.y+12}),E=m(u.from),b=m(u.to),D="top"===u.to.location?{x:b.x,y:b.y-a.em}:{x:b.x-a.em,y:b.y},M="bottom"===u.from.location?{x:E.x,y:E.y+a.em+6}:{x:E.x+a.em+6,y:E.y},S=n?i.uiState.strokeWidthSelected??3:i.uiState.strokeWidth??2,x=h?`${h}-${i.id}`:i.id,w=null==d||null==(t=d.tryToGetRendererComponent("arrow-renderer"))?void 0:t.renderer,_=o.createElement("path",{d:y,fill:"none",stroke:`url(#${x})`,strokeWidth:S,className:i.processing||i.flowing?"dashed-line flowing-line":""});return o.createElement(N,{className:(0,s.Z)("gedit-flow-activity-edge",i.className),style:{...i.uiState.style,left:f.x-12,top:f.y-12,position:"absolute"}},l,o.createElement("svg",{width:f.width+24,height:f.height+24},o.createElement("defs",null,o.createElement("linearGradient",{x1:p?"100%":"0%",y1:p?"0%":"100%",x2:"100%",y2:"100%",id:x,gradientUnits:"userSpaceOnUse"},o.createElement("stop",{stopColor:r,offset:"0%"}),o.createElement("stop",{stopColor:r,offset:"100%"}))),o.createElement("g",null,_,o.createElement(w||C,{id:x,reverseArrow:c,pos:c?M:D,strokeWidth:S,vertical:p,hide:g,line:i}))))},(e,t)=>e.version===t.version),S=class extends l.mh{onZoom(e){this.node.style.transform=`scale(${e})`}onReady(){this.pipelineNode.appendChild(this.node),this.toDispose.pushAll([this.selectService.onSelectionChanged(()=>this.render()),this.hoverService.onHoveredChange(()=>this.render()),this.workflowDocument.linesManager.onForceUpdate(()=>{this.mountedLines.clear(),this.bumpVersion(),this.render()})])}dispose(){this.mountedLines.clear()}render(){let[,e]=(0,o.useState)({});(0,o.useLayoutEffect)(()=>{let t=requestAnimationFrame(()=>{let t=!1;this.lines.forEach(e=>{let i=e.getData(a.ps),r=i.renderVersion;i.update(),i.renderVersion!==r&&(t=!0)}),t&&e({})});return()=>cancelAnimationFrame(t)},[this.lines]);let t=this.lines.map(e=>this.renderLine(e));return o.createElement(o.Fragment,null,t)}bumpVersion(){this._version=this._version+1,this._version===Number.MAX_SAFE_INTEGER&&(this._version=0)}lineProps(e){let{lineType:t}=this.workflowDocument.linesManager,i=this.selectService.isSelected(e.id),r=this.hoverService.isHovered(e.id),n=this.lineVersion(e);return{key:e.id,color:e.color,selected:i,hovered:r,line:e,lineType:t,version:n,strokePrefix:this.layerID,rendererRegistry:this.rendererRegistry}}lineVersion(e){let{renderVersion:t}=e.getData(a.ps),i=this.selectService.isSelected(e.id),r=this.hoverService.isHovered(e.id),{version:n,color:o}=e;return`v:${this._version},lv:${n},rv:${t},c:${o},s:${i?"T":"F"},h:${r?"T":"F"}`}lineComponent(e){let t=this.options.renderInsideLine??(()=>o.createElement(o.Fragment,null));return o.createElement(M,{...e},o.createElement(t,{...e}))}renderLine(e){let t=this.lineProps(e),i=this.mountedLines.get(e.id),r=void 0!==i,{portal:o,version:s}=i??{};if(r&&s===t.version)return o;r||(this.renderElement.appendChild(e.node),e.onDispose(()=>{this.mountedLines.delete(e.id),e.node.remove()}));let a=n.createPortal(this.lineComponent(t),e.node);return this.mountedLines.set(e.id,{line:e,portal:a,version:t.version}),a}get renderElement(){return this.stackContext.node}constructor(){super(...arguments),this.layerID=(0,a.x0)(),this.mountedLines=new Map,this._version=0,this.node=u.xF.createDivWithClass("gedit-playground-layer gedit-flow-lines-layer")}};function x(e,t){return{x:e.x-t.x+12,y:e.y-t.y+12}}function w(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function _(e){let{location:t,x1:i,y1:r,x2:n,y2:o,curvature:s}=e;switch(t){case"left":return{x:i-w(i-n,s),y:r};case"right":return{x:i+w(n-i,s),y:r};case"top":return{x:i,y:r-w(r-o,s)};case"bottom":return{x:i,y:r+w(o-r,s)}}}S.type="WorkflowLinesLayer",m([(0,d.f3)(a.XH)],S.prototype,"hoverService",2),m([(0,d.f3)(a.oJ)],S.prototype,"selectService",2),m([(0,d.f3)(g.StackingContextManager)],S.prototype,"stackContext",2),m([(0,d.f3)(c.Rf)],S.prototype,"rendererRegistry",2),m([(0,l.RX)(a.e2)],S.prototype,"lines",2),m([(0,l.RX)(a.FD)],S.prototype,"ports",2),m([(0,l.aI)(a.CT,l.VO)],S.prototype,"trans",2),m([(0,d.f3)(a.L4)],S.prototype,"workflowDocument",2),S=m([(0,d.b2)()],S);var I=class{get path(){var e;return(null==(e=this.data)?void 0:e.path)??""}calcDistance(e){return this.data?u.E9.getDistance(e,this.data.bezier.project(e)):Number.MAX_SAFE_INTEGER}get bounds(){return this.data?this.data.bbox:u.Ae.EMPTY}get center(){var e;return null==(e=this.data)?void 0:e.center}update(e){this.data=this.calcBezier(e.fromPos,e.toPos)}calcBezier(e,t){let{controls:i,center:r}=function(e,t){var i,r,n,o;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.25,a=_({location:e.location,x1:e.x,y1:e.y,x2:t.x,y2:t.y,curvature:s}),l=_({location:t.location,x1:t.x,y1:t.y,x2:e.x,y2:e.y,curvature:s}),h=(i=e,r=t,n=a,o=l,{x:.125*i.x+.375*n.x+.375*o.x+.125*r.x,y:.125*i.y+.375*n.y+.375*o.y+.125*r.y});return{controls:[a,l],center:h}}(e,t,this.entity.uiState.curvature),n=new p.D([e,...i,t]),o=n.bbox(),s=new u.Ae(o.x.min,o.y.min,o.x.max-o.x.min,o.y.max-o.y.min),a=x(r,s),l=this.getPath({bbox:s,fromPos:e,toPos:t,controls:i});return this.data={fromPos:e,toPos:t,bezier:n,bbox:s,controls:i,path:l,center:{...r,labelX:a.x,labelY:a.y}},this.data}getPath(e){let{bbox:t}=e,i=x(e.fromPos,t),r=x(e.toPos,t),n=e.controls.map(e=>x(e,t)),o=this.entity.uiState.shrink,s="bottom"===e.fromPos.location?{x:i.x,y:i.y+o}:{x:i.x+o,y:i.y},a="top"===e.toPos.location?{x:r.x,y:r.y-o}:{x:r.x-o,y:r.y},l=n.map(e=>`${e.x} ${e.y}`).join(",");return`M${s.x} ${s.y} C ${l}, ${a.x} ${a.y}`}constructor(e){this.entity=e}};I.type=a.SP.BEZIER;var L=r||(r={});let T={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1}};L.getPoints=function(e){let t,i,{source:r,target:n}=e,o=T[r.location],s=T[n.location],a={x:r.x+20*o.x,y:r.y+20*o.y,location:r.location},l={x:n.x+20*s.x,y:n.y+20*s.y,location:n.location},h=(e=>{let{source:t,target:i}=e;return"left"===t.location||"right"===t.location?t.x<i.x?{x:1,y:0}:{x:-1,y:0}:t.y<i.y?{x:0,y:1}:{x:0,y:-1}})({source:a,target:l}),d=0!==h.x?"x":"y",u=h[d],c=[],[g,p]=function(e){let{source:t,target:i}=e,r=Math.abs(i.x-t.x)/2,n=i.x<t.x?i.x+r:i.x-r,o=Math.abs(i.y-t.y)/2;return[n,i.y<t.y?i.y+o:i.y-o]}({source:r,target:n});if(o[d]*s[d]==-1){t=g,i=p;let e=[{x:t,y:a.y},{x:t,y:l.y}],r=[{x:a.x,y:i},{x:l.x,y:i}];c=o[d]===u?"x"===d?e:r:"x"===d?r:e}else{let e=[{x:a.x,y:l.y}],r=[{x:l.x,y:a.y}];c="x"===d?o.x===u?r:e:o.y===u?e:r;let n="x"===d?"y":"x",h=o[d]===s[n],g=a[n]>l[n],p=a[n]<l[n];(1===o[d]&&(!h&&g||h&&p)||1!==o[d]&&(!h&&p||h&&g))&&(c="x"===d?e:r);let f={x:a.x,y:a.y},y={x:l.x,y:l.y};Math.max(Math.abs(f.x-c[0].x),Math.abs(y.x-c[0].x))>=Math.max(Math.abs(f.y-c[0].y),Math.abs(y.y-c[0].y))?(t=(f.x+y.x)/2,i=c[0].y):(t=c[0].x,i=(f.y+y.y)/2)}return{points:[r,{x:a.x,y:a.y},...c,{x:l.x,y:l.y},n],center:{x:t,y:i}}},L.getSmoothStepPath=function(e){return e.reduce((t,i,r)=>t+(r>0&&r<e.length-1?function(e,t,i){let r=Math.min(u.E9.getDistance(e,t)/2,u.E9.getDistance(t,i)/2,5),{x:n,y:o}=t;if(e.x===n&&n===i.x||e.y===o&&o===i.y)return`L${n} ${o}`;if(e.y===o){let t=e.x<i.x?-1:1,s=e.y<i.y?1:-1;return`L ${n+r*t},${o}Q ${n},${o} ${n},${o+r*s}`}let s=e.x<i.x?1:-1,a=e.y<i.y?-1:1;return`L ${n},${o+r*a}Q ${n},${o} ${n+r*s},${o}`}(e[r-1],i,e[r+1]):`${0===r?"M":"L"}${i.x} ${i.y}`),"")},L.getBounds=function(e){let t=e.map(e=>e.x),i=e.map(e=>e.y),r=Math.min(...t),n=Math.max(...t),o=Math.min(...i),s=Math.max(...i);return u.Ae.createRectangleWithTwoPoints({x:r,y:o},{x:n,y:s})},L.getFoldLineToPointDistance=(e,t)=>{if(0===e.length)return 1/0;if(1===e.length)return u.E9.getDistance(e[0],t);let i=[];for(let t=0;t<e.length-1;t++)i.push([e[t],e[t+1]]);return Math.min(...i.map(e=>{let[i,r]=e;return((e,t,i)=>{let r,n,{x:o,y:s}=e,{x:a,y:l}=t,{x:h,y:d}=i,u=h-a,c=d-l,g=u*u+c*c,p=0===g?-1:((o-a)*u+(s-l)*c)/g;p<0?(r=a,n=l):p>1?(r=h,n=d):(r=a+p*u,n=l+p*c);let f=o-r,y=s-n;return Math.sqrt(f*f+y*y)})(t,i,r)}))};var A=class{get path(){var e;return(null==(e=this.data)?void 0:e.path)??""}calcDistance(e){return this.data?r.getFoldLineToPointDistance(this.data.points,e):Number.MAX_SAFE_INTEGER}get bounds(){return this.data?this.data.bbox:new u.Ae}get center(){var e;return null==(e=this.data)?void 0:e.center}update(e){let{fromPos:t,toPos:i}=e,n=this.entity.uiState.shrink,o={x:"bottom"===t.location?0:n,y:"bottom"===t.location?n:0},s={x:"top"===i.location?0:-n,y:"top"===i.location?-n:0},{points:a,center:l}=r.getPoints({source:{x:t.x+o.x,y:t.y+o.y,location:t.location},target:{x:i.x+s.x,y:i.y+s.y,location:i.location}}),h=r.getBounds(a),d=a.map(e=>x(e,h)),u=r.getSmoothStepPath(d),c=x(l,h);this.data={points:a,path:u,bbox:h,center:{x:l.x,y:l.y,labelX:c.x,labelY:c.y}}}constructor(e){this.entity=e}};A.type=a.SP.LINE_CHART;var O=class{get path(){var e;return(null==(e=this.data)?void 0:e.path)??""}calcDistance(e){if(!this.data)return Number.MAX_SAFE_INTEGER;let[t,i]=this.data.points;return u.E9.getDistance(e,function(e,t,i){let r=i.x-t.x,n=i.y-t.y;if(0===r)return{x:t.x,y:e.y};if(0===n)return{x:e.x,y:t.y};let o=Math.max(0,Math.min(1,((e.x-t.x)*r+(e.y-t.y)*n)/(r*r+n*n)));return{x:t.x+o*r,y:t.y+o*n}}(e,t,i))}get bounds(){return this.data?this.data.bbox:new u.Ae}get center(){var e;return null==(e=this.data)?void 0:e.center}update(e){let{fromPos:t,toPos:i}=e,r=this.entity.uiState.shrink,n={x:"bottom"===t.location?0:r,y:"bottom"===t.location?r:0},o={x:"top"===i.location?0:-r,y:"top"===i.location?-r:0},s=[{x:t.x+n.x,y:t.y+n.y},{x:i.x+o.x,y:i.y+o.y}],l=u.Ae.createRectangleWithTwoPoints(s[0],s[1]),h=s.map(e=>({x:e.x-l.x+12,y:e.y-l.y+12})),d=`M ${h[0].x} ${h[0].y} L ${h[1].x} ${h[1].y}`;this.data={points:s,path:d,bbox:l,center:(0,a.KH)(t,i,l,12)}}constructor(e){this.entity=e}};O.type=a.SP.STRAIGHT;var k=(0,l.M1)({singleton:!0,onInit:(e,t)=>{e.playground.registerLayer(S,{...t})},onReady:(e,t)=>{let i=e.container.get(a.dm);i.registerContribution(I).registerContribution(A).registerContribution(O),t.contributions&&t.contributions.forEach(e=>{i.registerContribution(e)}),t.defaultLineType&&i.switchLineType(t.defaultLineType)}})},773898:function(e,t,i){i.d(t,{Z:()=>D});var r=i(893740),n=i(461932),o=i(832176),s=i(288216),a=i(579962),l=i(908600),h=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?d(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&h(t,i,o),o},c={enableEdgeSnapping:!0,edgeThreshold:7,enableGridSnapping:!1,gridSize:20,enableMultiSnapping:!1,enableOnlyViewportSnapping:!0,edgeColor:"#4E40E5",alignColor:"#4E40E5",edgeLineWidth:2,alignLineWidth:2,alignCrossWidth:16},g=(e,t)=>void 0!==e&&void 0!==t&&1e-5>Math.abs(e-t),p=(e,t)=>void 0!==e&&void 0!==t&&t-e>1e-5,f=(e,t)=>void 0!==e&&void 0!==t&&e-t>1e-5,y=(e,t)=>g(e,t)||p(e,t),m=e=>"number"==typeof e&&!isNaN(e),E=class{init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options={...c,...e},this.mountListener()}dispose(){this.disposers.forEach(e=>e.dispose())}get disabled(){return this._disabled}disable(){this._disabled||(this._disabled=!0,this.clear())}enable(){this._disabled&&(this._disabled=!1,this.clear())}mountListener(){let e=this.dragService.registerPosAdjuster(e=>{let{selectedNodes:t,position:i}=e,r=!this.options.enableMultiSnapping&&1!==t.length;return this._disabled||!this.options.enableEdgeSnapping||r?{x:0,y:0}:this.snapping({targetNodes:t,position:i})}),t=this.dragService.onNodesDrag(e=>{"onDragEnd"===e.type&&!this._disabled&&(this.options.enableGridSnapping&&this.gridSnapping({targetNodes:e.nodes,gridSize:this.options.gridSize}),this.options.enableEdgeSnapping&&this.clear())});this.disposers.push(e,t)}snapping(e){let{targetNodes:t,position:i}=e,r=this.getBounds(t),n=new o.Ae(i.x,i.y,r.width,r.height),s=this.getSnapNodeRects({targetNodes:t,targetRect:n}),{alignOffset:a,alignRects:l,alignSpacing:h}=this.calcAlignOffset({targetRect:n,alignThreshold:this.options.edgeThreshold,snapNodeRects:s}),{snapOffset:d,snapEdgeLines:u}=this.calcSnapOffset({targetRect:n,edgeThreshold:this.options.edgeThreshold,snapNodeRects:s}),c={x:d.x||a.x,y:d.y||a.y},g=new o.Ae(i.x+c.x,i.y+c.y,n.width,n.height);return this.snapEmitter.fire({snapRect:g,snapEdgeLines:u,alignRects:l,alignSpacing:h}),c}calcSnapOffset(e){let{snapNodeRects:t,edgeThreshold:i,targetRect:r}=e,n=this.getSnapLines({snapNodeRects:t}),o=n.horizontal.find(e=>y(Math.abs(e.y-r.top),i)),s=n.horizontal.find(e=>y(Math.abs(e.y-r.bottom),i)),a=n.vertical.find(e=>y(Math.abs(e.x-r.left),i)),l=n.vertical.find(e=>y(Math.abs(e.x-r.right),i)),h=n.midHorizontal.find(e=>y(Math.abs(e.y-r.center.y),i)),d=n.midVertical.find(e=>y(Math.abs(e.x-r.center.x),i)),u=null==o?void 0:o.y,c=m(null==s?void 0:s.y)?s.y-r.height:void 0,p=null==a?void 0:a.x,f=m(null==l?void 0:l.x)?l.x-r.width:void 0,E=m(null==h?void 0:h.y)?h.y-r.height/2:void 0,b=m(null==d?void 0:d.x)?d.x-r.width/2:void 0,D={x:b??p??f??r.x,y:E??u??c??r.y};return{snapOffset:{x:D.x-r.x,y:D.y-r.y},snapEdgeLines:{top:g(u,D.y)?o:void 0,bottom:g(c,D.y)?s:void 0,left:g(p,D.x)?a:void 0,right:g(f,D.x)?l:void 0,midVertical:g(b,D.x)?d:void 0,midHorizontal:g(E,D.y)?h:void 0}}}gridSnapping(e){let{gridSize:t,targetNodes:i}=e,r=this.getBounds(i),n=e=>Math.round(e/t)*t,o={x:n(r.x),y:n(r.y)},s={x:o.x-r.x,y:o.y-r.y};i.forEach(e=>this.updateNodePositionWithOffset({node:e,offset:s}))}clear(){this.snapEmitter.fire({snapEdgeLines:{},snapRect:o.Ae.EMPTY,alignRects:{top:[],bottom:[],left:[],right:[]},alignSpacing:{}})}getSnapLines(e){let{snapNodeRects:t}=e,i=[],r=[],n=[],o=[];return t.forEach(e=>{let t=e.rect,s=t.center,a={y:t.top,sourceNodeId:e.id},l={y:t.bottom,sourceNodeId:e.id},h={x:t.left,sourceNodeId:e.id},d={x:t.right,sourceNodeId:e.id},u={y:s.y,sourceNodeId:e.id},c={x:s.x,sourceNodeId:e.id};i.push(a,l),r.push(h,d),n.push(u),o.push(c)}),{horizontal:i,vertical:r,midHorizontal:n,midVertical:o}}getAvailableNodes(e){var t;let{targetNodes:i,targetRect:r}=e,n=r.center,o=(null==(t=i[0].parent)?void 0:t.id)??this.document.root.id,s=i.map(e=>e.id);return s.push(a.Sy.ROOT),this.nodes.filter(e=>{var t;return(null==(t=e.parent)?void 0:t.id)===o}).filter(e=>!s.includes(e.id)).sort((e,t)=>{let i=e.getData(a.eG).bounds.center,r=t.getData(a.eG).bounds.center;return Math.abs(i.x-n.x)+Math.abs(i.y-n.y)-(Math.abs(r.x-n.x)+Math.abs(r.y-n.y))})}viewRect(){let{width:e,height:t,scrollX:i,scrollY:r,zoom:n}=this.playgroundConfig.config;return new o.Ae(i/n,r/n,e/n,t/n)}getSnapNodeRects(e){let t=this.getAvailableNodes(e),i=this.viewRect();return t.map(e=>{var t;let r={id:e.id,rect:e.getData(a.eG).bounds,entity:e};if(!this.options.enableOnlyViewportSnapping||(null==(t=e.parent)?void 0:t.flowNodeType)!==a.Sy.ROOT||o.Ae.intersects(i,r.rect))return r}).filter(Boolean)}get nodes(){return this.entityManager.getEntities(s.CT)}getBounds(e){return 0===e.length?o.Ae.EMPTY:o.Ae.enlarge(e.map(e=>e.getData(a.eG).bounds))}updateNodePositionWithOffset(e){let{node:t,offset:i}=e,n=t.getData(r.VO),o={x:n.position.x+i.x,y:n.position.y+i.y};n.update({position:o}),this.document.layout.updateAffectedTransform(t)}calcAlignOffset(e){let t,i,r,n,o,s,{snapNodeRects:a,targetRect:l,alignThreshold:h}=e,d=this.getAlignRects({targetRect:l,snapNodeRects:a}),u=this.calcAlignSpacing({targetRect:l,alignRects:d});if(u.top){let e=d.top[0].rect.bottom+u.top;y(Math.abs(l.top-e),h)?t=e:u.top=void 0}if(u.bottom){let e=d.bottom[0].rect.top-u.bottom;p(Math.abs(l.bottom-e),h)?i=e-l.height:u.bottom=void 0}if(u.left){let e=d.left[0].rect.right+u.left;y(Math.abs(l.left-e),h)?r=e:u.left=void 0}if(u.right){let e=d.right[0].rect.left-u.right;y(Math.abs(l.right-e),h)?n=e-l.width:u.right=void 0}if(u.midHorizontal){let e=d.left[0].rect.right+u.midHorizontal;y(Math.abs(l.left-e),h)?s=e:u.midHorizontal=void 0}if(u.midVertical){let e=d.top[0].rect.bottom+u.midVertical;y(Math.abs(l.top-e),h)?o=e:u.midVertical=void 0}let c={x:s??r??n??l.x,y:o??t??i??l.y};return{alignOffset:{x:c.x-l.x,y:c.y-l.y},alignRects:d,alignSpacing:u}}calcAlignSpacing(e){var t,i,r,n;let{targetRect:o,alignRects:s}=e,a=this.getDirectionAlignSpacing({rects:s.top,isHorizontal:!1}),l=this.getDirectionAlignSpacing({rects:s.bottom,isHorizontal:!1}),h=this.getDirectionAlignSpacing({rects:s.left,isHorizontal:!0}),d=this.getDirectionAlignSpacing({rects:s.right,isHorizontal:!0});return{top:a,bottom:l,left:h,right:d,midHorizontal:this.getMidAlignSpacing({rectA:null==(t=s.left[0])?void 0:t.rect,rectB:null==(i=s.right[0])?void 0:i.rect,targetRect:o,isHorizontal:!0}),midVertical:this.getMidAlignSpacing({rectA:null==(r=s.top[0])?void 0:r.rect,rectB:null==(n=s.bottom[0])?void 0:n.rect,targetRect:o,isHorizontal:!1})}}getAlignRects(e){let{targetRect:t,snapNodeRects:i}=e,r=[],n=[],o=[],s=[];return i.forEach(e=>{let i=e.rect,{isVerticalIntersection:a,isHorizontalIntersection:l,isIntersection:h}=this.intersection(i,t);!h&&(a?f(i.center.y,t.center.y)?n.push({rect:i,sourceNodeId:e.id}):r.push({rect:i,sourceNodeId:e.id}):l&&(f(i.center.x,t.center.x)?s.push({rect:i,sourceNodeId:e.id}):o.push({rect:i,sourceNodeId:e.id})))}),{top:r,bottom:n,left:o,right:s}}getMidAlignSpacing(e){let{rectA:t,rectB:i,targetRect:r,isHorizontal:n}=e;if(!t||!i)return;let{isVerticalIntersection:o,isHorizontalIntersection:s,isIntersection:a}=this.intersection(t,i);if(!a){if(n&&s&&!o)return(Math.min(Math.abs(t.left-i.right),Math.abs(t.right-i.left))-r.width)/2;else if(!n&&o&&!s)return(Math.min(Math.abs(t.top-i.bottom),Math.abs(t.bottom-i.top))-r.height)/2}}getDirectionAlignSpacing(e){let{rects:t,isHorizontal:i}=e;if(t.length<2)return;let r=t[0].rect,n=t[1].rect,{isVerticalIntersection:o,isHorizontalIntersection:s,isIntersection:a}=this.intersection(r,n);if(!a){if(i&&s&&!o)return Math.min(Math.abs(r.left-n.right),Math.abs(r.right-n.left));else if(!i&&o&&!s)return Math.min(Math.abs(r.top-n.bottom),Math.abs(r.bottom-n.top))}}intersection(e,t){let i=p(e.left,t.right)&&f(e.right,t.left),r=p(e.top,t.bottom)&&f(e.bottom,t.top);return{isHorizontalIntersection:r,isVerticalIntersection:i,isIntersection:r&&i}}constructor(){this.disposers=[],this.snapEmitter=new o.Q5,this.onSnap=this.snapEmitter.event,this._disabled=!1}};u([(0,n.f3)(s.L4)],E.prototype,"document",2),u([(0,n.f3)(r.v2)],E.prototype,"entityManager",2),u([(0,n.f3)(s.iw)],E.prototype,"dragService",2),u([(0,n.f3)(r.ER)],E.prototype,"playgroundConfig",2),E=u([(0,n.b2)()],E);var b=class extends r.mh{onReady(){this.node.style.zIndex="9999",this.toDispose.pushAll([this.service.onSnap(e=>{this.edgeLines=this.calcEdgeLines(e),this.alignLines=this.calcAlignLines(e),this.render()})])}render(){return l.createElement(l.Fragment,null,this.alignLines.length>0&&l.createElement("div",{className:"workflow-snap-align-lines"},this.renderAlignLines()),this.edgeLines.length>0&&l.createElement("div",{className:"workflow-snap-edge-lines"},this.renderEdgeLines()))}onZoom(e){this.node.style.transform=`scale(${e})`}renderEdgeLines(){return this.edgeLines.map(e=>{let{className:t,sourceNode:i,top:r,left:n,width:o,height:s,dashed:a}=e,h=`${t}-${i}-${r}-${n}-${o}-${s}`,d=o<s,u=`${this.options.edgeLineWidth}px ${a?"dashed":"solid"} ${this.options.edgeColor}`;return l.createElement("div",{className:`workflow-snap-edge-line ${t}`,"data-testid":"sdk.workflow.canvas.snap.edgeLine","data-snap-line-id":h,"data-snap-line-source-node":i,key:h,style:{top:r,left:n,width:o,height:s,position:"absolute",borderLeft:d?u:"none",borderTop:d?"none":u}})})}renderAlignLines(){return this.alignLines.map(e=>{let t=`${e.className}-${e.sourceNode}-${e.top}-${e.left}-${e.width}-${e.height}`,i=f(e.width,e.height),r=this.options.alignLineWidth,n=this.options.alignCrossWidth,o=i?e.top-r/2:e.top,s=i?e.left:e.left-r/2;return l.createElement("div",{className:`workflow-snap-align-line ${e.className}`,"data-testid":"sdk.workflow.canvas.snap.alignLine","data-snap-line-id":t,"data-snap-line-source-node":e.sourceNode,key:t,style:{position:"absolute"}},l.createElement("div",{style:{position:"absolute",top:o,left:s,width:i?e.width:r,height:i?r:e.height,backgroundColor:this.options.alignColor}}),l.createElement("div",{style:{position:"absolute",top:i?o-(n-r)/2:o,left:i?s:s-(n-r)/2,width:i?r:n,height:i?n:r,backgroundColor:this.options.alignColor}}),l.createElement("div",{style:{position:"absolute",top:i?o-(n-r)/2:o+e.height-r,left:i?s+e.width-r:s-(n-r)/2,width:i?r:n,height:i?n:r,backgroundColor:this.options.alignColor}}))})}calcEdgeLines(e){let{alignRects:t,snapRect:i,snapEdgeLines:r}=e,n=[],o=this.directionFullAlign({alignRects:t.top,targetRect:i,isVertical:!0}),s=this.directionFullAlign({alignRects:t.bottom,targetRect:i,isVertical:!0}),l=this.directionFullAlign({alignRects:t.left,targetRect:i,isVertical:!1}),h=this.directionFullAlign({alignRects:t.right,targetRect:i,isVertical:!1});if(o){let e=o.rect.top,t=s?i.bottom-i.height/2-e:i.bottom-e,r={top:e,width:this.options.edgeLineWidth,height:t};n.push({className:"edge-full-top-left",sourceNode:o.sourceNodeId,left:i.left,...r}),n.push({className:"edge-full-top-right",sourceNode:o.sourceNodeId,left:i.right,...r}),n.push({className:"edge-full-top-mid",sourceNode:o.sourceNodeId,left:i.left+i.width/2,dashed:!0,...r})}if(s){let e=o?i.top+i.height/2:i.top,t=s.rect.bottom-e,r={top:e,width:this.options.edgeLineWidth,height:t};n.push({className:"edge-full-bottom-left",sourceNode:s.sourceNodeId,left:i.left,...r}),n.push({className:"edge-full-bottom-right",sourceNode:s.sourceNodeId,left:i.right,...r}),n.push({className:"edge-full-bottom-mid",sourceNode:s.sourceNodeId,left:i.left+i.width/2,dashed:!0,...r})}if(l){let e=l.rect.left,t=h?i.right-i.width/2-e:i.right-e,r={left:e,width:t,height:this.options.edgeLineWidth};n.push({className:"edge-full-left-top",sourceNode:l.sourceNodeId,top:i.top,...r}),n.push({className:"edge-full-left-bottom",sourceNode:l.sourceNodeId,top:i.bottom,...r}),n.push({className:"edge-full-left-mid",sourceNode:l.sourceNodeId,top:i.top+i.height/2,dashed:!0,...r})}if(h){let e=l?i.left+i.width/2:i.left,t=h.rect.right-e,r={left:e,width:t,height:this.options.edgeLineWidth};n.push({className:"edge-full-right-top",sourceNode:h.sourceNodeId,top:i.top,...r}),n.push({className:"edge-full-right-bottom",sourceNode:h.sourceNodeId,top:i.bottom,...r}),n.push({className:"edge-full-right-mid",sourceNode:h.sourceNodeId,top:i.top+i.height/2,dashed:!0,...r})}let d=Object.entries(r).map(e=>{let[t,r]=e;if(!r)return;let n=this.document.getNode(r.sourceNodeId);if(!n)return;let d=n.getData(a.eG).bounds;if(m(r.x)){let e=Math.min(d.top,i.top),n=Math.max(d.bottom,i.bottom),a=r.x,l=this.options.edgeLineWidth,h={className:`edge-snapped-${t}`,sourceNode:r.sourceNodeId,top:e,left:a,width:l,height:n-e,dashed:"midVertical"===t},u=e===d.top;if(u&&o||!u&&s)return;return h}if(m(r.y)){let e=Math.min(d.left,i.left),n=Math.max(d.right,i.right),o=r.y,s=this.options.edgeLineWidth,a={className:`edge-snapped-${t}`,sourceNode:r.sourceNodeId,top:o,left:e,width:n-e,height:s,dashed:"midHorizontal"===t},u=e===d.left;if(u&&l||!u&&h)return;return a}}).filter(Boolean);return n.push(...d),n}directionFullAlign(e){let{alignRects:t,targetRect:i,isVertical:r}=e,n=-1;for(let e=0;e<t.length;e++){var o;let s=t[e],a=(null==(o=t[e-1])?void 0:o.rect)??i;if(!this.rectFullAlign(s.rect,a,r))break;n=e}return t[n]}rectFullAlign(e,t,i){return i?g(e.left,t.left)&&g(e.right,t.right):g(e.top,t.top)&&g(e.bottom,t.bottom)}calcAlignLines(e){let{alignRects:t,alignSpacing:i,snapRect:r}=e,n=this.calcDirectionAlignLines({alignRects:t.top,targetRect:r,isVertical:!0,spacing:i.midVertical??i.top}),o=this.calcDirectionAlignLines({alignRects:t.bottom,targetRect:r,isVertical:!0,spacing:i.midVertical??i.bottom});return[...n,...o,...this.calcDirectionAlignLines({alignRects:t.left,targetRect:r,isVertical:!1,spacing:i.midHorizontal??i.left}),...this.calcDirectionAlignLines({alignRects:t.right,targetRect:r,isVertical:!1,spacing:i.midHorizontal??i.right})]}calcDirectionAlignLines(e){let{alignRects:t,targetRect:i,isVertical:r,spacing:n}=e,o=[];if(!n)return o;for(let e=0;e<t.length;e++){var s;let a=t[e],l=a.rect,h=(null==(s=t[e-1])?void 0:s.rect)??i;if(!g(r?Math.min(Math.abs(h.top-l.bottom),Math.abs(h.bottom-l.top)):Math.min(Math.abs(h.left-l.right),Math.abs(h.right-l.left)),n))break;if(r){let e=this.calcHorizontalIntersectionCenter(l,i);o.push({className:"align-vertical",sourceNode:a.sourceNodeId,top:Math.min(l.bottom,h.bottom),left:e,width:1,height:n})}else{let e=this.calcVerticalIntersectionCenter(l,i);o.push({className:"align-horizontal",sourceNode:a.sourceNodeId,top:e,left:Math.min(l.right,h.right),width:n,height:1})}}return o}calcVerticalIntersectionCenter(e,t){return(Math.max(e.top,t.top)+Math.min(e.bottom,t.bottom))/2}calcHorizontalIntersectionCenter(e,t){return(Math.max(e.left,t.left)+Math.min(e.right,t.right))/2}constructor(){super(...arguments),this.node=o.xF.createDivWithClass("gedit-playground-layer gedit-flow-snap-layer"),this.edgeLines=[],this.alignLines=[]}};b.type="WorkflowSnapLayer",u([(0,n.f3)(s.L4)],b.prototype,"document",2),u([(0,n.f3)(E)],b.prototype,"service",2),b=u([(0,n.b2)()],b);var D=(0,r.M1)({onBind(e){let{bind:t}=e;t(E).toSelf().inSingletonScope()},onInit(e,t){let i={...c,...t};e.playground.registerLayer(b,i),e.get(E).init(i)},onDispose(e){e.get(E).dispose()}})},854343:function(e,t,i){i.r(t),i.d(t,{StackingBaseIndex:()=>b,StackingComputing:()=>y,StackingConfig:()=>N,StackingContextManager:()=>C,StackingItem:()=>m,StackingType:()=>E,createFreeStackPlugin:()=>M,layersComputing:()=>I});var r,n,o,s,a=i(893740),l=i(658639),h=i(461932),d=i(832176),u=i(288216),c=i(579962),g=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?p(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&g(t,i,o),o},y=class{compute(e){this.clearCache();let{root:t,nodes:i,context:r}=e;return this.context=r,this.nodeIndexes=this.computeNodeIndexesMap(i),this.topLevel=this.computeTopLevel(i),this.maxLevel=2*this.topLevel,this.layerHandler(t.blocks),{nodeLevel:this.nodeLevel,lineLevel:this.lineLevel,topLevel:this.topLevel,maxLevel:this.maxLevel}}clearCache(){this.currentLevel=0,this.topLevel=0,this.maxLevel=0,this.nodeIndexes=new Map,this.nodeLevel=new Map,this.lineLevel=new Map}computeNodeIndexesMap(e){let t=new Map;return e.forEach((e,i)=>{t.set(e.id,i)}),t}computeTopLevel(e){let t=e.filter(e=>e.id!==c.Sy.ROOT),i=t.reduce((e,t)=>t.blocks.length>0?e+1:e,0);return t.length+i+1}layerHandler(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.sortNodes(e);this.getNodesAllLines(i).forEach(e=>{e.isDrawing||this.context.hoveredEntityID===e.id||this.context.selectedIDs.includes(e.id)?this.lineLevel.set(e.id,this.maxLevel):this.lineLevel.set(e.id,this.getLevel(t))}),this.levelIncrease(),i.forEach(e=>{let i=this.context.selectedIDs.includes(e.id);i?this.nodeLevel.set(e.id,this.topLevel):this.nodeLevel.set(e.id,this.getLevel(t)),this.levelIncrease(),e.blocks.length>0&&this.layerHandler(e.blocks,t||i)})}sortNodes(e){return e.sort((e,t)=>{let i=this.nodeIndexes.get(e.id),r=this.nodeIndexes.get(t.id);return void 0===i||void 0===r?0:i-r})}getNodesAllLines(e){return e.map(e=>{let t=e.getData(u.Z1);return[...t.outputLines.filter(Boolean),...t.inputLines.filter(Boolean)]}).flat().filter(e=>void 0===this.lineLevel.get(e.id)||this.isHigherFirstLine(e))}isHigherFirstLine(e){var t,i;return(null==(t=e.to)?void 0:t.parent)===e.from||(null==(i=e.from)?void 0:i.parent)===e.to}getLevel(e){return e?this.topLevel+this.currentLevel:this.currentLevel}levelIncrease(){this.currentLevel+=1}},m=((r=m||{}).Line="line",r.Node="node",r),E=((n=E||{}).Line="line",n.Node="node",n),b={line:0,node:1},D=Object.keys(E).length,N={startIndex:8,allowLevel:2,levelIndexStep:D,maxLevel:4,maxIndex:8+4*D},C=class{init(){this.pipelineRenderer.node.appendChild(this.node),this.mountListener()}ready(){this.compute()}dispose(){this.disposers.forEach(e=>e.dispose())}_compute(){let e=this.context,{nodeLevel:t,lineLevel:i}=new y().compute({root:this.document.root,nodes:this.nodes,context:e});this.nodes.forEach(e=>{let i=t.get(e.id),r=e.getData(c.Lz),n=r.node;if(n.style.position="absolute",void 0===i){r.stackIndex=0,n.style.zIndex="auto";return}r.stackIndex=i;let o=N.startIndex+i;n.style.zIndex=String(o)}),this.lines.forEach(e=>{let t=i.get(e.id),r=e.node;if(r.style.position="absolute",void 0===t){e.stackIndex=0,r.style.zIndex="auto";return}e.stackIndex=t;let n=N.startIndex+t;r.style.zIndex=String(n)})}get nodes(){return this.entityManager.getEntities(u.CT)}get lines(){return this.entityManager.getEntities(u.e2)}get context(){var e;return{hoveredEntity:this.hoverService.hoveredNode,hoveredEntityID:null==(e=this.hoverService.hoveredNode)?void 0:e.id,selectedEntities:this.selectService.selection,selectedIDs:this.selectService.selection.map(e=>e.id)}}mountListener(){let e=this.onEntityChange(),t=this.onZoom(),i=this.onHover(),r=this.onSelect();this.disposers=[e,t,i,r]}onZoom(){return this.pipelineRegistry.onZoom(e=>{this.node.style.transform=`scale(${e})`})}onHover(){return this.hoverService.onHoveredChange(()=>{this.compute()})}onEntityChange(){return this.entityManager.onEntityChange(()=>{this.compute()})}onSelect(){return this.selectService.onSelectionChanged(()=>{this.compute()})}constructor(){this.node=d.xF.createDivWithClass("gedit-playground-layer gedit-flow-render-layer"),this.disposers=[],this.compute=(0,l.Z)(this._compute,10)}};f([(0,h.f3)(u.L4)],C.prototype,"document",2),f([(0,h.f3)(a.v2)],C.prototype,"entityManager",2),f([(0,h.f3)(a.Tj)],C.prototype,"pipelineRenderer",2),f([(0,h.f3)(a.Rm)],C.prototype,"pipelineRegistry",2),f([(0,h.f3)(u.XH)],C.prototype,"hoverService",2),f([(0,h.f3)(u.oJ)],C.prototype,"selectService",2),C=f([(0,h.b2)()],C);var M=(0,a.M1)({onBind(e){let{bind:t}=e;t(C).toSelf().inSingletonScope()},onInit(e){e.get(C).init()},onReady(e){e.get(C).ready()},onDispose(e){e.get(C).dispose()}}),S=o||(o={});S.compute=(e,t)=>{let i=x(e,t),r=w(e);r.style.position="absolute",r.style.zIndex=(0,S.zIndexStringify)(i)},S.stackingIndex=(e,t)=>{if(t<1)return;let i=b[e];return N.startIndex+N.levelIndexStep*(t-1)+i},S.nodeStackingLevel=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],n=e;for(;n;)r.push(n),n=n.parent;let o=r.reverse(),s=o.length-1,a=o.findIndex(e=>!!t.selectedIDs.includes(e.id)),l=N.allowLevel+(o.length-a);return i||-1===a?s:l},S.zIndexStringify=e=>void 0===e?"auto":e.toString();let x=(e,t)=>{let i=(0,S.nodeStackingLevel)(e,t);return(0,S.stackingIndex)("node",i)},w=e=>e.getData(c.Lz).node;(s||(s={})).compute=(e,t)=>{let i=_(e,t),r=e.node;r.style.position="absolute",r.style.zIndex=o.zIndexStringify(i)};let _=(e,t)=>{let i=((e,t)=>{if(e.isDrawing||t.hoveredEntityID===e.id||t.selectedIDs.includes(e.id))return N.maxLevel+1;let i=o.nodeStackingLevel(e.from,t,!0);return e.to?Math.min(i,o.nodeStackingLevel(e.to,t,!0)):i})(e,t);return o.stackingIndex("line",i)};var I=e=>{let{nodes:t,lines:i,context:r}=e;t.forEach(e=>{o.compute(e,r)}),i.forEach(e=>{s.compute(e,r)})}},330893:function(e,t,i){i.d(t,{I5:()=>b,Zd:()=>y,qP:()=>N});var r,n=i(908600),o=i(893740),s=i(658639),a=i(461932),l=i(832176),h=i(579962),d=Object.defineProperty,u=Object.getOwnPropertyDescriptor,c=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?u(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&d(t,i,o),o},g={canvasWidth:250,canvasHeight:250,canvasPadding:50,canvasBackground:"rgba(242, 243, 245, 1)",canvasBorderRadius:10,viewportBackground:"rgba(255, 255, 255, 1)",viewportBorderRadius:4,viewportBorderColor:"rgba(6, 7, 9, 0.10)",viewportBorderWidth:1,viewportBorderDashLength:void 0,nodeColor:"rgba(0, 0, 0, 0.10)",nodeBorderRadius:2,nodeBorderWidth:.145,nodeBorderColor:"rgba(6, 7, 9, 0.10)",overlayColor:"rgba(255, 255, 255, 0.55)"},p={scale:.7,opacity:1,translateX:15,translateY:15},f={canvasStyle:g,canvasClassName:"gedit-minimap-canvas",enableActiveDebounce:!1,enableInactiveDebounce:!0,enableDisplayAllNodes:!1,activeDebounceTime:0,inactiveDebounceTime:5},y=e=>{let{service:t,panelStyles:i={},containerStyles:r={},inactiveStyle:o={}}=e,s={...p,...o},a=(0,n.useRef)(null),[l,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=a.current;e&&t.canvas&&e.appendChild(t.canvas);let i=t.onActive(e=>{h(e)});return()=>{i.dispose()}},[]);let d=l?1:s.scale,u=l?1:s.opacity,c=l?0:s.translateX,g=l?0:s.translateY;return n.createElement("div",{className:"minimap-container",style:{position:"fixed",right:30,bottom:70,transition:"all 0.3s ease",transform:`scale(${d}) translate(${c}px, ${g}px)`,opacity:u,transformOrigin:"bottom right",...r}},n.createElement("div",{className:"minimap-panel",style:{display:"flex",width:"100%",height:"100%",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 1)",border:"0.572px solid rgba(6, 7, 9, 0.10)",overflow:"hidden",boxShadow:"0px 2.289px 6.867px 0px rgba(0, 0, 0, 0.08), 0px 4.578px 13.733px 0px rgba(0, 0, 0, 0.04)",boxSizing:"border-box",padding:8,...i},"data-flow-editor-selectable":"false",ref:a,onMouseEnter:()=>{t.setActivate(!0)},onMouseLeave:()=>{t.setActivate(!1)},onTouchStartCapture:()=>{t.setActivate(!0)},onTouchEndCapture:()=>{t.setActivate(!1)}}))},m=r||(r={});let E=e=>e.width>0&&e.height>0;m.clear=e=>{let{canvas:t,context:i}=e;i.clearRect(0,0,t.width,t.height)},m.backgroundColor=e=>{let{canvas:t,context:i,color:r}=e;i.fillStyle=r,i.fillRect(0,0,t.width,t.height)},m.rectangle=e=>{let{context:t,rect:i,color:r}=e;E(i)&&(t.fillStyle=r,t.fillRect(i.x,i.y,i.width,i.height))},m.roundRectangle=e=>{let{context:t,rect:i,color:r,radius:n,borderColor:o,borderDashLength:s,borderWidth:a=0}=e,{x:l,y:h,width:d,height:u}=i;E(i)&&(t.beginPath(),t.moveTo(l+n,h),t.lineTo(l+d-n,h),t.quadraticCurveTo(l+d,h,l+d,h+n),t.lineTo(l+d,h+u-n),t.quadraticCurveTo(l+d,h+u,l+d-n,h+u),t.lineTo(l+n,h+u),t.quadraticCurveTo(l,h+u,l,h+u-n),t.lineTo(l,h+n),t.quadraticCurveTo(l,h,l+n,h),t.closePath(),t.fillStyle=r,t.fill(),o&&a>0&&(t.strokeStyle=o,t.lineWidth=a,s?t.setLineDash([s,s]):t.setLineDash([]),t.stroke(),t.setLineDash([])))},m.overlay=e=>{let{canvas:t,context:i,offset:r,scale:n,rect:o,color:s}=e;E(o)&&(i.fillStyle=s,i.fillRect(0,0,t.width,(o.y+r.y)*n),i.fillRect(0,(o.y+o.height+r.y)*n,t.width,t.height-(o.y+o.height+r.y)*n),i.fillRect(0,(o.y+r.y)*n,(o.x+r.x)*n,o.height*n),i.fillRect((o.x+o.width+r.x)*n,(o.y+r.y)*n,t.width-(o.x+o.width+r.x)*n,o.height*n))};var b=class{init(e){this.options=f,Object.assign(this.options,e),this.setDebounce({enableDebounce:this.options.enableInactiveDebounce,debounceTime:this.options.inactiveDebounceTime}),this.initStyle(),this.mountListener()}dispose(){this.toDispose.dispose(),this.initialized=!1,this.activated=!1,this.removeEventListeners()}setActivate(e){e!==this.activated&&(e||!this.isDragging)&&(this.activated=e,e?(this.setDebounce({enableDebounce:this.options.enableActiveDebounce,debounceTime:this.options.activeDebounceTime}),this.addEventListeners()):(this.setDebounce({enableDebounce:this.options.enableInactiveDebounce,debounceTime:this.options.inactiveDebounceTime}),this.removeEventListeners()),this.render(),this.onActiveCallbacks.forEach(t=>t(e)))}initStyle(){if(!this.initialized)return;let{canvasClassName:e,canvasStyle:t}=this.options;this.canvas.className=e,this.style={...g,...t},this.canvas.width=this.style.canvasWidth,this.canvas.height=this.style.canvasHeight,this.canvas.style.borderRadius=this.style.canvasBorderRadius?`${this.style.canvasBorderRadius}px`:"unset"}setDebounce(e){let{enableDebounce:t,debounceTime:i}=e;t?this.render=(0,s.Z)(this._render,i):this.render=this._render}_render(){if(!this.initialized)return;let e=this.createRenderContext();this.renderCanvas(e)}createRenderContext(){let{canvas:e,context2D:t,nodes:i}=this,r=this.nodeTransforms(i).map(e=>e.bounds),n=this.viewRect(),o=this.renderRect(r).withPadding({top:this.style.canvasPadding,bottom:this.style.canvasPadding,left:this.style.canvasPadding,right:this.style.canvasPadding}),s=l.Ae.enlarge([n,o]),{scale:a,offset:h}=this.calculateScaleAndOffset({canvasRect:s});return{canvas:e,context2D:t,nodeRects:r,canvasRect:s,viewRect:n,renderRect:o,scale:a,offset:h}}renderCanvas(e){let{canvas:t,context2D:i,nodeRects:n,viewRect:o,scale:s,offset:a}=e;r.clear({canvas:t,context:i}),r.backgroundColor({canvas:t,context:i,color:this.style.canvasBackground}),r.roundRectangle({context:i,rect:this.rectOnCanvas({rect:o,scale:s,offset:a}),color:this.style.viewportBackground,radius:this.style.viewportBorderRadius}),n.forEach(e=>{r.roundRectangle({context:i,rect:this.rectOnCanvas({rect:e,scale:s,offset:a}),color:this.style.nodeColor,radius:this.style.nodeBorderRadius,borderWidth:this.style.nodeBorderWidth,borderColor:this.style.nodeBorderColor})}),r.roundRectangle({context:i,rect:this.rectOnCanvas({rect:o,scale:s,offset:a}),color:"rgba(255, 255, 255, 0)",radius:this.style.viewportBorderRadius,borderColor:this.style.viewportBorderColor,borderWidth:this.style.viewportBorderWidth,borderDashLength:this.style.viewportBorderDashLength}),r.overlay({canvas:t,context:i,offset:a,scale:s,rect:o,color:this.style.overlayColor})}calculateScaleAndOffset(e){let{canvasRect:t}=e,{width:i,height:r}=this.canvas,n=Math.min(i/t.width,r/t.height),o=t.width*n,s=t.height*n,a={x:(i-o)/2/n-t.x,y:(r-s)/2/n-t.y};return{scale:n,offset:a}}get nodes(){return this.document.getAllNodes().filter(e=>!e.hidden&&(e.flowNodeType===h.Sy.ROOT?void 0:!!this.options.enableDisplayAllNodes||!e.parent||e.parent.flowNodeType===h.Sy.ROOT||void 0))}nodeTransforms(e){return e.map(e=>e.getData(h.eG)).filter(Boolean)}renderRect(e){return l.Ae.enlarge(e)}viewRect(){let{width:e,height:t,scrollX:i,scrollY:r,zoom:n}=this.playgroundConfig.config;return new l.Ae(i/n,r/n,e/n,t/n)}mountListener(){let e=this.entityManager.onEntityChange(()=>this.render());this.toDispose.push(e)}rectOnCanvas(e){let{rect:t,scale:i,offset:r}=e;return new l.Ae((t.x+r.x)*i,(t.y+r.y)*i,t.width*i,t.height*i)}isPointInRect(e){let{point:t,rect:i}=e;return t.x>=i.x&&t.x<=i.x+i.width&&t.y>=i.y&&t.y<=i.y+i.height}addEventListeners(){this.canvas.addEventListener("wheel",this.handleWheel),this.canvas.addEventListener("mousedown",this.handleStartDrag),this.canvas.addEventListener("touchstart",this.handleStartDrag,{passive:!1}),this.canvas.addEventListener("mousemove",this.handleCursor)}removeEventListeners(){this.canvas.removeEventListener("wheel",this.handleWheel),this.canvas.removeEventListener("mousedown",this.handleStartDrag),this.canvas.removeEventListener("touchstart",this.handleStartDrag),this.canvas.removeEventListener("mousemove",this.handleCursor)}isMouseInCanvas(e){let t=this.canvas.getBoundingClientRect(),{clientX:i,clientY:r}=o.UJ.getEventCoord(e);return i>=t.left&&i<=t.right&&r>=t.top&&r<=t.bottom}updateScrollPosition(e,t){let{scrollX:i,scrollY:r,zoom:n}=this.playgroundConfig.config;this.playgroundConfig.updateConfig({scrollX:i+e*n,scrollY:r+t*n})}constructor(){this.onActive=e=>(this.onActiveCallbacks.add(e),{dispose:()=>{this.onActiveCallbacks.delete(e)}}),this.render=this._render,this.handleWheel=e=>{},this.handleStartDrag=e=>{o.UJ.preventDefault(e),e.stopPropagation();let{viewRect:t,scale:i,offset:r}=this.createRenderContext(),n=this.canvas.getBoundingClientRect(),{clientX:s,clientY:a}=o.UJ.getEventCoord(e),l={x:s-n.left,y:a-n.top},h=this.rectOnCanvas({rect:t,scale:i,offset:r});this.isPointInRect({point:l,rect:h})&&(this.isDragging=!0,this.dragStart=l,document.addEventListener("mousemove",this.handleDragging),document.addEventListener("mouseup",this.handleEndDrag),document.addEventListener("touchmove",this.handleDragging,{passive:!1}),document.addEventListener("touchend",this.handleEndDrag),document.addEventListener("touchcancel",this.handleEndDrag))},this.handleDragging=e=>{if(!this.isDragging||!this.dragStart)return;o.UJ.preventDefault(e),e.stopPropagation();let{scale:t}=this.createRenderContext(),i=this.canvas.getBoundingClientRect(),{clientX:r,clientY:n}=o.UJ.getEventCoord(e),s=r-i.left,a=n-i.top,l=(s-this.dragStart.x)/t,h=(a-this.dragStart.y)/t;this.updateScrollPosition(l,h),this.dragStart={x:s,y:a},this.render()},this.handleEndDrag=e=>{o.UJ.preventDefault(e),e.stopPropagation(),document.removeEventListener("mousemove",this.handleDragging),document.removeEventListener("mouseup",this.handleEndDrag),document.removeEventListener("touchmove",this.handleDragging),document.removeEventListener("touchend",this.handleEndDrag),document.removeEventListener("touchcancel",this.handleEndDrag),this.isDragging=!1,this.dragStart=void 0,this.setActivate(this.isMouseInCanvas(e))},this.handleCursor=e=>{if(!this.activated)return;let{viewRect:t,scale:i,offset:r}=this.createRenderContext(),n=this.canvas.getBoundingClientRect(),o={x:e.clientX-n.left,y:e.clientY-n.top},s=this.rectOnCanvas({rect:t,scale:i,offset:r});this.isPointInRect({point:o,rect:s})?this.canvas.style.cursor="grab":this.canvas.style.cursor="default"},this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.initialized=!!this.context2D,this.onActiveCallbacks=new Set,this.toDispose=new l.K4,this.render=this._render,this.activated=!1,this.isDragging=!1}};c([(0,a.f3)(h.pQ)],b.prototype,"document",2),c([(0,a.f3)(o.v2)],b.prototype,"entityManager",2),c([(0,a.f3)(o.ER)],b.prototype,"playgroundConfig",2),b=c([(0,a.b2)()],b);var D=class extends o.mh{render(){return this.options.disableLayer?n.createElement(n.Fragment,null):n.createElement(y,{service:this.service,panelStyles:this.options.panelStyles,containerStyles:this.options.containerStyles,inactiveStyle:this.options.inactiveStyle})}constructor(){super(),this.className="gedit-minimap-layer gedit-playground-layer",this.node=l.xF.createDivWithClass(this.className),this.node.style.zIndex="9999"}};D.type="FlowMinimapLayer",c([(0,a.f3)(b)],D.prototype,"service",2),D=c([(0,a.b2)()],D);var N=(0,o.M1)({onBind:e=>{let{bind:t}=e;t(b).toSelf().inSingletonScope()},onInit:(e,t)=>{e.playground.registerLayer(D,t),e.get(b).init(t)},onDispose:e=>{e.get(b).dispose()}})},324067:function(e,t,i){i.d(t,{Y:()=>n});var r=i(438024),n=(0,i(893740).M1)({onInit(e,t){!1!==t.enable&&(e.playground.registerLayer(r.aK,t),e.playground.registerLayer(r.Kz,{canSelect:t.canSelect}))}})},148168:function(e,t,i){i.d(t,{Kg:()=>d,cL:()=>p});var r,n=i(893740),o=i(461932),s=Object.defineProperty,a=Object.getOwnPropertyDescriptor,l=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?a(t,i):t,l=e.length-1;l>=0;l--)(n=e[l])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&s(t,i,o),o},h=Symbol("ShortcutsContribution"),d=class{addHandlers(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(e=>{this.commandRegistry.getCommand(e.commandId)?this.commandRegistry.registerHandler(e.commandId,{execute:e.execute,isEnabled:e.isEnabled}):this.commandRegistry.registerCommand({id:e.commandId,...e.commandDetail||{}},{execute:e.execute,isEnabled:e.isEnabled})}),this.shortcutsHandlers.unshift(...t)}addHandlersIfNotFound(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(e=>{this.has(e.commandId)||this.addHandlers(e)})}has(e){return this.shortcutsHandlers.some(t=>t.commandId===e)}init(){var e;null==(e=this.contribs)||e.forEach(e=>e.registerShortcuts(this))}constructor(){this.shortcutsHandlers=[]}};l([(0,o.f3)(n.Qc),(0,o.t6)(h),(0,o.jt)()],d.prototype,"contribs",2),l([(0,o.f3)(n.Ho)],d.prototype,"commandRegistry",2),l([(0,o.zY)()],d.prototype,"init",1),d=l([(0,o.b2)()],d);var u={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pausebreak:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftwindowkey:91,rightwindowkey:92,meta:/(mac|iphone|ipod|ipad)/i.test("undefined"!=typeof navigator?null==(r=navigator)?void 0:r.platform:"")?[91,93]:[91,92],selectkey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,"=":187,comma:188,dash:189,"-":189,period:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222},c={ctrl:e=>e.ctrlKey,shift:e=>e.shiftKey,alt:e=>e.altKey,meta:e=>"keyup"===e.type?u.meta.includes(e.keyCode):e.metaKey},g=class extends n.mh{onReady(){this.shortcuts.addHandlersIfNotFound({commandId:n.mY.Default.ZOOM_IN,shortcuts:["meta =","ctrl ="],execute:()=>{this.config.zoomin()}},{commandId:n.mY.Default.ZOOM_OUT,shortcuts:["meta -","ctrl -"],execute:()=>{this.config.zoomout()}}),this.toDispose.pushAll([this.listenPlaygroundEvent("keydown",e=>{this.isFocused&&e.target===this.playgroundNode&&this.shortcuts.shortcutsHandlers.some(t=>{if(t.shortcuts.some(t=>(function(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e.key||!t)return!1;let r=t.split(/\s+/),n=0;for(let t of r){let i=c[t],r=u[t.toLowerCase()];(i&&i(e)||r&&r===e.keyCode)&&n++}return i?n===r.length&&function(e){let t=Object.keys(c).reduce((t,i)=>c[i](e)?t+1:t,0);return[16,17,18,91,92].includes(e.keyCode)?t:t+1}(e)===r.length:n===r.length})(e,t))&&(!t.isEnabled||t.isEnabled(e)))return t.execute(e),e.preventDefault(),!0})})])}};g.type="ShortcutsLayer",l([(0,o.f3)(d)],g.prototype,"shortcuts",2),l([(0,o.f3)(n.z2)],g.prototype,"selection",2),g=l([(0,o.b2)()],g);var p=(0,n.M1)({onBind:e=>{let{bind:t}=e;t(d).toSelf().inSingletonScope(),(0,n.yb)(t,h)},onInit:e=>{e.playground.registerLayer(g)},contributionKeys:[h]})},319428:function(e,t,i){i.d(t,{$Y:()=>eS,$e:()=>ex,$s:()=>$,Gw:()=>s,Hx:()=>G,LF:()=>e_,OI:()=>ey,gJ:()=>eC,i2:()=>eD,qR:()=>a,qm:()=>eN,rV:()=>ew,sX:()=>eb});var r,n,o,s,a,l=i(461932),h=i(149674),d=i(832176),u=i(706493),c=i(666442),g=i(340823),p=i(26302),f=i(492320),y=i(499273),m=i(705999),E=i(314842),b=i(98029),D=i(366418),N=i(322972),C=i(433210),M=i(268479),S=i(923032),x=i(972453),w=i(207074),_=i(928365),I=i(51429),L=i(661195),T=i(582939),A=i(697497),O=i(908600),k=i(893740),R=Object.defineProperty,P=Object.getOwnPropertyDescriptor,j=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?P(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&R(t,i,o),o},z=(e,t)=>(i,r)=>t(i,r,e);function V(e){return d.JT.create(()=>e.unsubscribe())}var B=()=>{let e=new Map,t=(t,i)=>{if(e.has(t))return e.get(t);let r=i();return e.set(t,r),r};return t.clear=t=>{t?e.delete(t):e.clear()},t},F=class{onAnyVariableChange(e){return V(this.anyVariableChange$.subscribe(e))}onVariableListChange(e){return V(this.variables$.subscribe(e))}onListOrAnyVarChange(e){let t=new d.K4;return t.pushAll([this.onVariableListChange(e),this.onAnyVariableChange(e)]),t}fireChange(){var e;this.bumpVersion(),this.onDataChangeEmitter.fire(),this.variables$.next(this.variables),null==(e=this.parentTable)||e.fireChange()}get version(){return this._version}bumpVersion(){this._version=this._version+1,this._version===Number.MAX_SAFE_INTEGER&&(this._version=0)}get variables(){return Array.from(this.table.values())}get variableKeys(){return Array.from(this.table.keys())}getByKeyPath(e){let[t,...i]=e||[];if(!t)return;let r=this.getVariableByKey(t);return i.length?null==r?void 0:r.getByKeyPath(i):r}getVariableByKey(e){return this.table.get(e)}addVariableToTable(e){this.table.set(e.key,e),this.parentTable&&this.parentTable.addVariableToTable(e)}removeVariableFromTable(e){this.table.delete(e),this.parentTable&&this.parentTable.removeVariableFromTable(e)}dispose(){var e;this.variableKeys.forEach(e=>{var t;return null==(t=this.parentTable)?void 0:t.removeVariableFromTable(e)}),null==(e=this.parentTable)||e.fireChange(),this.variables$.complete(),this.variables$.unsubscribe(),this.toDispose.dispose()}constructor(e){this.parentTable=e,this.table=new Map,this.toDispose=new d.K4,this.onDataChangeEmitter=new d.Q5,this.variables$=new h.x,this.anyVariableChange$=this.variables$.pipe((0,u.w)(e=>(0,c.T)(...e.map(e=>e.value$.pipe((0,g.T)(1))))),(0,p.B)()),this.onDataChange=this.onDataChangeEmitter.event,this._version=0,this.toDispose.pushAll([this.onDataChangeEmitter,this.onAnyVariableChange(()=>{this.bumpVersion()})])}},Y=Symbol("DynamicVariableEngine"),U=Symbol("ContainerProvider"),$=class{get variableEngine(){return this.variableEngineProvider()}refreshAllChange(){this.variableEngine.getAllScopes().forEach(e=>{e.refreshCovers(),e.refreshDeps()})}dispose(){this.toDispose.dispose()}get disposed(){return this.toDispose.disposed}get onDispose(){return this.toDispose.onDispose}constructor(){this.toDispose=new d.K4}};j([(0,l.f3)(Y)],$.prototype,"variableEngineProvider",2),$=j([(0,l.b2)()],$);var G=((r=G||{}).String="String",r.Number="Number",r.Integer="Integer",r.Boolean="Boolean",r.Object="Object",r.Array="Array",r.Map="Map",r.Union="Union",r.Any="Any",r.CustomType="CustomType",r.Property="Property",r.VariableDeclaration="VariableDeclaration",r.VariableDeclarationList="VariableDeclarationList",r.KeyPathExpression="KeyPathExpression",r.EnumerateExpression="EnumerateExpression",r.WrapArrayExpression="WrapArrayExpression",r.ListNode="ListNode",r.DataNode="DataNode",r.MapNode="MapNode",r),Q=Symbol("post_construct_ast");function W(e){let{getChildNode:t,updateChildNode:i,removeChildNode:r,nextJSON:n}=e,o=t(),s=(null==o?void 0:o.kind)!==(null==n?void 0:n.kind),a=(null==n?void 0:n.key)&&(null==n?void 0:n.key)!==(null==o?void 0:o.key);if(s||a){if(o&&(o.dispose(),r()),n){let e=this.createChildNode(n);return i(e),this.fireChange(),e}this.fireChange()}else n&&(null==o||o.fromJSON(n));return o}function H(e){return"string"==typeof e?{kind:e}:e}(n=s||(s={})).isString=e=>(null==e?void 0:e.kind)==="String",n.isNumber=e=>(null==e?void 0:e.kind)==="Number",n.isBoolean=e=>(null==e?void 0:e.kind)==="Boolean",n.isInteger=e=>(null==e?void 0:e.kind)==="Integer",n.isObject=e=>(null==e?void 0:e.kind)==="Object",n.isArray=e=>(null==e?void 0:e.kind)==="Array",n.isMap=e=>(null==e?void 0:e.kind)==="Map",n.isCustomType=e=>(null==e?void 0:e.kind)==="CustomType",n.isVariableDeclaration=e=>(null==e?void 0:e.kind)==="VariableDeclaration",n.isProperty=e=>(null==e?void 0:e.kind)==="Property",n.isVariableDeclarationList=e=>(null==e?void 0:e.kind)==="VariableDeclarationList",n.isEnumerateExpression=e=>(null==e?void 0:e.kind)==="EnumerateExpression",n.isKeyPathExpression=e=>(null==e?void 0:e.kind)==="KeyPathExpression",n.is=function(e,t){return(null==e?void 0:e.kind)===(null==t?void 0:t.kind)};var X=class e{get kind(){if(!this.constructor.kind)throw Error(`ASTNode Registry need a kind: ${this.constructor.name}`);return this.constructor.kind}get children(){return Array.from(this._children)}toJSON(){return console.warn("[VariableEngine] Please Implement toJSON method for "+this.kind),{kind:this.kind}}createChildNode(e){let t=this.scope.variableEngine.astRegisters.createAST(e,{parent:this,scope:this.scope});return this._children.add(t),t.toDispose.push(d.JT.create(()=>{this._children.delete(t)})),t}updateChildNodeByKey(e,t){this.withBatchUpdate(W).call(this,{getChildNode:()=>this[e],updateChildNode:t=>this[e]=t,removeChildNode:()=>this[e]=void 0,nextJSON:t})}withBatchUpdate(e){var t=this;return function(){for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];if(t._batch.batching)return e.call(t,...r);t._batch.hasChangesInBatch=!1,t._batch.batching=!0;let o=e.call(t,...r);return t._batch.batching=!1,t._batch.hasChangesInBatch&&t.fireChange(),t._batch.hasChangesInBatch=!1,o}}fireChange(){var e;if(!this.changeLocked&&!this.disposed){if(this._batch.batching){this._batch.hasChangesInBatch=!0;return}this._version++,this.value$.next(this),this.dispatchGlobalEvent({type:"UpdateAST"}),null==(e=this.parent)||e.fireChange()}}get version(){return this._version}get hash(){return`${this._version}${this.kind}${this.key}`}subscribe(t){let{selector:i,debounceAnimation:r,triggerOnInit:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return V(this.value$.pipe((0,y.U)(()=>i?i(this):this),(0,m.x)((e,t)=>(0,M.shallowEqual)(e,t),t=>t instanceof e?t.hash:t),n?(0,E.b)(()=>null):(0,g.T)(1),r?(0,b.b)(0,D.Z):(0,E.b)(()=>null)).subscribe(t))}dispatchGlobalEvent(e){this.scope.event.dispatch({...e,ast:this})}dispose(){this.toDispose.disposed||(this.toDispose.dispose(),this.dispatchGlobalEvent({type:"DisposeAST"}),this.value$.complete(),this.value$.unsubscribe())}get disposed(){return this.toDispose.disposed}constructor({key:e,parent:t,scope:i},r){this.flags=0,this._version=0,this.changeLocked=!1,this._batch={batching:!1,hasChangesInBatch:!1},this.value$=new N.X(this),this._children=new Set,this.toDispose=new d.K4(d.JT.create(()=>{var e;null==(e=this.parent)||e.fireChange(),this.children.forEach(e=>e.dispose())})),this.onDispose=this.toDispose.onDispose,this.scope=i,this.parent=t,this.opts=r,this.key=e||(0,C.x0)(),this.fromJSON=this.withBatchUpdate(this.fromJSON.bind(this))}},J=class extends X{isTypeEqual(e){let t=H(e);if((null==t?void 0:t.kind)==="Union"){var i;return null==(i=(null==t?void 0:t.types)||[])?void 0:i.some(e=>this.isTypeEqual(e))}return this.kind===(null==t?void 0:t.kind)}getByKeyPath(){throw arguments.length>0&&void 0!==arguments[0]&&arguments[0],Error(`Get By Key Path is not implemented for Type: ${this.kind}`)}toJSON(){return{kind:this.kind}}constructor(){super(...arguments),this.flags=8}},Z=class extends J{fromJSON(e){let{items:t}=e;this.updateChildNodeByKey("items",H(t))}get canDrilldownItems(){var e;return!!((null==(e=this.items)?void 0:e.flags)&16)}getByKeyPath(e){let[t,...i]=e||[];if("0"===t&&this.canDrilldownItems)return this.items.getByKeyPath(i)}isTypeEqual(e){let t=H(e),i=super.isTypeEqual(e);return(null==t?void 0:t.weak)||(null==t?void 0:t.kind)==="Union"?i:t&&i&&((null==t?void 0:t.weak)||this.customStrongEqual(t))}customStrongEqual(e){var t;return this.items?null==(t=this.items)?void 0:t.isTypeEqual(e.items):!(null==e?void 0:e.items)}toJSON(){var e;return{kind:"Array",items:null==(e=this.items)?void 0:e.toJSON()}}constructor(){super(...arguments),this.flags=48}};Z.kind="Array";var K=class extends J{fromJSON(){}constructor(){super(...arguments),this.flags=8}};K.kind="String";var q=class extends J{fromJSON(){}constructor(){super(...arguments),this.flags=8}};q.kind="Integer";var ee=class extends J{fromJSON(){}};ee.kind="Boolean";var et=class extends J{fromJSON(){}};et.kind="Number";var ei=class extends J{fromJSON(e){let{keyType:t="String",valueType:i}=e;this.updateChildNodeByKey("keyType",H(t)),this.updateChildNodeByKey("valueType",H(i))}isTypeEqual(e){let t=H(e),i=super.isTypeEqual(e);return(null==t?void 0:t.weak)||(null==t?void 0:t.kind)==="Union"?i:t&&i&&((null==t?void 0:t.weak)||this.customStrongEqual(t))}customStrongEqual(e){var t,i;let{keyType:r="String",valueType:n}=e;return(!n&&!this.valueType||(null==(t=this.valueType)?void 0:t.isTypeEqual(n)))&&(null==(i=this.keyType)?void 0:i.isTypeEqual(r))}toJSON(){var e,t;return{kind:"Map",keyType:null==(e=this.keyType)?void 0:e.toJSON(),valueType:null==(t=this.valueType)?void 0:t.toJSON()}}};ei.kind="Map";var er=class extends J{fromJSON(e){let{properties:t}=e,i=new Set(this.propertyTable.keys()),r=[...this.properties||[]];this.properties=(t||[]).map(e=>{let t=this.propertyTable.get(e.key);if(i.delete(e.key),t)return t.fromJSON(e),t;{let t=this.createChildNode({...e,kind:"Property"});return this.fireChange(),this.propertyTable.set(e.key,t),t}}),i.forEach(e=>{let t=this.propertyTable.get(e);null==t||t.dispose(),this.propertyTable.delete(e),this.fireChange()}),this.dispatchGlobalEvent({type:"ObjectPropertiesChange",payload:{prev:r,next:[...this.properties]}})}toJSON(){return{kind:"Object",properties:this.properties.map(e=>e.toJSON())}}getByKeyPath(e){var t;let[i,...r]=e,n=this.propertyTable.get(i);return r.length?(null==n?void 0:n.type)&&(null==n||null==(t=n.type)?void 0:t.flags)&16?n.type.getByKeyPath(r):void 0:n}isTypeEqual(e){let t=H(e),i=super.isTypeEqual(e);return(null==t?void 0:t.weak)||(null==t?void 0:t.kind)==="Union"?i:t&&i&&((null==t?void 0:t.weak)||this.customStrongEqual(t))}customStrongEqual(e){let t=e.properties||[],i=Array.from(this.propertyTable.keys()),r=t.map(e=>e.key);return!(0,S.Z)(i,r).length&&t.every(e=>{var t;let i=this.propertyTable.get(e.key);return i&&i.key===e.key&&(null==(t=i.type)?void 0:t.isTypeEqual(null==e?void 0:e.type))})}constructor(){super(...arguments),this.flags=16,this.propertyTable=new Map}};er.kind="Object";var en=class extends J{get typeName(){return this._typeName}fromJSON(e){this._typeName!==e.typeName&&(this._typeName=e.typeName,this.fireChange())}isTypeEqual(e){let t=H(e);if((null==t?void 0:t.kind)==="Union"){var i;return null==(i=(null==t?void 0:t.types)||[])?void 0:i.some(e=>this.isTypeEqual(e))}return(null==t?void 0:t.kind)===this.kind&&(null==t?void 0:t.typeName)===this.typeName}};function eo(e){let t=e.parent,i=[];for(;t;)1&t.flags&&i.push(t),t=t.parent;return i}en.kind="CustomType";var es=class extends X{get globalVariableTable(){return this.scope.variableEngine.globalVariableTable}get parentFields(){return eo(this)}get refs(){return this._refs}refreshRefs(){this.refreshRefs$.next()}constructor(e,t){super(e,t),this.flags=4,this._refs=[],this.refreshRefs$=new h.x,this.refs$=this.refreshRefs$.pipe((0,y.U)(()=>this.getRefFields()),(0,m.x)(M.shallowEqual),(0,u.w)(e=>(null==e?void 0:e.length)?(0,w.a)(e.map(e=>e?e.value$:(0,x.of)(void 0))):(0,x.of)([])),(0,p.B)()),this.toDispose.push(V(this.refs$.subscribe(e=>{this._refs=e,this.fireChange()})))}};var ea=class extends es{get enumerateFor(){return this._enumerateFor}get returnType(){var e;let t=null==(e=this.enumerateFor)?void 0:e.returnType;if((null==t?void 0:t.kind)==="Array")return t.items}getRefFields(){return[]}fromJSON(e){let{enumerateFor:t}=e;this.updateChildNodeByKey("_enumerateFor",t)}toJSON(){var e;return{kind:"EnumerateExpression",enumerateFor:null==(e=this.enumerateFor)?void 0:e.toJSON()}}};ea.kind="EnumerateExpression";var el=class extends es{get keyPath(){return this._keyPath}getRefFields(){let e=this.scope.available.getByKeyPath(this._keyPath);return!function(e,t){if(0===(0,_.Z)(e.scope.coverScopes,t.map(e=>null==e?void 0:e.scope).filter(Boolean)).length)return!1;let i=new Set,r=[...t];for(;r.length;){let e=r.shift();for(let t of(i.add(e),(function e(t){return[...t.children,...t.children.map(t=>e(t)).flat()]})(e).filter(e=>4&e.flags).map(e=>e.refs).flat().filter(Boolean).filter(e=>!i.has(e))))r.push(t)}return(0,_.Z)(Array.from(i),eo(e)).length>0}(this,[e])?e?[e]:[]:(console.warn("[CustomKeyPathExpression] checkRefCycle: Reference Cycle Existed",this.parentFields.map(e=>e.key).reverse()),[])}get returnType(){return this._returnType}parseToKeyPath(e){return e.keyPath}fromJSON(e){let t=this.parseToKeyPath(e);(0,M.shallowEqual)(t,this._keyPath)||(this._keyPath=t,this.refreshRefs())}getReturnTypeJSONByRef(e){var t;return null==e||null==(t=e.type)?void 0:t.toJSON()}toJSON(){return{kind:"KeyPathExpression",keyPath:this._keyPath}}constructor(e,t){super(e,t),this._keyPath=[],this.toDispose.pushAll([this.scope.available.onVariableListChange(()=>{this.refreshRefs()}),this.scope.available.onAnyVariableChange(e=>{e.key===this._keyPath[0]&&this.refreshRefs()}),V(this.refs$.subscribe(e=>{var t,i;let[r]=this._refs;this.prevRefTypeHash!==(null==r||null==(t=r.type)?void 0:t.hash)&&(this.prevRefTypeHash=null==r||null==(i=r.type)?void 0:i.hash,this.updateChildNodeByKey("_returnType",this.getReturnTypeJSONByRef(r)))}))])}};el.kind="KeyPathExpression";var eh=class extends es{get wrapFor(){return this._wrapFor}get returnType(){return this._returnType}refreshReturnType(){var e,t;let i=null==(t=this.wrapFor)||null==(e=t.returnType)?void 0:e.toJSON();this.updateChildNodeByKey("_returnType",{kind:"Array",items:i})}getRefFields(){return[]}fromJSON(e){let{wrapFor:t}=e;this.updateChildNodeByKey("_wrapFor",t)}toJSON(){var e;return{kind:"WrapArrayExpression",wrapFor:null==(e=this.wrapFor)?void 0:e.toJSON()}}init(){this.refreshReturnType=this.refreshReturnType.bind(this),this.toDispose.push(this.subscribe(this.refreshReturnType,{selector:e=>{var t;return null==(t=e.wrapFor)?void 0:t.returnType},triggerOnInit:!0}))}};eh.kind="WrapArrayExpression",j([(e,t)=>{if(Reflect.hasMetadata(Q,e))throw Error("Duplication Post Construct AST");Reflect.defineMetadata(Q,t,e)}],eh.prototype,"init",1);var ed=class extends X{get parentFields(){return eo(this)}get keyPath(){return[...this.parentFields.reverse().map(e=>e.key),this.key]}get meta(){return this._meta}get type(){var e;return(null==(e=this._initializer)?void 0:e.returnType)||this._type}get initializer(){return this._initializer}get hash(){return`[${this._version}]${this.keyPath.join(".")}`}fromJSON(e){let{type:t,initializer:i,meta:r}=e;this.updateType(t),this.updateInitializer(i),this.updateMeta(r)}updateType(e){this.updateChildNodeByKey("_type","string"==typeof e?{kind:e}:e)}updateInitializer(e){this.updateChildNodeByKey("_initializer",e)}updateMeta(e){(0,M.shallowEqual)(e,this._meta)||(this._meta=e,this.fireChange())}getByKeyPath(e){var t;if((null==(t=this.type)?void 0:t.flags)&16)return this.type.getByKeyPath(e)}onTypeChange(e){return this.subscribe(e,{selector:e=>e.type})}toJSON(){var e,t;return{kind:this.kind,key:this.key,type:null==(e=this.type)?void 0:e.toJSON(),initializer:null==(t=this.initializer)?void 0:t.toJSON(),meta:this._meta}}constructor(){super(...arguments),this.flags=1,this._meta={}}},eu=class extends ed{get order(){return this._order}fromJSON(e){let{order:t,...i}=e;this.updateOrder(t),super.fromJSON(i)}updateOrder(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e!==this._order&&(this._order=e,this.dispatchGlobalEvent({type:"ReSortVariableDeclarations"}),this.fireChange())}onTypeChange(e){return this.subscribe(e,{selector:e=>e.type})}constructor(e){super(e),this._order=0}};eu.kind="VariableDeclaration";var ec=class extends X{fromJSON(e){let{declarations:t,startOrder:i}=e,r=new Set(this.declarationTable.keys()),n=[...this.declarations||[]];this.declarations=(t||[]).map((e,t)=>{var n,o;let s=(i||0)+t,a=e.key||(null==(o=this.declarations)||null==(n=o[t])?void 0:n.key),l=this.declarationTable.get(a);if(a&&r.delete(a),l)return l.fromJSON({order:s,...e}),l;{let t=this.createChildNode({order:s,...e,kind:"VariableDeclaration"});return this.fireChange(),this.declarationTable.set(t.key,t),t}}),r.forEach(e=>{let t=this.declarationTable.get(e);null==t||t.dispose(),this.declarationTable.delete(e)}),this.dispatchGlobalEvent({type:"VariableListChange",payload:{prev:n,next:[...this.declarations]}})}toJSON(){return{kind:"VariableDeclarationList",properties:this.declarations.map(e=>e.toJSON())}}constructor(){super(...arguments),this.declarationTable=new Map}};ec.kind="VariableDeclarationList";var eg=class extends ed{};eg.kind="Property";var ep=class extends X{get data(){return this._data}fromJSON(e){let{kind:t,...i}=e;(0,M.shallowEqual)(i,this._data)||(this._data=i,this.fireChange())}toJSON(){return{kind:"DataNode",...this._data}}partialUpdate(e){(0,M.shallowEqual)(e,this._data)||(this._data={...this._data,...e},this.fireChange())}};ep.kind="DataNode";var ef=class extends X{fromJSON(e){let{map:t}=e,i=new Set(this.map.keys());for(let[e,r]of t||[])i.delete(e),this.set(e,r);for(let e of Array.from(i))this.remove(e)}toJSON(){return{kind:"MapNode",map:Array.from(this.map.entries())}}set(e,t){return this.withBatchUpdate(W).call(this,{getChildNode:()=>this.get(e),removeChildNode:()=>this.map.delete(e),updateChildNode:t=>this.map.set(e,t),nextJSON:t})}remove(e){var t;null==(t=this.get(e))||t.dispose(),this.map.delete(e),this.fireChange()}get(e){return this.map.get(e)}constructor(){super(...arguments),this.map=new Map}};ef.kind="MapNode";var ey=class{createAST(e,t){let{parent:i,scope:r}=t,n=this.astMap.get(e.kind);if(!n)throw Error(`ASTKind: ${String(e.kind)} can not find its ASTNode Registry`);let o=this.injectors.get(e.kind),s=new n({key:e.key,scope:r,parent:i},(null==o?void 0:o())||{});if(s.changeLocked=!0,s.fromJSON((0,f.Z)(e,["key","kind"])),s.changeLocked=!1,s.dispatchGlobalEvent({type:"NewAST"}),Reflect.hasMetadata(Q,s)){var a;let e=Reflect.getMetadata(Q,s);null==(a=s[e])||a.call(s)}return s}getASTRegistryByKind(e){return this.astMap.get(e)}registerAST(e,t){this.astMap.set(e.kind,e),t&&this.injectors.set(e.kind,t)}constructor(){this.injectors=new Map,this.astMap=new Map,this.registerAST(K),this.registerAST(et),this.registerAST(ee),this.registerAST(q),this.registerAST(er),this.registerAST(Z),this.registerAST(ei),this.registerAST(en),this.registerAST(eg),this.registerAST(eu),this.registerAST(ec),this.registerAST(el),this.registerAST(ea),this.registerAST(eh),this.registerAST(ef),this.registerAST(ep)}};ey=j([(0,l.b2)()],ey),(o=a||(a={})).createString=()=>({kind:"String"}),o.createNumber=()=>({kind:"Number"}),o.createBoolean=()=>({kind:"Boolean"}),o.createInteger=()=>({kind:"Integer"}),o.createObject=e=>({kind:"Object",...e}),o.createArray=e=>({kind:"Array",...e}),o.createMap=e=>({kind:"Map",...e}),o.createUnion=e=>({kind:"Union",...e}),o.createCustomType=e=>({kind:"CustomType",...e}),o.createVariableDeclaration=e=>({kind:"VariableDeclaration",...e}),o.createProperty=e=>({kind:"Property",...e}),o.createVariableDeclarationList=e=>({kind:"VariableDeclarationList",...e}),o.createEnumerateExpression=e=>({kind:"EnumerateExpression",...e}),o.createKeyPathExpression=e=>({kind:"KeyPathExpression",...e}),o.createWrapArrayExpression=e=>({kind:"WrapArrayExpression",...e}),o.create=(e,t)=>({kind:e.kind,...t});var em=class{get variableEngine(){return this.scope.variableEngine}get globalVariableTable(){return this.scope.variableEngine.globalVariableTable}get version(){return this.variableTable.version}get onDataChange(){return this.variableTable.onDataChange.bind(this.variableTable)}get onVariableListChange(){return this.variableTable.onVariableListChange.bind(this.variableTable)}get onAnyVariableChange(){return this.variableTable.onAnyVariableChange.bind(this.variableTable)}get onListOrAnyVarChange(){return this.variableTable.onListOrAnyVarChange.bind(this.variableTable)}get variables(){return this.memo("variables",()=>this.variableTable.variables.sort((e,t)=>e.order-t.order))}get variableKeys(){return this.memo("variableKeys",()=>this.variableTable.variableKeys)}addVariableToTable(e){if(e.scope!==this.scope)throw Error("VariableDeclaration must be a ast node in scope");this.variableTable.addVariableToTable(e),this._hasChanges=!0}removeVariableFromTable(e){this.variableTable.removeVariableFromTable(e),this._hasChanges=!0}getVariableByKey(e){return this.variableTable.getVariableByKey(e)}notifyCoversChange(){this.scope.coverScopes.forEach(e=>e.available.refresh())}constructor(e){this.scope=e,this.memo=B(),this._hasChanges=!1,this.variableTable=new F(e.variableEngine.globalVariableTable),this.scope.toDispose.pushAll([this.scope.ast.subscribe(()=>{this._hasChanges&&(this.memo.clear(),this.notifyCoversChange(),this.variableTable.fireChange(),this._hasChanges=!1)}),this.scope.event.on("DisposeAST",e=>{var t;(null==(t=e.ast)?void 0:t.kind)==="VariableDeclaration"&&this.removeVariableFromTable(e.ast.key)}),this.scope.event.on("NewAST",e=>{var t;(null==(t=e.ast)?void 0:t.kind)==="VariableDeclaration"&&this.addVariableToTable(e.ast)}),this.scope.event.on("ReSortVariableDeclarations",()=>{this._hasChanges=!0}),this.variableTable])}},ev=class{get globalVariableTable(){return this.scope.variableEngine.globalVariableTable}get version(){return this._version}bumpVersion(){this._version=this._version+1,this._version===Number.MAX_SAFE_INTEGER&&(this._version=0)}refresh(){this.scope.disposed||this.refresh$.next()}onAnyVariableChange(e){return V(this.anyVariableChange$.subscribe(e))}onVariableListChange(e){return V(this.variables$.subscribe(e))}get variables(){return this._variables}get variableKeys(){return this.memo("availableKeys",()=>this._variables.map(e=>e.key))}get depScopes(){return this.scope.depScopes}getByKeyPath(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.variableKeys.includes(e[0]))return this.globalVariableTable.getByKeyPath(e)}trackByKeyPath(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,{triggerOnInit:r=!0,debounceAnimation:n,selector:o}=i||{};return V((0,c.T)(this.anyVariableChange$,this.variables$).pipe(r?(0,I.O)():(0,E.b)(()=>null),(0,y.U)(()=>{let t=this.getByKeyPath(e);return o?o(t):t}),(0,m.x)((e,t)=>(0,M.shallowEqual)(e,t),e=>e instanceof X?e.hash:e),n?(0,b.b)(0,D.Z):(0,E.b)(()=>null)).subscribe(t))}constructor(e){this.scope=e,this.memo=B(),this._version=0,this.refresh$=new h.x,this._variables=[],this.variables$=this.refresh$.pipe((0,y.U)(()=>(0,L.Z)(this.depScopes.map(e=>e.output.variables||[]))),(0,m.x)(M.shallowEqual),(0,p.B)()),this.anyVariableChange$=this.variables$.pipe((0,u.w)(e=>(0,c.T)(...e.map(e=>e.value$.pipe((0,g.T)(1))))),(0,p.B)()),this.onDataChangeEmitter=new d.Q5,this.onListOrAnyVarChangeEmitter=new d.Q5,this.onDataChange=this.onDataChangeEmitter.event,this.onListOrAnyVarChange=this.onListOrAnyVarChangeEmitter.event,this.scope.toDispose.pushAll([this.onVariableListChange(e=>{this._variables=e,this.memo.clear(),this.onDataChangeEmitter.fire(this._variables),this.bumpVersion(),this.onListOrAnyVarChangeEmitter.fire(this._variables)}),this.onAnyVariableChange(()=>{this.onDataChangeEmitter.fire(this._variables),this.bumpVersion(),this.onListOrAnyVarChangeEmitter.fire(this._variables)}),d.JT.create(()=>{this.refresh$.complete(),this.refresh$.unsubscribe()})])}},eE=class{dispatch(e){this.scope.disposed||this.event$.next(e)}subscribe(e){return V(this.event$.subscribe(e))}on(e,t){return V(this.event$.pipe((0,T.h)(t=>t.type===e)).subscribe(t))}constructor(e){this.scope=e,this.event$=new h.x,e.toDispose.pushAll([this.subscribe(t=>{e.variableEngine.fireGlobalEvent(t)})])}},eb=class{refreshCovers(){this.memo.clear("covers")}refreshDeps(){this.memo.clear("deps"),this.available.refresh()}get depScopes(){return this.memo("deps",()=>this.variableEngine.chain.getDeps(this).filter(e=>!!e&&!(null==e?void 0:e.disposed)))}get coverScopes(){return this.memo("covers",()=>this.variableEngine.chain.getCovers(this).filter(e=>!!e&&!(null==e?void 0:e.disposed)))}dispose(){this.ast.dispose(),this.toDispose.dispose(),this.coverScopes.forEach(e=>e.refreshDeps()),this.depScopes.forEach(e=>e.refreshCovers())}get disposed(){return this.toDispose.disposed}setVar(e,t){if("string"==typeof e&&void 0!==t)return this.ast.set(e,t);if("object"==typeof e&&void 0===t)return this.ast.set("outputs",e);throw Error("Invalid arguments")}getVar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"outputs";return this.ast.get(e)}clearVar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"outputs";return this.ast.remove(e)}constructor(e){this.memo=B(),this.toDispose=new d.K4,this.onDispose=this.toDispose.onDispose,this.id=e.id,this.meta=e.meta||{},this.variableEngine=e.variableEngine,this.event=new eE(this),this.ast=this.variableEngine.astRegisters.createAST({kind:"MapNode",key:String(this.id)},{scope:this}),this.output=new em(this),this.available=new ev(this)}},eD=class{get container(){return this.containerProvider()}dispose(){this.toDispose.dispose()}getScopeById(e){return this.scopeMap.get(e)}removeScopeById(e){var t;null==(t=this.getScopeById(e))||t.dispose()}createScope(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{ScopeConstructor:r=eb}=i,n=this.getScopeById(e);return n||(n=new r({variableEngine:this,meta:t,id:e}),this.scopeMap.set(e,n),this.onScopeChangeEmitter.fire({type:"add",scope:n}),n.toDispose.pushAll([n.ast.subscribe(()=>{this.onScopeChangeEmitter.fire({type:"update",scope:n})}),n.available.onDataChange(()=>{this.onScopeChangeEmitter.fire({type:"available",scope:n})})]),n.onDispose(()=>{this.scopeMap.delete(e),this.onScopeChangeEmitter.fire({type:"delete",scope:n})})),n}getAllScopes(){let{sort:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Array.from(this.scopeMap.values());if(e){let e=this.chain.sortAll(),i=new Set(t);return e.forEach(e=>i.delete(e)),[...e,...Array.from(i)]}return[...t]}fireGlobalEvent(e){this.globalEvent$.next(e)}onGlobalEvent(e,t){return V(this.globalEvent$.subscribe(i=>{i.type===e&&t(i)}))}constructor(e,t){this.chain=e,this.astRegisters=t,this.toDispose=new d.K4,this.memo=B(),this.scopeMap=new Map,this.globalEvent$=new h.x,this.onScopeChangeEmitter=new d.Q5,this.globalVariableTable=new F,this.onScopeChange=this.onScopeChangeEmitter.event,this.toDispose.pushAll([e,d.JT.create(()=>{this.getAllScopes().forEach(e=>e.dispose()),this.globalVariableTable.dispose()})])}};j([(0,l.f3)(U)],eD.prototype,"containerProvider",2),j([(0,l.Pj)()],eD.prototype,"dispose",1),eD=j([(0,l.b2)(),z(0,(0,l.f3)($)),z(1,(0,l.f3)(ey))],eD);var eN=class{handleFieldListChange(e,t,i){if(!e||!(null==t?void 0:t.length)||!(null==i?void 0:i.length)||t.length!==i.length)return void this.notifyFieldsDispose(t,i);let r=null,n=!1;for(let[e,a]of t.entries()){let l=i[e];if(a.key!==l.key){var o,s;if(n)return void this.notifyFieldsDispose(t,i);n=!0,(null==(o=a.type)?void 0:o.kind)===(null==(s=l.type)?void 0:s.kind)&&(r={before:a,after:l})}}if(!r)return void this.notifyFieldsDispose(t,i);this.renameEmitter.fire(r)}notifyFieldsDispose(e,t){(0,A.Z)(e||[],t||[]).forEach(e=>this.disposeInListEmitter.fire(e))}init(){this.toDispose.pushAll([this.variableEngine.onGlobalEvent("VariableListChange",e=>{var t,i;this.handleFieldListChange(e.ast,null==(t=e.payload)?void 0:t.prev,null==(i=e.payload)?void 0:i.next)}),this.variableEngine.onGlobalEvent("ObjectPropertiesChange",e=>{var t,i;this.handleFieldListChange(e.ast,null==(t=e.payload)?void 0:t.prev,null==(i=e.payload)?void 0:i.next)})])}dispose(){this.toDispose.dispose()}constructor(){this.toDispose=new d.K4,this.renameEmitter=new d.Q5,this.disposeInListEmitter=new d.Q5,this.onRename=this.renameEmitter.event,this.onDisposeInList=this.disposeInListEmitter.event}};j([(0,l.f3)(eD)],eN.prototype,"variableEngine",2),j([(0,l.zY)()],eN.prototype,"init",1),j([(0,l.Pj)()],eN.prototype,"dispose",1),eN=j([(0,l.b2)()],eN);var eC=new l.nZ(e=>{e(eD).toSelf().inSingletonScope(),e(ey).toSelf().inSingletonScope(),e(eN).toSelf().inSingletonScope(),e(Y).toDynamicValue(e=>()=>e.container.get(eD)),e(U).toDynamicValue(e=>()=>e.container)}),eM=(0,O.createContext)(null),eS=eM.Provider,ex=()=>{var e;return null==(e=(0,O.useContext)(eM))?void 0:e.scope};function ew(){let e=ex(),t=(0,k.JA)();return(0,O.useEffect)(()=>{let i=e.available.onDataChange(()=>{t()});return()=>i.dispose()},[]),e.available}function e_(){let e=ex(),t=(0,k.G2)(eD),i=(0,k.JA)();return(0,O.useEffect)(()=>{if(!e){let e=t.globalVariableTable.onListOrAnyVarChange(()=>{i()});return()=>e.dispose()}let r=e.available.onDataChange(()=>{i()});return()=>r.dispose()},[]),e?e.available.variables:t.globalVariableTable.variables}}}]);