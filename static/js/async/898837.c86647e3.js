"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["898837"],{309119:function(e,r,s){s.r(r),s.d(r,{default:()=>t});var n=s(110239),i=s(437562),a=s(944529),l=s(262343);function o(e){let r={a:"a",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.h1,{id:"disabledeclarationplugin",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#disabledeclarationplugin",children:"#"}),"DisableDeclarationPlugin"]}),"\n",(0,n.jsxs)(r.div,{className:"rspress-directive note",children:[(0,n.jsx)(r.div,{className:"rspress-directive-title",children:"NOTE"}),(0,n.jsxs)(r.div,{className:"rspress-directive-content",children:[(0,n.jsxs)(r.p,{children:["在物料库的设计中，",(0,n.jsx)(r.strong,{children:"“节点本身”作为一种变量声明，是可选的"}),"。"]}),(0,n.jsxs)(r.p,{children:["物料库中 ",(0,n.jsx)(r.a,{href:"/materials/components/variable-selector.html",children:(0,n.jsx)(r.code,{children:"VariableSelector"})}),", ",(0,n.jsx)(r.a,{href:"/materials/components/prompt-editor-with-variables.html",children:(0,n.jsx)(r.code,{children:"PromptEditorWithVariables"})}),", ",(0,n.jsx)(r.a,{href:"/materials/components/sql-editor-with-variables.html",children:(0,n.jsx)(r.code,{children:"SQLEditorWithVariables"})})," 等组件，都默认支持选择 ",(0,n.jsx)(r.strong,{children:"“节点变量”"}),"。"]})]})]}),"\n",(0,n.jsxs)(r.p,{children:["DisableDeclarationPlugin 可以",(0,n.jsx)(r.strong,{children:"禁用变量声明的可选性（只能选下钻）"}),"，从而使“节点变量”不可选。"]}),"\n",(0,n.jsxs)(r.h2,{id:"案例演示",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#案例演示",children:"#"}),"案例演示"]}),"\n",(0,n.jsxs)(r.h3,{id:"基本使用",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#基本使用",children:"#"}),"基本使用"]}),"\n",(0,n.jsx)(l.w,{}),"\n",(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",title:"use-editor-props.tsx",children:(0,n.jsxs)(r.code,{className:"language-tsx",children:[(0,n.jsxs)(r.span,{className:"line",children:[(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:" { createDisableDeclarationPlugin } "}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-string-expression)"},children:" '@flowgram.ai/form-materials'"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,n.jsx)(r.span,{className:"line"}),"\n",(0,n.jsx)(r.span,{className:"line",children:(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})}),"\n",(0,n.jsx)(r.span,{className:"line",children:(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:"{"})}),"\n",(0,n.jsxs)(r.span,{className:"line",children:[(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:"  plugins"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:" ["}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"createDisableDeclarationPlugin"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:"()]"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsx)(r.span,{className:"line",children:(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:"}"})}),"\n",(0,n.jsx)(r.span,{className:"line",children:(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})})]})})}),"\n",(0,n.jsxs)(r.h2,{id:"api",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#api",children:"#"}),"API"]}),"\n",(0,n.jsxs)(r.h3,{id:"createdisabledeclarationplugin",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#createdisabledeclarationplugin",children:"#"}),"createDisableDeclarationPlugin"]}),"\n",(0,n.jsx)(r.p,{children:"用于创建禁用变量声明的插件。该插件会拦截变量引擎的事件，将所有变量声明标记为禁用状态。"}),"\n",(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,n.jsx)(r.code,{className:"language-ts",children:(0,n.jsxs)(r.span,{className:"line",children:[(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:" const"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:" createDisableDeclarationPlugin"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:" definePluginCreator"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:"<"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"void"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:">({"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"..."}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-foreground)"},children:"});"})]})})})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"参数"}),"：无"]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"返回值"}),"：一个插件实例，可直接添加到 Editor 的插件列表中。"]}),"\n",(0,n.jsxs)(r.h2,{id:"源码导读",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#源码导读",children:"#"}),"源码导读"]}),"\n",(0,n.jsx)(a.ZB,{href:"https://github.com/bytedance/flowgram.ai/blob/main/packages/materials/form-materials/src/plugins/disable-declaration-plugin/create-disable-declaration-plugin.ts"}),"\n",(0,n.jsx)(r.p,{children:"使用 CLI 命令可以复制源代码到本地："}),"\n",(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,n.jsx)(r.code,{className:"language-bash",children:(0,n.jsxs)(r.span,{className:"line",children:[(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"npx"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-string)"},children:" @flowgram.ai/cli@latest"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-string)"},children:" materials"}),(0,n.jsx)(r.span,{style:{color:"var(--shiki-token-string)"},children:" plugins/disable-declaration-plugin"})]})})})}),"\n",(0,n.jsxs)(r.h3,{id:"目录结构讲解",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#目录结构讲解",children:"#"}),"目录结构讲解"]}),"\n",(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.pre,{className:"shiki css-variables has-highlighted",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",children:(0,n.jsxs)(r.code,{className:"language-plaintext",children:[(0,n.jsx)(r.span,{className:"line",children:(0,n.jsx)(r.span,{children:"packages/materials/form-materials/src/plugins/disable-declaration-plugin/"})}),"\n",(0,n.jsx)(r.span,{className:"line",children:(0,n.jsx)(r.span,{children:"└── create-disable-declaration-plugin.ts  # 插件的主要实现文件"})})]})})}),"\n",(0,n.jsxs)(r.h3,{id:"核心实现说明",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#核心实现说明",children:"#"}),"核心实现说明"]}),"\n",(0,n.jsx)(r.p,{children:"DisableDeclarationPlugin 的核心实现非常简洁，主要包含以下步骤："}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"初始化插件"}),"：通过 ",(0,n.jsx)(r.code,{children:"definePluginCreator"})," 创建插件，并在 ",(0,n.jsx)(r.code,{children:"onInit"})," 钩子中获取变量引擎实例"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"事件监听"}),"：监听变量引擎的 ",(0,n.jsx)(r.code,{children:"NewAST"})," 和 ",(0,n.jsx)(r.code,{children:"UpdateAST"})," 事件"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"处理逻辑"}),"：当检测到变量声明类型 (",(0,n.jsx)(r.code,{children:"VariableDeclaration"}),") 的 AST 节点时，将其 ",(0,n.jsx)(r.code,{children:"meta.disabled"})," 属性设置为 ",(0,n.jsx)(r.code,{children:"true"})]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"这种实现方式确保了所有新创建或更新的变量声明都会被自动禁用，从而在变量选择器等组件中不可选。"}),"\n",(0,n.jsxs)(r.h3,{id:"依赖梳理",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#依赖梳理",children:"#"}),"依赖梳理"]}),"\n",(0,n.jsxs)(r.h4,{id:"flowgram-api",children:[(0,n.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#flowgram-api",children:"#"}),"flowgram API"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://github.com/bytedance/flowgram.ai/tree/main/packages/client/editor",rel:"noopener noreferrer",target:"_blank",children:(0,n.jsx)(r.strong,{children:"@flowgram.ai/editor"})})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"https://flowgram.ai/auto-docs/editor/modules/ASTMatch",rel:"noopener noreferrer",target:"_blank",children:(0,n.jsx)(r.code,{children:"ASTMatch"})}),": 用于匹配和判断 AST 节点类型的工具类"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"https://flowgram.ai/auto-docs/core/functions/definePluginCreator",rel:"noopener noreferrer",target:"_blank",children:(0,n.jsx)(r.code,{children:"definePluginCreator"})}),": 定义插件创建器的函数"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"https://flowgram.ai/auto-docs/editor/interfaces/GlobalEventActionType",rel:"noopener noreferrer",target:"_blank",children:(0,n.jsx)(r.code,{children:"GlobalEventActionType"})}),": 全局事件动作的类型定义"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"https://flowgram.ai/auto-docs/editor/classes/VariableEngine",rel:"noopener noreferrer",target:"_blank",children:(0,n.jsx)(r.code,{children:"VariableEngine"})}),": 变量引擎，负责管理和处理变量相关的操作"]}),"\n"]})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}={...(0,i.a)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["zh%2Fmaterials%2Fcommon%2Fdisable-declaration-plugin.mdx"]={toc:[{id:"案例演示",text:"案例演示",depth:2},{id:"基本使用",text:"基本使用",depth:3},{id:"api",text:"API",depth:2},{id:"createdisabledeclarationplugin",text:"createDisableDeclarationPlugin",depth:3},{id:"源码导读",text:"源码导读",depth:2},{id:"目录结构讲解",text:"目录结构讲解",depth:3},{id:"核心实现说明",text:"核心实现说明",depth:3},{id:"依赖梳理",text:"依赖梳理",depth:3},{id:"flowgram-api",text:"flowgram API",depth:4}],title:"DisableDeclarationPlugin",headingTitle:"DisableDeclarationPlugin",frontmatter:{}}},262343:function(e,r,s){s.d(r,{w:()=>c});var n=s(110239),i=s(908600),a=s(640898),l=s(176332),o=s(132288);let t=i.lazy(()=>Promise.all([s.e("386212"),s.e("133914"),s.e("227692"),s.e("838147"),s.e("933451"),s.e("942362"),s.e("917828"),s.e("428647"),s.e("135691"),s.e("46854"),s.e("232558"),s.e("673693"),s.e("51029")]).then(s.bind(s,261548)).then(e=>({default:e.VariableSelector}))),c=()=>(0,n.jsx)(o.y,{filterEndNode:!0,plugins:()=>[(0,l.O)()],formMeta:{render:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.p,{}),(0,n.jsx)(a.gNt,{name:"variable_selector",children:e=>{let{field:r}=e;return(0,n.jsx)(t,{value:r.value,onChange:e=>r.onChange(e)})}})]})}})},132288:function(e,r,s){s.d(r,{p:()=>l,y:()=>o});var n=s(110239),i=s(908600);let a=i.lazy(()=>Promise.all([s.e("386212"),s.e("133914"),s.e("227692"),s.e("933451"),s.e("917828"),s.e("428647"),s.e("135691"),s.e("46854"),s.e("690536")]).then(s.bind(s,654296)).then(e=>({default:e.FreeFormMetaStoryBuilder}))),l=i.lazy(()=>Promise.all([s.e("386212"),s.e("133914"),s.e("227692"),s.e("933451"),s.e("917828"),s.e("428647"),s.e("135691"),s.e("46854"),s.e("690536")]).then(s.bind(s,654296)).then(e=>({default:e.FormHeader}))),o=e=>(0,n.jsx)("div",{style:{position:"relative",height:e.height||400},children:(0,n.jsx)(a,{...e})})},176332:function(e,r,s){s.d(r,{O:()=>i});var n=s(950454);let i=(0,n.M1y)({onInit(e){let r=e.get(n.i2z),s=e=>{if(n.GwP.isVariableDeclaration(e.ast)){var r;(null==(r=e.ast.meta)?void 0:r.disabled)||e.ast.updateMeta({...e.ast.meta||{},disabled:!0})}};r.onGlobalEvent("NewAST",s),r.onGlobalEvent("UpdateAST",s)}})}}]);